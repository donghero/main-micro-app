<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>指南</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/freelog.ico">
    <meta name="description" content="freelog 开发者文档">
    
    <link rel="preload" href="/assets/css/0.styles.b4108987.css" as="style"><link rel="preload" href="/assets/js/app.7c30a442.js" as="script"><link rel="preload" href="/assets/js/2.733019b2.js" as="script"><link rel="preload" href="/assets/js/7.cad30a9a.js" as="script"><link rel="prefetch" href="/assets/js/3.39104db2.js"><link rel="prefetch" href="/assets/js/4.d12742be.js"><link rel="prefetch" href="/assets/js/5.216cae74.js"><link rel="prefetch" href="/assets/js/6.2d0a63f8.js"><link rel="prefetch" href="/assets/js/8.53aaf59a.js"><link rel="prefetch" href="/assets/js/9.6846600c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b4108987.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" aria-current="page" class="home-link router-link-exact-active router-link-active"><img src="/home.jpg" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  指南
</a></div><div class="nav-item"><a href="/api/" class="nav-link">
  API
</a></div><div class="nav-item"><a href="/faq/" class="nav-link">
  FAQ
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  指南
</a></div><div class="nav-item"><a href="/api/" class="nav-link">
  API
</a></div><div class="nav-item"><a href="/faq/" class="nav-link">
  FAQ
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/#介绍" class="sidebar-link">介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/#概念" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/#通俗解释" class="sidebar-link">通俗解释</a></li><li class="sidebar-sub-header"><a href="/#运行原理" class="sidebar-link">运行原理</a></li><li class="sidebar-sub-header"><a href="/#重要说明" class="sidebar-link">重要说明</a></li></ul></li><li><a href="/#示例节点代码仓" class="sidebar-link">示例节点代码仓</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/#基础使用案例代码仓" class="sidebar-link">基础使用案例代码仓</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/#框架准备" class="sidebar-link">框架准备</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/#支持框架" class="sidebar-link">支持框架</a></li><li class="sidebar-sub-header"><a href="/#生命周期" class="sidebar-link">生命周期</a></li><li class="sidebar-sub-header"><a href="/#webpack-通用配置" class="sidebar-link">webpack 通用配置</a></li><li class="sidebar-sub-header"><a href="/#vue2-配置示例" class="sidebar-link">Vue2 配置示例</a></li><li class="sidebar-sub-header"><a href="/#vue3-配置示例" class="sidebar-link">Vue3 配置示例</a></li><li class="sidebar-sub-header"><a href="/#react-配置示例" class="sidebar-link">React 配置示例</a></li><li class="sidebar-sub-header"><a href="/#jquery-配置" class="sidebar-link">jquery 配置</a></li><li class="sidebar-sub-header"><a href="/#静态文件处理" class="sidebar-link">静态文件处理</a></li><li class="sidebar-sub-header"><a href="/#路由支持" class="sidebar-link">路由支持</a></li><li class="sidebar-sub-header"><a href="/#配置总结" class="sidebar-link">配置总结</a></li></ul></li><li><a href="/#开发" class="sidebar-link">开发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/#https-证书准备-必须" class="sidebar-link">https 证书准备（必须）</a></li><li class="sidebar-sub-header"><a href="/#chrome-无法访问-localhost-问题" class="sidebar-link">chrome 无法访问 localhost 问题</a></li><li class="sidebar-sub-header"><a href="/#创建一个节点和主题" class="sidebar-link">创建一个节点和主题</a></li><li class="sidebar-sub-header"><a href="/#连接节点与插件" class="sidebar-link">连接节点与插件</a></li><li class="sidebar-sub-header"><a href="/#获取节点信息" class="sidebar-link">获取节点信息</a></li><li class="sidebar-sub-header"><a href="/#加载自身的子依赖插件" class="sidebar-link">加载自身的子依赖插件</a></li><li class="sidebar-sub-header"><a href="/#加载展品插件" class="sidebar-link">加载展品插件</a></li><li class="sidebar-sub-header"><a href="/#单独调试某个插件" class="sidebar-link">单独调试某个插件</a></li><li class="sidebar-sub-header"><a href="/#控制插件" class="sidebar-link">控制插件</a></li><li class="sidebar-sub-header"><a href="/#配置插件配置数据" class="sidebar-link">配置插件配置数据</a></li><li class="sidebar-sub-header"><a href="/#获取插件自身配置数据" class="sidebar-link">获取插件自身配置数据</a></li><li class="sidebar-sub-header"><a href="/#插件通信方式一-全局通信" class="sidebar-link">插件通信方式一：全局通信</a></li><li class="sidebar-sub-header"><a href="/#插件之间通信方式二-配置数据中传递-config" class="sidebar-link">插件之间通信方式二：配置数据中传递 config</a></li><li class="sidebar-sub-header"><a href="/#插件之间通信方式三-插件对外发布-api" class="sidebar-link">插件之间通信方式三：插件对外发布 api</a></li><li class="sidebar-sub-header"><a href="/#插件自身重载" class="sidebar-link">插件自身重载</a></li><li class="sidebar-sub-header"><a href="/#获取当前完整-url" class="sidebar-link">获取当前完整 URL</a></li><li class="sidebar-sub-header"><a href="/#移动端适配" class="sidebar-link">移动端适配</a></li></ul></li><li><a href="/#展品相关" class="sidebar-link">展品相关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/#获取展品" class="sidebar-link">获取展品</a></li><li class="sidebar-sub-header"><a href="/#获取单个展品详情" class="sidebar-link">获取单个展品详情</a></li><li class="sidebar-sub-header"><a href="/#获取展品作品" class="sidebar-link">获取展品作品</a></li><li class="sidebar-sub-header"><a href="/#展品子依赖列表" class="sidebar-link">展品子依赖列表</a></li><li class="sidebar-sub-header"><a href="/#批量查询展品依赖的作品信息" class="sidebar-link">批量查询展品依赖的作品信息</a></li><li class="sidebar-sub-header"><a href="/#获取子依赖作品文件" class="sidebar-link">获取子依赖作品文件</a></li><li class="sidebar-sub-header"><a href="/#查找展品签约数量" class="sidebar-link">查找展品签约数量</a></li><li class="sidebar-sub-header"><a href="/#批量查询展品授权" class="sidebar-link">批量查询展品授权</a></li><li class="sidebar-sub-header"><a href="/#批量查询展品是否可用-即能否提供给用户签约" class="sidebar-link">批量查询展品是否可用（即能否提供给用户签约）</a></li><li class="sidebar-sub-header"><a href="/#授权错误返回值" class="sidebar-link">授权错误返回值</a></li><li class="sidebar-sub-header"><a href="/#授权处理" class="sidebar-link">授权处理</a></li></ul></li><li><a href="/#用户相关" class="sidebar-link">用户相关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/#唤起登录" class="sidebar-link">唤起登录</a></li><li class="sidebar-sub-header"><a href="/#唤起退出登录" class="sidebar-link">唤起退出登录</a></li><li class="sidebar-sub-header"><a href="/#获取当前登录用户信息" class="sidebar-link">获取当前登录用户信息</a></li><li class="sidebar-sub-header"><a href="/#监听用户登录事件" class="sidebar-link">监听用户登录事件</a></li><li class="sidebar-sub-header"><a href="/#监听用户在其余页面切换账号或登录事件" class="sidebar-link">监听用户在其余页面切换账号或登录事件</a></li><li class="sidebar-sub-header"><a href="/#用户数据" class="sidebar-link">用户数据</a></li></ul></li><li><a href="/#打包上传" class="sidebar-link">打包上传</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="指南"><a href="#指南" class="header-anchor">#</a> 指南</h1> <h2 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h2> <h3 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h3> <p>在 Freelog 平台，插件是指作品类型为插件的功能性作品，一般作为主题的依赖在节点发挥作用，决定节点中内容型展品的访问、展示和交互方式。</p> <p>插件可以是一个播放器、一个图床、一个目录菜单或者一个小说阅读器。</p> <h3 id="通俗解释"><a href="#通俗解释" class="header-anchor">#</a> 通俗解释</h3> <p><strong>插件是一个运行在我司平台运行时的可管控的一个完整应用或组件</strong></p> <p><strong>后面出现的运行时皆指平台运行时</strong></p> <h3 id="运行原理"><a href="#运行原理" class="header-anchor">#</a> 运行原理</h3> <p><strong>插件打包后的文件是放在我司平台的，运行时通过解析 index.html 和修改 webpack_public_path 获取 js 和 css 等作品文件</strong></p> <p><strong>同时从 js 中获取导出的插件生命周期来启动、加载、卸载插件</strong></p> <h3 id="重要说明"><a href="#重要说明" class="header-anchor">#</a> 重要说明</h3> <p><strong>请不要在 html 当中直接引入 js，CDN 方式不支持，必须经过 webpack 约定配置后打包</strong></p> <h2 id="示例节点代码仓"><a href="#示例节点代码仓" class="header-anchor">#</a> 示例节点代码仓</h2> <p><a href="https://github.com/freelogfe/freelog-sample-themes.git" target="_blank" rel="noopener noreferrer">https://github.com/freelogfe/freelog-sample-themes.git<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="基础使用案例代码仓"><a href="#基础使用案例代码仓" class="header-anchor">#</a> 基础使用案例代码仓</h2> <p><a href="https://github.com/freelogfe/freelog-developer-guide-examples.git" target="_blank" rel="noopener noreferrer">https://github.com/freelogfe/freelog-developer-guide-examples.git<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="框架准备"><a href="#框架准备" class="header-anchor">#</a> 框架准备</h2> <h3 id="支持框架"><a href="#支持框架" class="header-anchor">#</a> 支持框架</h3> <p><strong>vue、react（两个框架都仅支持以 webpack 打包）,</strong> <strong>jquery</strong></p> <h3 id="生命周期"><a href="#生命周期" class="header-anchor">#</a> 生命周期</h3> <p><strong>平台运行时所需要入口文件 export 的三个生命周期，用来供平台启动准备、加载、卸载插件</strong></p> <div class="language- extra-class"><pre class="language-text"><code>bootstrap--&gt;mount--&gt;unmount

bootstrap: 加载未运行，目前不建议进行

mount: 放置插件启动代码

unmount: 将所有实例置为null，回收内存
</code></pre></div><h3 id="webpack-通用配置"><a href="#webpack-通用配置" class="header-anchor">#</a> webpack 通用配置</h3> <p><strong>webpack 属于唯一支持打包工具</strong></p> <p><strong>入口配置</strong></p> <p>由于插件所有文件都交给平台管理，平台运行时替代了类似 nginx 的功能，插件文件访问插件文件都通过运行时，例如 index.html 中的 js，css，或 js 中的图片</p> <p>运行时会替换 <strong>_ <strong>webpack_public_path</strong> _</strong> 让打包后的文件访问能指向正确的插件文件访问路径</p> <div class="language- extra-class"><pre class="language-text"><code>// 建一个包含一下内容的public-path.js文件，在应用入口文件开头引入

if (window.__POWERED_BY_FREELOG__) {
  // eslint-disable-next-line no-undef
  __webpack_public_path__ = window.__INJECTED_PUBLIC_PATH_BY_FREELOG__;
}
</code></pre></div><p><strong>打包配置文件配置</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 开发模式需配置headers</span>

devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    disableHostCheck<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    port<span class="token punctuation">,</span>
    overlay<span class="token operator">:</span> <span class="token punctuation">{</span>
        warnings<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        errors<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    headers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'Access-Control-Allow-Origin'</span><span class="token operator">:</span> <span class="token string">'*'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 将以下属性合并到webpack配置当中 其中name是package.json中的name，自行引入</span>
output<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 把子应用打包成 umd 库格式</span>
    library<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-[name]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    libraryTarget<span class="token operator">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span>
    jsonpFunction<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">webpackJsonp_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token comment">// webpack5使用chunkLoadingGlobal: `webpackJsonp${name}`</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="vue2-配置示例"><a href="#vue2-配置示例" class="header-anchor">#</a> Vue2 配置示例</h3> <p><strong>入口配置</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token string">&quot;./public-path&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ElementUI <span class="token keyword">from</span> <span class="token string">&quot;element-ui&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;element-ui/lib/theme-chalk/index.css&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">&quot;vue-router&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;./App.vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> routes <span class="token keyword">from</span> <span class="token string">&quot;./router&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">&quot;./store&quot;</span><span class="token punctuation">;</span>

Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ElementUI<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> router <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span>props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> container <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    base<span class="token operator">:</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">&quot;history&quot;</span><span class="token punctuation">,</span>
    routes<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    router<span class="token punctuation">,</span>
    store<span class="token punctuation">,</span>
    <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span>container <span class="token operator">?</span> container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>__POWERED_BY_FREELOG__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">storeTest</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  props<span class="token punctuation">.</span>onGlobalStateChange <span class="token operator">&amp;&amp;</span>
    props<span class="token punctuation">.</span><span class="token function">onGlobalStateChange</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span>value<span class="token punctuation">,</span> prev<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[onGlobalStateChange - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]:</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> prev<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token boolean">true</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  props<span class="token punctuation">.</span>setGlobalState <span class="token operator">&amp;&amp;</span>
    props<span class="token punctuation">.</span><span class="token function">setGlobalState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      ignore<span class="token operator">:</span> props<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
      user<span class="token operator">:</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> props<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;[vue] vue app bootstraped&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;[vue] props from main framework&quot;</span><span class="token punctuation">,</span> props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">storeTest</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  instance<span class="token punctuation">.</span><span class="token function">$destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  instance<span class="token punctuation">.</span>$el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
  instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  router <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>webpack 配置</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&quot;./package&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> webpackPlugin <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-mkcert&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">7101</span><span class="token punctuation">;</span> <span class="token comment">// dev port</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&quot;@vue/cli-service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// https 插件 需要安装</span>
<span class="token keyword">const</span> webpackPlugin <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-mkcert&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">7105</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> https <span class="token operator">=</span> <span class="token keyword">await</span> webpackPlugin<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    force<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    source<span class="token operator">:</span> <span class="token string">&quot;coding&quot;</span><span class="token punctuation">,</span>
    hosts<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * You will need to set publicPath if you plan to deploy your site under a sub path,
     * for example GitHub Pages. If you plan to deploy your site to https://foo.github.io/bar/,
     * then publicPath should be set to &quot;/bar/&quot;.
     * In most cases please use '/' !!!
     * Detail: https://cli.vuejs.org/config/#publicpath
     */</span>
    outputDir<span class="token operator">:</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">,</span>
    assetsDir<span class="token operator">:</span> <span class="token string">&quot;static&quot;</span><span class="token punctuation">,</span>
    filenameHashing<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    https<span class="token punctuation">,</span>
    <span class="token comment">// tweak internal webpack configuration.</span>
    <span class="token comment">// see https://github.com/vuejs/vue-cli/blob/dev/docs/webpack.md</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// host: '0.0.0.0',</span>
      hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      disableHostCheck<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      port<span class="token punctuation">,</span>
      overlay<span class="token operator">:</span> <span class="token punctuation">{</span>
        warnings<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        errors<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      headers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;Access-Control-Allow-Origin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 自定义webpack配置</span>
    configureWebpack<span class="token operator">:</span> <span class="token punctuation">{</span>
      resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
        alias<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;@&quot;</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      output<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 把子应用打包成 umd 库格式</span>
        library<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-[name]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        libraryTarget<span class="token operator">:</span> <span class="token string">&quot;umd&quot;</span><span class="token punctuation">,</span>
        jsonpFunction<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">webpackJsonp_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token comment">// webpack5使用chunkLoadingGlobal: `webpackJsonp${name}`</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="vue3-配置示例"><a href="#vue3-配置示例" class="header-anchor">#</a> Vue3 配置示例</h3> <p><strong>入口配置</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token string">&quot;./public-path&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 入口配置</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createRouter<span class="token punctuation">,</span> createWebHistory <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue-router&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;./App.vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> routes <span class="token keyword">from</span> <span class="token string">&quot;./router&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">&quot;./store&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> router <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span>props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> container <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  router <span class="token operator">=</span> <span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    history<span class="token operator">:</span> <span class="token function">createWebHistory</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    routes<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  instance <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>
  instance<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">;</span>
  instance<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span><span class="token punctuation">;</span>
  instance<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span>container <span class="token operator">?</span> container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>__POWERED_BY_FREELOG__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;%c &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;color: green;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;vue3.0 app bootstraped&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">storeTest</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  instance<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span>$onGlobalStateChange <span class="token operator">=</span>
    props<span class="token punctuation">.</span>onGlobalStateChange<span class="token punctuation">;</span>
  instance<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span>$setGlobalState <span class="token operator">=</span> props<span class="token punctuation">.</span>setGlobalState<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  instance<span class="token punctuation">.</span><span class="token function">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  instance<span class="token punctuation">.</span>_container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
  instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  router <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 插件通信功能</span>
<span class="token keyword">function</span> <span class="token function">storeTest</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  props<span class="token punctuation">.</span>onGlobalStateChange <span class="token operator">&amp;&amp;</span>
    props<span class="token punctuation">.</span><span class="token function">onGlobalStateChange</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span>value<span class="token punctuation">,</span> prev<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[onGlobalStateChange - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]:</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> prev<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token boolean">true</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  props<span class="token punctuation">.</span>setGlobalState <span class="token operator">&amp;&amp;</span>
    props<span class="token punctuation">.</span><span class="token function">setGlobalState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      ignore<span class="token operator">:</span> props<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
      user<span class="token operator">:</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> props<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>webpack 配置</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&quot;./package&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&quot;@vue/cli-service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// https 插件 需要安装</span>
<span class="token keyword">const</span> webpackPlugin <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-mkcert&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">7105</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> https <span class="token operator">=</span> <span class="token keyword">await</span> webpackPlugin<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    force<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    source<span class="token operator">:</span> <span class="token string">&quot;coding&quot;</span><span class="token punctuation">,</span>
    hosts<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>https<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    transpileDependencies<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    outputDir<span class="token operator">:</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">,</span>
    assetsDir<span class="token operator">:</span> <span class="token string">&quot;static&quot;</span><span class="token punctuation">,</span>
    filenameHashing<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
      https<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// ca: './path/to/server.pem',</span>
        <span class="token comment">// pfx: './path/to/server.pfx',</span>
        <span class="token comment">// key: './path/to/server.key',</span>
        <span class="token comment">// cert: './path/to/server.crt',</span>
        <span class="token comment">// passphrase: 'webpack-dev-server',</span>
        <span class="token comment">// requestCert: true,</span>
        <span class="token operator">...</span>https<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      port<span class="token punctuation">,</span>
      headers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;Access-Control-Allow-Origin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 自定义webpack配置</span>
    configureWebpack<span class="token operator">:</span> <span class="token punctuation">{</span>
      resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
        alias<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;@&quot;</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      output<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 把子应用打包成 umd 库格式</span>
        library<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-[name]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        libraryTarget<span class="token operator">:</span> <span class="token string">&quot;umd&quot;</span><span class="token punctuation">,</span>
        chunkLoadingGlobal<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">webpackJsonp_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="react-配置示例"><a href="#react-配置示例" class="header-anchor">#</a> React 配置示例</h3> <p><strong>入口配置</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">&quot;react-dom&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;./index.scss&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;./App&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> reportWebVitals <span class="token keyword">from</span> <span class="token string">&quot;./reportWebVitals&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;./public-path&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;./utils/flexible&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// If you want to start measuring performance in your app, pass a function</span>
<span class="token comment">// to log results (for example: reportWebVitals(console.log))</span>
<span class="token comment">// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals</span>
<span class="token function">reportWebVitals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;[react17] react app bootstraped&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//     &lt;/React.StrictMode&gt;,</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span>props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> container <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">unmount</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> container <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  ReactDOM<span class="token punctuation">.</span><span class="token function">unmountComponentAtNode</span><span class="token punctuation">(</span>
    container
      <span class="token operator">?</span> container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#root&quot;</span><span class="token punctuation">)</span>
      <span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>__POWERED_BY_FREELOG__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>mount<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>create react app 创建项目的配置</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code> <span class="token operator">**</span>通过npm run eject<span class="token punctuation">,</span> 释放出webpack配置<span class="token operator">**</span>

  <span class="token operator">**</span><span class="token operator">*</span>webpack 配置<span class="token operator">**</span><span class="token operator">*</span>
  <span class="token comment">/**
    *
    * 修改webpack.config.js
    * output处添加三个属性，name为package.json的name
    */</span>
      library<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-[name]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      libraryTarget<span class="token operator">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span>
      jsonpFunction<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">webpackJsonp_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token comment">// webpack5使用chunkLoadingGlobal: `webpackJsonp${name}`</span>
  <span class="token comment">/**
    * 修改webpackDevServer.config.js
    * 添加跨域headers
    */</span>
    port<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span><span class="token punctuation">,</span>
    headers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'Access-Control-Allow-Origin'</span><span class="token operator">:</span> <span class="token string">'*'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token operator">**</span><span class="token operator">*</span>热更新配置<span class="token operator">**</span><span class="token operator">*</span>
  <span class="token comment">/**
    * 修改env.js
    * 添加websocket所需的
    */</span>
     process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">=</span> <span class="token string">'7102'</span> <span class="token comment">// 端口自行定</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">WDS_SOCKET_HOST</span> <span class="token operator">=</span> <span class="token string">'localhost'</span>
      process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">WDS_SOCKET_PATH</span> <span class="token operator">=</span> <span class="token string">'localhost:'</span><span class="token operator">+</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token comment">// webpack5设置为空 ''</span>
      process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">WDS_SOCKET_PORT</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span>
    <span class="token punctuation">}</span>
  <span class="token operator">**</span><span class="token operator">*</span>热更白屏问题处理<span class="token operator">**</span><span class="token operator">*</span>
  <span class="token comment">// 把html中根节点的同级iframe隐藏</span>
  <span class="token comment">/**  #root~iframe{
        display: none !important;
    }
  */</span>
</code></pre></div><h3 id="jquery-配置"><a href="#jquery-配置" class="header-anchor">#</a> jquery 配置</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// entry.js  在index.html中引入</span>
<span class="token keyword">const</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span>$<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#purehtml-container&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, render with jQuery&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token punctuation">(</span>global<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  global<span class="token punctuation">[</span><span class="token string">&quot;purehtml&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">bootstrap</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;purehtml bootstrap&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">mount</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;purehtml mount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">render</span><span class="token punctuation">(</span>$<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">unmount</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;purehtml unmount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="静态文件处理"><a href="#静态文件处理" class="header-anchor">#</a> 静态文件处理</h3> <p><strong>打包之后 css 中的字体文件和图片加载 404</strong></p> <p>原因是 freelog 将外链样式改成了内联样式，但是字体文件和背景图片的加载路径是相对路径。</p> <p>而 css 文件一旦打包完成，就无法通过动态修改 publicPath 来修正其中的字体文件和背景图片的路径。</p> <p>解决方案：</p> <ol><li><p>大图片与大字体处理方式：</p> <p>大图片：放在不需要 webpack 打包的 public 目录下，通过 <strong>window.freelogApp.getStaticPath(path)</strong> 获取正确地址，
其中 path 为以/开头的正常开发时的路径。</p> <p>大字体：（暂未实现）如果路径写在 css 中则无需刻意放在 public 目录下，如果使用 js 去赋值，则同图片一样处理。</p></li> <li><p>小文件处理方式：借助 webpack 的 url-loader 将字体文件和图片打包成 base64（适用于字体文件和图片体积小的项目）</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif|webp|woff2?|eot|ttf|otf)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>vue-cli3 项目写法：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">chainWebpack</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>module
      <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">&quot;fonts&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span><span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    config<span class="token punctuation">.</span>module
      <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">&quot;images&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span><span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">options</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>vue-cli3 项目可以将 css 打包到 js 里面，不单独生成文件(不推荐，仅适用于 css 较少的项目)</strong></p> <p>配置参考 <a href="https://cli.vuejs.org/zh/config/#css-extract" target="_blank" rel="noopener noreferrer">vue-cli3 官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">css</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">extract</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="路由支持"><a href="#路由支持" class="header-anchor">#</a> 路由支持</h3> <p><strong>仅支持 history 路由或不由运行时管的 abstract 路由，hash 路由还有问题需要改进</strong></p> <h3 id="配置总结"><a href="#配置总结" class="header-anchor">#</a> 配置总结</h3> <p><strong>由于运行时是通过 index.html 解析获取 js，css 文件，再进行运行插件的</strong></p> <p><strong>所以:</strong></p> <p><strong>1.让运行时具备动态修改的</strong><em>webpack_public_path</em><strong>的能力</strong></p> <p><strong>2.将 js 打包成库，让运行时能够获取到 bootstrap,mount,unmount 来启动卸载插件</strong></p> <h2 id="开发"><a href="#开发" class="header-anchor">#</a> 开发</h2> <h3 id="https-证书准备-必须"><a href="#https-证书准备-必须" class="header-anchor">#</a> https 证书准备（必须）</h3> <p><strong>由于浏览器安全限制，本地开发需要本地以 https 启动</strong></p> <p>参考 webpack-mkcert 工具</p> <p><a href="https://www.npmjs.com/package/webpack-mkcert" target="_blank" rel="noopener noreferrer">https://www.npmjs.com/package/webpack-mkcert<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="chrome-无法访问-localhost-问题"><a href="#chrome-无法访问-localhost-问题" class="header-anchor">#</a> chrome 无法访问 localhost 问题</h3> <p>地址栏输入：chrome://flags/#block-insecure-private-network-requests</p> <p>把 Block insecure private network requests. 设置为 disabled</p> <p>如图
<img src="/chrome.png" alt="chrome"></p> <h3 id="创建一个节点和主题"><a href="#创建一个节点和主题" class="header-anchor">#</a> 创建一个节点和主题</h3> <p>进入 console.freelog.com ---&gt; 节点管理</p> <p>创建节点后必须建一个主题作品并签约激活</p> <p>假设节点为https://snnaenu.freelog.com/</p> <p>用于开发的测试节点为https://t.snnaenu.freelog.com/</p> <h3 id="连接节点与插件"><a href="#连接节点与插件" class="header-anchor">#</a> 连接节点与插件</h3> <p>启动插件，例如‘https://localhost:7101’</p> <p>在节点 url 的https://t.snnaenu.freelog.com/后面加上</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token string">&quot;https://t.snnaenu.freelog.com/?dev=https://localhost:7101&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>此时插件是作为节点主题（即入口）使用</p> <h3 id="获取节点信息"><a href="#获取节点信息" class="header-anchor">#</a> 获取节点信息</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 目前没有权限控制，主题和插件都可以获取到，后期整体考虑权限时会限制插件使用</span>
<span class="token comment">// 如果使用到了节点信息，插件开发者应当在使用说明里明确使用到了节点信息以及无法获取到的影响</span>
<span class="token keyword">const</span> nodeInfo <span class="token operator">=</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span>nodeInfo<span class="token punctuation">;</span>
</code></pre></div><h3 id="加载自身的子依赖插件"><a href="#加载自身的子依赖插件" class="header-anchor">#</a> 加载自身的子依赖插件</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> subData <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getSubDep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 示范代码，这里只加载一个</span>
subData<span class="token punctuation">.</span>subDep<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sub<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> widgetController <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">mountWidget</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    widget<span class="token operator">:</span> sub<span class="token punctuation">,</span> <span class="token comment">// 必传，子插件数据</span>
    container<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;freelog-single&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 必传，自定义一个让插件挂载的div容器</span>
    topExhibitData<span class="token operator">:</span> subData<span class="token punctuation">,</span> <span class="token comment">// 必传，最外层展品数据（子孙插件都需要用）</span>
    config<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 子插件配置数据，需要另外获取作品上的配置数据</span>
    seq<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token comment">// 如果要用多个同样的子插件需要传递序号，可以考虑与其余节点插件避免相同的序号, 注意用户数据是根据插件id+序号保存的。</span>
    widget_entry<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token comment">// 本地url，dev模式下，可以使用本地url调试子插件</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="加载展品插件"><a href="#加载展品插件" class="header-anchor">#</a> 加载展品插件</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getExhibitListById</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  articleResourceTypes<span class="token operator">:</span> <span class="token string">&quot;widget&quot;</span><span class="token punctuation">,</span>
  isLoadVersionProperty<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> widgets <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>dataList<span class="token punctuation">;</span>
<span class="token comment">// 示范代码，这里只加载一个</span>
widgets<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token punctuation">(</span>widget<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> widgetController <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">mountWidget</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    widget<span class="token operator">:</span> widget<span class="token punctuation">,</span>
    container<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;freelog-single&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 给每一个提供不同的容器</span>
    topExhibitData<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    config<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    seq<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    widget_entry<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="单独调试某个插件"><a href="#单独调试某个插件" class="header-anchor">#</a> 单独调试某个插件</h3> <p>当需要跳过主题直接调试正在运行的子插件或展品插件</p> <p>定义： <code>${url}?dev=replace&amp;${widgetId}=${local_entry}</code></p> <p>url: 节点地址</p> <p>widgetId: 插件 ID 这里用的是插件的作品 ID: articleId
获取方式：插件内可以通过 freelogApp.getSelfId()获取，但先有鸡才能有蛋，后续要在作品管理页面以及测试节点提供获取途径。
目前开发者可以 F12 去找一下。</p> <p>local_entry: 本地地址</p> <p>举例：</p> <div class="language-ts extra-class"><pre class="language-ts"><code>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>nes<span class="token operator">-</span>common<span class="token punctuation">.</span>freelog<span class="token punctuation">.</span>com<span class="token operator">/</span><span class="token operator">?</span>dev<span class="token operator">=</span>replace<span class="token operator">&amp;</span>62270c5cf670b2002e800193<span class="token operator">=</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">localhost:7107</span><span class="token regex-delimiter">/</span></span>
</code></pre></div><h3 id="控制插件"><a href="#控制插件" class="header-anchor">#</a> 控制插件</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">let</span> widgetController <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span>mountWidget

widgetController<span class="token operator">:</span> <span class="token punctuation">{</span>
  mount
  unmount
  update
  getStatus
  loadPromise
  bootstrapPromise
  mountPromise
  unmountPromise
  getApi
<span class="token punctuation">}</span>

<span class="token operator">**</span> 使用说明 <span class="token operator">**</span>

<span class="token function">unmount</span><span class="token punctuation">(</span> keeplocation<span class="token operator">:</span> Boolean<span class="token punctuation">)</span> 卸载插件，返回一个promise。 keeplocation： 布尔值 是否保持url（即路由），<span class="token boolean">false</span>不保持时该插件对应的url清空

<span class="token function">mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  可用于卸载后重新加载插件，返回一个promise

<span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 返回一个字符串代表插件的状态。所有状态如下：
    <span class="token constant">NOT_BOOTSTRAPPED</span><span class="token operator">:</span> 未初始化
    <span class="token constant">BOOTSTRAPPING</span><span class="token operator">:</span> 初始化中
    <span class="token constant">NOT_MOUNTED</span><span class="token operator">:</span> 完成初始化，未挂载
    <span class="token constant">MOUNTED</span><span class="token operator">:</span> 激活状态，且已挂载至<span class="token constant">DOM</span>
    <span class="token constant">UNMOUNTING</span><span class="token operator">:</span> 卸载中
    <span class="token constant">SKIP_BECAUSE_BROKEN</span><span class="token operator">:</span> 在初始化、挂载、卸载或更新时发生异常。其他插件可能会被正常使用，但当前插件会被跳过。

loadPromise  <span class="token function">一个promise，当插件被装载</span><span class="token punctuation">(</span>loaded<span class="token punctuation">)</span>后resolve。

bootstrapPromise 一个promise，当插件初始化后resolve。

mountPromise  一个promise，当插件加载后resolve。通常用于检测插件生成的<span class="token constant">DOM</span>是否已经挂载。

unmountPromise 一个promise，当插件卸载后resolve。

<span class="token function">getApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   在子插件加载完成后 <span class="token function">使用getApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>方法获取子插件的对外api， 由于子插件可能自己重载、或操作子插件重载，每次调用都需要使用方法获取，不能直接获取，
</code></pre></div><h3 id="配置插件配置数据"><a href="#配置插件配置数据" class="header-anchor">#</a> 配置插件配置数据</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 通过作品或展品的meta属性配置指定key作为配置数据, 目前运行时占用的key如下（皆为默认值）</span>
hbfOnlyToTheme<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 历史记录整体前进后退是否只给主题权限</span>
historyFB<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 历史记录整体前进后退是否有权限</span>
</code></pre></div><h3 id="获取插件自身配置数据"><a href="#获取插件自身配置数据" class="header-anchor">#</a> 获取插件自身配置数据</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 父插件的传递过来的config数据也会在这里</span>
<span class="token keyword">const</span> widgetConfig <span class="token operator">=</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getSelfConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="插件通信方式一-全局通信"><a href="#插件通信方式一-全局通信" class="header-anchor">#</a> 插件通信方式一：全局通信</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">**</span>在入口处通过props修改与监听全局数据<span class="token operator">**</span>
<span class="token keyword">const</span> freelogApp <span class="token operator">=</span> window<span class="token punctuation">.</span>freelogApp
<span class="token comment">// 主题独有方法，但主题可以传递给插件使用</span>
<span class="token comment">// 初始化全局数据，只能修改不能添加, 例如可以修改a:{} 为对象，但不能添加同级的b、c、d</span>
freelogApp<span class="token punctuation">.</span><span class="token function">initGlobalState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 通过mount函数传递进来props 访问监听与设置的方法</span>
<span class="token keyword">function</span> <span class="token function">storeTest</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  props<span class="token punctuation">.</span>onGlobalStateChange <span class="token operator">&amp;&amp;</span>
    props<span class="token punctuation">.</span><span class="token function">onGlobalStateChange</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span>value<span class="token punctuation">,</span> prev<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[onGlobalStateChange - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]:</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> prev<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token boolean">true</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  props<span class="token punctuation">.</span>setGlobalState <span class="token operator">&amp;&amp;</span>
    props<span class="token punctuation">.</span><span class="token function">setGlobalState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      ignore<span class="token operator">:</span> props<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
      user<span class="token operator">:</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> props<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;[vue] props from main framework&quot;</span><span class="token punctuation">,</span> props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">storeTest</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 函数说明</span>
props<span class="token punctuation">.</span><span class="token function">setGlobalState</span><span class="token punctuation">(</span>obj<span class="token operator">:</span> 自定义对象<span class="token punctuation">)</span>：
props<span class="token punctuation">.</span><span class="token function">onGlobalStateChange</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token operator">:</span> 当前状态<span class="token punctuation">,</span> prevState<span class="token operator">:</span> 前数据<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span> fireImmediately<span class="token operator">:</span>是否立即执行<span class="token punctuation">)</span>
</code></pre></div><h3 id="插件之间通信方式二-配置数据中传递-config"><a href="#插件之间通信方式二-配置数据中传递-config" class="header-anchor">#</a> 插件之间通信方式二：配置数据中传递 config</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">**</span>在config中传递数据或方法提供给子插件访问，同时子插件可以通过调用方法传递数据给父插件<span class="token operator">**</span>
<span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">mountWidget</span><span class="token punctuation">(</span>
  sub<span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;freelog-single&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  subData<span class="token punctuation">,</span>
  config<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 子插件配置数据，这里会和子插件自身数据合并，必须为对象</span>
  seq<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token comment">// 如果要用多个同样的子插件需要传递序号，可以考虑与其余节点插件避免相同的序号</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="插件之间通信方式三-插件对外发布-api"><a href="#插件之间通信方式三-插件对外发布-api" class="header-anchor">#</a> 插件之间通信方式三：插件对外发布 api</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 子插件在mount时使用props.resisterApi注册api</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mount</span><span class="token punctuation">(</span>props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> container <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  props<span class="token punctuation">.</span><span class="token function">registerApi</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 这个对象会给到父插件</span>
    <span class="token function-variable function">show</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    container
      <span class="token operator">?</span> container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#root&quot;</span><span class="token punctuation">)</span>
      <span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#root&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 在子插件加载完成后，父插件可以使用app.getApi() 获取子插件的api</span>
app<span class="token punctuation">.</span>mountPromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  app<span class="token punctuation">.</span><span class="token function">getApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="插件自身重载"><a href="#插件自身重载" class="header-anchor">#</a> 插件自身重载</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 目前重载后挂载在window的数据没变，后期增加参数可选是否保留，以及返回重载失败可由插件决定是否刷新页面、但需要主题授权</span>
window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="获取当前完整-url"><a href="#获取当前完整-url" class="header-anchor">#</a> 获取当前完整 URL</h3> <div class="language-ts extra-class"><pre class="language-ts"><code>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>currentURL<span class="token punctuation">;</span>
</code></pre></div><h3 id="移动端适配"><a href="#移动端适配" class="header-anchor">#</a> 移动端适配</h3> <p><strong>除媒体查询外，支持最新的问题最少的最好的 viewport 兼容方案</strong></p> <p><strong>推荐使用 postcss-px-to-viewport 插件, 各框架具体使用方法请百度</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token operator">**</span>viewport修改用法<span class="token operator">**</span>
window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">setViewport</span><span class="token punctuation">(</span>keys<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span>
keys <span class="token operator">=</span> <span class="token punctuation">{</span>
  width<span class="token operator">:</span> <span class="token string">&quot;device-width&quot;</span><span class="token punctuation">,</span> <span class="token comment">// immutable</span>
  height<span class="token operator">:</span> <span class="token string">&quot;device-height&quot;</span><span class="token punctuation">,</span> <span class="token comment">// not supported in browser</span>
  <span class="token string-property property">&quot;initial-scale&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 0.0-10.0   available for theme</span>
  <span class="token string-property property">&quot;maximum-scale&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 0.0-10.0   available for theme</span>
  <span class="token string-property property">&quot;minimum-scale&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 0.0-10.0   available for theme</span>
  <span class="token string-property property">&quot;user-scalable&quot;</span><span class="token operator">:</span> <span class="token string">&quot;no&quot;</span><span class="token punctuation">,</span> <span class="token comment">// available for theme</span>
  <span class="token string-property property">&quot;viewport-fit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;auto&quot;</span><span class="token punctuation">,</span> <span class="token comment">// not supported in browser</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="展品相关"><a href="#展品相关" class="header-anchor">#</a> 展品相关</h2> <h3 id="获取展品"><a href="#获取展品" class="header-anchor">#</a> 获取展品</h3> <p><strong>分页列表</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getExhibitListByPaging</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  skip<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  limit<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a href="/api/#getexhibitlistbypaging">查看 getExhibitListByPaging 详情</a></p> <p><strong>查找展品</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> res <span class="token operator">=</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getExhibitListById</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span>

<span class="token operator">**</span>参数说明<span class="token operator">**</span>
  query<span class="token operator">:</span><span class="token punctuation">{</span>
    exhibitIds<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>  展品ids 多个使用<span class="token string">&quot;,&quot;</span>隔开
    isLoadVersionProperty<span class="token operator">:</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">,</span> 可选，是否加载版本信息<span class="token punctuation">,</span>默认<span class="token number">0</span>
  <span class="token punctuation">}</span>
</code></pre></div><p><a href="/api/#getexhibitlistbyid">查看 getExhibitListById 详情</a></p> <h3 id="获取单个展品详情"><a href="#获取单个展品详情" class="header-anchor">#</a> 获取单个展品详情</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span>  window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getExhibitInfo</span><span class="token punctuation">(</span>exhibitId<span class="token punctuation">,</span> query<span class="token punctuation">)</span>

<span class="token operator">**</span>参数说明<span class="token operator">**</span>
  exhibitId<span class="token operator">:</span> 展品id，
  query<span class="token operator">:</span><span class="token punctuation">{</span>
      isLoadVersionProperty<span class="token operator">:</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 是否需要展品版本属性</span>
  <span class="token punctuation">}</span>
</code></pre></div><p><a href="/api/#getexhibitinfo">查看 getExhibitInfo 详情</a></p> <h3 id="获取展品作品"><a href="#获取展品作品" class="header-anchor">#</a> 获取展品作品</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getExhibitFileStream</span><span class="token punctuation">(</span>
  exhibitId<span class="token punctuation">,</span>
  options
<span class="token punctuation">)</span>

<span class="token operator">**</span>参数说明<span class="token operator">**</span>
  exhibitId<span class="token operator">:</span> <span class="token comment">// 展品id，</span>
  options<span class="token operator">:</span> <span class="token punctuation">{</span>
    returnUrl<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span> <span class="token comment">// 是否只返回url， 例如img标签图片只需要url</span>
    config<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span> <span class="token comment">// axios的config 目前仅支持&quot;onUploadProgress&quot;, &quot;onDownloadProgress&quot;, &quot;responseType&quot;</span>
    subFilePath<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// 漫画中的图片等子文件的路径</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="展品子依赖列表"><a href="#展品子依赖列表" class="header-anchor">#</a> 展品子依赖列表</h3> <p><strong>在 获取展品 与 获取单个展品详情 接口返回数据中</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code>  <span class="token operator">**</span>如下所示，数组versionInfo<span class="token punctuation">.</span>dependencyTree就是该展品的所有子孙依赖列表<span class="token operator">**</span>
  <span class="token operator">**</span>第一个为自身，通过自身的nid去找出parentNid为该nid的依赖即为直接子依赖<span class="token operator">**</span>
  <span class="token punctuation">{</span>
	<span class="token string-property property">&quot;ret&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token string-property property">&quot;errCode&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token string-property property">&quot;errcode&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token string-property property">&quot;msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span>
	<span class="token string-property property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token string-property property">&quot;exhibitId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;61b99394c9dacc002e9f5821&quot;</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
		<span class="token string-property property">&quot;versionInfo&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token string-property property">&quot;exhibitId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;61b99394c9dacc002e9f5821&quot;</span><span class="token punctuation">,</span>
			<span class="token string-property property">&quot;exhibitProperty&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token string-property property">&quot;fileSize&quot;</span><span class="token operator">:</span> <span class="token number">6234</span><span class="token punctuation">,</span>
				<span class="token string-property property">&quot;mime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text/markdown&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string-property property">&quot;dependencyTree&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
				<span class="token string-property property">&quot;nid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;61b99394c9da&quot;</span><span class="token punctuation">,</span>
				<span class="token string-property property">&quot;articleId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;61b993157841ed002e5c96ca&quot;</span><span class="token punctuation">,</span>
				<span class="token string-property property">&quot;articleName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ZhuC/测试md&quot;</span><span class="token punctuation">,</span>
				<span class="token string-property property">&quot;articleType&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
				<span class="token string-property property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.1.1&quot;</span><span class="token punctuation">,</span>
				<span class="token string-property property">&quot;versionRange&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.1.1&quot;</span><span class="token punctuation">,</span>
				<span class="token string-property property">&quot;resourceType&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;markdown&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
				<span class="token string-property property">&quot;versionId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0d786f5b273bc549454b55ea649569a3&quot;</span><span class="token punctuation">,</span>
				<span class="token string-property property">&quot;deep&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
				<span class="token string-property property">&quot;parentNid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
				<span class="token string-property property">&quot;nid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;9091f75e23fb&quot;</span><span class="token punctuation">,</span>
				<span class="token string-property property">&quot;articleId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;61b9a82f2ae3ac002eb7993a&quot;</span><span class="token punctuation">,</span>
				<span class="token string-property property">&quot;articleName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ZhuC/元宇宙&quot;</span><span class="token punctuation">,</span>
				<span class="token string-property property">&quot;articleType&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
				<span class="token string-property property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.1.0&quot;</span><span class="token punctuation">,</span>
				<span class="token string-property property">&quot;versionRange&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.1.0&quot;</span><span class="token punctuation">,</span>
				<span class="token string-property property">&quot;resourceType&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;video&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
				<span class="token string-property property">&quot;versionId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;85fa350f4d003d0adea1fffc2852891d&quot;</span><span class="token punctuation">,</span>
				<span class="token string-property property">&quot;deep&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
				<span class="token string-property property">&quot;parentNid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;61b99394c9da&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">]</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="批量查询展品依赖的作品信息"><a href="#批量查询展品依赖的作品信息" class="header-anchor">#</a> 批量查询展品依赖的作品信息</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getExhibitDepInfo</span><span class="token punctuation">(</span>
  exhibitId<span class="token punctuation">,</span>
  articleNids
<span class="token punctuation">)</span>
<span class="token operator">**</span>参数说明<span class="token operator">**</span>
  exhibitId<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">,</span>  自身展品id
  articleNids<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> 链路id
</code></pre></div><h3 id="获取子依赖作品文件"><a href="#获取子依赖作品文件" class="header-anchor">#</a> 获取子依赖作品文件</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getExhibitDepFileStream</span><span class="token punctuation">(</span>
  exhibitId<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">,</span>
  parentNid<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  subArticleIdOrName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  returnUrl<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">,</span>
  config<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span>
<span class="token punctuation">)</span>

<span class="token operator">**</span>参数说明<span class="token operator">**</span>
  exhibitId<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">,</span> <span class="token comment">// 自身展品id</span>
  parentNid<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>    <span class="token comment">// 自身链路id</span>
  subArticleIdOrName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token comment">// 子依赖作品id或名称</span>
  returnUrl<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">,</span> <span class="token comment">// 是否只返回url， 例如img标签图片只需要url</span>
  config<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token comment">// axios的config 目前仅支持&quot;onUploadProgress&quot;, &quot;onDownloadProgress&quot;, &quot;responseType&quot;</span>
</code></pre></div><h3 id="查找展品签约数量"><a href="#查找展品签约数量" class="header-anchor">#</a> 查找展品签约数量</h3> <p><strong>同一个用户的多次签约只计算一次</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getExhibitSignCount</span><span class="token punctuation">(</span>
  exhibitIds<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">)</span>

<span class="token operator">**</span>参数说明<span class="token operator">**</span>
  exhibitIds<span class="token operator">:</span> 用英文逗号隔开的展品id
</code></pre></div><h3 id="批量查询展品授权"><a href="#批量查询展品授权" class="header-anchor">#</a> 批量查询展品授权</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getExhibitAuthStatus</span><span class="token punctuation">(</span>
  exhibitIds<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">)</span>

<span class="token operator">**</span>参数说明<span class="token operator">**</span>
  exhibitIds<span class="token operator">:</span>  用英文逗号隔开的展品id
</code></pre></div><h3 id="批量查询展品是否可用-即能否提供给用户签约"><a href="#批量查询展品是否可用-即能否提供给用户签约" class="header-anchor">#</a> 批量查询展品是否可用（即能否提供给用户签约）</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getExhibitAvailalbe</span><span class="token punctuation">(</span>
  exhibitIds<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">)</span>

<span class="token operator">**</span>参数说明<span class="token operator">**</span>
  exhibitIds<span class="token operator">:</span>  用英文逗号隔开的展品id
</code></pre></div><p><a href="/api/#getexhibitavailalbe">查看 getexhibitavailalbe 详情</a></p> <h3 id="授权错误返回值"><a href="#授权错误返回值" class="header-anchor">#</a> 授权错误返回值</h3> <div class="language-ts extra-class"><pre class="language-ts"><code>  <span class="token operator">**</span>存在但未授权<span class="token operator">**</span>
  <span class="token punctuation">{</span>
    authErrorType<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token comment">// 存在但未授权</span>
    authCode<span class="token operator">:</span> resData<span class="token punctuation">.</span>authCode<span class="token punctuation">,</span>
    exhibitName<span class="token punctuation">,</span>
    exhibitId<span class="token punctuation">,</span>
    articleNid<span class="token punctuation">,</span>
    resourceType<span class="token punctuation">,</span>
    subDep<span class="token punctuation">,</span>
    versionInfo<span class="token operator">:</span> <span class="token punctuation">{</span>exhibitProperty<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>resData<span class="token punctuation">,</span> <span class="token comment">// 原始数据</span>
  <span class="token punctuation">}</span>
  <span class="token operator">**</span>不存在<span class="token operator">**</span>
  <span class="token punctuation">{</span>
    authErrorType<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token comment">// 不存在</span>
    authCode<span class="token operator">:</span> resData<span class="token punctuation">.</span>authCode<span class="token punctuation">,</span>
    exhibitName<span class="token punctuation">,</span>
    exhibitId<span class="token punctuation">,</span>
    articleNid<span class="token punctuation">,</span>
    resourceType<span class="token punctuation">,</span>
    subDep<span class="token punctuation">,</span>
    versionInfo<span class="token operator">:</span> <span class="token punctuation">{</span>exhibitProperty<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>resData<span class="token punctuation">,</span> <span class="token comment">// 原始数据</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="授权处理"><a href="#授权处理" class="header-anchor">#</a> 授权处理</h3> <p><strong>单个呼出授权</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 根据展品id获取展品作品</span>
<span class="token keyword">let</span> ch <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getExhibitFileStream</span><span class="token punctuation">(</span>
  chapters<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>exhibitId
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>ch<span class="token punctuation">.</span>authErrorType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 提交给运行时处理</span>
  <span class="token comment">/**
   * addAuth 参数
      exhibitId: string,
      options?: {
        immediate: boolean  // 是否立即弹出授权窗口
      }
  */</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> rej<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">addAuth</span><span class="token punctuation">(</span>ch<span class="token punctuation">.</span>data<span class="token punctuation">.</span>exhibitId<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      immediate<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token operator">**</span>res返回值说明<span class="token operator">**</span>
   <span class="token punctuation">{</span>status<span class="token operator">:</span> <span class="token constant">SUCCESS</span><span class="token punctuation">,</span> data<span class="token punctuation">}</span>
   status 枚举判断：
     status <span class="token operator">===</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span>resultType<span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token punctuation">;</span>  <span class="token comment">// 成功</span>
     status <span class="token operator">===</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span>resultType<span class="token punctuation">.</span><span class="token constant">FAILED</span><span class="token punctuation">;</span>   <span class="token comment">// 失败</span>
     status <span class="token operator">===</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span>resultType<span class="token punctuation">.</span><span class="token constant">USER_CANCEL</span><span class="token punctuation">;</span> <span class="token comment">// 用户取消</span>
     status <span class="token operator">===</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span>resultType<span class="token punctuation">.</span><span class="token constant">DATA_ERROR</span><span class="token punctuation">;</span>  <span class="token comment">// 数据错误</span>
     status <span class="token operator">===</span> <span class="token operator">=</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span>resultType<span class="token punctuation">.</span><span class="token constant">OFFLINE</span><span class="token punctuation">;</span> <span class="token comment">// 展品已经下线</span>
   data<span class="token operator">:</span> 如果是<span class="token constant">DATA_ERROR</span>或<span class="token constant">OFFLINE</span>，会返回错误数据或展品数据
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>呼出授权</strong></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// 当addAuth多个未授权展品且没有立刻呼出（或者存在未授权展品且已经addAuth 但用户关闭了，插件想要用户签约时）可以通过callAuth()唤出</span>
window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">callAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="用户相关"><a href="#用户相关" class="header-anchor">#</a> 用户相关</h2> <h3 id="唤起登录"><a href="#唤起登录" class="header-anchor">#</a> 唤起登录</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// callback: 登录成功的回调，登录失败不会回调,这里需要考虑一下，</span>
window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">callLogin</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="唤起退出登录"><a href="#唤起退出登录" class="header-anchor">#</a> 唤起退出登录</h3> <div class="language-ts extra-class"><pre class="language-ts"><code>window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">callLoginOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="获取当前登录用户信息"><a href="#获取当前登录用户信息" class="header-anchor">#</a> 获取当前登录用户信息</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getCurrentUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="监听用户登录事件"><a href="#监听用户登录事件" class="header-anchor">#</a> 监听用户登录事件</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// callback: 登录成功的回调，登录失败不会回调</span>
window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">onLogin</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="监听用户在其余页面切换账号或登录事件"><a href="#监听用户在其余页面切换账号或登录事件" class="header-anchor">#</a> 监听用户在其余页面切换账号或登录事件</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// callback: 再次进入页面发现账号变化后会回调所有函数</span>
window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">onUserChange</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="用户数据"><a href="#用户数据" class="header-anchor">#</a> 用户数据</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 开发者模式需要注意在入口文件加载页面加上主题或插件本身的作品名称,例如：</span>
window<span class="token punctuation">.</span><span class="token constant">FREELOG_RESOURCENAME</span> <span class="token operator">=</span> Freelog <span class="token operator">/</span> dev <span class="token operator">-</span> docs<span class="token punctuation">;</span>

<span class="token comment">// 更新用户数据   data 为任意对象，</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">setUserData</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取用户数据</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>freelogApp<span class="token punctuation">.</span><span class="token function">getUserData</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="打包上传"><a href="#打包上传" class="header-anchor">#</a> 打包上传</h2> <p><strong>正常 build 后，将打包后的所有文件压缩为一个 zip 文件（无根目录），作为主题 theme 或插件 widget 类型上传为作品</strong></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7c30a442.js" defer></script><script src="/assets/js/2.733019b2.js" defer></script><script src="/assets/js/7.cad30a9a.js" defer></script>
  </body>
</html>
