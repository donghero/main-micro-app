{"version":3,"sources":["ui/pc/_components/button.tsx","services/request.ts","services/base.ts","utils/utils.ts","bridge/index.ts","bridge/event.ts","services/handler.ts","services/api/modules/user.ts","services/api/modules/event.ts","services/api/modules/transaction.ts","services/api/modules/presentable.ts","services/api/modules/node.ts","platform/structure/api.ts","platform/runtime/single-spa/applications/app-errors.js","platform/runtime/single-spa/applications/app.helpers.js","platform/runtime/single-spa/utils/assign.js","platform/runtime/single-spa/lifecycles/lifecycle.helpers.js","platform/runtime/single-spa/utils/find.js","platform/runtime/single-spa/lifecycles/bootstrap.js","platform/runtime/single-spa/lifecycles/unmount.js","platform/runtime/single-spa/lifecycles/mount.js","platform/runtime/single-spa/parcels/mount-parcel.js","platform/runtime/single-spa/lifecycles/update.js","platform/runtime/single-spa/lifecycles/prop.helpers.js","platform/runtime/single-spa/applications/timeouts.js","platform/runtime/single-spa/devtools/devtools.js","platform/runtime/single-spa/lifecycles/load.js","platform/runtime/single-spa/utils/runtime-environment.js","platform/runtime/single-spa/jquery-support.js","platform/runtime/single-spa/single-spa.js","platform/runtime/import-html-entry/utils.js","platform/runtime/import-html-entry/process-tpl.js","platform/structure/history.ts","platform/structure/dev.ts","platform/structure/proxy.ts","platform/structure/widget.ts","platform/runtime/import-html-entry/index.js","platform/runtime/addons/runtimePublicPath.ts","platform/runtime/addons/index.ts","platform/runtime/addons/engineFlag.ts","platform/runtime/interfaces.ts","platform/runtime/globalState.ts","platform/runtime/sandbox/patchers/css.ts","platform/runtime/utils.ts","platform/runtime/sandbox/common.ts","platform/runtime/sandbox/patchers/dynamicAppend/common.ts","platform/runtime/sandbox/patchers/dynamicAppend/forStrictSandbox.ts","platform/runtime/sandbox/patchers/interval.ts","platform/runtime/sandbox/patchers/windowListener.ts","platform/runtime/sandbox/patchers/index.ts","platform/runtime/sandbox/patchers/historyListener.ts","platform/runtime/sandbox/proxySandbox.ts","platform/runtime/sandbox/index.ts","platform/runtime/loader.ts","platform/runtime/apis.ts","platform/structure/utils.ts","ui/pc/event/pay.tsx","ui/pc/policy/_components/policyGraph.tsx","ui/pc/policy/_components/policyCode.tsx","ui/pc/policy/_components/policyContent.tsx","ui/pc/contract/contract.tsx","ui/pc/policy/policy.tsx","ui/pc/_components/confirm.tsx","ui/pc/login.tsx","platform/structure/event.ts","services/api/modules/contract.ts","ui/pc/topology/data.tsx","ui/pc/auth.tsx","ui/mobile/user/login.tsx","ui/mobile/user/forgot.tsx","ui/mobile/user/register.tsx","ui/mobile/event/pay.tsx","ui/mobile/policy/_components/policyGraph.tsx","ui/mobile/policy/_components/policyCode.tsx","ui/mobile/policy/_components/policyContent.tsx","ui/mobile/contract/contract.tsx","ui/mobile/policy/policy.tsx","ui/mobile/topology/data.tsx","ui/mobile/auth.tsx","ui/App.tsx","reportWebVitals.js","platform/structure/global.ts","platform/structure/init.ts","index.tsx","platform/index.ts"],"names":["buttonTypes","main","common","normal","hover","active","disabled","cancel","props","useState","status","setStatus","buttonClass","setButtonClass","useEffect","type","onClick","e","click","onMouseDown","onMouseUp","onMouseEnter","onMouseLeave","className","children","axios","interceptors","request","use","config","error","console","Promise","reject","response","placeHolder","baseURL","window","location","href","indexOf","baseConfig","withCredentials","timeout","compareObjects","origin","data","diff","otype","Object","prototype","toString","call","dtype","0","includes","keys","forEach","dkey","isDelete","some","okey","item","presentableQueue","Map","eventMap","failedMap","UI","updateUI","locked","updateLock","uiInited","addAuth","presentableId","resolve","options","event","name","this","get","errorCode","msg","errCode","authCode","arr","callBacks","push","id","set","eventId","immediate","setTimeout","removeEvent","delete","clear","endEvent","log","frequest","action","urlData","returnUrl","caller","api","assign","url","length","replace","dataModel","isDiff","before","method","toLowerCase","params","_config","key","_api","query","then","a","after","resourceIdOrName","headers","presentableName","decodeURI","value","widget","contracts","policies","info","errorMsg","catch","user","login","loginName","password","isRemember","jwtType","loginOut","getCurrent","getAccount","postRegister","username","getAuthCode","authCodeType","pay","accountId","transactionAmount","transaction","getRecord","presentable","getPresentableDetail","getPagingPresentables","nodeId","skip","limit","resourceType","omitResourceType","onlineStatus","tags","projection","keywords","isLoadVersionProperty","isLoadPolicyInfo","getPresentables","userId","presentableIds","resourceIds","resourceNames","getByPresentableId","getByResourceIdOrName","getTestPagingData","getTestByPresentableId","getTestByResourceIdOrName","node","getInfoById","getInfoByNameOrDomain","nodeName","nodeDomain","postUserData","putUserData","getUserData","isTest","bind","parentNid","subResourceIdOrName","test","form","subEntityIdOrName","errorHandlers","handleAppError","err","app","newStatus","transformedErr","transformErr","handler","addErrorHandler","Error","formatErrorMessage","__DEV__","removeErrorHandler","removedSomething","filter","h","isHandler","code","args","join","ogErr","appOrParcel","result","errPrefix","objectType","toName","message","warn","JSON","stringify","appOrParcelName","NOT_LOADED","LOADING_SOURCE_CODE","NOT_BOOTSTRAPPED","BOOTSTRAPPING","NOT_MOUNTED","MOUNTING","MOUNTED","UPDATING","UNMOUNTING","LOAD_ERROR","SKIP_BECAUSE_BROKEN","isParcel","Boolean","unmountThisParcel","i","arguments","validLifecycleFn","fn","Array","isArray","func","find","flattenFnArray","lifecycle","fns","reduce","resultPromise","index","thisPromise","smellsLikeAPromise","promise","toBootstrapPromise","hardFail","bootstrap","reasonableTime","successfulBootstrap","toUnmountPromise","unmountChildrenParcels","parcels","map","parcelId","all","unmountAppOrParcel","parcelError","parentError","beforeFirstMountFired","firstMountFired","toMountPromise","dispatchEvent","CustomEvent","setSkipBecauseBroken","parcelCount","rootParcels","mountRootParcel","mountParcel","apply","customProps","owningAppOrParcel","domElement","externalRepresentation","passedConfigLoadingFunction","configLoadingFunction","parcel","parentName","resolveUnmount","rejectUnmount","loadPromise","bootstrapPromise","hasOwnProperty","mount","unmount","update","timeouts","ensureValidAppTimeouts","promiseWithoutReturnValue","toUpdatePromise","mountPromise","unmountPromise","getStatus","getProps","singleSpa","unmountSelf","defaultWarningMillis","globalTimeoutConfig","millis","dieOnTimeout","warningMillis","unload","setBootstrapMaxTime","time","setMountMaxTime","setUnmountMaxTime","setUnloadMaxTime","timeoutConfig","warningPeriod","finished","errored","val","maybeTimingOut","errMsg","shouldError","numWarnings","numMillis","toLoadPromise","loadApp","isUserErr","validationErrMessage","validationErrCode","loadErrorTime","appOpts","appOptsStr","devtools","overlays","Date","getTime","isInBrowser","hasInitialized","ensureJQuerySupport","jQuery","$","jquery","originalJQueryOn","on","originalJQueryOff","off","eventString","captureRoutingEvents","addEventListener","removeEventListener","originalJQueryFunction","nativeFunctionToCall","originalArgs","split","eventName","trim","__SINGLE_SPA_DEVTOOLS__","exposedMethods","firstGlobalProp","secondGlobalProp","lastGlobalProp","isIE11","navigator","userAgent","shouldSkipProperty","global","p","isNaN","parent","getGlobalProp","lastProp","cnt","hasIframe","frames","noteGlobalProps","undefined","getInlineCode","match","start","end","lastIndexOf","substring","defaultGetPublicPath","entry","URL","startsWith","protocol","paths","pathname","requestIdleCallback","cb","now","didTimeout","timeRemaining","Math","max","readResAsString","autoDetectCharset","text","contentType","charset","parts","encoding","toUpperCase","blob","file","reader","FileReader","onload","onerror","readAsText","ALL_SCRIPT_REGEX","SCRIPT_TAG_REGEX","SCRIPT_SRC_REGEX","SCRIPT_TYPE_REGEX","SCRIPT_ENTRY_REGEX","SCRIPT_ASYNC_REGEX","SCRIPT_NO_MODULE_REGEX","SCRIPT_MODULE_REGEX","LINK_TAG_REGEX","LINK_PRELOAD_OR_PREFETCH_REGEX","LINK_HREF_REGEX","LINK_AS_FONT","STYLE_TAG_REGEX","STYLE_TYPE_REGEX","STYLE_HREF_REGEX","HTML_COMMENT_REGEX","LINK_IGNORE_REGEX","STYLE_IGNORE_REGEX","SCRIPT_IGNORE_REGEX","hasProtocol","getEntirePath","path","baseURI","substr","genLinkReplaceSymbol","linkHref","preloadOrPrefetch","genScriptReplaceSymbol","scriptSrc","async","genIgnoreAssetReplaceSymbol","genModuleScriptReplaceSymbol","moduleSupport","processTpl","tpl","scripts","styles","document","createElement","template","styleHref","styleIgnore","newHref","scriptTag","scriptIgnore","moduleScriptIgnore","matchedScriptTypeMatch","matchedScriptType","matchedScriptEntry","matchedScriptSrcMatch","matchedScriptSrc","SyntaxError","asyncScript","src","every","line","script","widgetHistories","setHistory","history","isReplace","obj","histories","position","splice","cut","slice","getHistory","dev","search","paramsArray","rawDocument","rawLocation","rawLocalStorage","locations","initLocation","loc","freelogApp","devData","temp","l","setLocation","hash","activeWidgets","devUrl","endsWith","pushState","locationCenter","attr","host","saveSandBox","sandBox","sandbox","sandBoxs","has","flatternWidgets","addSandBox","createHistoryProxy","patch","state","replaceState","go","count","historyGo","back","historyBack","forward","historyForward","write","writeln","getElementsByClassName","getElementsByTagName","getElementsByTagNameNS","querySelector","querySelectorAll","getElementById","appendChild","body","removeChild","rawFetch","fetch","credentials","setFetch","styleCache","scriptCache","embedHTMLCache","defaultFetch","defaultGetTemplate","getEmbedHTML","opts","embedHTML","getExternalStyleSheets","styleSheets","html","styleSrc","isInlineCode","getExecutableScript","scriptText","proxy","strictGlobal","sourceUrl","eval","styleLink","getExternalScripts","errorCallback","fetchScript","scriptUrl","content","throwNonBlockingError","performance","mark","clearMarks","measure","clearMeasures","execScripts","success","beforeExec","afterExec","scriptsText","geval","inlineScript","schedule","resolvePromise","downloadedScriptText","exec","importHTML","autoDecodeResponse","getTemplate","getPublicPath","getDomain","assetPublicPath","execScriptsHooks","importEntry","getHTMLWithStylePlaceholder","reduceRight","getHTMLWithScriptPlaceholder","rawPublicPath","__INJECTED_PUBLIC_PATH_BY_FREELOG__","getAddOns","publicPath","mergeWith","beforeLoad","__POWERED_BY_FREELOG__","beforeMount","beforeUnmount","getEngineFlagAddon","hasMountedOnce","getRuntimePublicPathAddOn","v1","v2","concat","SandBoxType","globalState","deps","emitGlobal","prevState","Function","cloneDeep","getMicroAppStateActions","isMaster","onGlobalStateChange","callback","fireImmediately","cloneState","setGlobalState","changeKeys","prevGlobalState","_globalState","changeKey","offGlobalStateChange","RuleType","processor","arrayify","list","rawDocumentBodyAppend","HTMLBodyElement","ScopedCSS","sheet","swapNode","appName","styleNode","prefix","textContent","textNode","createTextNode","rules","cssRules","css","rewrite","mutator","MutationObserver","mutations","mutation","ModifiedTag","observe","childList","rule","STYLE","ruleStyle","MEDIA","ruleMedia","SUPPORTS","ruleSupport","cssText","widgetsConfig","rootSelectorRE","rootCombinationRE","selector","selectorText","selectors","s","m","conditionText","FreelogCSSRewriteAttr","process","appWrapper","stylesheetElement","tagName","tag","toArray","array","constructableMap","WeakMap","isCallable","boundedMap","getDefaultTplWrapper","getWrapperId","snakeCase","validateExportLifecycle","exports","isFunction","currentRunningSandboxProxy","Deferred","getEntriesByName","isEnableScopedCSS","strictStyleIsolation","experimentalStyleIsolation","getContainer","container","setCurrentRunningSandboxProxy","functionBoundedValueMap","getTargetValue","target","cachedBoundFunction","bounded","isBoundedFunction","constructable","constructor","getOwnPropertyNames","isConstructable","boundValue","rawHeadAppendChild","HTMLHeadElement","rawHeadRemoveChild","rawBodyAppendChild","rawBodyRemoveChild","rawHeadInsertBefore","insertBefore","rawRemoveChild","HTMLElement","SCRIPT_TAG_NAME","LINK_TAG_NAME","STYLE_TAG_NAME","isHijackingTag","isStyledComponentsLike","element","getStyledElementCSSRules","patchCustomEvent","elementGetter","defineProperties","srcElement","manualInvokeElementOnLoad","patchedEvent","manualInvokeElementOnError","styledComponentCSSRulesMap","dynamicScriptAttachedCommentMap","dynamicLinkAttachedInlineStyleMap","recordStyledComponentsCSSRules","styleElements","styleElement","HTMLStyleElement","styledElement","getOverwrittenAppendChildOrInsertBefore","newChild","refChild","rawDOMAppendOrInsertBefore","isInvokedByMicroApp","containerConfigGetter","containerConfig","appWrapperGetter","dynamicStyleSheetElements","scopedCSS","excludeAssetFilter","mountDOM","rel","frameworkConfiguration","postProcess","fetchFn","dataset","freelogHref","res","styleContext","convertLinkAsStyle","referenceNode","contains","defineProperty","configurable","dynamicScriptCommentElement","createComment","dynamicInlineScriptCommentElement","getNewRemoveChild","headOrBodyRemoveChild","appWrapperGetterGetter","child","attachedElement","patchHTMLDynamicAppendPrototypeFunctions","rebuildCSSRules","styleSheetElements","reAppendElement","cssRule","cssStyleSheetElement","insertRule","rawDocumentCreateElement","Document","proxyAttachContainerConfigMap","elementAttachContainerConfigMap","patchDocumentCreateElement","proxyContainerConfig","bootstrappingPatchCount","mountingPatchCount","patchStrictSandbox","mounting","unpatchDocumentCreate","unpatchDynamicAppendPrototypeFunctions","rawWindowInterval","setInterval","rawWindowClearInterval","clearInterval","rawAddEventListener","rawRemoveEventListener","patchAtMounting","basePatchers","intervals","intervalId","noop","patchInterval","listenerMap","listener","listeners","storedTypeListeners","patchWindowListener","rawHistoryListen","_","historyListeners","historyUnListens","g_history","listen","unListen","rebuild","patchHistoryListener","Proxy","rawObjectDefineProperty","variableWhiteListInDev","__FREELOG_DEVELOPMENT__","variableWhiteList","unscopables","String","Number","Symbol","parseFloat","Float32Array","activeSandboxCount","ProxySandbox","updatedValueSet","Set","sandboxRunning","latestSetProp","proxyHis","proxyLoc","proxyWidget","freelogAppProxy","rawWindow","propertiesWithGetter","fakeWindow","descriptor","getOwnPropertyDescriptor","hasGetter","writable","freeze","createFakeWindow","descriptorTargetMap","_this","enumerable","add","pro","childWidgets","property","childrenWidgets","childrenArray","childId","createWidgetProxy","createLocationProxy","getItem","removeItem","setItem","doc","isShadow","shadowRoot","rootDoc","docTarget","appDiv","nodeType","getAttribute","head","rootId","createDocumentProxy","ownKeys","Reflect","create","attributes","deleteProperty","createSandboxContainer","useLooseSandbox","bootstrappingFreers","patchAtBootstrapping","mountingFreers","sideEffectsRebuilders","instance","sideEffectsRebuildersAtBootstrapping","sideEffectsRebuildersAtMounting","free","inactive","assertElementExist","execHooksChain","hooks","chain","hook","validateSingularMode","validate","supportShadowDOM","attachShadow","createShadowRoot","appContent","containerElement","innerHTML","appElement","firstChild","mode","setAttribute","styleNodes","getAppWrapperGetter","appInstanceId","useLegacyRender","prevAppUnmountedDeferred","rawAppendChild","getRender","legacyRender","phase","loading","getLifecyclesFromExports","scriptExports","globalLatestSetProp","lifecycles","globalVariableExports","configuration","lifeCycles","floor","random","singular","importEntryOpts","initialAppWrapperElement","initialContainer","render","initialAppWrapperGetter","mountSandbox","unmountSandbox","loose","sandboxContainer","afterUnmount","afterMount","syncAppWrapperElement2Sandbox","parcelConfigGetter","remountContainer","appWrapperElement","parcelConfig","appConfigPromiseGetterMap","addWidget","plugin","firstDev","mountSubWidgets","parentGlobal","promises","subDeps","sub","subContainer","mountWidget","nodeInfo","nodeThemeId","entityNid","subDependId","finally","presenbaleId","widgetName","getSubDep","that","parse","decodeURIComponent","userInfo","getUserInfo","getCurrentUser","setUserInfo","getEntry","url2","immutableKeys","viewPortValue","width","height","setPassword","setLoading","visible","setVisible","userAccount","setUserAccount","contractId","payResult","Modal","title","zIndex","modal","flag","transactionRecordId","paymentFinish","destroy","isModalVisible","centered","footer","maskClosable","onOk","setIsModalVisible","onCancel","wrapClassName","subjectName","contractName","receiver","balance","Password","size","onChange","maxLength","placeholder","nodes","policy","bestPyramid","pyramid","layer","yIndex","xIndex","fill","stroke","rx","ry","isAuth","x","y","label","attrs","edges","translateInfo","fsmInfos","eventTranslateInfos","eventInfo","used","nodesMap","from","stateInfo","source","labels","to","Graph","policyId","panning","interacting","nodeMovable","edgeMovable","fromJSON","policyText","TabPane","Tabs","moment","require","eventIndex","setEventIndex","unfold","setUnFold","argsMap","setArgsMap","authClass","setAuthClass","authStatus","setAuthStatus","amount","currentStatus","setCurrentStatus","payEvent","contract","fsmDeclarations","envArgs","policyInfo","fsmCurrentState","tec","nextState","fsmDescriptionInfo","currentSatus","account","ownerName","defaultActiveKey","tab","updateDate","format","Group","nextEvent","UpOutlined","DownOutlined","getAuth","policyName","selectType","onConfirm","policySelect","getPopupContainer","okText","cancelText","checked","policNames","setPolicNames","names","currentPresentable","layout","labelCol","span","wrapperCol","Form","useForm","setDisabled","onFinish","getFieldsValue","values","loginFinished","closable","setIsLoginVisible","onValuesChange","changedValues","allValues","initialValues","remember","onFinishFailed","errorInfo","Item","required","loginCallback","getContractInfo","contractIds","getContracts","subjectIds","subjectType","licenseeIdentityType","licensorId","licenseeId","isTranslate","subjectId","subjects","isWaitInitial","getColumn","column","getBestTopology","betterPyramids","initial","findNextLevel","level","currentLevel","pre","nodeData","row","relations","route","transitions","next","toNodeData","toState","maxWidth","aRow","aColumn","bRow","b","bColumn","policyPyramid","getPyramid","allLevel","contents","norepeatContents","equals","norepeat","input","permArr","usedChars","ch","pop","fullSort","compose","nextLevel","_pyramid","crosses","cross","aNode","bNode","c","cColumn","d","dRow","dColumn","getCrosses","policyMaps","findNext","isExist","nextRoute","getRouteMaps","isLoginVisible","setContracts","events","setCurrentPresentable","setPolicies","selectedPolicies","setSelectedPolicies","getDetail","con","contractFinished","updateEvents","contracted","single","keyboard","seq","logging","setLogging","setLoginName","fail","popup","animationType","setModalType","inline","phone","email","errorTip","setErrorTip","setSuccess","available","setAvailable","countDown","setCountDown","setAuthCode","authCodeLoading","setAuthCodeLoading","setUsername","setPhone","setEmail","registerType","setRegisterType","verify","checkUsername","checkPhone","checkEmail","checkPassword","errors","flag1","flag2","timer","prevTime","authCodeRes","startWith","parseInt","htmlFor","transparent","prompt","focus","setFocus","inputVisible","setInputVisible","tipType","setTipType","passwords","setPasswords","input1","useRef","input2","input3","input4","input5","input0","inputs","current","onClose","minLength","ref","onKeyDown","keyCode","tabs","initialPage","onTabClick","alert","onPress","confirm","isListVisible","setIsListVisible","modalType","userCancel","App","setEvents","setFailedEvents","inited","setInited","backToNode","style","opacity","updateEvent","arr2","showUI","isMobile","reportWebVitals","onPerfEntry","getCLS","getFID","getFCP","getLCP","getTTFB","resourceInfo","resourceId","widgetConfig","isTheme","isDev","addWidgetConfig","getContainerXpath","el","pos","tmpEle","xpath","documentElement","previousSibling","namespaceURI","parentNode","getXPathForElement","wrapParcelConfigForRemount","userConfiguration","$$cacheLifecycleByAppName","parcelConfigGetterPromise","parcelConfigObjectGetterPromise","loadMicroApp","shadowDom","scopedCss","_app","getPresentablesPaging","getPresentablesSearch","getInfoByName","getResultById","getResultByName","getFileStreamById","getFileStreamByName","getSubInfoById","getSubInfoByName","getSubResultById","getSubResultByName","getSubFileStreamById","getSubFileStreamByName","getResourceInfoById","getResourceInfoByName","getSubResourceInfoById","getSubResourceInfoByName","getStaticPath","autoMoutSubWdigets","getSelfId","callAuth","onLogin","setViewport","metaEl","initNode","requestNodeInfo","theme","resourceName","browser","u","trident","presto","webKit","gecko","mobile","ios","android","iPhone","iPad","webApp","browserLanguage","language","display","domain","__REACT_ERROR_OVERLAY_GLOBAL_HOOK__","ReactDOM","locale","zhCN"],"mappings":"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","file":"static/js/main.b5a57916.chunk.js","sourcesContent":["import { useState, useEffect } from \"react\";\r\ninterface buttonProps {\r\n  disabled?: boolean;\r\n  click?(e: any): any;\r\n  children: any;\r\n  className?: string;\r\n  type?: string;\r\n}\r\nconst buttonTypes = {\r\n  main: {\r\n    common: \"text-align-center px-10 py-5 brs-4 cur-pointer select-none fw-medium fc-white\",\r\n    normal: \"bg-main\",\r\n    hover: \"bg-hover\",\r\n    active: \"bg-active\",\r\n    disabled: \"bg-disabled bg-main\",\r\n  },\r\n  cancel: {\r\n    common: \"text-align-center px-10 py-5 brs-4 cur-pointer select-none fc-grey\",\r\n    normal: \"bg-c-main\",\r\n    hover: \"bg-c-hover\",\r\n    active: \"bg-c-active\",\r\n    disabled: \"bg-disabled bg-c-main\",\r\n  }\r\n};\r\nexport default function (props: buttonProps) {\r\n  const [status, setStatus] = useState(0);\r\n  const [buttonClass, setButtonClass] = useState(buttonTypes.main);\r\n  useEffect(() => {\r\n    setStatus(props.disabled ? 3 : 0);\r\n    // @ts-ignore\r\n    setButtonClass(buttonTypes[props.type || 'main'] || buttonClass)\r\n  });\r\n  return (\r\n    <div\r\n      onClick={(e) => {\r\n        !props.disabled && props.click && props.click(e);\r\n        return true\r\n      }}\r\n      onMouseDown={(e) => {\r\n        !props.disabled && setStatus(2);\r\n      }}\r\n      onMouseUp={(e) => {\r\n        !props.disabled && setStatus(0);\r\n      }}\r\n      onMouseEnter={(e) => {\r\n        !props.disabled && setStatus(1);\r\n      }}\r\n      onMouseLeave={() => {\r\n        !props.disabled && setStatus(0);\r\n      }}\r\n      className={\r\n        props.className +\r\n        \" \" +\r\n        (status === 0\r\n          ? buttonClass.normal\r\n          : status === 1\r\n          ? buttonClass.hover\r\n          : status === 2\r\n          ? buttonClass.active\r\n          : buttonClass.disabled) +\r\n        \" \" + buttonClass.common\r\n      }\r\n    >\r\n      {props.children}\r\n    </div>\r\n  );\r\n}\r\n","import axios from 'axios'\r\n\r\n\r\naxios.interceptors.request.use(\r\n        config => {\r\n            return config\r\n        },\r\n        error => {\r\n            console.error(error) // for debug 11\r\n            Promise.reject(error)\r\n        }\r\n    )\r\n    // response 拦截器\r\naxios.interceptors.response.use(\r\n    response => {\r\n        return response\r\n    },\r\n    error => {\r\n        // TODO\r\n        console.error(error) // for debug 11\r\n    }\r\n)\r\nexport default axios","export const placeHolder = 'urlPlaceHolder'\r\nlet baseURL = 'http://qi.freelog.com/v2/'\r\nif (window.location.href.indexOf('testfreelog') > -1) {\r\n    baseURL = 'http://qi.testfreelog.com/v2/'\r\n}\r\nexport const baseUrl = baseURL\r\nexport const baseConfig = {\r\n        baseURL,\r\n        withCredentials: true,\r\n        timeout: 30000\r\n    };\r\n    // TODO 上传文件进度等需要配置","/**\r\n *\r\n * @param origin model\r\n * @param data wait to compare with model\r\n * @param diff  if only reserve difference set\r\n * delete the data's keys while they are (not) exist in origin\r\n */\r\nexport function compareObjects(origin: any, data: any, diff = false) {\r\n  let otype = Object.prototype.toString.call(origin);\r\n  let dtype = Object.prototype.toString.call(data);\r\n  if (dtype === otype && otype === \"[object Array]\") {\r\n    origin = { 0: origin };\r\n    data = { 0: data };\r\n  } else if (otype !== dtype || otype !== \"[object Object]\") {\r\n    ![\"[object Array]\", \"[object object]\"].includes(otype) &&\r\n      console.error(origin + \" is not object or array\");\r\n    ![\"[object Array]\", \"[object object]\"].includes(dtype) &&\r\n      console.error(data + \" is not object or array\");\r\n    return;\r\n  }\r\n  Object.keys(data).forEach((dkey) => {\r\n    // depend on whether diff\r\n    let isDelete = !diff;\r\n    Object.keys(origin).some((okey) => {\r\n      if (dkey === okey) {\r\n        isDelete = !isDelete;\r\n        if (diff) {\r\n          return true;\r\n        }\r\n        let otype = Object.prototype.toString.call(origin[okey]);\r\n        let dtype = Object.prototype.toString.call(data[dkey]);\r\n        // loop if they are object the same time\r\n        if (otype === dtype && dtype === \"[object Object]\") {\r\n          compareObjects(origin[okey], data[dkey], diff);\r\n        } else if (\r\n          otype === dtype &&\r\n          dtype === \"[object Array]\" &&\r\n          Object.prototype.toString.call(origin[dkey][0]) === \"[object Object]\"\r\n        ) {\r\n          // if they are array the same time and origin[dkey][0] is object,\r\n          data[dkey].forEach((item: any) => {\r\n            Object.prototype.toString.call(item) === \"[object Array]\" &&\r\n              compareObjects(origin[okey][0], item, diff);\r\n          });\r\n        }\r\n        return true;\r\n      }\r\n      return false;\r\n    });\r\n    isDelete && delete data[dkey];\r\n  });\r\n}\r\n\r\nexport function isMobile() {\r\n  var browser = {\r\n    versions: (function () {\r\n      var u = navigator.userAgent;\r\n      // app = navigator.appVersion;\r\n      return {\r\n        //移动终端浏览器版本信息\r\n        trident: u.indexOf(\"Trident\") > -1, //IE内核\r\n        presto: u.indexOf(\"Presto\") > -1, //opera内核\r\n        webKit: u.indexOf(\"AppleWebKit\") > -1, //苹果、谷歌内核\r\n        gecko: u.indexOf(\"Gecko\") > -1 && u.indexOf(\"KHTML\") === -1, //火狐内核\r\n        mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端\r\n        ios: !!u.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端\r\n        android: u.indexOf(\"Android\") > -1 || u.indexOf(\"Linux\") > -1, //android终端或者uc浏览器\r\n        iPhone: u.indexOf(\"iPhone\") > -1, //是否为iPhone或者QQHD浏览器\r\n        iPad: u.indexOf(\"iPad\") > -1, //是否iPad\r\n        webApp: u.indexOf(\"Safari\") === -1, //是否web应该程序，没有头部与底部\r\n      };\r\n    })(),\r\n    // @ts-ignore\r\n    language: (navigator.browserLanguage || navigator.language).toLowerCase(),\r\n  };\r\n  //如果是移动端就进行这里\r\n  if (\r\n    browser.versions.mobile ||\r\n    browser.versions.ios ||\r\n    browser.versions.android ||\r\n    browser.versions.iPhone ||\r\n    browser.versions.iPad\r\n  ) {\r\n    return true;\r\n  } else {\r\n    return false;\r\n  }\r\n}\r\nexport function checkPhone(phone: string) {\r\n  if (!/^1(3|4|5|6|7|8|9)\\d{9}$/.test(phone)) {\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\nexport function checkEmail(email: string) {\r\n  const reg =\r\n    /^([a-zA-Z0-9]+[_|\\-|\\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\\-|\\.]?)*[a-zA-Z0-9]+\\.[a-zA-Z]{2,3}$/gi;\r\n  if (!reg.test(email)) {\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\nexport function checkPassword(password: string){\r\n  const reg = /^(?=.*[0-9])(?=.*[a-zA-Z])(.{6,24})$/;\r\n  if (!reg.test(password)) {\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\nexport function checkUsername(username: string){\r\n  const reg =  /^(?!-)[A-Za-z0-9-]{1,30}(?<!-)$/;\r\n  if (!reg.test(username)) {\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n","import { SUCCESS, FAILED, USER_CANCEL } from \"./event\";\r\nimport { LOGIN, CONTRACT } from \"./event\";\r\n/**\r\n * 架构设计目的：\r\n *     1.有利于更快进行业务细分实现和技术实现\r\n *     2.便于维护和管理\r\n *           UI可以插件化（模块化）\r\n *           例如交给无权限修改运行时的开发人员开发UI，所有UI插件队列由权限人员管理\r\n * 插件平台： 提供api给插件连接注册中心调取UI（是否弹出UI由注册中心判断决定）\r\n * 数据接口中心： 涉及授权的只要请求过，加入到注册中心的 已授权队列或未授权队列\r\n * 注册中心： UI事件种类： 1.登录   2.授权  3.其余ui（后续考虑）\r\n *           数据结构：已授权队列，未授权队列，处理失败队列（该队列保留处理时的数据），\r\n *                    插件唤起UI事件队列（必须处理完）\r\n *           处理方式：插件唤起Ui，如果在未授权队列里面有，才调用Ui部分\r\n * UI(s)： 所有UI注册到中心，用于注册中心唤起UI\r\n *         目前分类：登录UI， 授权UI\r\n *         展望：例如游戏over想要接着玩时 得看广告，那就有官方的广告UI\r\n * 目前不打算做的：Ui插件化\r\n * 目前还需要改的地方：已授权队列，UI部分，合约事件部分\r\n * 工作量安排：3日（以往工作经验1日，原因是对后端表关系与接口数据结构不是参与者）\r\n * 文档编写工作量安排：3日\r\n */\r\nexport const presentableQueue = new Map<any, any>();\r\nexport const eventMap = new Map<any, any>(); // 数组\r\nexport const failedMap = new Map<any, any>();\r\nlet UI: any = null;\r\nlet updateUI: any = null;\r\nexport function reisterUI(ui: any, update: any) {\r\n  UI = ui;\r\n  updateUI = update;\r\n}\r\nlet locked = false;\r\nexport function updateLock(status: boolean) {\r\n  locked = !!status;\r\n}\r\nexport function setPresentableQueue(name: string, value: any) {\r\n  presentableQueue.set(name, value);\r\n}\r\nlet uiInited = false;\r\n// 公共非展品事件UI， 后面考虑\r\nexport function addAuth(\r\n  presentableId: any,\r\n  resolve: any,\r\n  reject: any,\r\n  options?: any\r\n) {\r\n  if (typeof resolve !== \"function\") {\r\n    resolve = () => {};\r\n  }\r\n  if (typeof reject !== \"function\") {\r\n    reject = () => {};\r\n  }\r\n  let event;\r\n  // @ts-ignore\r\n  const name = this.name;\r\n  if (name !== \"node\") {\r\n    // @ts-ignore\r\n    let data = presentableQueue.get(presentableId);\r\n    if (!data) {\r\n      //  TODO 返回信息\r\n      reject &&\r\n        reject({\r\n          errorCode: 2,\r\n          msg: presentableId + \" is inncorrect or not required for callUI\",\r\n        });\r\n      return;\r\n    }\r\n    // TODO 根据 errCode 决定事件 外部函数判断，不写在里面\r\n    if (data.errCode === 3 && data.authCode === 502 && false) {\r\n      event = LOGIN;\r\n    } else {\r\n      event = CONTRACT;\r\n    }\r\n    const arr = eventMap.get(presentableId)?.callBacks || [];\r\n    arr.push({\r\n      resolve,\r\n      reject,\r\n      options,\r\n    });\r\n    let id = presentableId;\r\n    if (event === LOGIN) id = event;\r\n    eventMap.set(id, {\r\n      event, // UI事件用最新的\r\n      eventId: id, // 后期evnetId是要与prsesentableId区分开来的\r\n      ...data,\r\n      callBacks: arr,\r\n    });\r\n    if (options && options.immediate) {\r\n      if (!uiInited) {\r\n        UI && UI();\r\n      } else {\r\n        if (locked) {\r\n          setTimeout(() => {\r\n            updateUI && updateUI();\r\n          }, 0);\r\n        } else {\r\n          updateUI && updateUI();\r\n        }\r\n      }\r\n    }\r\n    uiInited = true;\r\n    return;\r\n  }\r\n  eventMap.set(name, {\r\n    // @ts-ignore\r\n    event: this.event,\r\n    // @ts-ignore\r\n    eventId: name, // 后期evnetId是要与prsesentableId区分开来的\r\n    presentableId,\r\n    callBacks: [\r\n      {\r\n        resolve,\r\n        reject,\r\n        options,\r\n      },\r\n    ],\r\n  });\r\n  UI && UI();\r\n  uiInited = true;\r\n}\r\nexport function callAuth() {\r\n  if (!uiInited) {\r\n    UI && UI();\r\n  } else {\r\n    if (locked) {\r\n      setTimeout(() => {\r\n        updateUI && updateUI();\r\n      }, 0);\r\n    } else {\r\n      updateUI && updateUI();\r\n    }\r\n  }\r\n}\r\nexport function updateEvent(event:any) {\r\n  if(!event) return eventMap\r\n  eventMap.set(event.eventId, event)\r\n  return eventMap\r\n}\r\nfunction removeEvent(eventId?: string) {\r\n  if(eventId){\r\n    eventMap.delete(eventId);\r\n  }else{\r\n    eventMap.clear()\r\n  }\r\n  if (locked) {\r\n    setTimeout(() => {\r\n      updateUI && updateUI();\r\n    }, 0);\r\n  } else {\r\n    updateUI && updateUI();\r\n  }\r\n}\r\nexport function endEvent(eventId: string, type: number, data: any) {\r\n  // if (eventMap.get(eventId)) {\r\n    // TODO 重复代码\r\n    switch (type) {\r\n      case SUCCESS:\r\n        eventMap.get(eventId).callBacks.forEach((item: any) => {\r\n          item.resolve(data);\r\n        });\r\n        presentableQueue.delete(eventId);\r\n        removeEvent(eventId);\r\n        break;\r\n      case FAILED:\r\n        eventMap.get(eventId).callBacks.forEach((item: any) => {\r\n          item.reject(FAILED, data);\r\n        });\r\n        presentableQueue.delete(eventId);\r\n        removeEvent(eventId);\r\n        break;\r\n      case USER_CANCEL:\r\n        eventMap.forEach((event:any)=>{\r\n          event.callBacks.forEach((item: any) => {\r\n            item.reject(USER_CANCEL, data);\r\n          });\r\n        }) \r\n        presentableQueue.clear();\r\n        removeEvent();\r\n        console.log(presentableQueue)\r\n        break;\r\n    }\r\n  // }\r\n}\r\n","export const LOGIN = 0;\r\nexport const CONTRACT = 1;\r\n\r\nexport const SUCCESS = 0;\r\nexport const FAILED = 1;\r\nexport const USER_CANCEL = 2;\r\n","import axios from \"./request\";\r\nimport { placeHolder, baseConfig } from \"./base\";\r\nimport { compareObjects } from \"../utils/utils\";\r\nimport { setPresentableQueue } from \"../bridge/index\";\r\n/**\r\n *\r\n * @param action api namespace.apiName\r\n * @param urlData array, use item for replace url's placeholder\r\n * @param data  body data or query data  string | object | Array<any> | null | JSON | undefined\r\n */\r\nexport default function frequest(\r\n  action: any,\r\n  urlData: Array<string | number> | null | undefined | \"\",\r\n  data: any,\r\n  returnUrl?: boolean,\r\n  config?: any\r\n): any {\r\n  // @ts-ignore\r\n  const caller = this;\r\n  let api = Object.assign({}, action);\r\n  // type Api2 = Exclude<Api, 'url' | 'before' | 'after'>\r\n  let url = api.url;\r\n  if (url.indexOf(placeHolder) > -1) {\r\n    if (!urlData || !urlData.length) {\r\n      console.error(\"urlData is required: \" + urlData);\r\n      return;\r\n    }\r\n    urlData.forEach((item) => {\r\n      url = url.replace(placeHolder, item + \"\");\r\n    });\r\n  }\r\n  // filter data if there is dataModel\r\n  if (api.dataModel) {\r\n    // TODO 需要用deepclone\r\n    data = Object.assign({}, data);\r\n    compareObjects(api.dataModel, data, !!api.isDiff);\r\n  }\r\n  // pre method\r\n  if (api.before) {\r\n    data = api.before(data) || data;\r\n  }\r\n  if (api.method.toLowerCase() === \"get\") {\r\n    api.params = data;\r\n  } else {\r\n    api.data = data;\r\n  }\r\n  // delete extra keys\r\n  [\"url\", \"before\", \"after\"].forEach((item) => {\r\n    delete api[item];\r\n  });\r\n  let _config: any = {};\r\n  if (config) {\r\n    [\"onUploadProgress\", \"onDownloadProgress\", \"responseType\"].forEach(\r\n      (key) => {\r\n        if (config[key]) _config[key] = config[key];\r\n      }\r\n    );\r\n  }\r\n  let _api = Object.assign(_config, baseConfig, api);\r\n  if (returnUrl && _api.method.toLowerCase() === \"get\") {\r\n    let query = \"\";\r\n    if (_api.params) {\r\n      Object.keys(_api.params).forEach((key) => {\r\n        query = query + \"&\" + key + \"=\" + _api.params[key];\r\n      });\r\n    }\r\n    if (query) {\r\n      query = \"?\" + query;\r\n    }\r\n    return _api.baseURL + url + query;\r\n  }\r\n  // show msg\r\n  return new Promise((resolve, reject) => {\r\n    axios(url, _api)\r\n      .then(async (response) => {\r\n         /** 301 合同未获得授权\r\n         *  303 标的物未签约\r\n         *  502 未登陆的用户\r\n         */\r\n        api.after && api.after(response);\r\n        //最外面拦截到errCode === 30 时需要跳转登录    \r\n       \r\n        // if(response.data.errCode === 30){\r\n        //   // TODO 需要登录的也是未授权\r\n        // }\r\n        // TODO 仅授权失败\r\n        if (\r\n          response.data.errCode &&\r\n          response.data.errCode === 3 &&\r\n          caller &&\r\n          (caller.presentableId || caller.resourceIdOrName)\r\n        ) {\r\n          const presentableId = response.headers[\"freelog-presentable-id\"];\r\n          const presentableName = decodeURI(\r\n            response.headers[\"freelog-presentable-name\"]\r\n          );\r\n          setPresentableQueue(presentableId, {\r\n            widget: caller.name,\r\n            errCode: response.data.errCode,\r\n            authCode: response.data.data.authCode,\r\n            contracts: response.data.data.data.contracts || [],\r\n            policies: response.data.data.data.policies,\r\n            presentableName,\r\n            presentableId,\r\n            info: response.data,\r\n          });\r\n          resolve({\r\n            data: {\r\n              errCode: 3,\r\n              authCode: response.data.errCode,\r\n              presentableName,\r\n              presentableId,\r\n              errorMsg: response.data.data.errorMsg,\r\n            },\r\n          });\r\n          return;\r\n        } else {\r\n          resolve(response);\r\n        }\r\n      })\r\n      .catch((error) => {\r\n        // 防止error为空\r\n        reject({ error });\r\n        if (typeof error === \"string\") {\r\n        } else {\r\n        }\r\n      });\r\n  });\r\n}\r\n","\r\nimport { placeHolder } from \"../../base\";\r\n\r\nexport type User = {\r\n  login: any;\r\n  loginOut: any;\r\n  getCurrent: any;\r\n  getAccount:any;\r\n  getAuthCode: any;\r\n  postRegister:any\r\n};\r\n\r\nconst user:User = {\r\n  login: {\r\n    url: `passport/login`,\r\n    method: \"post\",\r\n    dataModel: {\r\n      loginName: \"string\",\r\n      password: \"string\",\r\n      isRemember: \"string\",\r\n      returnUrl: \"string\",\r\n      jwtType: \"string\",\r\n    },\r\n  },\r\n  loginOut: {\r\n    url: `passport/logout`,\r\n    method: \"post\",\r\n    params: {\r\n      returnUrl: \"string\",\r\n    },\r\n  },\r\n  getCurrent: {\r\n    url: `users/current`,\r\n    method: \"get\",\r\n  },\r\n  getAccount:{\r\n    url: `accounts/individualAccounts/${placeHolder}`,\r\n    method: \"get\",\r\n  },\r\n  postRegister:{\r\n    url: `users`,\r\n    method: \"post\",\r\n    dataModel: {\r\n      loginName: \"string\",\r\n      password: \"string\",\r\n      username: \"string\",\r\n      authCode: \"string\",\r\n    }\r\n  },\r\n  getAuthCode:{\r\n    url: `messages/send`,\r\n    method: \"post\",\r\n    dataModel: {\r\n      loginName: \"string\",\r\n      authCodeType: \"string\",\r\n    }\r\n  }\r\n};\r\n\r\n \r\n\r\nexport default user;\r\n","import { placeHolder } from \"../../base\";\r\n\r\nexport type Event = {\r\n \r\n  pay: any;\r\n};\r\n\r\nconst event: Event = {\r\n   \r\n  pay: {\r\n    url: `contracts/${placeHolder}/events/payment`,\r\n    method: \"POST\",\r\n    dataModel: {\r\n      eventId: \"string\",\r\n      accountId: \"int\",\r\n      transactionAmount: \"string\",\r\n      password: \"string\" \r\n    },\r\n  },\r\n};\r\nexport default event;\r\n","import { placeHolder } from \"../../base\";\r\n\r\nexport type Transaction = {\r\n    getRecord: any;\r\n};\r\n\r\nconst transaction: Transaction = {\r\n  getRecord: {\r\n    url: `transactions/records/${placeHolder}`,\r\n    method: \"get\"\r\n  },\r\n};\r\nexport default transaction;\r\n","import { placeHolder } from \"../../base\";\r\n\r\n// TODO  需要给data或params定义类型\r\n\r\nexport type Presentable = {\r\n  getPagingPresentables: any;\r\n  getPresentables: any;\r\n  getByPresentableId: any;\r\n  getByResourceIdOrName: any;\r\n  getTestPagingData: any;\r\n  getTestByPresentableId: any;\r\n  getTestByResourceIdOrName: any;\r\n  getPresentableDetail: any\r\n};\r\n\r\nconst presentable: Presentable = {\r\n  // presentableId, result|info|resourceInfo|fileStream\r\n  getPresentableDetail: {\r\n    url: `presentables/${placeHolder}`,\r\n    method: \"GET\",\r\n  },\r\n  getPagingPresentables: {\r\n    url: \"presentables\",\r\n    method: \"GET\",\r\n    dataModel: {\r\n      nodeId: \"string\",\r\n      skip: \"string\",\r\n      limit: \"string\",\r\n      resourceType: \"string\",\r\n      omitResourceType: \"string\",\r\n      onlineStatus: \"string\",\r\n      tags: \"string\",\r\n      projection: \"string\",\r\n      keywords: \"string\",\r\n      isLoadVersionProperty: \"string\",\r\n      isLoadPolicyInfo: \"string\",\r\n    },\r\n  },\r\n  getPresentables: {\r\n    url: \"presentables/list\",\r\n    method: \"GET\",\r\n    dataModel: {\r\n      nodeId: \"string\",\r\n      userId: \"string\",\r\n      presentableIds: \"string\",\r\n      resourceIds: \"string\",\r\n      resourceNames: \"string\",\r\n      isLoadVersionProperty: \"string\",\r\n      isLoadPolicyInfo: \"string\",\r\n      projection: \"string\",\r\n    },\r\n  },\r\n  // presentableId, result|info|resourceInfo|fileStream\r\n  getByPresentableId: {\r\n    url: `auths/presentables/${placeHolder}/${placeHolder}`,\r\n    method: \"GET\",\r\n  },\r\n  // nodeId  resourceIdOrName   result|info|resourceInfo|fileStream\r\n  getByResourceIdOrName: {\r\n    url: `auths/presentables/nodes/${placeHolder}/${placeHolder}/${placeHolder}`,\r\n    method: \"GET\",\r\n  },\r\n  getTestPagingData: {\r\n    url: `testNodes/${placeHolder}/testResources`,\r\n    method: \"GET\",\r\n    dataModel: {\r\n      nodeId: \"string\",\r\n      skip: \"string\",\r\n      limit: \"string\",\r\n      resourceType: \"string\",\r\n      onlineStatus: \"string\",\r\n      tags: \"string\",\r\n      omitResourceType: \"string\",\r\n      keywords: \"string\",\r\n    },\r\n  },\r\n  // testResourceId, result|info|fileStream\r\n  getTestByPresentableId: {\r\n    url: `auths/testResources/${placeHolder}/${placeHolder}`,\r\n    method: \"GET\",\r\n  },\r\n  // nodeId  entityIdOrName   result|info|fileStream\r\n  getTestByResourceIdOrName: {\r\n    url: `auths/testResources/nodes/${placeHolder}/${placeHolder}/${placeHolder}`,\r\n    method: \"GET\",\r\n  },\r\n};\r\nexport default presentable;\r\n","import { placeHolder } from '../../base'\r\n\r\n// TODO  需要给data或params定义类型 \r\n\r\nexport type Node = {\r\n    getInfoById: any;\r\n    getInfoByNameOrDomain: any; \r\n    postUserData: any;\r\n    putUserData: any;\r\n    getUserData: any;\r\n};\r\n\r\nconst node: Node = {\r\n    getInfoById: {\r\n        url: `nodes/${placeHolder}`,\r\n        method: 'GET' \r\n    },\r\n    // presentableId, result|info|resourceInfo|fileStream\r\n    getInfoByNameOrDomain: {\r\n        url: `nodes/detail`,\r\n        method: 'GET',\r\n        dataModel: {\r\n            nodeName: 'string',\r\n            nodeDomain: 'string' \r\n        }\r\n    },\r\n    // storages/buckets/.UserNodeData/objects   post\r\n    postUserData: {\r\n        url: `storages/buckets/.UserNodeData/objects/${placeHolder}`,\r\n        method: 'POST' \r\n    },\r\n    // storages/buckets/.UserNodeData/objects/{nodeId}  PUT\r\n    putUserData: {\r\n        url: `storages/buckets/.UserNodeData/objects/${placeHolder}`,\r\n        method: 'PUT' \r\n    },\r\n    // storages/buckets/.UserNodeData/objects/{objectIdOrNodeId}/customPick  GET\r\n    getUserData: {\r\n        url: `storages/buckets/.UserNodeData/objects/${placeHolder}`,\r\n        method: 'GET' \r\n    }\r\n}\r\nexport default node","/**\r\n * 1.开始：流程获取主题  \r\n * 2.准备：获取主题依赖的插件极其依赖   主题里面不能有js   是否请求所有展品名称（相当于id）用于判定根据名称的请求是否需要发起\r\n * 3.判断：插件和依赖授权与否\r\n *     3.1存在没有授权的且为必须授权\r\n *        弹出批量签约 左右滑动滚动方式\r\n *     3.2存在没有授权的且为非必须授权\r\n *        此种情况暂不考虑\r\n * 4.已授权：\r\n *   4.1 准备插件对象 flatternWidgets childrenWidgets sandBoxs \r\n *   4.2 加载主题内的非点击按钮加载的插件\r\n *   4.3 父插件加载完成后加载插件内的插件（获取插件标签失败后转为提供api给插件自己加载）  \r\n *   4.3 准备api提供给插件懒加载或插件内的插件加载（前置方法检查容器是否存在，不存在则终止）\r\n *       考虑问题：插件内部依赖几十个资源，在不同路由里面加载。\r\n *       解决办法：提供\r\n * api汇总：\r\n *   开发者模式：需要与真实节点访问场景相同，因为涉及签约等事件需要开发模式下测试\r\n *          \r\n *       1.多插件模式：即主题模式\r\n *          \r\n *       2.单插件模式：直接加载一个应用，也可认为就写了一个插件的主题\r\n *       理应有主入口\r\n *       提供测试节点，例如snnaenu.devfreelog.com\r\n * \r\n * 展品api：\r\n * 1.获取单个展品\r\n *   公共参数：response-type: result (标准授权响应结果)\r\n *            query参数：\r\n *                parentNid：依赖树上的父级节点ID,一般获取展品子依赖需要传递\r\n *                subResourceIdOrName：子依赖的资源ID或者名称\r\n *            公共http-header：\r\n *                freelog-entity-nid： string\t当前响应的展品的依赖树链路ID\r\n *                freelog-sub-dependencies：\tstring\t当前展品的子依赖,encodeURIComponent编码的json字符串\r\n *                freelog-resource-type： string\t资源类型\r\n *                freelog-resource-property： string\t资源meta信息,encodeURIComponent编码过的json字符串\r\n *            响应类型：result|info|resourceInfo|fileStream\r\n *                result (标准授权响应结果)\r\n *                info (展品信息)\r\n *                resourceInfo (资源信息) \r\n *                fileStream (文件流)\r\n * \r\n *   url1: https://api.freelog.com/v2/auths/presentables/{presentableId}/{result|info|resourceInfo|fileStream}\r\n *         presentableId: 展品id\r\n *         \r\n *   \r\n *   url2: https://api.freelog.com/v2/auths/presentables/nodes/{nodeId}/{resourceIdOrName}/{result|info|resourceInfo|fileStream}\r\n *         presentableId: 展品id\r\n *         resourceIdOrName： 资源ID或者名称,需要encodeURIComponent编码\r\n\r\n * 2.获取多个展品\r\n *   url:  https://api.freelog.com/v2/presentables?nodeId={nodeId}\r\n *        \r\n *        \r\n * \r\n *      skip\t可选\tint\t跳过的数量.默认为0.\r\n        limit\t可选\tint\t本次请求获取的数据条数.一般不允许超过100\r\n        resourceType\t可选\tstring\t资源类型\r\n        omitResourceType\t可选\tstring\t忽略的资源类型,与resourceType参数互斥\r\n        onlineStatus\t可选\tint\t上线状态 (0:下线 1:上线 2:全部) 默认1\r\n        tags\t可选\tstring\t用户创建presentable时设置的自定义标签,多个用\",\"分割\r\n        projection\t可选\tstring\t指定返回的字段,多个用逗号分隔\r\n        keywords\t可选\tstring[1,100]\t搜索关键字,目前支持模糊搜索节点资源名称和资源名称\r\n        isLoadVersionProperty\t可选\tint\t是否响应展品版本属性\r\n        isLoadPolicyInfo\t可选\tint\t是否加载策略信息\r\n *          \r\n */\r\nimport frequest from \"../../services/handler\";\r\nimport presentable from \"../../services/api/modules/presentable\";\r\nimport node from \"../../services/api/modules/node\";\r\nlet isTest = false;\r\nif (\r\n  window.location.href\r\n    .replace(\"http://\", \"\")\r\n    .replace(\"https://\", \"\")\r\n    .indexOf(\"t.\") === 0\r\n) {\r\n  isTest = true;\r\n}\r\n// @ts-ignore\r\nlet nodeId = \"\";\r\nexport function init() {\r\n  //@ts-ignore\r\n  nodeId = window.freelogApp.nodeInfo.nodeId;\r\n}\r\n// 展品非授权信息接口\r\nexport async function getPresentables(query: any): Promise<any> {\r\n  if (query && Object.prototype.toString.call(query) !== \"[object Object]\") {\r\n    return \"query parameter must be object\";\r\n  }\r\n  if (isTest)\r\n    //@ts-ignore\r\n    return frequest.bind({ name: this.name })(\r\n      presentable.getTestPagingData,\r\n      [nodeId],\r\n      {\r\n        ...query,\r\n      }\r\n    );\r\n  //@ts-ignore\r\n  return frequest.bind({ name: this.name })(\r\n    presentable.getPagingPresentables,\r\n    \"\",\r\n    {\r\n      nodeId,\r\n      ...query,\r\n    }\r\n  );\r\n}\r\nexport async function getPresentablesPaging(query: any): Promise<any> {\r\n  if (query && Object.prototype.toString.call(query) !== \"[object Object]\") {\r\n    return \"query parameter must be object\";\r\n  }\r\n  if (isTest)\r\n    // @ts-ignore\r\n    return frequest.bind({ name: this.name })(\r\n      presentable.getTestPagingData,\r\n      [nodeId],\r\n      {\r\n        ...query,\r\n      }\r\n    );\r\n  // @ts-ignore\r\n  return frequest.bind({ name: this.name })(\r\n    presentable.getPagingPresentables,\r\n    \"\",\r\n    {\r\n      nodeId,\r\n      ...query,\r\n    }\r\n  );\r\n}\r\nexport async function getPresentablesSearch(query: any): Promise<any> {\r\n  if (query && Object.prototype.toString.call(query) !== \"[object Object]\") {\r\n    return \"query parameter must be object\";\r\n  }\r\n  if (isTest)\r\n    // @ts-ignore\r\n    return frequest.bind({ name: this.name })(\r\n      presentable.getTestPagingData,\r\n      [nodeId],\r\n      {\r\n        ...query,\r\n      }\r\n    );\r\n  // @ts-ignore\r\n  return frequest.bind({ name: this.name })(presentable.getPresentables, \"\", {\r\n    nodeId,\r\n    ...query,\r\n  });\r\n}\r\n\r\n// 展品授权信息接口\r\nfunction getByPresentableId(\r\n  name: string,\r\n  presentableId: string | number,\r\n  type: string,\r\n  parentNid?: string,\r\n  subResourceIdOrName?: string,\r\n  returnUrl?: boolean,\r\n  config?: any\r\n): Promise<any> | string {\r\n  if (!presentableId) {\r\n    return \"presentableId is required\";\r\n  }\r\n  let test: any = {};\r\n  let form: any = {};\r\n  if (parentNid) {\r\n    test.parentNid = parentNid;\r\n    form.parentNid = parentNid;\r\n  }\r\n  if (subResourceIdOrName) {\r\n    test.subEntityIdOrName = subResourceIdOrName;\r\n    form.subResourceIdOrName = subResourceIdOrName;\r\n  }\r\n  if (isTest)\r\n    return frequest.bind({ name, presentableId })(\r\n      presentable.getTestByPresentableId,\r\n      [presentableId, type],\r\n      test,\r\n      returnUrl,\r\n      config\r\n    );\r\n  return frequest.bind({ name, presentableId: parentNid ? \"\" : presentableId })(\r\n    presentable.getByPresentableId,\r\n    [presentableId, type],\r\n    form,\r\n    returnUrl,\r\n    config\r\n  );\r\n}\r\nexport async function getResultById(presentableId: string | number) {\r\n  // @ts-ignore\r\n  return getByPresentableId(this.name, presentableId, \"result\", \"\", \"\");\r\n}\r\nexport async function getInfoById(presentableId: string | number) {\r\n  // @ts-ignore\r\n  return getByPresentableId(this.name, presentableId, \"info\", \"\", \"\");\r\n}\r\nexport async function getResourceInfoById(presentableId: string | number) {\r\n  if (isTest) return \"not supported!\";\r\n  // @ts-ignore\r\n  return getByPresentableId(this.name, presentableId, \"resourceInfo\", \"\", \"\");\r\n}\r\nexport async function getFileStreamById(\r\n  presentableId: string | number,\r\n  returnUrl?: boolean,\r\n  config?: any\r\n) {\r\n  // @ts-ignore\r\n  return getByPresentableId(\r\n    // @ts-ignore\r\n    this.name,\r\n    presentableId,\r\n    \"fileStream\",\r\n    \"\",\r\n    \"\",\r\n    returnUrl,\r\n    config\r\n  );\r\n}\r\n// 子依赖\r\nexport async function getSubResultById(\r\n  presentableId: string | number,\r\n  parentNid: string,\r\n  subResourceIdOrName: string\r\n) {\r\n  if (!parentNid || !subResourceIdOrName) {\r\n    return \"parentNid and subResourceIdOrName is required!\";\r\n  }\r\n  // @ts-ignore\r\n  return getByPresentableId(\r\n    // @ts-ignore\r\n    this.name,\r\n    presentableId,\r\n    \"result\",\r\n    parentNid,\r\n    subResourceIdOrName\r\n  );\r\n}\r\nexport async function getSubInfoById(\r\n  presentableId: string | number,\r\n  parentNid: string,\r\n  subResourceIdOrName: string\r\n) {\r\n  if (!parentNid || !subResourceIdOrName) {\r\n    return \"parentNid and subResourceIdOrName is required!\";\r\n  }\r\n  // @ts-ignore\r\n  return getByPresentableId(\r\n    // @ts-ignore\r\n    this.name,\r\n    presentableId,\r\n    \"info\",\r\n    parentNid,\r\n    subResourceIdOrName\r\n  );\r\n}\r\nexport async function getSubResourceInfoById(\r\n  presentableId: string | number, // 主题请求自己的依赖，传自己的presentableId 和 自己的parentNid\r\n  parentNid: string, // 主题的依赖请求自己的依赖，传主题的presentableId 和 自己的parentNid\r\n  subResourceIdOrName: string\r\n) {\r\n  if (!parentNid || !subResourceIdOrName) {\r\n    return \"parentNid and subResourceIdOrName is required!\";\r\n  }\r\n  if (isTest) return \"not supported!\";\r\n  // @ts-ignore\r\n  return getByPresentableId(\r\n    // @ts-ignore\r\n    this.name,\r\n    presentableId,\r\n    \"resourceInfo\",\r\n    parentNid,\r\n    subResourceIdOrName\r\n  );\r\n}\r\nexport async function getSubFileStreamById(\r\n  presentableId: string | number,\r\n  parentNid: string,\r\n  subResourceIdOrName: string,\r\n  returnUrl?: boolean,\r\n  config?: any\r\n) {\r\n  if (!parentNid || !subResourceIdOrName) {\r\n    return \"parentNid and subResourceIdOrName is required!\";\r\n  }\r\n  // @ts-ignore\r\n  return getByPresentableId(\r\n    // @ts-ignore\r\n    this.name,\r\n    presentableId,\r\n    \"fileStream\",\r\n    parentNid,\r\n    subResourceIdOrName,\r\n    returnUrl,\r\n    config\r\n  );\r\n}\r\n\r\n// TODO return a promise\r\nfunction getByResourceIdOrName(\r\n  name: string,\r\n  resourceIdOrName: string | number,\r\n  type: string,\r\n  parentNid?: string,\r\n  subResourceIdOrName?: string,\r\n  returnUrl?: boolean,\r\n  config?: any\r\n): Promise<any> | string {\r\n  if (!resourceIdOrName) {\r\n    return \"resourceIdOrName is required\";\r\n  }\r\n  let test: any = {};\r\n  let form: any = {};\r\n  if (parentNid) {\r\n    test.parentNid = parentNid;\r\n    form.parentNid = parentNid;\r\n  }\r\n  if (subResourceIdOrName) {\r\n    test.subEntityIdOrName = subResourceIdOrName;\r\n    form.subResourceIdOrName = subResourceIdOrName;\r\n  }\r\n  if (isTest)\r\n    return frequest.bind({\r\n      name,\r\n      resourceIdOrName: parentNid ? \"\" : resourceIdOrName,\r\n    })(\r\n      presentable.getTestByResourceIdOrName,\r\n      [resourceIdOrName, type],\r\n      test,\r\n      returnUrl,\r\n      config\r\n    );\r\n  return frequest.bind({\r\n    name,\r\n    resourceIdOrName: parentNid ? \"\" : resourceIdOrName,\r\n  })(\r\n    presentable.getByResourceIdOrName,\r\n    [nodeId, resourceIdOrName, type],\r\n    form,\r\n    returnUrl,\r\n    config\r\n  );\r\n}\r\nexport async function getResultByName(resourceIdOrName: string | number) {\r\n  // @ts-ignore\r\n  return getByResourceIdOrName(this.name, resourceIdOrName, \"result\", \"\", \"\");\r\n}\r\nexport async function getInfoByName(resourceIdOrName: string | number) {\r\n  // @ts-ignore\r\n  return getByResourceIdOrName(this.name, resourceIdOrName, \"info\", \"\", \"\");\r\n}\r\nexport async function getResourceInfoByName(resourceIdOrName: string | number) {\r\n  if (isTest) return \"not supported!\";\r\n  // @ts-ignore\r\n  return getByResourceIdOrName(\r\n    // @ts-ignore\r\n    this.name,\r\n    resourceIdOrName,\r\n    \"resourceInfo\",\r\n    \"\",\r\n    \"\"\r\n  );\r\n}\r\nexport async function getFileStreamByName(\r\n  resourceIdOrName: string | number,\r\n  returnUrl?: boolean,\r\n  config?: any\r\n) {\r\n  // @ts-ignore\r\n  return getByResourceIdOrName(\r\n    // @ts-ignore\r\n    this.name,\r\n    resourceIdOrName,\r\n    \"fileStream\",\r\n    \"\",\r\n    \"\",\r\n    returnUrl,\r\n    config\r\n  );\r\n}\r\n// sub\r\nexport async function getSubResultByName(\r\n  resourceIdOrName: string | number,\r\n  parentNid: string,\r\n  subResourceIdOrName: string\r\n) {\r\n  if (!parentNid || !subResourceIdOrName) {\r\n    return \"parentNid and subResourceIdOrName is required!\";\r\n  }\r\n  return getByResourceIdOrName(\r\n    // @ts-ignore\r\n    this.name,\r\n    resourceIdOrName,\r\n    \"result\",\r\n    parentNid,\r\n    subResourceIdOrName\r\n  );\r\n}\r\nexport async function getSubInfoByName(\r\n  resourceIdOrName: string | number,\r\n  parentNid: string,\r\n  subResourceIdOrName: string\r\n) {\r\n  if (!parentNid || !subResourceIdOrName) {\r\n    return \"parentNid and subResourceIdOrName is required!\";\r\n  }\r\n  return getByResourceIdOrName(\r\n    // @ts-ignore\r\n    this.name,\r\n    resourceIdOrName,\r\n    \"info\",\r\n    parentNid,\r\n    subResourceIdOrName\r\n  );\r\n}\r\nexport async function getSubResourceInfoByName(\r\n  resourceIdOrName: string | number,\r\n  parentNid: string,\r\n  subResourceIdOrName: string\r\n) {\r\n  if (!parentNid || !subResourceIdOrName) {\r\n    return \"parentNid and subResourceIdOrName is required!\";\r\n  }\r\n  if (isTest) return \"not supported!\";\r\n  return getByResourceIdOrName(\r\n    // @ts-ignore\r\n    this.name,\r\n    resourceIdOrName,\r\n    \"resourceInfo\",\r\n    parentNid,\r\n    subResourceIdOrName\r\n  );\r\n}\r\nexport async function getSubFileStreamByName(\r\n  resourceIdOrName: string | number,\r\n  parentNid: string,\r\n  subResourceIdOrName: string,\r\n  returnUrl?: boolean,\r\n  config?: any\r\n) {\r\n  if (!parentNid || !subResourceIdOrName) {\r\n    return \"parentNid and subResourceIdOrName is required!\";\r\n  }\r\n  return getByResourceIdOrName(\r\n    // @ts-ignore\r\n    this.name,\r\n    resourceIdOrName,\r\n    \"fileStream\",\r\n    parentNid,\r\n    subResourceIdOrName,\r\n    returnUrl,\r\n    config\r\n  );\r\n}\r\n\r\n// user data\r\nexport async function getUserData() {\r\n  // @ts-ignore\r\n  return frequest(node.getUserData, [nodeId], { fields: this.name });\r\n}\r\n\r\n// user data\r\nexport async function saveUserData() {\r\n  // @ts-ignore\r\n  return frequest(node.putUserData, [nodeId], { fields: this.name });\r\n}\r\n","import { objectType, toName } from \"./app.helpers\";\r\n\r\nlet errorHandlers = [];\r\n\r\nexport function handleAppError(err, app, newStatus) {\r\n  const transformedErr = transformErr(err, app, newStatus);\r\n\r\n  if (errorHandlers.length) {\r\n    errorHandlers.forEach((handler) => handler(transformedErr));\r\n  } else {\r\n    setTimeout(() => {\r\n      throw transformedErr;\r\n    });\r\n  }\r\n}\r\n\r\nexport function addErrorHandler(handler) {\r\n  if (typeof handler !== \"function\") {\r\n    throw Error(\r\n      formatErrorMessage(\r\n        28,\r\n        window.__DEV__ && \"a single-spa error handler must be a function\"\r\n      )\r\n    );\r\n  }\r\n\r\n  errorHandlers.push(handler);\r\n}\r\n\r\nexport function removeErrorHandler(handler) {\r\n  if (typeof handler !== \"function\") {\r\n    throw Error(\r\n      formatErrorMessage(\r\n        29,\r\n        window.__DEV__ && \"a single-spa error handler must be a function\"\r\n      )\r\n    );\r\n  }\r\n\r\n  let removedSomething = false;\r\n  errorHandlers = errorHandlers.filter((h) => {\r\n    const isHandler = h === handler;\r\n    removedSomething = removedSomething || isHandler;\r\n    return !isHandler;\r\n  });\r\n\r\n  return removedSomething;\r\n}\r\n\r\nexport function formatErrorMessage(code, msg, ...args) {\r\n  return `single-spa minified message #${code}: ${\r\n    msg ? msg + \" \" : \"\"\r\n  }See https://single-spa.js.org/error/?code=${code}${\r\n    args.length ? `&arg=${args.join(\"&arg=\")}` : \"\"\r\n  }`;\r\n}\r\n\r\nexport function transformErr(ogErr, appOrParcel, newStatus) {\r\n  const errPrefix = `${objectType(appOrParcel)} '${toName(\r\n    appOrParcel\r\n  )}' died in status ${appOrParcel.status}: `;\r\n\r\n  let result;\r\n\r\n  if (ogErr instanceof Error) {\r\n    try {\r\n      ogErr.message = errPrefix + ogErr.message;\r\n    } catch (err) {\r\n      /* Some errors have read-only message properties, in which case there is nothing\r\n       * that we can do.\r\n       */\r\n    }\r\n    result = ogErr;\r\n  } else {\r\n    console.warn(\r\n      formatErrorMessage(\r\n        30,\r\n        window.__DEV__ &&\r\n          `While ${appOrParcel.status}, '${toName(\r\n            appOrParcel\r\n          )}' rejected its lifecycle function promise with a non-Error. This will cause stack traces to not be accurate.`,\r\n        appOrParcel.status,\r\n        toName(appOrParcel)\r\n      )\r\n    );\r\n    try {\r\n      result = Error(errPrefix + JSON.stringify(ogErr));\r\n    } catch (err) {\r\n      // If it's not an Error and you can't stringify it, then what else can you even do to it?\r\n      result = ogErr;\r\n    }\r\n  }\r\n\r\n  result.appOrParcelName = toName(appOrParcel);\r\n\r\n  // We set the status after transforming the error so that the error message\r\n  // references the state the application was in before the status change.\r\n  appOrParcel.status = newStatus;\r\n\r\n  return result;\r\n}\r\n","import { handleAppError } from \"./app-errors.js\";\r\n\r\n// App statuses\r\nexport const NOT_LOADED = \"NOT_LOADED\";\r\nexport const LOADING_SOURCE_CODE = \"LOADING_SOURCE_CODE\";\r\nexport const NOT_BOOTSTRAPPED = \"NOT_BOOTSTRAPPED\";\r\nexport const BOOTSTRAPPING = \"BOOTSTRAPPING\";\r\nexport const NOT_MOUNTED = \"NOT_MOUNTED\";\r\nexport const MOUNTING = \"MOUNTING\";\r\nexport const MOUNTED = \"MOUNTED\";\r\nexport const UPDATING = \"UPDATING\";\r\nexport const UNMOUNTING = \"UNMOUNTING\";\r\nexport const UNLOADING = \"UNLOADING\";\r\nexport const LOAD_ERROR = \"LOAD_ERROR\";\r\nexport const SKIP_BECAUSE_BROKEN = \"SKIP_BECAUSE_BROKEN\";\r\n\r\nexport function isActive(app) {\r\n  return app.status === MOUNTED;\r\n}\r\n\r\nexport function shouldBeActive(app) {\r\n  try {\r\n    return app.activeWhen(window.location);\r\n  } catch (err) {\r\n    handleAppError(err, app, SKIP_BECAUSE_BROKEN);\r\n    return false;\r\n  }\r\n}\r\n\r\nexport function toName(app) {\r\n  return app.name;\r\n}\r\n\r\nexport function isParcel(appOrParcel) {\r\n  return Boolean(appOrParcel.unmountThisParcel);\r\n}\r\n\r\nexport function objectType(appOrParcel) {\r\n  return isParcel(appOrParcel) ? \"parcel\" : \"application\";\r\n}\r\n","// Object.assign() is not available in IE11. And the babel compiled output for object spread\r\n// syntax checks a bunch of Symbol stuff and is almost a kb. So this function is the smaller replacement.\r\nexport function assign() {\r\n  for (let i = arguments.length - 1; i > 0; i--) {\r\n    for (let key in arguments[i]) {\r\n      if (key === \"__proto__\") {\r\n        continue;\r\n      }\r\n      arguments[i - 1][key] = arguments[i][key];\r\n    }\r\n  }\r\n\r\n  return arguments[0];\r\n}\r\n","import { find } from \"../utils/find.js\";\r\nimport { objectType, toName } from \"../applications/app.helpers.js\";\r\nimport { formatErrorMessage } from \"../applications/app-errors.js\";\r\n\r\nexport function validLifecycleFn(fn) {\r\n  return fn && (typeof fn === \"function\" || isArrayOfFns(fn));\r\n\r\n  function isArrayOfFns(arr) {\r\n    return (\r\n      Array.isArray(arr) && !find(arr, (item) => typeof item !== \"function\")\r\n    );\r\n  }\r\n}\r\n\r\nexport function flattenFnArray(appOrParcel, lifecycle) {\r\n  let fns = appOrParcel[lifecycle] || [];\r\n  fns = Array.isArray(fns) ? fns : [fns];\r\n  if (fns.length === 0) {\r\n    fns = [() => Promise.resolve()];\r\n  }\r\n\r\n  const type = objectType(appOrParcel);\r\n  const name = toName(appOrParcel);\r\n\r\n  return function (props) {\r\n    return fns.reduce((resultPromise, fn, index) => {\r\n      return resultPromise.then(() => {\r\n        const thisPromise = fn(props);\r\n        return smellsLikeAPromise(thisPromise)\r\n          ? thisPromise\r\n          : Promise.reject(\r\n              formatErrorMessage(\r\n                15,\r\n                window.__DEV__ &&\r\n                  `Within ${type} ${name}, the lifecycle function ${lifecycle} at array index ${index} did not return a promise`,\r\n                type,\r\n                name,\r\n                lifecycle,\r\n                index\r\n              )\r\n            );\r\n      });\r\n    }, Promise.resolve());\r\n  };\r\n}\r\n\r\nexport function smellsLikeAPromise(promise) {\r\n  return (\r\n    promise &&\r\n    typeof promise.then === \"function\" &&\r\n    typeof promise.catch === \"function\"\r\n  );\r\n}\r\n","/* the array.prototype.find polyfill on npmjs.com is ~20kb (not worth it)\r\n * and lodash is ~200kb (not worth it)\r\n */\r\n\r\nexport function find(arr, func) {\r\n  for (let i = 0; i < arr.length; i++) {\r\n    if (func(arr[i])) {\r\n      return arr[i];\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n","import {\r\n  NOT_BOOTSTRAPPED,\r\n  BOOTSTRAPPING,\r\n  NOT_MOUNTED,\r\n  SKIP_BECAUSE_BROKEN,\r\n} from \"../applications/app.helpers.js\";\r\nimport { reasonableTime } from \"../applications/timeouts.js\";\r\nimport { handleAppError, transformErr } from \"../applications/app-errors.js\";\r\n\r\nexport function toBootstrapPromise(appOrParcel, hardFail) {\r\n  return Promise.resolve().then(() => {\r\n    if (appOrParcel.status !== NOT_BOOTSTRAPPED) {\r\n      return appOrParcel;\r\n    }\r\n\r\n    appOrParcel.status = BOOTSTRAPPING;\r\n\r\n    if (!appOrParcel.bootstrap) {\r\n      // Default implementation of bootstrap\r\n      return Promise.resolve().then(successfulBootstrap);\r\n    }\r\n\r\n    return reasonableTime(appOrParcel, \"bootstrap\")\r\n      .then(successfulBootstrap)\r\n      .catch((err) => {\r\n        if (hardFail) {\r\n          throw transformErr(err, appOrParcel, SKIP_BECAUSE_BROKEN);\r\n        } else {\r\n          handleAppError(err, appOrParcel, SKIP_BECAUSE_BROKEN);\r\n          return appOrParcel;\r\n        }\r\n      });\r\n  });\r\n\r\n  function successfulBootstrap() {\r\n    appOrParcel.status = NOT_MOUNTED;\r\n    return appOrParcel;\r\n  }\r\n}\r\n","import {\r\n  UNMOUNTING,\r\n  NOT_MOUNTED,\r\n  MOUNTED,\r\n  SKIP_BECAUSE_BROKEN,\r\n} from \"../applications/app.helpers.js\";\r\nimport { handleAppError, transformErr } from \"../applications/app-errors.js\";\r\nimport { reasonableTime } from \"../applications/timeouts.js\";\r\n\r\nexport function toUnmountPromise(appOrParcel, hardFail) {\r\n  return Promise.resolve().then(() => {\r\n    if (appOrParcel.status !== MOUNTED) {\r\n      return appOrParcel;\r\n    }\r\n    appOrParcel.status = UNMOUNTING;\r\n\r\n    const unmountChildrenParcels = Object.keys(\r\n      appOrParcel.parcels\r\n    ).map((parcelId) => appOrParcel.parcels[parcelId].unmountThisParcel());\r\n\r\n    let parcelError;\r\n\r\n    return Promise.all(unmountChildrenParcels)\r\n      .then(unmountAppOrParcel, (parcelError) => {\r\n        // There is a parcel unmount error\r\n        return unmountAppOrParcel().then(() => {\r\n          // Unmounting the app/parcel succeeded, but unmounting its children parcels did not\r\n          const parentError = Error(parcelError.message);\r\n          if (hardFail) {\r\n            throw transformErr(parentError, appOrParcel, SKIP_BECAUSE_BROKEN);\r\n          } else {\r\n            handleAppError(parentError, appOrParcel, SKIP_BECAUSE_BROKEN);\r\n          }\r\n        });\r\n      })\r\n      .then(() => appOrParcel);\r\n\r\n    function unmountAppOrParcel() {\r\n      // We always try to unmount the appOrParcel, even if the children parcels failed to unmount.\r\n      return reasonableTime(appOrParcel, \"unmount\")\r\n        .then(() => {\r\n          // The appOrParcel needs to stay in a broken status if its children parcels fail to unmount\r\n          if (!parcelError) {\r\n            appOrParcel.status = NOT_MOUNTED;\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          if (hardFail) {\r\n            throw transformErr(err, appOrParcel, SKIP_BECAUSE_BROKEN);\r\n          } else {\r\n            handleAppError(err, appOrParcel, SKIP_BECAUSE_BROKEN);\r\n          }\r\n        });\r\n    }\r\n  });\r\n}\r\n","import {\r\n  NOT_MOUNTED,\r\n  MOUNTED,\r\n  SKIP_BECAUSE_BROKEN,\r\n} from \"../applications/app.helpers.js\";\r\nimport { handleAppError, transformErr } from \"../applications/app-errors.js\";\r\nimport { reasonableTime } from \"../applications/timeouts.js\";\r\nimport CustomEvent from \"custom-event\";\r\nimport { toUnmountPromise } from \"./unmount.js\";\r\n\r\nlet beforeFirstMountFired = false;\r\nlet firstMountFired = false;\r\n\r\nexport function toMountPromise(appOrParcel, hardFail) {\r\n  return Promise.resolve().then(() => {\r\n    if (appOrParcel.status !== NOT_MOUNTED) {\r\n      return appOrParcel;\r\n    }\r\n\r\n    if (!beforeFirstMountFired) {\r\n      window.dispatchEvent(new CustomEvent(\"single-spa:before-first-mount\"));\r\n      beforeFirstMountFired = true;\r\n    }\r\n\r\n    return reasonableTime(appOrParcel, \"mount\")\r\n      .then(() => {\r\n        appOrParcel.status = MOUNTED;\r\n\r\n        if (!firstMountFired) {\r\n          window.dispatchEvent(new CustomEvent(\"single-spa:first-mount\"));\r\n          firstMountFired = true;\r\n        }\r\n\r\n        return appOrParcel;\r\n      })\r\n      .catch((err) => {\r\n        // If we fail to mount the appOrParcel, we should attempt to unmount it before putting in SKIP_BECAUSE_BROKEN\r\n        // We temporarily put the appOrParcel into MOUNTED status so that toUnmountPromise actually attempts to unmount it\r\n        // instead of just doing a no-op.\r\n        appOrParcel.status = MOUNTED;\r\n        return toUnmountPromise(appOrParcel, true).then(\r\n          setSkipBecauseBroken,\r\n          setSkipBecauseBroken\r\n        );\r\n\r\n        function setSkipBecauseBroken() {\r\n          if (!hardFail) {\r\n            handleAppError(err, appOrParcel, SKIP_BECAUSE_BROKEN);\r\n            return appOrParcel;\r\n          } else {\r\n            throw transformErr(err, appOrParcel, SKIP_BECAUSE_BROKEN);\r\n          }\r\n        }\r\n      });\r\n  });\r\n}\r\n","import {\r\n  validLifecycleFn,\r\n  flattenFnArray,\r\n} from \"../lifecycles/lifecycle.helpers.js\";\r\nimport {\r\n  NOT_BOOTSTRAPPED,\r\n  NOT_MOUNTED,\r\n  MOUNTED,\r\n  LOADING_SOURCE_CODE,\r\n  SKIP_BECAUSE_BROKEN,\r\n  toName,\r\n} from \"../applications/app.helpers.js\";\r\nimport { toBootstrapPromise } from \"../lifecycles/bootstrap.js\";\r\nimport { toMountPromise } from \"../lifecycles/mount.js\";\r\nimport { toUpdatePromise } from \"../lifecycles/update.js\";\r\nimport { toUnmountPromise } from \"../lifecycles/unmount.js\";\r\nimport { ensureValidAppTimeouts } from \"../applications/timeouts.js\";\r\nimport { formatErrorMessage } from \"../applications/app-errors.js\";\r\n\r\nlet parcelCount = 0;\r\nconst rootParcels = { parcels: {} };\r\n\r\n// This is a public api, exported to users of single-spa\r\nexport function mountRootParcel() {\r\n  return mountParcel.apply(rootParcels, arguments);\r\n}\r\n\r\nexport function mountParcel(config, customProps) {\r\n  const owningAppOrParcel = this;\r\n  var name = config.name || ''\r\n  // Validate inputs\r\n  if (!config || (typeof config !== \"object\" && typeof config !== \"function\")) {\r\n    throw Error(\r\n      formatErrorMessage(\r\n        2,\r\n        window.__DEV__ &&\r\n          \"Cannot mount parcel without a config object or config loading function\"\r\n      )\r\n    );\r\n  }\r\n\r\n  if (config.name && typeof config.name !== \"string\") {\r\n    throw Error(\r\n      formatErrorMessage(\r\n        3,\r\n        window.__DEV__ &&\r\n          `Parcel name must be a string, if provided. Was given ${typeof config.name}`,\r\n        typeof config.name\r\n      )\r\n    );\r\n  }\r\n\r\n  if (typeof customProps !== \"object\") {\r\n    throw Error(\r\n      formatErrorMessage(\r\n        4,\r\n        window.__DEV__ &&\r\n          `Parcel ${name} has invalid customProps -- must be an object but was given ${typeof customProps}`,\r\n        name,\r\n        typeof customProps\r\n      )\r\n    );\r\n  }\r\n\r\n  if (!customProps.domElement) {\r\n    throw Error(\r\n      formatErrorMessage(\r\n        5,\r\n        window.__DEV__ &&\r\n          `Parcel ${name} cannot be mounted without a domElement provided as a prop`,\r\n        name\r\n      )\r\n    );\r\n  }\r\n\r\n  const id = parcelCount++;\r\n\r\n  const passedConfigLoadingFunction = typeof config === \"function\";\r\n  const configLoadingFunction = passedConfigLoadingFunction\r\n    ? config\r\n    : () => Promise.resolve(config);\r\n\r\n  // Internal representation\r\n  const parcel = {\r\n    id,\r\n    parcels: {},\r\n    status: passedConfigLoadingFunction\r\n      ? LOADING_SOURCE_CODE\r\n      : NOT_BOOTSTRAPPED,\r\n    customProps,\r\n    parentName: toName(owningAppOrParcel),\r\n    unmountThisParcel() {\r\n      if (parcel.status !== MOUNTED) {\r\n        throw Error(\r\n          formatErrorMessage(\r\n            6,\r\n            window.__DEV__ &&\r\n              `Cannot unmount parcel '${name}' -- it is in a ${parcel.status} status`,\r\n            name,\r\n            parcel.status\r\n          )\r\n        );\r\n      }\r\n\r\n      return toUnmountPromise(parcel, true)\r\n        .then((value) => {\r\n          if (parcel.parentName) {\r\n            delete owningAppOrParcel.parcels[parcel.id];\r\n          }\r\n\r\n          return value;\r\n        })\r\n        .then((value) => {\r\n          resolveUnmount(value);\r\n          return value;\r\n        })\r\n        .catch((err) => {\r\n          parcel.status = SKIP_BECAUSE_BROKEN;\r\n          rejectUnmount(err);\r\n          throw err;\r\n        });\r\n    },\r\n  };\r\n\r\n  // We return an external representation\r\n  let externalRepresentation;\r\n\r\n  // Add to owning app or parcel\r\n  owningAppOrParcel.parcels[id] = parcel;\r\n\r\n  let loadPromise = configLoadingFunction();\r\n\r\n  if (!loadPromise || typeof loadPromise.then !== \"function\") {\r\n    throw Error(\r\n      formatErrorMessage(\r\n        7,\r\n        window.__DEV__ &&\r\n          `When mounting a parcel, the config loading function must return a promise that resolves with the parcel config`\r\n      )\r\n    );\r\n  }\r\n\r\n  loadPromise = loadPromise.then((config) => {\r\n    if (!config) {\r\n      throw Error(\r\n        formatErrorMessage(\r\n          8,\r\n          window.__DEV__ &&\r\n            `When mounting a parcel, the config loading function returned a promise that did not resolve with a parcel config`\r\n        )\r\n      );\r\n    }\r\n\r\n    const name = config.name || `parcel-${id}`;\r\n\r\n    if (\r\n      // ES Module objects don't have the object prototype\r\n      Object.prototype.hasOwnProperty.call(config, \"bootstrap\") &&\r\n      !validLifecycleFn(config.bootstrap)\r\n    ) {\r\n      throw Error(\r\n        formatErrorMessage(\r\n          9,\r\n          window.__DEV__ && `Parcel ${name} provided an invalid bootstrap function`,\r\n          name\r\n        )\r\n      );\r\n    }\r\n\r\n    if (!validLifecycleFn(config.mount)) {\r\n      throw Error(\r\n        formatErrorMessage(\r\n          10,\r\n          window.__DEV__ && `Parcel ${name} must have a valid mount function`,\r\n          name\r\n        )\r\n      );\r\n    }\r\n\r\n    if (!validLifecycleFn(config.unmount)) {\r\n      throw Error(\r\n        formatErrorMessage(\r\n          11,\r\n          window.__DEV__ && `Parcel ${name} must have a valid unmount function`,\r\n          name\r\n        )\r\n      );\r\n    }\r\n\r\n    if (config.update && !validLifecycleFn(config.update)) {\r\n      throw Error(\r\n        formatErrorMessage(\r\n          12,\r\n          window.__DEV__ && `Parcel ${name} provided an invalid update function`,\r\n          name\r\n        )\r\n      );\r\n    }\r\n\r\n    const bootstrap = flattenFnArray(config, \"bootstrap\");\r\n    const mount = flattenFnArray(config, \"mount\");\r\n    const unmount = flattenFnArray(config, \"unmount\");\r\n\r\n    parcel.status = NOT_BOOTSTRAPPED;\r\n    parcel.name = name;\r\n    parcel.bootstrap = bootstrap;\r\n    parcel.mount = mount;\r\n    parcel.unmount = unmount;\r\n    parcel.timeouts = ensureValidAppTimeouts(config.timeouts);\r\n\r\n    if (config.update) {\r\n      parcel.update = flattenFnArray(config, \"update\");\r\n      externalRepresentation.update = function (customProps) {\r\n        parcel.customProps = customProps;\r\n\r\n        return promiseWithoutReturnValue(toUpdatePromise(parcel));\r\n      };\r\n    }\r\n  });\r\n\r\n  // Start bootstrapping and mounting\r\n  // The .then() causes the work to be put on the event loop instead of happening immediately\r\n  const bootstrapPromise = loadPromise.then(() =>\r\n    toBootstrapPromise(parcel, true)\r\n  );\r\n  const mountPromise = bootstrapPromise.then(() =>\r\n    toMountPromise(parcel, true)\r\n  );\r\n\r\n  let resolveUnmount, rejectUnmount;\r\n\r\n  const unmountPromise = new Promise((resolve, reject) => {\r\n    resolveUnmount = resolve;\r\n    rejectUnmount = reject;\r\n  });\r\n\r\n  externalRepresentation = {\r\n    mount() {\r\n      return promiseWithoutReturnValue(\r\n        Promise.resolve().then(() => {\r\n          if (parcel.status !== NOT_MOUNTED) {\r\n            throw Error(\r\n              formatErrorMessage(\r\n                13,\r\n                window.__DEV__ &&\r\n                  `Cannot mount parcel '${name}' -- it is in a ${parcel.status} status`,\r\n                name,\r\n                parcel.status\r\n              )\r\n            );\r\n          }\r\n\r\n          // Add to owning app or parcel\r\n          owningAppOrParcel.parcels[id] = parcel;\r\n\r\n          return toMountPromise(parcel);\r\n        })\r\n      );\r\n    },\r\n    unmount() {\r\n      return promiseWithoutReturnValue(parcel.unmountThisParcel());\r\n    },\r\n    getStatus() {\r\n      return parcel.status;\r\n    },\r\n    loadPromise: promiseWithoutReturnValue(loadPromise),\r\n    bootstrapPromise: promiseWithoutReturnValue(bootstrapPromise),\r\n    mountPromise: promiseWithoutReturnValue(mountPromise),\r\n    unmountPromise: promiseWithoutReturnValue(unmountPromise),\r\n  };\r\n\r\n  return externalRepresentation;\r\n}\r\n\r\nfunction promiseWithoutReturnValue(promise) {\r\n  return promise.then(() => null);\r\n}\r\n","import {\r\n  UPDATING,\r\n  MOUNTED,\r\n  SKIP_BECAUSE_BROKEN,\r\n  toName,\r\n} from \"../applications/app.helpers.js\";\r\nimport {\r\n  transformErr,\r\n  formatErrorMessage,\r\n} from \"../applications/app-errors.js\";\r\nimport { reasonableTime } from \"../applications/timeouts.js\";\r\n\r\nexport function toUpdatePromise(parcel) {\r\n  return Promise.resolve().then(() => {\r\n    if (parcel.status !== MOUNTED) {\r\n      throw Error(\r\n        formatErrorMessage(\r\n          32,\r\n          window.__DEV__ &&\r\n            `Cannot update parcel '${toName(\r\n              parcel\r\n            )}' because it is not mounted`,\r\n          toName(parcel)\r\n        )\r\n      );\r\n    }\r\n\r\n    parcel.status = UPDATING;\r\n\r\n    return reasonableTime(parcel, \"update\")\r\n      .then(() => {\r\n        parcel.status = MOUNTED;\r\n        return parcel;\r\n      })\r\n      .catch((err) => {\r\n        throw transformErr(err, parcel, SKIP_BECAUSE_BROKEN);\r\n      });\r\n  });\r\n}\r\n","import * as singleSpa from \"../single-spa.js\";\r\nimport { mountParcel } from \"../parcels/mount-parcel.js\";\r\nimport { assign } from \"../utils/assign.js\";\r\nimport { isParcel, toName } from \"../applications/app.helpers.js\";\r\nimport { formatErrorMessage } from \"../applications/app-errors.js\";\r\n\r\nexport function getProps(appOrParcel) {\r\n  const name = toName(appOrParcel);\r\n  let customProps =\r\n    typeof appOrParcel.customProps === \"function\"\r\n      ? appOrParcel.customProps(name, window.location)\r\n      : appOrParcel.customProps;\r\n  if (\r\n    typeof customProps !== \"object\" ||\r\n    customProps === null ||\r\n    Array.isArray(customProps)\r\n  ) {\r\n    customProps = {};\r\n    console.warn(\r\n      formatErrorMessage(\r\n        40,\r\n        window.__DEV__ &&\r\n          `single-spa: ${name}'s customProps function must return an object. Received ${customProps}`\r\n      ),\r\n      name,\r\n      customProps\r\n    );\r\n  }\r\n  const result = assign({}, customProps, {\r\n    name,\r\n    mountParcel: mountParcel.bind(appOrParcel),\r\n    singleSpa,\r\n  });\r\n\r\n  if (isParcel(appOrParcel)) {\r\n    result.unmountSelf = appOrParcel.unmountThisParcel;\r\n  }\r\n\r\n  return result;\r\n}\r\n","import { assign } from \"../utils/assign\";\r\nimport { getProps } from \"../lifecycles/prop.helpers\";\r\nimport { objectType, toName } from \"./app.helpers\";\r\nimport { formatErrorMessage } from \"./app-errors\";\r\n\r\nconst defaultWarningMillis = 1000;\r\n\r\nconst globalTimeoutConfig = {\r\n  bootstrap: {\r\n    millis: 4000,\r\n    dieOnTimeout: false,\r\n    warningMillis: defaultWarningMillis,\r\n  },\r\n  mount: {\r\n    millis: 3000,\r\n    dieOnTimeout: false,\r\n    warningMillis: defaultWarningMillis,\r\n  },\r\n  unmount: {\r\n    millis: 3000,\r\n    dieOnTimeout: false,\r\n    warningMillis: defaultWarningMillis,\r\n  },\r\n  unload: {\r\n    millis: 3000,\r\n    dieOnTimeout: false,\r\n    warningMillis: defaultWarningMillis,\r\n  },\r\n  update: {\r\n    millis: 3000,\r\n    dieOnTimeout: false,\r\n    warningMillis: defaultWarningMillis,\r\n  },\r\n};\r\n\r\nexport function setBootstrapMaxTime(time, dieOnTimeout, warningMillis) {\r\n  if (typeof time !== \"number\" || time <= 0) {\r\n    throw Error(\r\n      formatErrorMessage(\r\n        16,\r\n        window.__DEV__ &&\r\n          `bootstrap max time must be a positive integer number of milliseconds`\r\n      )\r\n    );\r\n  }\r\n\r\n  globalTimeoutConfig.bootstrap = {\r\n    millis: time,\r\n    dieOnTimeout,\r\n    warningMillis: warningMillis || defaultWarningMillis,\r\n  };\r\n}\r\n\r\nexport function setMountMaxTime(time, dieOnTimeout, warningMillis) {\r\n  if (typeof time !== \"number\" || time <= 0) {\r\n    throw Error(\r\n      formatErrorMessage(\r\n        17,\r\n        window.__DEV__ &&\r\n          `mount max time must be a positive integer number of milliseconds`\r\n      )\r\n    );\r\n  }\r\n\r\n  globalTimeoutConfig.mount = {\r\n    millis: time,\r\n    dieOnTimeout,\r\n    warningMillis: warningMillis || defaultWarningMillis,\r\n  };\r\n}\r\n\r\nexport function setUnmountMaxTime(time, dieOnTimeout, warningMillis) {\r\n  if (typeof time !== \"number\" || time <= 0) {\r\n    throw Error(\r\n      formatErrorMessage(\r\n        18,\r\n        window.__DEV__ &&\r\n          `unmount max time must be a positive integer number of milliseconds`\r\n      )\r\n    );\r\n  }\r\n\r\n  globalTimeoutConfig.unmount = {\r\n    millis: time,\r\n    dieOnTimeout,\r\n    warningMillis: warningMillis || defaultWarningMillis,\r\n  };\r\n}\r\n\r\nexport function setUnloadMaxTime(time, dieOnTimeout, warningMillis) {\r\n  if (typeof time !== \"number\" || time <= 0) {\r\n    throw Error(\r\n      formatErrorMessage(\r\n        19,\r\n        window.__DEV__ &&\r\n          `unload max time must be a positive integer number of milliseconds`\r\n      )\r\n    );\r\n  }\r\n\r\n  globalTimeoutConfig.unload = {\r\n    millis: time,\r\n    dieOnTimeout,\r\n    warningMillis: warningMillis || defaultWarningMillis,\r\n  };\r\n}\r\n\r\nexport function reasonableTime(appOrParcel, lifecycle) {\r\n  const timeoutConfig = appOrParcel.timeouts[lifecycle];\r\n  const warningPeriod = timeoutConfig.warningMillis;\r\n  const type = objectType(appOrParcel);\r\n\r\n  return new Promise((resolve, reject) => {\r\n    let finished = false;\r\n    let errored = false;\r\n\r\n    appOrParcel[lifecycle](getProps(appOrParcel))\r\n      .then((val) => {\r\n        finished = true;\r\n        resolve(val);\r\n      })\r\n      .catch((val) => {\r\n        finished = true;\r\n        reject(val);\r\n      });\r\n\r\n    setTimeout(() => maybeTimingOut(1), warningPeriod);\r\n    setTimeout(() => maybeTimingOut(true), timeoutConfig.millis);\r\n\r\n    const errMsg = formatErrorMessage(\r\n      31,\r\n      window.__DEV__ &&\r\n        `Lifecycle function ${lifecycle} for ${type} ${toName(\r\n          appOrParcel\r\n        )} lifecycle did not resolve or reject for ${timeoutConfig.millis} ms.`,\r\n      lifecycle,\r\n      type,\r\n      toName(appOrParcel),\r\n      timeoutConfig.millis\r\n    );\r\n\r\n    function maybeTimingOut(shouldError) {\r\n      if (!finished) {\r\n        if (shouldError === true) {\r\n          errored = true;\r\n          if (timeoutConfig.dieOnTimeout) {\r\n            reject(Error(errMsg));\r\n          } else {\r\n            console.error(errMsg);\r\n            //don't resolve or reject, we're waiting this one out\r\n          }\r\n        } else if (!errored) {\r\n          const numWarnings = shouldError;\r\n          const numMillis = numWarnings * warningPeriod;\r\n          console.warn(errMsg);\r\n          if (numMillis + warningPeriod < timeoutConfig.millis) {\r\n            setTimeout(() => maybeTimingOut(numWarnings + 1), warningPeriod);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nexport function ensureValidAppTimeouts(timeouts) {\r\n  const result = {};\r\n\r\n  for (let key in globalTimeoutConfig) {\r\n    result[key] = assign(\r\n      {},\r\n      globalTimeoutConfig[key],\r\n      (timeouts && timeouts[key]) || {}\r\n    );\r\n  }\r\n\r\n  return result;\r\n}\r\n","import { NOT_LOADED } from \"../applications/app.helpers\";\r\nimport { toLoadPromise } from \"../lifecycles/load\";\r\nimport { toBootstrapPromise } from \"../lifecycles/bootstrap\";\r\n\r\nexport default {\r\n    NOT_LOADED,\r\n    toLoadPromise,\r\n    toBootstrapPromise,\r\n};","import {\r\n  LOAD_ERROR,\r\n  NOT_BOOTSTRAPPED,\r\n  LOADING_SOURCE_CODE,\r\n  SKIP_BECAUSE_BROKEN,\r\n  NOT_LOADED,\r\n  objectType,\r\n  toName,\r\n} from \"../applications/app.helpers.js\";\r\nimport { ensureValidAppTimeouts } from \"../applications/timeouts.js\";\r\nimport {\r\n  handleAppError,\r\n  formatErrorMessage,\r\n} from \"../applications/app-errors.js\";\r\nimport {\r\n  flattenFnArray,\r\n  smellsLikeAPromise,\r\n  validLifecycleFn,\r\n} from \"./lifecycle.helpers.js\";\r\nimport { getProps } from \"./prop.helpers.js\";\r\nimport { assign } from \"../utils/assign.js\";\r\n\r\nexport function toLoadPromise(app) {\r\n  return Promise.resolve().then(() => {\r\n    if (app.loadPromise) {\r\n      return app.loadPromise;\r\n    }\r\n\r\n    if (app.status !== NOT_LOADED && app.status !== LOAD_ERROR) {\r\n      return app;\r\n    }\r\n\r\n    app.status = LOADING_SOURCE_CODE;\r\n\r\n    let appOpts, isUserErr;\r\n\r\n    return (app.loadPromise = Promise.resolve()\r\n      .then(() => {\r\n        const loadPromise = app.loadApp(getProps(app));\r\n        if (!smellsLikeAPromise(loadPromise)) {\r\n          // The name of the app will be prepended to this error message inside of the handleAppError function\r\n          isUserErr = true;\r\n          throw Error(\r\n            formatErrorMessage(\r\n              33,\r\n              window.__DEV__ &&\r\n                `single-spa loading function did not return a promise. Check the second argument to registerApplication('${toName(\r\n                  app\r\n                )}', loadingFunction, activityFunction)`,\r\n              toName(app)\r\n            )\r\n          );\r\n        }\r\n        return loadPromise.then((val) => {\r\n          app.loadErrorTime = null;\r\n\r\n          appOpts = val;\r\n\r\n          let validationErrMessage, validationErrCode;\r\n\r\n          if (typeof appOpts !== \"object\") {\r\n            validationErrCode = 34;\r\n            if (window.__DEV__) {\r\n              validationErrMessage = `does not export anything`;\r\n            }\r\n          }\r\n\r\n          if (\r\n            // ES Modules don't have the Object prototype\r\n            Object.prototype.hasOwnProperty.call(appOpts, \"bootstrap\") &&\r\n            !validLifecycleFn(appOpts.bootstrap)\r\n          ) {\r\n            validationErrCode = 35;\r\n            if (window.__DEV__) {\r\n              validationErrMessage = `does not export a valid bootstrap function or array of functions`;\r\n            }\r\n          }\r\n\r\n          if (!validLifecycleFn(appOpts.mount)) {\r\n            validationErrCode = 36;\r\n            if (window.__DEV__) {\r\n              validationErrMessage = `does not export a bootstrap function or array of functions`;\r\n            }\r\n          }\r\n\r\n          if (!validLifecycleFn(appOpts.unmount)) {\r\n            validationErrCode = 37;\r\n            if (window.__DEV__) {\r\n              validationErrMessage = `does not export a bootstrap function or array of functions`;\r\n            }\r\n          }\r\n\r\n          const type = objectType(appOpts);\r\n\r\n          if (validationErrCode) {\r\n            let appOptsStr;\r\n            try {\r\n              appOptsStr = JSON.stringify(appOpts);\r\n            } catch {}\r\n            console.error(\r\n              formatErrorMessage(\r\n                validationErrCode,\r\n                window.__DEV__ &&\r\n                  `The loading function for single-spa ${type} '${toName(\r\n                    app\r\n                  )}' resolved with the following, which does not have bootstrap, mount, and unmount functions`,\r\n                type,\r\n                toName(app),\r\n                appOptsStr\r\n              ),\r\n              appOpts\r\n            );\r\n            handleAppError(validationErrMessage, app, SKIP_BECAUSE_BROKEN);\r\n            return app;\r\n          }\r\n\r\n          if (appOpts.devtools && appOpts.devtools.overlays) {\r\n            app.devtools.overlays = assign(\r\n              {},\r\n              app.devtools.overlays,\r\n              appOpts.devtools.overlays\r\n            );\r\n          }\r\n\r\n          app.status = NOT_BOOTSTRAPPED;\r\n          app.bootstrap = flattenFnArray(appOpts, \"bootstrap\");\r\n          app.mount = flattenFnArray(appOpts, \"mount\");\r\n          app.unmount = flattenFnArray(appOpts, \"unmount\");\r\n          app.unload = flattenFnArray(appOpts, \"unload\");\r\n          app.timeouts = ensureValidAppTimeouts(appOpts.timeouts);\r\n\r\n          delete app.loadPromise;\r\n\r\n          return app;\r\n        });\r\n      })\r\n      .catch((err) => {\r\n        delete app.loadPromise;\r\n\r\n        let newStatus;\r\n        if (isUserErr) {\r\n          newStatus = SKIP_BECAUSE_BROKEN;\r\n        } else {\r\n          newStatus = LOAD_ERROR;\r\n          app.loadErrorTime = new Date().getTime();\r\n        }\r\n        handleAppError(err, app, newStatus);\r\n\r\n        return app;\r\n      }));\r\n  });\r\n}\r\n","export const isInBrowser = typeof window !== \"undefined\";\r\n"," let hasInitialized = false;\r\n\r\n export function ensureJQuerySupport(jQuery = window.jQuery) {\r\n     if (!jQuery) {\r\n         if (window.$ && window.$.fn && window.$.fn.jquery) {\r\n             jQuery = window.$;\r\n         }\r\n     }\r\n\r\n     if (jQuery && !hasInitialized) {\r\n         const originalJQueryOn = jQuery.fn.on;\r\n         const originalJQueryOff = jQuery.fn.off;\r\n\r\n         jQuery.fn.on = function(eventString, fn) {\r\n             return captureRoutingEvents.call(\r\n                 this,\r\n                 originalJQueryOn,\r\n                 window.addEventListener,\r\n                 eventString,\r\n                 fn,\r\n                 arguments\r\n             );\r\n         };\r\n\r\n         jQuery.fn.off = function(eventString, fn) {\r\n             return captureRoutingEvents.call(\r\n                 this,\r\n                 originalJQueryOff,\r\n                 window.removeEventListener,\r\n                 eventString,\r\n                 fn,\r\n                 arguments\r\n             );\r\n         };\r\n\r\n         hasInitialized = true;\r\n     }\r\n }\r\n\r\n function captureRoutingEvents(\r\n     originalJQueryFunction,\r\n     nativeFunctionToCall,\r\n     eventString,\r\n     fn,\r\n     originalArgs\r\n ) {\r\n     if (typeof eventString !== \"string\") {\r\n         return originalJQueryFunction.apply(this, originalArgs);\r\n     }\r\n\r\n     const eventNames = eventString.split(/\\s+/);\r\n     eventNames.forEach((eventName) => {\r\n         if ([\"hashchange\", \"popstate\"].indexOf(eventName) >= 0) {\r\n             nativeFunctionToCall(eventName, fn);\r\n             eventString = eventString.replace(eventName, \"\");\r\n         }\r\n     });\r\n\r\n     if (eventString.trim() === \"\") {\r\n         return this;\r\n     } else {\r\n         return originalJQueryFunction.apply(this, originalArgs);\r\n     }\r\n }","\r\nimport devtools from \"./devtools/devtools\";\r\nimport { isInBrowser } from \"./utils/runtime-environment.js\";\r\nexport { ensureJQuerySupport }\r\nfrom \"./jquery-support.js\";\r\nexport {\r\n    setBootstrapMaxTime,\r\n    setMountMaxTime,\r\n    setUnmountMaxTime,\r\n    setUnloadMaxTime,\r\n}\r\nfrom \"./applications/timeouts.js\";\r\nwindow.__DEV__ = false;\r\n\r\nexport {\r\n    addErrorHandler,\r\n    removeErrorHandler,\r\n}\r\nfrom \"./applications/app-errors.js\";\r\nexport { mountRootParcel }\r\nfrom \"./parcels/mount-parcel.js\";\r\n\r\nexport {\r\n    NOT_LOADED,\r\n    LOADING_SOURCE_CODE,\r\n    NOT_BOOTSTRAPPED,\r\n    BOOTSTRAPPING,\r\n    NOT_MOUNTED,\r\n    MOUNTING,\r\n    UPDATING,\r\n    LOAD_ERROR,\r\n    MOUNTED,\r\n    UNMOUNTING,\r\n    SKIP_BECAUSE_BROKEN,\r\n}\r\nfrom \"./applications/app.helpers.js\";\r\n\r\n\r\nif (isInBrowser && window.__SINGLE_SPA_DEVTOOLS__) {\r\n    window.__SINGLE_SPA_DEVTOOLS__.exposedMethods = devtools;\r\n}","/**\r\n * @author Kuitos\r\n * @homepage https://github.com/kuitos/\r\n * @since 2019-02-25\r\n * fork from https://github.com/systemjs/systemjs/blob/master/src/extras/global.js\r\n */\r\n\r\nconst isIE11 = typeof navigator !== 'undefined' && navigator.userAgent.indexOf('Trident') !== -1;\r\n\r\nfunction shouldSkipProperty(global, p) {\r\n\tif (\r\n\t\t!global.hasOwnProperty(p) ||\r\n\t\t!isNaN(p) && p < global.length\r\n\t)\r\n\t\treturn true;\r\n\r\n\tif (isIE11) {\r\n\t\t// https://github.com/kuitos/import-html-entry/pull/32，最小化 try 范围\r\n\t\ttry {\r\n\t\t\treturn global[p] && typeof window !== 'undefined' && global[p].parent === window;\r\n\t\t} catch (err) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t} else {\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\n// safari unpredictably lists some new globals first or second in object order\r\nlet firstGlobalProp, secondGlobalProp, lastGlobalProp;\r\n\r\nexport function getGlobalProp(global) {\r\n\tlet cnt = 0;\r\n\tlet lastProp;\r\n\tlet hasIframe = false;\r\n\r\n\tfor (let p in global) {\r\n\t\tif (shouldSkipProperty(global, p))\r\n\t\t\tcontinue;\r\n\r\n\t\t// 遍历 iframe，检查 window 上的属性值是否是 iframe，是则跳过后面的 first 和 second 判断\r\n\t\tfor (let i = 0; i < window.frames.length && !hasIframe; i++) {\r\n\t\t\tconst frame = window.frames[i];\r\n\t\t\tif (frame === global[p]) {\r\n\t\t\t\thasIframe = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!hasIframe && (cnt === 0 && p !== firstGlobalProp || cnt === 1 && p !== secondGlobalProp))\r\n\t\t\treturn p;\r\n\t\tcnt++;\r\n\t\tlastProp = p;\r\n\t}\r\n\r\n\tif (lastProp !== lastGlobalProp)\r\n\t\treturn lastProp;\r\n}\r\n\r\nexport function noteGlobalProps(global) {\r\n\t// alternatively Object.keys(global).pop()\r\n\t// but this may be faster (pending benchmarks)\r\n\tfirstGlobalProp = secondGlobalProp = undefined;\r\n\r\n\tfor (let p in global) {\r\n\t\tif (shouldSkipProperty(global, p))\r\n\t\t\tcontinue;\r\n\t\tif (!firstGlobalProp)\r\n\t\t\tfirstGlobalProp = p;\r\n\t\telse if (!secondGlobalProp)\r\n\t\t\tsecondGlobalProp = p;\r\n\t\tlastGlobalProp = p;\r\n\t}\r\n\r\n\treturn lastGlobalProp;\r\n}\r\n\r\nexport function getInlineCode(match) {\r\n\tconst start = match.indexOf('>') + 1;\r\n\tconst end = match.lastIndexOf('<');\r\n\treturn match.substring(start, end);\r\n}\r\n\r\nexport function defaultGetPublicPath(entry) {\r\n\tif (typeof entry === 'object') {\r\n\t\treturn '/';\r\n\t}\r\n\ttry {\r\n\t\t// URL 构造函数不支持使用 // 前缀的 url\r\n\t\tconst { origin, pathname } = new URL(entry.startsWith('//') ? `${window.location.protocol}${entry}` : entry, window.location.href);\r\n\t\tconst paths = pathname.split('/');\r\n\t\t// 移除最后一个元素\r\n\t\t// paths.pop();\r\n\t\treturn `${origin}${paths.join('/')}/`;\r\n\t} catch (e) {\r\n\t\tconsole.warn(e);\r\n\t\treturn '';\r\n\t}\r\n}\r\n\r\n// Detect whether browser supports `<script type=module>` or not\r\nexport function isModuleScriptSupported() {\r\n\tconst s = document.createElement('script');\r\n\treturn 'noModule' in s;\r\n}\r\n\r\n// RIC and shim for browsers setTimeout() without it\r\nexport const requestIdleCallback =\r\n\twindow.requestIdleCallback ||\r\n\tfunction requestIdleCallback(cb) {\r\n\t\tconst start = Date.now();\r\n\t\treturn setTimeout(() => {\r\n\t\t\tcb({\r\n\t\t\t\tdidTimeout: false,\r\n\t\t\t\ttimeRemaining() {\r\n\t\t\t\t\treturn Math.max(0, 50 - (Date.now() - start));\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t}, 1);\r\n\t};\r\n\r\nexport function readResAsString(response, autoDetectCharset) {\r\n\t// 未启用自动检测\r\n\tif (!autoDetectCharset) {\r\n\t\treturn response.text();\r\n\t}\r\n\r\n\t// 如果没headers，发生在test环境下的mock数据，为兼容原有测试用例\r\n\tif (!response.headers) {\r\n\t\treturn response.text();\r\n\t}\r\n\r\n\t// 如果没返回content-type，走默认逻辑\r\n\tconst contentType = response.headers.get('Content-Type');\r\n\tif (!contentType) {\r\n\t\treturn response.text();\r\n\t}\r\n\r\n\t// 解析content-type内的charset\r\n\t// Content-Type: text/html; charset=utf-8\r\n\t// Content-Type: multipart/form-data; boundary=something\r\n\t// GET请求下不会出现第二种content-type\r\n\tlet charset = 'utf-8';\r\n\tconst parts = contentType.split(';');\r\n\tif (parts.length === 2) {\r\n\t\tconst [, value] = parts[1].split('=');\r\n\t\tconst encoding = value && value.trim();\r\n\t\tif (encoding) {\r\n\t\t\tcharset = encoding;\r\n\t\t}\r\n\t}\r\n\r\n\t// 如果还是utf-8，那么走默认，兼容原有逻辑，这段代码删除也应该工作\r\n\tif (charset.toUpperCase() === 'UTF-8') {\r\n\t\treturn response.text();\r\n\t}\r\n\r\n\t// 走流读取，编码可能是gbk，gb2312等，比如sofa 3默认是gbk编码\r\n\treturn response.blob()\r\n\t\t.then(file => new Promise((resolve, reject) => {\r\n\t\t\tconst reader = new window.FileReader();\r\n\t\t\treader.onload = () => {\r\n\t\t\t\tresolve(reader.result);\r\n\t\t\t};\r\n\t\t\treader.onerror = reject;\r\n\t\t\treader.readAsText(file, charset);\r\n\t\t}));\r\n}\r\n","/**\r\n * @author Kuitos\r\n * @homepage https://github.com/kuitos/\r\n * @since 2018-09-03 15:04\r\n */\r\n import { getInlineCode, isModuleScriptSupported } from './utils';\r\n\r\nconst ALL_SCRIPT_REGEX = /(<script[\\s\\S]*?>)[\\s\\S]*?<\\/script>/gi;\r\nconst SCRIPT_TAG_REGEX = /<(script)\\s+((?!type=('|\")text\\/ng-template\\3).)*?>.*?<\\/\\1>/is;\r\nconst SCRIPT_SRC_REGEX = /.*\\ssrc=('|\")?([^>'\"\\s]+)/;\r\nconst SCRIPT_TYPE_REGEX = /.*\\stype=('|\")?([^>'\"\\s]+)/;\r\nconst SCRIPT_ENTRY_REGEX = /.*\\sentry\\s*.*/;\r\nconst SCRIPT_ASYNC_REGEX = /.*\\sasync\\s*.*/;\r\nconst SCRIPT_NO_MODULE_REGEX = /.*\\snomodule\\s*.*/;\r\nconst SCRIPT_MODULE_REGEX = /.*\\stype=('|\")?module('|\")?\\s*.*/;\r\nconst LINK_TAG_REGEX = /<(link)\\s+.*?>/isg;\r\nconst LINK_PRELOAD_OR_PREFETCH_REGEX = /\\srel=('|\")?(preload|prefetch)\\1/;\r\nconst LINK_HREF_REGEX = /.*\\shref=('|\")?([^>'\"\\s]+)/;\r\nconst LINK_AS_FONT = /.*\\sas=('|\")?font\\1.*/;\r\nconst STYLE_TAG_REGEX = /<style[^>]*>[\\s\\S]*?<\\/style>/gi;\r\nconst STYLE_TYPE_REGEX = /\\s+rel=('|\")?stylesheet\\1.*/;\r\nconst STYLE_HREF_REGEX = /.*\\shref=('|\")?([^>'\"\\s]+)/;\r\nconst HTML_COMMENT_REGEX = /<!--([\\s\\S]*?)-->/g;\r\nconst LINK_IGNORE_REGEX = /<link(\\s+|\\s+.+\\s+)ignore(\\s*|\\s+.*|=.*)>/is;\r\nconst STYLE_IGNORE_REGEX = /<style(\\s+|\\s+.+\\s+)ignore(\\s*|\\s+.*|=.*)>/is;\r\nconst SCRIPT_IGNORE_REGEX = /<script(\\s+|\\s+.+\\s+)ignore(\\s*|\\s+.*|=.*)>/is;\r\n\r\nfunction hasProtocol(url) {\r\n\treturn url.startsWith('//') || url.startsWith('http://') || url.startsWith('https://');\r\n}\r\n\r\nfunction getEntirePath(path, baseURI) {\r\n\t// new URL 虽然可保安全，但我们有特殊需求\r\n\tif(/\\/\\/$/.test(baseURI)){\r\n\t\tbaseURI = baseURI.substr(0, baseURI.length - 1)\r\n\t}\r\n\tif(!/\\/$/.test(baseURI)){\r\n \t\tbaseURI =  baseURI + '/'\r\n\t}\r\n    if(path.startsWith('/')) path = path.replace('/', '') \r\n\tconst url = baseURI + path\r\n\treturn url\r\n\r\n\t// return new URL(path, baseURI).toString();\r\n}\r\n\r\nfunction isValidJavaScriptType(type) {\r\n\tconst handleTypes = ['text/javascript', 'module', 'application/javascript', 'text/ecmascript', 'application/ecmascript'];\r\n\treturn !type || handleTypes.indexOf(type) !== -1;\r\n}\r\n\r\nexport const genLinkReplaceSymbol = (linkHref, preloadOrPrefetch = false) => `<!-- ${preloadOrPrefetch ? 'prefetch/preload' : ''} link ${linkHref} replaced by import-html-entry -->`;\r\nexport const genScriptReplaceSymbol = (scriptSrc, async = false) => `<!-- ${async ? 'async' : ''} script ${scriptSrc} replaced by import-html-entry -->`;\r\nexport const inlineScriptReplaceSymbol = `<!-- inline scripts replaced by import-html-entry -->`;\r\nexport const genIgnoreAssetReplaceSymbol = url => `<!-- ignore asset ${url || 'file'} replaced by import-html-entry -->`;\r\nexport const genModuleScriptReplaceSymbol = (scriptSrc, moduleSupport) => `<!-- ${moduleSupport ? 'nomodule' : 'module'} script ${scriptSrc} ignored by import-html-entry -->`;\r\n\r\n/**\r\n * parse the script link from the template\r\n * 1. collect stylesheets\r\n * 2. use global eval to evaluate the inline scripts\r\n *    see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function#Difference_between_Function_constructor_and_function_declaration\r\n *    see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval#Do_not_ever_use_eval!\r\n * @param tpl\r\n * @param baseURI\r\n * @stripStyles whether to strip the css links\r\n * @returns {{template: void | string | *, scripts: *[], entry: *}}\r\n */\r\nexport default function processTpl(tpl, baseURI) {\r\n \tlet scripts = [];\r\n\tconst styles = [];\r\n\tlet entry = null;\r\n\tconst moduleSupport = isModuleScriptSupported();\r\n\t// TODO 可能多余的代码\r\n\tif(/\\/\\/$/.test(baseURI)){\r\n\t\tbaseURI = baseURI.substr(0, baseURI.length - 1)\r\n\t};\r\n\tif(!/\\/$/.test(baseURI)){\r\n \t\tbaseURI =  baseURI + '/'\r\n\t};\r\n\tconst template = tpl.replace(/url\\(static/g,`url(${baseURI}static`).replace(/url\\(\\/static/g,`url(${baseURI}static`) \r\n\r\n\t\t/*\r\n\t\tremove html comment first\r\n\t\t*/\r\n\t\t.replace(HTML_COMMENT_REGEX, '')\r\n\r\n\t\t.replace(LINK_TAG_REGEX, match => {\r\n\t\t\t/*\r\n\t\t\tchange the css link\r\n\t\t\t*/\r\n\t\t\tconst styleType = !!match.match(STYLE_TYPE_REGEX);\r\n\t\t\tif (styleType) {\r\n\r\n\t\t\t\tconst styleHref = match.match(STYLE_HREF_REGEX);\r\n\t\t\t\tconst styleIgnore = match.match(LINK_IGNORE_REGEX);\r\n\r\n\t\t\t\tif (styleHref) {\r\n\r\n\t\t\t\t\tconst href = styleHref && styleHref[2];\r\n\t\t\t\t\tlet newHref = href;\r\n\r\n\t\t\t\t\tif (href && !hasProtocol(href)) {\r\n\t\t\t\t\t\tnewHref = getEntirePath(href, baseURI);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (styleIgnore) {\r\n\t\t\t\t\t\treturn genIgnoreAssetReplaceSymbol(newHref);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tstyles.push(newHref);\r\n\t\t\t\t\treturn genLinkReplaceSymbol(newHref);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst preloadOrPrefetchType = match.match(LINK_PRELOAD_OR_PREFETCH_REGEX) && match.match(LINK_HREF_REGEX) && !match.match(LINK_AS_FONT);\r\n\t\t\tif (preloadOrPrefetchType) {\r\n\t\t\t\tconst [, , linkHref] = match.match(LINK_HREF_REGEX);\r\n\t\t\t\treturn genLinkReplaceSymbol(linkHref, true);\r\n\t\t\t}\r\n\r\n\t\t\treturn match;\r\n\t\t})\r\n\t\t.replace(STYLE_TAG_REGEX, match => {\r\n\r\n\t\t\tif (STYLE_IGNORE_REGEX.test(match)) {\r\n\t\t\t\treturn genIgnoreAssetReplaceSymbol('style file');\r\n\t\t\t}\r\n\t\t\treturn match;\r\n\t\t})\r\n\t\t.replace(ALL_SCRIPT_REGEX, (match, scriptTag) => {\r\n\t\t\tconst scriptIgnore = scriptTag.match(SCRIPT_IGNORE_REGEX);\r\n\t\t\tconst moduleScriptIgnore =\r\n\t\t\t\t(moduleSupport && !!scriptTag.match(SCRIPT_NO_MODULE_REGEX)) ||\r\n\t\t\t\t(!moduleSupport && !!scriptTag.match(SCRIPT_MODULE_REGEX));\r\n\t\t\t// in order to keep the exec order of all javascripts\r\n\r\n\t\t\tconst matchedScriptTypeMatch = scriptTag.match(SCRIPT_TYPE_REGEX);\r\n\t\t\tconst matchedScriptType = matchedScriptTypeMatch && matchedScriptTypeMatch[2];\r\n\t\t\tif (!isValidJavaScriptType(matchedScriptType)) {\r\n\t\t\t\treturn match;\r\n\t\t\t}\r\n\r\n\t\t\t// if it is a external script\r\n\t\t\tif (SCRIPT_TAG_REGEX.test(match) && scriptTag.match(SCRIPT_SRC_REGEX)) {\r\n\t\t\t\t/*\r\n\t\t\t\tcollect scripts and replace the ref\r\n\t\t\t\t*/\r\n\r\n\t\t\t\tconst matchedScriptEntry = scriptTag.match(SCRIPT_ENTRY_REGEX);\r\n\t\t\t\tconst matchedScriptSrcMatch = scriptTag.match(SCRIPT_SRC_REGEX);\r\n\t\t\t\tlet matchedScriptSrc = matchedScriptSrcMatch && matchedScriptSrcMatch[2];\r\n\r\n\t\t\t\tif (entry && matchedScriptEntry) {\r\n\t\t\t\t\tthrow new SyntaxError('You should not set multiply entry script!');\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// append the domain while the script not have an protocol prefix\r\n\t\t\t\t\tif (matchedScriptSrc && !hasProtocol(matchedScriptSrc)) {\r\n\t\t\t\t\t\tmatchedScriptSrc = getEntirePath(matchedScriptSrc, baseURI);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tentry = entry || matchedScriptEntry && matchedScriptSrc;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (scriptIgnore) {\r\n\t\t\t\t\treturn genIgnoreAssetReplaceSymbol(matchedScriptSrc || 'js file');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (moduleScriptIgnore) {\r\n\t\t\t\t\treturn genModuleScriptReplaceSymbol(matchedScriptSrc || 'js file', moduleSupport);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (matchedScriptSrc) {\r\n\t\t\t\t\tconst asyncScript = !!scriptTag.match(SCRIPT_ASYNC_REGEX);\r\n\t\t\t\t\tscripts.push(asyncScript ? { async: true, src: matchedScriptSrc } : matchedScriptSrc);\r\n\t\t\t\t\treturn genScriptReplaceSymbol(matchedScriptSrc, asyncScript);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn match;\r\n\t\t\t} else {\r\n\t\t\t\tif (scriptIgnore) {\r\n\t\t\t\t\treturn genIgnoreAssetReplaceSymbol('js file');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (moduleScriptIgnore) {\r\n\t\t\t\t\treturn genModuleScriptReplaceSymbol('js file', moduleSupport);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// if it is an inline script\r\n\t\t\t\tconst code = getInlineCode(match);\r\n\r\n\t\t\t\t// remove script blocks when all of these lines are comments.\r\n\t\t\t\tconst isPureCommentBlock = code.split(/[\\r\\n]+/).every(line => !line.trim() || line.trim().startsWith('//'));\r\n\r\n\t\t\t\tif (!isPureCommentBlock) {\r\n\t\t\t\t\tscripts.push(match);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn inlineScriptReplaceSymbol;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\tscripts = scripts.filter(function (script) {\r\n\t\t// filter empty script\r\n\t\treturn !!script;\r\n\t});\r\n\treturn {\r\n\t\ttemplate,\r\n\t\tscripts,\r\n\t\tstyles,\r\n\t\t// set the last script as entry if have not set\r\n\t\tentry: entry || scripts[scripts.length - 1],\r\n\t};\r\n}\r\n","export const widgetHistories = new Map<any, any>();\r\ntype histories = {\r\n  length: number;\r\n  histories: Array<string>;\r\n  position: number;\r\n};\r\nexport function setHistory(key: string, history: any, isReplace?: boolean) {\r\n  let obj: histories = widgetHistories.get(key) || {\r\n    length: 0,\r\n    histories: [],\r\n    position: 0,\r\n  };\r\n  if (isReplace && obj.length > 0) {\r\n    obj.histories.splice(obj.position, 1, history);\r\n  } else {\r\n    let cut = obj.position\r\n    obj.histories = obj.histories.slice(0, cut + 1)\r\n    obj.histories.push(history);\r\n    obj.length = obj.histories.length;\r\n    obj.position = obj.histories.length - 1\r\n  }\r\n  widgetHistories.set(key, obj)\r\n}\r\nexport function getHistory(key: string) {\r\n  let obj: histories = widgetHistories.get(key) || {\r\n    length: 0,\r\n    histories: [],\r\n    position: 0,\r\n  };\r\n  return {...obj}\r\n}\r\nexport function historyBack(key: string) {\r\n  let obj: histories = widgetHistories.get(key) || {\r\n    length: 0,\r\n    histories: [],\r\n    position: 0,\r\n  };\r\n  if (obj.length > 0 && obj.position > 0) {\r\n    obj.position = obj.position - 1;\r\n    return obj.histories[obj.position];\r\n  } else {\r\n    return false;\r\n  }\r\n}\r\nexport function historyForward(key: string) {\r\n  let obj: histories = widgetHistories.get(key) || {\r\n    length: 0,\r\n    histories: [],\r\n    position: 0,\r\n  };\r\n  if (obj.length > 0  && obj.position < obj.length - 1) {\r\n    obj.position = obj.position + 1;\r\n    return obj.histories[obj.position];\r\n  } else {\r\n    return false;\r\n  }\r\n}\r\nexport function historyGo(key: string, count: number) {\r\n  let obj: histories = widgetHistories.get(key) || {\r\n    length: 0,\r\n    histories: [],\r\n    position: 0,\r\n  };\r\n  if (\r\n    obj.length > 0 &&\r\n    obj.position > 0 &&\r\n    obj.position + count < obj.length - 1 &&\r\n    obj.position + count >= 0\r\n  ) {\r\n    obj.position = obj.position + count;\r\n    return obj.histories[obj.position];\r\n  } else {\r\n    return false;\r\n  }\r\n}\r\n","export const DEV_FALSE= 0\r\nexport const DEV_WIDGET = 1\r\nexport const DEV_TYPE_REPLACE = 2\r\nexport function dev():any{\r\n    const searchs = window.location.search? window.location.search.split('?') : []\r\n    if(!searchs[1]){\r\n        return {type: DEV_FALSE}\r\n    }\r\n    const paramsArray = window.location.search.split('?')[1].split('&')\r\n    const params:any = {}\r\n    paramsArray.forEach(item=>{\r\n        params[item.split('=')[0]] = item.split('=')[1]\r\n    })\r\n    if(!params.dev){\r\n      return {type: DEV_FALSE}\r\n    } \r\n    if(params.dev.toLowerCase() === 'replace'){\r\n        return {type: DEV_TYPE_REPLACE, params}\r\n    }else{\r\n        params.dev =  params.dev.split('$_')[0]\r\n    }\r\n    return {type: DEV_WIDGET, params}\r\n}","/**\r\n * 需求与问题：\r\n *    1.首先进来时需要根据路由启动存在的不同插件（主要点是启动）:\r\n *      1.1 location解析\r\n *      1.2 路由拦截，存为历史\r\n *      1.3 整体回退前进\r\n *      1.4 插件回退前进\r\n *      1.5 抽象路由的插件\r\n *      1.6 懒加载或点击按钮加载插件的问题：\r\n *          1.6.1 懒加载：提供属性空闲后加载，或指定延迟时间（不精准）\r\n *          1.6.1 点击再加载：提供属性标明不加载，点击按钮，提供api（mountWidget(pluginId)）\r\n *    2.插件控制插件进入不同路由：\r\n *      2.1 给插件对象提供api，（例如push(home/about?age=18)）劫持重定向的路由进行unmount后再mount\r\n *    3.\r\n * 总结：window.FreelogApp.mountWidget\r\n */\r\nimport {\r\n  addSandBox,\r\n  activeWidgets,\r\n  widgetsConfig,\r\n  childrenWidgets,\r\n  flatternWidgets,\r\n} from \"./widget\";\r\nimport {\r\n  historyBack,\r\n  historyForward,\r\n  historyGo,\r\n  setHistory,\r\n  getHistory,\r\n} from \"./history\";\r\nimport { baseUrl } from \"../../services/base\";\r\nimport { DEV_WIDGET } from \"./dev\";\r\n\r\nconst rawDocument = document;\r\n\r\n// const rawHistory = window[\"history\"];\r\nconst rawLocation = window[\"location\"];\r\nconst rawLocalStorage = window[\"localStorage\"];\r\nconst locations = new Map();\r\nwindow.addEventListener(\r\n  \"popstate\",\r\n  function (event) {\r\n    initLocation();\r\n  },\r\n  true\r\n);\r\nwindow.addEventListener(\r\n  \"hashchange\",\r\n  function () {\r\n    initLocation();\r\n  },\r\n  true\r\n);\r\n \r\nexport function setFetch() {\r\n  const rawFetch = window.fetch;\r\n  // @ts-ignore\r\n  window.fetch = function (url: string, options: any) {\r\n    options = options || {};\r\n    if (url.indexOf(\"freelog.com\") > -1) {\r\n      return rawFetch(url, { ...options, credentials: \"include\" });\r\n    } else {\r\n      return rawFetch(url, options);\r\n    }\r\n  };\r\n}\r\nexport function initLocation() {\r\n  if (rawLocation.href.includes(\"$freelog\")) {\r\n    var loc = rawLocation.href.split(\"freelog.com/\")[1].split(\"$\");\r\n    if (window.freelogApp.devData.type === DEV_WIDGET) {\r\n      const temp = rawLocation.search.split(\"$_\")[1];\r\n      // @ts-ignore\r\n      loc = temp ? temp.split(\"$\") : [];\r\n    }\r\n    loc.forEach((item) => {\r\n      try {\r\n        if (!item) return;\r\n        item = item.replace(\"_\", \"?\");\r\n        if (item.indexOf(\"?\") > -1) {\r\n          let index = item.indexOf(\"?\");\r\n          let [id, pathname] = item.substring(0, index).split(\"=\");\r\n          let search = item.substring(index);\r\n          // TODO 判断id是否存在 isExist(id) &&\r\n          locations.set(id, { pathname, href: pathname + search, search });\r\n          return;\r\n        }\r\n        var l = item.split(\"=\");\r\n        locations.set(l[0], { pathname: l[1], href: l[1], search: \"\" });\r\n      } catch (e) {\r\n        console.error(\"url is error\" + e);\r\n      }\r\n    });\r\n  }\r\n}\r\nexport function setLocation() {\r\n  // TODO 只有在线的应用才在url上显示, 只有pathname和query需要\r\n  var hash = \"\";\r\n  locations.forEach((value, key) => {\r\n    if (!activeWidgets.get(key)) {\r\n      locations.delete(key);\r\n      return;\r\n    }\r\n    hash += \"$\" + key + \"=\" + value.href || \"\";\r\n  });\r\n  if (window.freelogApp.devData.type === DEV_WIDGET) {\r\n    let devUrl = rawLocation.search.split(\"$_\")[0];\r\n    if (!devUrl.endsWith(\"/\")) {\r\n      devUrl = devUrl + \"/\";\r\n    }\r\n    const url =\r\n      rawLocation.origin +\r\n      devUrl +\r\n      \"$_\" +\r\n      hash.replace(\"?\", \"_\") +\r\n      rawLocation.hash;\r\n    window.history.pushState(\"\", \"\", url);\r\n  } else {\r\n    const url =\r\n      rawLocation.origin +\r\n      \"/\" +\r\n      hash.replace(\"?\", \"_\") +\r\n      rawLocation.hash +\r\n      rawLocation.search;\r\n    window.history.pushState(\"\", \"\", url);\r\n  }\r\n  // rawLocation.hash = hash;\r\n}\r\n// TODO pathname  search 需要不可变\r\nexport const locationCenter: any = {\r\n  set: function (name: string, attr: any) {\r\n    var loc = locations.get(name) || {};\r\n    if (attr.pathname && attr.pathname.indexOf(rawLocation.host) > -1) {\r\n      // for vue3\r\n      attr.pathname = attr.pathname\r\n        .replace(rawLocation.protocol, \"\")\r\n        .replace(rawLocation.host, \"\")\r\n        .replace(\"//\", \"\");\r\n    }\r\n    locations.set(name, {\r\n      ...loc,\r\n      ...attr,\r\n    });\r\n    setLocation();\r\n  },\r\n\r\n  get: function (name: string): string {\r\n    return locations.get(name);\r\n  },\r\n};\r\nexport function freelogLocalStorage(id: string) {\r\n  return {\r\n    clear: function (name: string) {},\r\n    getItem: function (name: string) {\r\n      return rawLocalStorage.getItem(id + name);\r\n    },\r\n    key: function (name: string) {},\r\n    removeItem: function (name: string) {\r\n      rawLocalStorage.removeItem(id + name);\r\n    },\r\n    setItem: function (name: string, value: string) {\r\n      rawLocalStorage.setItem(id + name, value);\r\n    },\r\n    length: 0,\r\n  };\r\n}\r\nexport const saveSandBox = function (name: string, sandBox: any) {\r\n  addSandBox(name, sandBox);\r\n};\r\nexport const createHistoryProxy = function (name: string, sandbox: any) {\r\n  function patch() {\r\n    let hash = \"\";\r\n    if (arguments[2] && arguments[2].indexOf(\"#\") > -1) {\r\n      hash = arguments[2];\r\n      // console.warn(\"hash route is not suggested!\");\r\n      // return;\r\n    }\r\n    // TODO 解析query参数  search\r\n    let href = arguments[2];\r\n    let [pathname, search] = href.split(\"?\");\r\n    locationCenter.set(name, { pathname, href, search, hash });\r\n  }\r\n  function pushPatch() {\r\n    // @ts-ignore\r\n    patch(...arguments);\r\n    setHistory(name, arguments);\r\n  }\r\n  function replacePatch() {\r\n    // @ts-ignore\r\n    patch(...arguments);\r\n    setHistory(name, arguments, true);\r\n  }\r\n  function go(count: number) {\r\n    const history = historyGo(name, count);\r\n    if (history) {\r\n      // @ts-ignore\r\n      patch(...history);\r\n    }\r\n    // else if(count == -1){\r\n    //   window.history.go(-1)\r\n    // }\r\n  }\r\n  function back() {\r\n    const history = historyBack(name);\r\n    if (history) {\r\n      // @ts-ignore\r\n      patch(...history);\r\n    }\r\n  }\r\n  function forward() {\r\n    const history = historyForward(name);\r\n    if (history) {\r\n      // @ts-ignore\r\n      patch(...history);\r\n    }\r\n  }\r\n  const state = getHistory(name).histories[getHistory(name).position]\r\n    ? [0]\r\n    : {};\r\n  const length = getHistory(name).length;\r\n  const historyProxy = {\r\n    // @ts-ignore\r\n    length: length,\r\n    ...window.history,\r\n    pushState: pushPatch,\r\n    replaceState: replacePatch,\r\n    state,\r\n    go: go, // window.history.go.bind(window.history),\r\n    back: back, // window.history.back.bind(window.history),\r\n    forward: forward, //window.history.forward.bind(window.history)\r\n  };\r\n  return historyProxy;\r\n  /*return new Proxy(historyProxy, {\r\n   \r\n    \r\n    get: function get(HisTarget: any, property: string) {\r\n      if (property === \"pushState\" || property === \"replaceState\") {\r\n        return function () {\r\n          // if (arguments[2] && arguments[2].indexOf(\"#\") > -1) {\r\n          //   console.warn(\"hash route is not supported!\");\r\n          //   // return;\r\n          // }\r\n          // TODO 解析query参数  search\r\n          let href = arguments[2];\r\n          let [pathname, search] = href.split(\"?\");\r\n          locationCenter.set(name, { pathname, href, search, hash: href });\r\n        };\r\n      } else {\r\n        // @ts-ignore\r\n        return rawHistory[property];\r\n      }\r\n    },\r\n  });\r\n   */\r\n};\r\nexport const createLocationProxy = function (name: string, sandbox: any) {\r\n  const locationProxy = {};\r\n\r\n  return new Proxy(locationProxy, {\r\n    /* \r\n        a标签的href需要拦截，// TODO 如果以http开头则不拦截\r\n         TODO reload 是重新加载插件\r\n     */\r\n    set: (target: any, p: PropertyKey, value: any): boolean => {\r\n      return true;\r\n    },\r\n    get: function get(target: any, property: string) {\r\n      if ([\"href\", \"pathname\", \"hash\", \"search\"].indexOf(property) > -1) {\r\n        if (locationCenter.get(name)) {\r\n          // @ts-ignore\r\n          return locationCenter.get(name)[property] || \"\";\r\n        }\r\n        // @ts-ignore\r\n        return \"\";\r\n      } else {\r\n        if ([\"replace\"].indexOf(property) > -1) {\r\n          return function () {};\r\n        }\r\n        if ([\"reload\"].indexOf(property) > -1) {\r\n          // TODO 重新加载自身插件\r\n          return async function () {\r\n            await flatternWidgets.get(name).unmount()\r\n            // console.log('reload')\r\n            // setTimeout(()=>{\r\n            flatternWidgets.get(name).mount()\r\n            // },200)\r\n            // await flatternWidgets.get(name).mount()\r\n          };\r\n        }\r\n        if (property === \"toString\") {\r\n          return () => {\r\n            // @ts-ignore\r\n            return (\r\n              locationCenter.get(name) &&\r\n              (locationCenter.get(name)[\"pathname\"] || \"\")\r\n            );\r\n          };\r\n        }\r\n        // @ts-ignore\r\n        if (typeof rawLocation[property] === \"function\") {\r\n          // @ts-ignore\r\n          return rawLocation[property].bind();\r\n        }\r\n        // @ts-ignore\r\n        return rawLocation[property];\r\n      }\r\n    },\r\n  });\r\n};\r\nrawDocument.write = () => {\r\n  console.warn(\"please be careful\");\r\n};\r\nrawDocument.writeln = () => {\r\n  console.warn(\"please be careful\");\r\n};\r\n// 需要改的几个属性 body  fonts ParentNode cookie domain designMode title\r\nconst getElementsByClassName = rawDocument.getElementsByClassName;\r\nconst getElementsByTagName = rawDocument.getElementsByTagName;\r\nconst getElementsByTagNameNS = rawDocument.getElementsByTagNameNS;\r\nconst querySelector = rawDocument.querySelector;\r\nconst querySelectorAll = rawDocument.querySelectorAll;\r\nconst getElementById = rawDocument.getElementById;\r\nconst appendChild = rawDocument.body.appendChild;\r\nconst removeChild = rawDocument.body.removeChild;\r\nconst addEventListener = rawDocument.addEventListener;\r\nexport const createDocumentProxy = function (\r\n  name: string,\r\n  sandbox: any,\r\n  proxy: any\r\n) {\r\n  const documentProxy = {};\r\n  var doc = widgetsConfig.get(name).container; //.firstChild;\r\n  // var doc: any = rawDocument.getElementById(name);\r\n  // for shadow dom\r\n  let isShadow = false;\r\n  // @ts-ignore\r\n  if (doc.shadowRoot) {\r\n    isShadow = true;\r\n    doc = doc.shadowRoot;\r\n  }\r\n  if (!doc) return rawDocument;\r\n  let rootDoc: any = doc;\r\n  // // @ts-ignore\r\n  // var a = doc.children || [];\r\n  // for (var i = 0; i < a.length; i++) {\r\n  //   if (a.item(i).tagName === \"DIV\") rootDoc = a.item(i);\r\n  // }\r\n  // HTMLElement.prototype.parentNode = ()=>{\r\n\r\n  // }\r\n  // TODO 有可能是 doc还没创建造成的\r\n  // console.log('isShadow', isShadow, doc)\r\n  \r\n  if (!isShadow) {\r\n    // TODO  判断document与doc的原型是否都有该方法，有则bind\r\n    // @ts-ignore\r\n    rawDocument.getElementsByClassName =\r\n      rootDoc.getElementsByClassName.bind(doc);\r\n    rawDocument.getElementsByTagName = (tag: string) => {\r\n      if (tag === \"head\") {\r\n        return [rawDocument.head];\r\n      }\r\n      if (tag === \"body\") {\r\n        return [rootDoc];\r\n      }\r\n      return rootDoc.getElementsByTagName(tag);\r\n    };\r\n    rawDocument.getElementsByTagNameNS =\r\n      rootDoc.getElementsByTagNameNS.bind(rootDoc);\r\n    rawDocument.querySelectorAll = rootDoc.querySelectorAll.bind(rootDoc);\r\n    rawDocument.addEventListener = rootDoc.addEventListener.bind(rootDoc);\r\n    rawDocument.body.appendChild = rootDoc.appendChild.bind(rootDoc);\r\n    rawDocument.body.removeChild = rootDoc.removeChild.bind(rootDoc);\r\n    rawDocument.querySelector = function () {\r\n      if ([\"head\", \"html\"].indexOf(arguments[0]) !== -1) {\r\n        if (arguments[0] === \"head\") return rawDocument.head;\r\n        // @ts-ignore\r\n        if (arguments[0] === \"html\") {\r\n          // @ts-ignore\r\n          return querySelector.bind(document)(...arguments);\r\n        }\r\n      } else {\r\n        if ([\"body\"].indexOf(arguments[0]) !== -1) {\r\n          return rootDoc;\r\n        }\r\n        // @ts-ignore\r\n        return rootDoc.querySelector(...arguments);\r\n      }\r\n    };\r\n    rawDocument.getElementById = function (id: string) {\r\n      // @ts-ignore\r\n      let children = rootDoc.getElementsByTagName(\"*\");\r\n      if (children) {\r\n        for (let i = 0; i < children.length; i++) {\r\n          if (children.item(i).getAttribute(\"id\") === id) {\r\n            return children.item(i);\r\n          }\r\n        }\r\n      }\r\n      return null;\r\n    };\r\n    setTimeout(() => {\r\n      rawDocument.getElementsByClassName =\r\n        getElementsByClassName.bind(rawDocument);\r\n      rawDocument.querySelectorAll = querySelectorAll.bind(rawDocument);\r\n      rawDocument.getElementsByTagName = getElementsByTagName.bind(rawDocument);\r\n      rawDocument.getElementsByTagNameNS =\r\n        getElementsByTagNameNS.bind(rawDocument);\r\n      rawDocument.addEventListener = addEventListener.bind(rawDocument);\r\n      // TODO 这里不应该使用runtime-root， 不需要考虑，直接禁掉\r\n      rawDocument.body.appendChild = appendChild.bind(\r\n        document.getElementById(window.rootId)\r\n      );\r\n      rawDocument.body.removeChild = removeChild.bind(\r\n        document.getElementById(window.rootId)\r\n      );\r\n      rawDocument.querySelector = querySelector.bind(rawDocument);\r\n      rawDocument.querySelector = querySelector.bind(rawDocument);\r\n      rawDocument.getElementById = getElementById.bind(rawDocument);\r\n    }, 0);\r\n    return rawDocument;\r\n  }\r\n  return new Proxy(documentProxy, {\r\n    /* 分类 \r\n         例如 addEventListener\r\n       2.zonejs需要用的全局取值的方法（出问题再解决问题）\r\n         例如 'querySelector', 'getElementsByTagName'\r\n       3.根节点下没有的方法\r\n       4.属性（包括原型）方法：替换this为根节点\r\n    */\r\n    get: function get(docTarget: any, property: string) {\r\n      let appDiv: any = null;\r\n      // @ts-ignore\r\n      var a = doc.children || [];\r\n      for (var i = 0; i < a.length; i++) {\r\n        if (a.item(i).tagName === \"DIV\") appDiv = a.item(i);\r\n      }\r\n      if (property === \"location\") {\r\n        // TODO varify\r\n        return proxy.location;\r\n      }\r\n\r\n      if (property === \"createElement\") {\r\n        return rawDocument.createElement.bind(rawDocument);\r\n      }\r\n      // @ts-ignore\r\n      rawDocument.addEventListener = rootDoc.addEventListener.bind(rootDoc);\r\n      // @ts-ignore\r\n      // rootDoc.body = appDiv;\r\n      // @ts-ignore\r\n      // rootDoc.body.appendChild = rootDoc.appendChild.bind(rootDoc);\r\n      if (property === \"head\") {\r\n        // return {\r\n        //   // @ts-ignore\r\n        //   appendChild: function () {\r\n        //     // @ts-ignore\r\n        //     rawDocument[property].appendChild(...arguments);\r\n        //   },\r\n        //   ...rawDocument[property]\r\n        // };\r\n        return rawDocument[property];\r\n      }\r\n      // return rootDoc\r\n      // if (property  === 'addEventListener') debugger\r\n      // @ts-ignore\r\n      if (\r\n        (rootDoc[property] || appDiv[property]) &&\r\n        [\"querySelector\", \"getElementsByTagName\"].indexOf(property) === -1\r\n      ) {\r\n        if (property === \"nodeType\") return rawDocument.nodeType;\r\n        // @ts-ignore\r\n        if (typeof rootDoc[property] === \"function\")\r\n          return rootDoc[property].bind(rootDoc);\r\n        if (typeof appDiv[property] === \"function\")\r\n          return appDiv[property].bind(appDiv);\r\n        // @ts-ignore\r\n        return rootDoc[property] || appDiv[property];\r\n      } else {\r\n        if (\r\n          [\"querySelector\", \"getElementsByTagName\"].indexOf(property) !== -1\r\n        ) {\r\n          return function () {\r\n            if ([\"head\", \"html\"].indexOf(arguments[0]) !== -1) {\r\n              // TODOjquery才需要此处放权\r\n              // @ts-ignore\r\n              return rawDocument[property](...arguments);\r\n            } else {\r\n              if ([\"body\"].indexOf(arguments[0]) !== -1) {\r\n                return appDiv;\r\n              }\r\n              // @ts-ignore\r\n              return rootDoc[property]\r\n                ? // @ts-ignore\r\n                  rootDoc[property](...arguments)\r\n                : // @ts-ignore\r\n                  appDiv[property](...arguments);\r\n            }\r\n          };\r\n        }\r\n        if (property === \"getElementById\") {\r\n          if (rootDoc.getElementById) {\r\n            return rootDoc.getElementById.bind(rootDoc);\r\n          }\r\n          return function (id: string) {\r\n            // @ts-ignore\r\n            let children = rootDoc.getElementsByTagName(\"*\");\r\n            if (children) {\r\n              for (let i = 0; i < children.length; i++) {\r\n                if (children.item(i).getAttribute(\"id\") === id) {\r\n                  return children.item(i);\r\n                }\r\n              }\r\n            }\r\n            return null;\r\n          };\r\n        }\r\n\r\n        // @ts-ignore\r\n        if (typeof rawDocument[property] === \"function\") {\r\n          // @ts-ignore\r\n          return rawDocument[property].bind(rawDocument);\r\n        }\r\n        // @ts-ignore\r\n        return rawDocument[property];\r\n      }\r\n    },\r\n  });\r\n};\r\nexport const createWidgetProxy = function (name: string, sandbox: any) {\r\n  const proxyWidget = {};\r\n  return new Proxy(proxyWidget, {\r\n    /*\r\n     */\r\n    get: function get(childWidgets: any, property: string) {\r\n      if (property === \"getAll\") {\r\n        return function () {\r\n          const children = childrenWidgets.get(name);\r\n          let childrenArray: any = [];\r\n          children &&\r\n            children.forEach((childId: string) => {\r\n              childrenArray.push(flatternWidgets.get(childId));\r\n            });\r\n          return childrenArray;\r\n        };\r\n      }\r\n      if (property === \"unmount\") {\r\n      }\r\n    },\r\n  });\r\n};\r\nexport function getPublicPath(name: string) {\r\n  const config = widgetsConfig.get(name);\r\n  if (/\\/$/.test(config.entry)) {\r\n    return config.entry;\r\n  }\r\n  return config.entry + \"/\";\r\n  // return config.entry + \"/\";\r\n  // if (config.isDev) {\r\n  //   if (/\\/$/.test(config.entry)) {\r\n  //     return config.entry;\r\n  //   }\r\n  //   return config.entry + \"/\";\r\n  // }\r\n  // // const route = name.split(\"-\")[1];\r\n  // return `${baseUrl}widgets/${config.widgetName}/`;\r\n}\r\nexport const createFreelogAppProxy = function (name: string, sandbox: any) {\r\n  const freelogAppProxy = {};\r\n  return new Proxy(freelogAppProxy, {\r\n    /*\r\n     */\r\n    get: function get(app: any, p: string) {\r\n      const pro = window.freelogApp[p];\r\n      if (typeof pro === \"function\") {\r\n        return function () {\r\n          // @ts-ignore\r\n          return pro.bind(sandbox)(...arguments);\r\n        };\r\n      }\r\n      return pro;\r\n    },\r\n  });\r\n};\r\n\r\nexport function pathATag() {\r\n  document.addEventListener(\"click\", (e) => {\r\n    // @ts-ignore\r\n    if (e.target.nodeName === \"A\") {\r\n      return false;\r\n    }\r\n  });\r\n}\r\n","// 插件对象管理plugins：flatternWidgets childrenWidgets sandBoxs\r\n\r\n/**\r\n * 1.数据结构\r\n *   flatternWidgets Map<key：plugin id,value: object: 所有插件配置与状态与加载后控制对象> 插件集合 平行 关系 所有插件配置与状态与\r\n *   childrenWidgets Map<key：father-plugin id,value: Array:[child-plugin id]> 插件对应的子插件集合\r\n *   sandBoxs Map<key: plugin id, value: sandbox>  所有插件对应沙盒对象\r\n * 2.设计模式\r\n *   自顶向下： 加载与卸载权限控制： 注册后通过沙盒提供控制对象给运行时或上层插件沙盒变量进行管控\r\n *   loadMicroApp({ name: 'vue', entry: '//localhost:7101', container: '#vue' }, { sandbox: { experimentalStyleIsolation: true } }, );\r\n *   状态管理：\r\n *      运行状态管理： bootstrap,mounting,mounted,unmounting,unmounted   后期思考：怎样算paused，能否实现？\r\n *      权限状态？？？\r\n *   中央集权：沙盒全部在运行时进行管控，一旦有恶意侵入可中断（对沙盒的中断算paused?）， 挂载后控制对象就在全局，故有加载与卸载任何插件权限。\r\n *\r\n */\r\n\r\nimport { loadMicroApp } from \"../runtime\";\r\nimport { baseUrl } from \"../../services/base\";\r\nimport { setLocation } from \"./proxy\";\r\nimport { DEV_TYPE_REPLACE, DEV_WIDGET } from \"./dev\";\r\nimport { getSubDep, getEntry } from \"./utils\";\r\nimport presentable from '../../services/api/modules/presentable';\r\n\r\nexport const flatternWidgets = new Map<any, any>();\r\nexport const widgetsConfig = new Map<any, any>();\r\nexport const activeWidgets = new Map<any, any>();\r\nexport const childrenWidgets = new Map<any, any>();\r\nexport const sandBoxs = new Map<any, any>(); // 沙盒不交给plugin, 因为plugin是插件可以用的\r\n\r\n// TODO plugin type\r\nexport function addWidget(key: string, plugin: any) {\r\n  if (activeWidgets.has(key)) {\r\n    console.warn(flatternWidgets.get(key).name + \" reloaded\");\r\n  }\r\n  flatternWidgets.set(key, plugin);\r\n  activeWidgets.set(key, plugin);\r\n}\r\nexport function addWidgetConfig(key: string, config: any) {\r\n  widgetsConfig.set(key, config);\r\n}\r\n// TODO error\r\nexport function removeWidget(key: string) {\r\n  flatternWidgets.has(key) && flatternWidgets.delete(key) && removeSandBox(key);\r\n}\r\nexport function deactiveWidget(key: string) {\r\n  activeWidgets.has(key) && activeWidgets.delete(key);\r\n}\r\nexport function addChildWidget(key: string, childKey: any) {\r\n  const arr = childrenWidgets.get(key) || [];\r\n  !arr.contains(childKey) && arr.push(childKey);\r\n  childrenWidgets.set(key, arr);\r\n}\r\nexport function removeChildWidget(key: string, childKey: string) {\r\n  if (childrenWidgets.has(key)) {\r\n    let arr = childrenWidgets.get(key) || [];\r\n    arr.contains(childKey) && arr.splice(arr.indexOf(childKey), 1);\r\n    childrenWidgets.set(key, arr);\r\n  }\r\n}\r\n// maybe plugin is not exists in flatternWidgets\r\nexport function addSandBox(key: string, sandbox: any) {\r\n  if (sandBoxs.has(key)) {\r\n    console.warn(flatternWidgets.get(key).name + \"reloaded\");\r\n  }\r\n  sandBoxs.set(key, sandbox);\r\n}\r\nexport function removeSandBox(key: string) {\r\n  sandBoxs.has(key) && sandBoxs.delete(key);\r\n}\r\nconst count = 0;\r\nlet firstDev = false;\r\n// 可供插件自己加载子插件  sub需要验证格式\r\nexport function mountWidget(\r\n  sub: any,\r\n  container: any,\r\n  data: any,\r\n  entry?: string,\r\n  config?: any\r\n): any {\r\n  if(entry && /\\/$/.test(entry)){\r\n\t\tentry = entry.substr(0, entry.length - 1)\r\n\t};\r\n\t \r\n  // @ts-ignore\r\n  const devData = window.freelogApp.devData;\r\n  if (devData && !entry) {\r\n    if (devData.type === DEV_TYPE_REPLACE) {\r\n      entry = devData.params[sub.id] || \"\";\r\n    }\r\n    if (devData.type === DEV_WIDGET && !firstDev) {\r\n      entry = devData.params.dev;\r\n      firstDev = true;\r\n    }\r\n  }\r\n  if (!data && sub) {\r\n    data = {\r\n      presentableId: sub.presentableId || \"\",\r\n      entityNid: \"\",\r\n      subDependId: sub.presentableId || \"\",\r\n      resourceInfo: {\r\n        resourceId: sub.id,\r\n      },\r\n    };\r\n  }\r\n  let id = !sub ? \"freelogDev\" : \"freelog-\" + data.resourceInfo.resourceId;\r\n  if (sub && flatternWidgets.has(sub.id)) {\r\n    id = \"freelog-\" + sub.id + \"-\" + (count + 1);\r\n  }\r\n  // @ts-ignore TODO 用了太多重复判断，要抽取,当entry存在时该行不出现sub data\r\n  const widgetConfig = {\r\n    container,\r\n    name: id, //id\r\n    isTheme: data.isTheme,\r\n    presentableId: data.presentableId,\r\n    widgetName: !sub ? \"freelogDev\" : sub.name.replace('/','-'),\r\n    parentNid: entry ? '' : data.entityNid,\r\n    subResourceIdOrName: entry ? '' :  data.resourceInfo.resourceId,\r\n    resourceId: !sub ? \"freelogDev\" : data.resourceInfo.resourceId, // id可以重复，name不可以, 这里暂时这样\r\n    entry:\r\n      entry || getEntry({presentableId: data.presentableId, parentNid: data.entityNid, subResourceIdOrName: data.resourceInfo.resourceId }),\r\n      // `${baseUrl}widgets/${sub.name.replace('/','-')}?entityNid=${data.entityNid}&presentableId=${data.presentableId}&subDependId=${data.subDependId}&resourceId=${data.resourceInfo.resourceId}`,\r\n    isDev: !!entry,\r\n  };\r\n  addWidgetConfig(id, widgetConfig);\r\n  console.log(widgetConfig)\r\n  // TODO 所有插件加载用promise all\r\n  // @ts-ignore\r\n  const app = loadMicroApp(widgetConfig, {\r\n    sandbox: {\r\n      strictStyleIsolation: config ? !!config.shadowDom : false,\r\n      experimentalStyleIsolation: config ? !!config.scopedCss : true,\r\n    },\r\n  });\r\n  // const id2 = createId(sub.id + 1)\r\n  // const app2 = loadMicroApp({\r\n  //     container: widgetContainer2,\r\n  //     name: id2,\r\n  //     entry: '//localhost:7103'\r\n  // }, { sandbox: { strictStyleIsolation: true, experimentalStyleIsolation: true } },);\r\n  // addWidget(id2, app2);\r\n  const _app = {\r\n    ...app,\r\n    mount: async () => {\r\n      await app.mount();\r\n      addWidget(id, app);\r\n    },\r\n    unmount: async () => {\r\n      await app.unmount();\r\n      deactiveWidget(id);\r\n      setLocation();\r\n    },\r\n  };\r\n  addWidget(id, _app);\r\n  // TODO 拦截mount做处理\r\n  return _app;\r\n}\r\n// 固定id 的加载子插件，仅支持加载一次\r\nexport function mountSubWidgets(parent: any, config?: any, resolve?: any) {\r\n  const parentGlobal = sandBoxs.get(\r\n    \"freelog-\" + parent.data.presentableId\r\n  ).proxy;\r\n  // @ts-ignore\r\n  // theme.subDeps.push({id:\"60068f63973b31003a4fbf2a\",name:\"chtes/pubu\",type:\"resource\",resourceType:\"widget\"})\r\n  const promises: Promise<any>[] = [];\r\n  // @ts-ignore\r\n  parent.subDeps.forEach((sub) => {\r\n    // 检测主题内部有没有这个插件，没有则不走这不\r\n    // const tags = document.getElementsByName(sub.tagName)\r\n    // if(!tags.length){\r\n    //   return\r\n    // }\r\n    // {\"id\":\"60068f63973b31003a4fbf2a\",\"name\":\"chtes/pubu\",\"type\":\"resource\",\"resourceType\":\"image\"}\r\n    // let url = resolveUrl(\r\n    //   `${baseUrl}auths/presentables/${parent.entityNid}/fileStream`,\r\n    //   {\r\n    //     parentNid: parent.data.presentableId,\r\n    //     subResourceIdOrName: sub.id,\r\n    //   }\r\n    // );\r\n    // let isTest = false;\r\n    // if (\r\n    //   window.location.href\r\n    //     .replace(\"http://\", \"\")\r\n    //     .replace(\"https://\", \"\")\r\n    //     .indexOf(\"t.\") === 0\r\n    // ) {\r\n    //   isTest = true;\r\n    // }\r\n    // if (isTest)\r\n    //   resolveUrl(\r\n    //     `${baseUrl}auths/testResources/${parent.entityNid}/fileStream`,\r\n    //     {\r\n    //       parentNid: parent.data.presentableId,\r\n    //       subEntityIdOrName: sub.id,\r\n    //     }\r\n    //   );\r\n\r\n    switch (sub.resourceType) {\r\n      case \"widget\":\r\n        const subContainer = parentGlobal.document.getElementById(\r\n          \"freelog-\" + sub.id\r\n        );\r\n        if (!subContainer) {\r\n          console.error(\"container is not exists: \" + sub.presentableName);\r\n          return;\r\n        }\r\n        // @ts-ignore\r\n        window.freelogApp.mountWidget(\r\n          sub,\r\n          subContainer,\r\n          {\r\n            //@ts-ignore\r\n            presentableId: window.freelogApp.nodeInfo.nodeThemeId,\r\n            entityNid: parent.entityNid,\r\n            subDependId: sub.id,\r\n          },\r\n          \"\",\r\n          config\r\n        );\r\n        // setTimeout(app.unmount, 2000)\r\n        // setTimeout(app.mount, 5000)\r\n        // TODO 所有插件加载完成后 加载交给运行时子依赖的插件\r\n        break;\r\n      // case \"js\": {\r\n      //   promises.push(createScript(url));\r\n      //   break;\r\n      // }\r\n      // case \"css\": {\r\n      //   promises.push(createCssLink(url));\r\n      //   break;\r\n      // }\r\n      default: {\r\n      }\r\n    }\r\n  });\r\n  let count = promises.length;\r\n  if (count === 0) {\r\n    resolve && resolve();\r\n  } else {\r\n    for (const p of promises) {\r\n      p.finally(() => {\r\n        count--;\r\n        if (count === 0) {\r\n          resolve && resolve();\r\n        }\r\n      });\r\n    }\r\n  }\r\n}\r\nexport async function autoMoutSubWdigets(config?: any) {\r\n  // @ts-ignore\r\n  const presenbaleId = widgetsConfig.get(this.widgetName)?.id;\r\n  // @ts-ignore\r\n  const parent = await getSubDep.bind(this)(presenbaleId);\r\n  mountSubWidgets(parent, config);\r\n}\r\n","/**\r\n * @author Kuitos\r\n * @homepage https://github.com/kuitos/\r\n * @since 2018-08-15 11:37\r\n */\r\n\r\nimport processTpl, { genLinkReplaceSymbol, genScriptReplaceSymbol } from './process-tpl';\r\nimport {\r\n\tdefaultGetPublicPath,\r\n\tgetGlobalProp,\r\n\tgetInlineCode,\r\n\tnoteGlobalProps,\r\n\treadResAsString,\r\n\trequestIdleCallback,\r\n} from './utils';\r\nimport { setFetch } from '../../structure/proxy'\r\nsetFetch()\r\nconst styleCache = {};\r\nconst scriptCache = {};\r\nconst embedHTMLCache = {};\r\nif (!window.fetch) {\r\n\tthrow new Error('[import-html-entry] Here is no \"fetch\" on the window env, you need to polyfill it');\r\n}\r\nconst defaultFetch = window.fetch.bind(window);\r\nfunction defaultGetTemplate(tpl) {\r\n\treturn tpl;\r\n}\r\n\r\n/**\r\n * convert external css link to inline style for performance optimization\r\n * @param template\r\n * @param styles\r\n * @param opts\r\n * @return embedHTML\r\n */\r\nfunction getEmbedHTML(template, styles, opts = {}, baseURI) {\r\n\tconst { fetch = defaultFetch } = opts;\r\n\tlet embedHTML = template;\r\n    // if(/\\/\\/$/.test(baseURI)){\r\n\t// \tbaseURI = baseURI.substr(0, baseURI.length - 1)\r\n\t// }\r\n\t// if(!/\\/$/.test(baseURI)){\r\n \t// \tbaseURI =  baseURI + '/'\r\n\t// }\r\n\treturn getExternalStyleSheets(styles, fetch)\r\n\t\t.then(styleSheets => {\r\n\t\t\tembedHTML = styles.reduce((html, styleSrc, i) => {\r\n\t\t\t\t// let styleText = styleSheets[i]\r\n\t\t\t\t// styleText = styleText.replace(/url\\(static/g,`url(${baseURI}static`) ;\r\n\t\t\t\t// styleText = styleText.replace(/url\\(\\/static/g,`url(${baseURI}static`) ;\r\n\t\t\t\thtml = html.replace(genLinkReplaceSymbol(styleSrc), `<style>/* ${styleSrc} */${styleSheets[i]}</style>`);\r\n\t\t\t\treturn html;\r\n\t\t\t}, embedHTML);\r\n\t\t\treturn embedHTML;\r\n\t\t});\r\n}\r\n\r\nconst isInlineCode = code => code.startsWith('<');\r\n\r\nfunction getExecutableScript(scriptSrc, scriptText, proxy, strictGlobal) {\r\n\tconst sourceUrl = isInlineCode(scriptSrc) ? '' : `//# sourceURL=${scriptSrc}\\n`;\r\n\r\n\t// 通过这种方式获取全局 window，因为 script 也是在全局作用域下运行的，所以我们通过 window.proxy 绑定时也必须确保绑定到全局 window 上\r\n\t// 否则在嵌套场景下， window.proxy 设置的是内层应用的 window，而代码其实是在全局作用域运行的，会导致闭包里的 window.proxy 取的是最外层的微应用的 proxy\r\n\tconst globalWindow = (0, eval)('window');\r\n\tglobalWindow.proxy = proxy;\r\n\t// TODO 通过 strictGlobal 方式切换切换 with 闭包，待 with 方式坑趟平后再合并\r\n\treturn strictGlobal\r\n\t\t? `;(function(window, self, globalThis){with(window){;${scriptText}\\n${sourceUrl}}}).bind(window.proxy)(window.proxy, window.proxy, window.proxy);`\r\n\t\t: `;(function(window, self, globalThis){;${scriptText}\\n${sourceUrl}}).bind(window.proxy)(window.proxy, window.proxy, window.proxy);`;\r\n}\r\n\r\n// for prefetch\r\nexport function getExternalStyleSheets(styles, fetch = defaultFetch) {\r\n\treturn Promise.all(styles.map(styleLink => {\r\n\t\tif (isInlineCode(styleLink)) {\r\n\t\t\t// if it is inline style\r\n\t\t\treturn getInlineCode(styleLink);\r\n\t\t} else {\r\n\t\t\t// external styles\r\n\t\t\treturn styleCache[styleLink] ||\r\n\t\t\t\t(styleCache[styleLink] = fetch(styleLink).then(response => {\r\n\t\t\t\t\tlet text = response.text()\r\n\t\t\t\t\treturn text\r\n\t\t\t\t}));\r\n\t\t}\r\n\r\n\t},\r\n\t));\r\n}\r\n\r\n// for prefetch\r\nexport function getExternalScripts(scripts, fetch = defaultFetch, errorCallback = () => {\r\n}) {\r\n\r\n\tconst fetchScript = scriptUrl => scriptCache[scriptUrl] ||\r\n\t\t(scriptCache[scriptUrl] = fetch(scriptUrl).then(response => {\r\n\t\t\t// usually browser treats 4xx and 5xx response of script loading as an error and will fire a script error event\r\n\t\t\t// https://stackoverflow.com/questions/5625420/what-http-headers-responses-trigger-the-onerror-handler-on-a-script-tag/5625603\r\n\t\t\tif (response.status >= 400) {\r\n\t\t\t\terrorCallback();\r\n\t\t\t\tthrow new Error(`${scriptUrl} load failed with status ${response.status}`);\r\n\t\t\t}\r\n\r\n\t\t\treturn response.text();\r\n\t\t}));\r\n\r\n\treturn Promise.all(scripts.map(script => {\r\n\r\n\t\tif (typeof script === 'string') {\r\n\t\t\tif (isInlineCode(script)) {\r\n\t\t\t\t// if it is inline script\r\n\t\t\t\treturn getInlineCode(script);\r\n\t\t\t} else {\r\n\t\t\t\t// external script\r\n\t\t\t\treturn fetchScript(script);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// use idle time to load async script\r\n\t\t\tconst { src, async } = script;\r\n\t\t\tif (async) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tsrc,\r\n\t\t\t\t\tasync: true,\r\n\t\t\t\t\tcontent: new Promise((resolve, reject) => requestIdleCallback(() => fetchScript(src).then(resolve, reject))),\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\treturn fetchScript(src);\r\n\t\t}\r\n\t},\r\n\t));\r\n}\r\n\r\nfunction throwNonBlockingError(error, msg) {\r\n\tsetTimeout(() => {\r\n\t\tconsole.error(msg);\r\n\t\tthrow error;\r\n\t});\r\n}\r\n\r\nconst supportsUserTiming =\r\n\ttypeof performance !== 'undefined' &&\r\n\ttypeof performance.mark === 'function' &&\r\n\ttypeof performance.clearMarks === 'function' &&\r\n\ttypeof performance.measure === 'function' &&\r\n\ttypeof performance.clearMeasures === 'function';\r\n\r\n/**\r\n * FIXME to consistent with browser behavior, we should only provide callback way to invoke success and error event\r\n * @param entry\r\n * @param scripts\r\n * @param proxy\r\n * @param opts\r\n * @returns {Promise<unknown>}\r\n */\r\nexport function execScripts(entry, scripts, proxy = window, opts = {}) {\r\n\tconst {\r\n\t\tfetch = defaultFetch, strictGlobal = false, success, error = () => {\r\n\t\t}, beforeExec = () => {\r\n\t\t}, afterExec = () => {\r\n\t\t},\r\n\t} = opts;\r\n\r\n\treturn getExternalScripts(scripts, fetch, error)\r\n\t\t.then(scriptsText => {\r\n\r\n\t\t\tconst geval = (scriptSrc, inlineScript) => {\r\n\t\t\t\tconst rawCode = beforeExec(inlineScript, scriptSrc) || inlineScript;\r\n\t\t\t\tconst code = getExecutableScript(scriptSrc, rawCode, proxy, strictGlobal);\r\n\r\n\t\t\t\t(0, eval)(code);\r\n\r\n\t\t\t\tafterExec(inlineScript, scriptSrc);\r\n\t\t\t};\r\n\r\n\t\t\tfunction exec(scriptSrc, inlineScript, resolve) {\r\n\r\n\t\t\t\tconst markName = `Evaluating script ${scriptSrc}`;\r\n\t\t\t\tconst measureName = `Evaluating Time Consuming: ${scriptSrc}`;\r\n\r\n\t\t\t\tif (process.env.NODE_ENV === 'development' && supportsUserTiming) {\r\n\t\t\t\t\tperformance.mark(markName);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (scriptSrc === entry) {\r\n\t\t\t\t\tnoteGlobalProps(strictGlobal ? proxy : window);\r\n\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t// bind window.proxy to change `this` reference in script\r\n\t\t\t\t\t\tgeval(scriptSrc, inlineScript);\r\n\t\t\t\t\t\tconst exports = proxy[getGlobalProp(strictGlobal ? proxy : window)] || {};\r\n\t\t\t\t\t\tresolve(exports);\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t// entry error must be thrown to make the promise settled\r\n\t\t\t\t\t\tconsole.error(`[import-html-entry]: error occurs while executing entry script ${scriptSrc}`);\r\n\t\t\t\t\t\tthrow e;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (typeof inlineScript === 'string') {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t// bind window.proxy to change `this` reference in script\r\n\t\t\t\t\t\t\tgeval(scriptSrc, inlineScript);\r\n\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\t// consistent with browser behavior, any independent script evaluation error should not block the others\r\n\t\t\t\t\t\t\tthrowNonBlockingError(e, `[import-html-entry]: error occurs while executing normal script ${scriptSrc}`);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// external script marked with async\r\n\t\t\t\t\t\tinlineScript.async && inlineScript?.content\r\n\t\t\t\t\t\t\t.then(downloadedScriptText => geval(inlineScript.src, downloadedScriptText))\r\n\t\t\t\t\t\t\t.catch(e => {\r\n\t\t\t\t\t\t\t\tthrowNonBlockingError(e, `[import-html-entry]: error occurs while executing async script ${inlineScript.src}`);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (process.env.NODE_ENV === 'development' && supportsUserTiming) {\r\n\t\t\t\t\tperformance.measure(measureName, markName);\r\n\t\t\t\t\tperformance.clearMarks(markName);\r\n\t\t\t\t\tperformance.clearMeasures(measureName);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfunction schedule(i, resolvePromise) {\r\n\r\n\t\t\t\tif (i < scripts.length) {\r\n\t\t\t\t\tconst scriptSrc = scripts[i];\r\n\t\t\t\t\tconst inlineScript = scriptsText[i];\r\n\r\n\t\t\t\t\texec(scriptSrc, inlineScript, resolvePromise);\r\n\t\t\t\t\t// resolve the promise while the last script executed and entry not provided\r\n\t\t\t\t\tif (!entry && i === scripts.length - 1) {\r\n\t\t\t\t\t\tresolvePromise();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tschedule(i + 1, resolvePromise);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn new Promise(resolve => schedule(0, success || resolve));\r\n\t\t});\r\n}\r\n\r\nexport default function importHTML(url, opts = {}) {\r\n\tlet fetch = defaultFetch;\r\n\tlet autoDecodeResponse = false;\r\n\tlet getPublicPath = defaultGetPublicPath;\r\n\tlet getTemplate = defaultGetTemplate;\r\n\r\n\t// compatible with the legacy importHTML api\r\n\tif (typeof opts === 'function') {\r\n\t\tfetch = opts;\r\n\t} else {\r\n\t\t// fetch option is availble\r\n\t\tif (opts.fetch) {\r\n\t\t\t// fetch is a funciton\r\n\t\t\tif (typeof opts.fetch === 'function') {\r\n\t\t\t\tfetch = opts.fetch;\r\n\t\t\t} else { // configuration\r\n\t\t\t\tfetch = opts.fetch.fn || defaultFetch;\r\n\t\t\t\tautoDecodeResponse = !!opts.fetch.autoDecodeResponse;\r\n\t\t\t}\r\n\t\t}\r\n\t\tgetPublicPath = opts.getPublicPath || opts.getDomain || defaultGetPublicPath;\r\n\t\tgetTemplate = opts.getTemplate || defaultGetTemplate;\r\n\t}\r\n\treturn embedHTMLCache[url] || (embedHTMLCache[url] = fetch(url + '/index.html')\r\n\t\t.then(response => readResAsString(response, autoDecodeResponse))\r\n\t\t.then(html => {\r\n\t\t\tconst assetPublicPath = url; // getPublicPath(url);\r\n\t\t\tconst { template, scripts, entry, styles } = processTpl(getTemplate(html), assetPublicPath);\r\n\r\n\t\t\treturn getEmbedHTML(template, styles, { fetch }, assetPublicPath).then(embedHTML => ({\r\n\t\t\t\ttemplate: embedHTML,\r\n\t\t\t\tassetPublicPath,\r\n\t\t\t\tgetExternalScripts: () => getExternalScripts(scripts, fetch),\r\n\t\t\t\tgetExternalStyleSheets: () => getExternalStyleSheets(styles, fetch),\r\n\t\t\t\texecScripts: (proxy, strictGlobal, execScriptsHooks = {}) => {\r\n\t\t\t\t\tif (!scripts.length) {\r\n\t\t\t\t\t\treturn Promise.resolve();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn execScripts(entry, scripts, proxy, {\r\n\t\t\t\t\t\tfetch,\r\n\t\t\t\t\t\tstrictGlobal,\r\n\t\t\t\t\t\tbeforeExec: execScriptsHooks.beforeExec,\r\n\t\t\t\t\t\tafterExec: execScriptsHooks.afterExec,\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t}));\r\n\t\t}));\r\n}\r\n\r\nexport function importEntry(entry, opts = {}) {\r\n\tconst { fetch = defaultFetch, getTemplate = defaultGetTemplate } = opts;\r\n\tconst getPublicPath = opts.getPublicPath || opts.getDomain || defaultGetPublicPath;\r\n\r\n\tif (!entry) {\r\n\t\tthrow new SyntaxError('entry should not be empty!');\r\n\t}\r\n\t// html entry\r\n\tif (typeof entry === 'string') {\r\n\t\treturn importHTML(entry, {\r\n\t\t\tfetch,\r\n\t\t\tgetPublicPath,\r\n\t\t\tgetTemplate,\r\n\t\t});\r\n\t}\r\n\r\n\t// config entry\r\n\tif (Array.isArray(entry.scripts) || Array.isArray(entry.styles)) {\r\n\r\n\t\tconst { scripts = [], styles = [], html = '' } = entry;\r\n\t\tconst getHTMLWithStylePlaceholder = tpl => styles.reduceRight((html, styleSrc) => `${genLinkReplaceSymbol(styleSrc)}${html}`, tpl);\r\n\t\tconst getHTMLWithScriptPlaceholder = tpl => scripts.reduce((html, scriptSrc) => `${html}${genScriptReplaceSymbol(scriptSrc)}`, tpl);\r\n\r\n\t\treturn getEmbedHTML(getTemplate(getHTMLWithScriptPlaceholder(getHTMLWithStylePlaceholder(html))), styles, { fetch }).then(embedHTML => ({\r\n\t\t\ttemplate: embedHTML,\r\n\t\t\tassetPublicPath: getPublicPath(entry),\r\n\t\t\tgetExternalScripts: () => getExternalScripts(scripts, fetch),\r\n\t\t\tgetExternalStyleSheets: () => getExternalStyleSheets(styles, fetch),\r\n\t\t\texecScripts: (proxy, strictGlobal, execScriptsHooks = {}) => {\r\n\t\t\t\tif (!scripts.length) {\r\n\t\t\t\t\treturn Promise.resolve();\r\n\t\t\t\t}\r\n\t\t\t\treturn execScripts(scripts[scripts.length - 1], scripts, proxy, {\r\n\t\t\t\t\tfetch,\r\n\t\t\t\t\tstrictGlobal,\r\n\t\t\t\t\tbeforeExec: execScriptsHooks.beforeExec,\r\n\t\t\t\t\tafterExec: execScriptsHooks.afterExec,\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t}));\r\n\r\n\t} else {\r\n\t\tthrow new SyntaxError('entry scripts or styles should be array!');\r\n\t}\r\n}\r\n","/**\r\n * @author Kuitos\r\n * @since 2019-11-12\r\n */\r\nimport type { FrameworkLifeCycles } from '../interfaces';\r\n\r\nconst rawPublicPath = window.__INJECTED_PUBLIC_PATH_BY_FREELOG__;\r\n\r\nexport default function getAddOn(global: Window, publicPath = '/'): FrameworkLifeCycles<any> {\r\n  let hasMountedOnce = false;\r\n\r\n  return {\r\n    async beforeLoad() {\r\n      // eslint-disable-next-line no-param-reassign\r\n      global.__INJECTED_PUBLIC_PATH_BY_FREELOG__ = publicPath;\r\n    },\r\n\r\n    async beforeMount() {\r\n      if (hasMountedOnce) {\r\n        // eslint-disable-next-line no-param-reassign\r\n        global.__INJECTED_PUBLIC_PATH_BY_FREELOG__ = publicPath;\r\n      }\r\n    },\r\n\r\n    async beforeUnmount() {\r\n      if (rawPublicPath === undefined) {\r\n        // eslint-disable-next-line no-param-reassign\r\n        delete global.__INJECTED_PUBLIC_PATH_BY_FREELOG__;\r\n      } else {\r\n        // eslint-disable-next-line no-param-reassign\r\n        global.__INJECTED_PUBLIC_PATH_BY_FREELOG__ = rawPublicPath;\r\n      }\r\n\r\n      hasMountedOnce = true;\r\n    },\r\n  };\r\n}\r\n","/**\r\n * @author Kuitos\r\n * @since 2020-03-02\r\n */\r\n\r\nimport { concat, mergeWith } from 'lodash';\r\nimport type { FrameworkLifeCycles, ObjectType } from '../interfaces';\r\n\r\nimport getRuntimePublicPathAddOn from './runtimePublicPath';\r\nimport getEngineFlagAddon from './engineFlag';\r\n\r\nexport default function getAddOns<T extends ObjectType>(global: Window, publicPath: string): FrameworkLifeCycles<T> {\r\n  // @ts-ignore\r\n  return mergeWith({}, getEngineFlagAddon(global), getRuntimePublicPathAddOn(global, publicPath), (v1, v2) =>\r\n    concat(v1 ?? [], v2 ?? []),\r\n  );\r\n}\r\n","/**\r\n * @author Kuitos\r\n * @since 2020-05-15\r\n */\r\n\r\nimport type { FrameworkLifeCycles } from '../interfaces';\r\n\r\nexport default function getAddOn(global: Window): FrameworkLifeCycles<any> {\r\n  return {\r\n    async beforeLoad() {\r\n      // eslint-disable-next-line no-param-reassign\r\n      global.__POWERED_BY_FREELOG__ = true;\r\n    },\r\n\r\n    async beforeMount() {\r\n      // eslint-disable-next-line no-param-reassign\r\n      global.__POWERED_BY_FREELOG__ = true;\r\n    },\r\n\r\n    async beforeUnmount() {\r\n      // eslint-disable-next-line no-param-reassign\r\n      delete global.__POWERED_BY_FREELOG__;\r\n    },\r\n  };\r\n}\r\n","/**\r\n * @author kuitos\r\n * @since 2019-05-16\r\n */\r\nimport type { ImportEntryOpts } from './import-html-entry';\r\nimport type { RegisterApplicationConfig, StartOpts, Parcel } from 'single-spa';\r\n\r\ndeclare global {\r\n  // eslint-disable-next-line @typescript-eslint/consistent-type-definitions\r\n  interface Window {\r\n    __POWERED_BY_FREELOG__?: boolean;\r\n    __INJECTED_PUBLIC_PATH_BY_FREELOG__?: string;\r\n    __FREELOG_DEVELOPMENT__?: boolean;\r\n  }\r\n}\r\n\r\nexport type ObjectType = Record<string, any>;\r\n\r\nexport type Entry =\r\n  | string\r\n  | {\r\n      scripts?: string[];\r\n      styles?: string[];\r\n      html?: string;\r\n    };\r\n\r\nexport type HTMLContentRender = (props: { appContent: string; loading: boolean }) => any;\r\n\r\nexport type AppMetadata = {\r\n  // app name\r\n  name: string;\r\n  // app entry\r\n  entry: Entry;\r\n};\r\n\r\n// just for manual loaded apps, in single-spa it called parcel\r\nexport type LoadableApp<T extends ObjectType> = AppMetadata & {\r\n  /* props pass through to app */ props?: T;\r\n} & (\r\n    | {\r\n        // legacy mode, the render function all handled by user\r\n        render: HTMLContentRender;\r\n      }\r\n    | {\r\n        // where the app mount to, mutual exclusive with the legacy custom render function\r\n        container: string | HTMLElement;\r\n      }\r\n  );\r\n\r\n// for the route-based apps\r\nexport type RegistrableApp<T extends ObjectType> = LoadableApp<T> & {\r\n  loader?: (loading: boolean) => void;\r\n  activeRule: RegisterApplicationConfig['activeWhen'];\r\n};\r\n\r\nexport type PrefetchStrategy =\r\n  | boolean\r\n  | 'all'\r\n  | string[]\r\n  | ((apps: AppMetadata[]) => { criticalAppNames: string[]; minorAppsName: string[] });\r\n\r\ntype FreelogSpecialOpts = {\r\n  /**\r\n   * @deprecated internal api, don't used it as normal, might be removed after next version\r\n   */\r\n  $$cacheLifecycleByAppName?: boolean;\r\n  prefetch?: PrefetchStrategy;\r\n  sandbox?:\r\n    | boolean\r\n    | {\r\n        strictStyleIsolation?: boolean;\r\n        experimentalStyleIsolation?: boolean;\r\n        /**\r\n         * @deprecated We use strict mode by default\r\n         */\r\n        loose?: boolean;\r\n        patchers?: Patcher[];\r\n      };\r\n  /*\r\n    with singular mode, any app will wait to load until other apps are unmouting\r\n    it is useful for the scenario that only one sub app shown at one time\r\n  */\r\n  singular?: boolean | ((app: LoadableApp<any>) => Promise<boolean>);\r\n  /**\r\n   * skip some scripts or links intercept, like JSONP\r\n   */\r\n  excludeAssetFilter?: (url: string) => boolean;\r\n};\r\nexport type FrameworkConfiguration = FreelogSpecialOpts & ImportEntryOpts & StartOpts;\r\n\r\nexport type LifeCycleFn<T extends ObjectType> = (app: LoadableApp<T>, global: typeof window) => Promise<any>;\r\nexport type FrameworkLifeCycles<T extends ObjectType> = {\r\n  beforeLoad?: LifeCycleFn<T> | Array<LifeCycleFn<T>>; // function before app load\r\n  beforeMount?: LifeCycleFn<T> | Array<LifeCycleFn<T>>; // function before app mount\r\n  afterMount?: LifeCycleFn<T> | Array<LifeCycleFn<T>>; // function after app mount\r\n  beforeUnmount?: LifeCycleFn<T> | Array<LifeCycleFn<T>>; // function before app unmount\r\n  afterUnmount?: LifeCycleFn<T> | Array<LifeCycleFn<T>>; // function after app unmount\r\n};\r\n\r\nexport type MicroApp = Parcel;\r\n\r\nexport type Rebuilder = () => void;\r\nexport type Freer = () => Rebuilder;\r\nexport type Patcher = () => Freer;\r\n\r\nexport enum SandBoxType {\r\n  Proxy = 'Proxy',\r\n  Snapshot = 'Snapshot',\r\n\r\n  // for legacy sandbox\r\n  // https://github.com/umijs/freelog/blob/0d1d3f0c5ed1642f01854f96c3fabf0a2148bd26/src/sandbox/legacy/sandbox.ts#L22...L25\r\n  LegacyProxy = 'LegacyProxy',\r\n}\r\n\r\nexport type SandBox = {\r\n  /** 沙箱的名字 */\r\n  name: string;\r\n  /** 沙箱的类型 */\r\n  type: SandBoxType;\r\n  /** 沙箱导出的代理实体 */\r\n  proxy: WindowProxy;\r\n  /** 沙箱是否在运行中 */\r\n  sandboxRunning: boolean;\r\n  /** latest set property */\r\n  latestSetProp?: PropertyKey | null;\r\n  /** 启动沙箱 */\r\n  active: () => void;\r\n  /** 关闭沙箱 */\r\n  inactive: () => void;\r\n};\r\n\r\nexport type OnGlobalStateChangeCallback = (state: Record<string, any>, prevState: Record<string, any>) => void;\r\n\r\nexport type MicroAppStateActions = {\r\n  onGlobalStateChange: (callback: OnGlobalStateChangeCallback, fireImmediately?: boolean) => void;\r\n  setGlobalState: (state: Record<string, any>) => boolean;\r\n  offGlobalStateChange: () => boolean;\r\n};\r\n","/**\r\n * @author dbkillerf6\r\n * @since 2020-04-10\r\n */\r\n\r\nimport { cloneDeep } from 'lodash';\r\nimport type { OnGlobalStateChangeCallback, MicroAppStateActions } from './interfaces';\r\n\r\nlet globalState: Record<string, any> = {};\r\n\r\nconst deps: Record<string, OnGlobalStateChangeCallback> = {};\r\n\r\n// 触发全局监听\r\nfunction emitGlobal(state: Record<string, any>, prevState: Record<string, any>) {\r\n  Object.keys(deps).forEach((id: string) => {\r\n    if (deps[id] instanceof Function) {\r\n      deps[id](cloneDeep(state), cloneDeep(prevState));\r\n    }\r\n  });\r\n}\r\n\r\nexport function initGlobalState(state: Record<string, any> = {}) {\r\n  if (state === globalState) {\r\n    console.warn('[freelog] state has not changed！');\r\n  } else {\r\n    const prevGlobalState = cloneDeep(globalState);\r\n    globalState = cloneDeep(state);\r\n    emitGlobal(globalState, prevGlobalState);\r\n  }\r\n  return getMicroAppStateActions(`global-${+new Date()}`, true);\r\n}\r\n\r\nexport function getMicroAppStateActions(id: string, isMaster?: boolean): MicroAppStateActions {\r\n  return {\r\n    /**\r\n     * onGlobalStateChange 全局依赖监听\r\n     *\r\n     * 收集 setState 时所需要触发的依赖\r\n     *\r\n     * 限制条件：每个子应用只有一个激活状态的全局监听，新监听覆盖旧监听，若只是监听部分属性，请使用 onGlobalStateChange\r\n     *\r\n     * 这么设计是为了减少全局监听滥用导致的内存爆炸\r\n     *\r\n     * 依赖数据结构为：\r\n     * {\r\n     *   {id}: callback\r\n     * }\r\n     *\r\n     * @param callback\r\n     * @param fireImmediately\r\n     */\r\n    onGlobalStateChange(callback: OnGlobalStateChangeCallback, fireImmediately?: boolean) {\r\n      if (!(callback instanceof Function)) {\r\n        console.error('[freelog] callback must be function!');\r\n        return;\r\n      }\r\n      if (deps[id]) {\r\n        console.warn(`[freelog] '${id}' global listener already exists before this, new listener will overwrite it.`);\r\n      }\r\n      deps[id] = callback;\r\n      const cloneState = cloneDeep(globalState);\r\n      if (fireImmediately) {\r\n        callback(cloneState, cloneState);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * setGlobalState 更新 store 数据\r\n     *\r\n     * 1. 对输入 state 的第一层属性做校验，只有初始化时声明过的第一层（bucket）属性才会被更改\r\n     * 2. 修改 store 并触发全局监听\r\n     *\r\n     * @param state\r\n     */\r\n    setGlobalState(state: Record<string, any> = {}) {\r\n      if (state === globalState) {\r\n        console.warn('[freelog] state has not changed！');\r\n        return false;\r\n      }\r\n\r\n      const changeKeys: string[] = [];\r\n      const prevGlobalState = cloneDeep(globalState);\r\n      globalState = cloneDeep(\r\n        Object.keys(state).reduce((_globalState, changeKey) => {\r\n          if (isMaster || _globalState.hasOwnProperty(changeKey)) {\r\n            changeKeys.push(changeKey);\r\n            return Object.assign(_globalState, { [changeKey]: state[changeKey] });\r\n          }\r\n          console.warn(`[freelog] '${changeKey}' not declared when init state！`);\r\n          return _globalState;\r\n        }, globalState),\r\n      );\r\n      if (changeKeys.length === 0) {\r\n        console.warn('[freelog] state has not changed！');\r\n        return false;\r\n      }\r\n      emitGlobal(globalState, prevGlobalState);\r\n      return true;\r\n    },\r\n\r\n    // 注销该应用下的依赖\r\n    offGlobalStateChange() {\r\n      delete deps[id];\r\n      return true;\r\n    },\r\n  };\r\n}\r\n","/**\r\n * @author Saviio\r\n * @since 2020-4-19\r\n */\r\n\r\nimport { threadId } from \"node:worker_threads\";\r\nimport { widgetsConfig } from \"../../../structure/widget\"\r\n// https://developer.mozilla.org/en-US/docs/Web/API/CSSRule\r\nenum RuleType {\r\n  // type: rule will be rewrote\r\n  STYLE = 1,\r\n  MEDIA = 4,\r\n  SUPPORTS = 12,\r\n\r\n  // type: value will be kept\r\n  IMPORT = 3,\r\n  FONT_FACE = 5,\r\n  PAGE = 6,\r\n  KEYFRAMES = 7,\r\n  KEYFRAME = 8,\r\n}\r\n\r\nconst arrayify = <T>(list: CSSRuleList | any[]) => {\r\n  return [].slice.call(list, 0) as T[];\r\n};\r\n\r\nconst rawDocumentBodyAppend = HTMLBodyElement.prototype.appendChild;\r\n\r\nexport class ScopedCSS {\r\n  private static ModifiedTag = 'Symbol(style-modified-freelog)';\r\n\r\n  private sheet: StyleSheet;\r\n\r\n  private swapNode: HTMLStyleElement;\r\n  private appName: string;\r\n  constructor(data:any) {\r\n    const styleNode = document.createElement('style');\r\n    rawDocumentBodyAppend.call(document.body, styleNode);\r\n    this.appName = data.appName\r\n    this.swapNode = styleNode;\r\n    this.sheet = styleNode.sheet!;\r\n    this.sheet.disabled = true;\r\n  }\r\n\r\n  process(styleNode: HTMLStyleElement, prefix: string = '') {\r\n    if (styleNode.textContent !== '') {\r\n      const textNode = document.createTextNode(styleNode.textContent || '');\r\n      this.swapNode.appendChild(textNode);\r\n      const sheet = this.swapNode.sheet as any; // type is missing\r\n      const rules = arrayify<CSSRule>(sheet?.cssRules ?? []);\r\n      const css = this.rewrite(rules, prefix);\r\n      // eslint-disable-next-line no-param-reassign\r\n      styleNode.textContent = css;\r\n\r\n      // cleanup\r\n      this.swapNode.removeChild(textNode);\r\n      return;\r\n    }\r\n\r\n    const mutator = new MutationObserver((mutations) => {\r\n      for (let i = 0; i < mutations.length; i += 1) {\r\n        const mutation = mutations[i];\r\n\r\n        if (ScopedCSS.ModifiedTag in styleNode) {\r\n          return;\r\n        }\r\n\r\n        if (mutation.type === 'childList') {\r\n          const sheet = styleNode.sheet as any;\r\n          const rules = arrayify<CSSRule>(sheet?.cssRules ?? []);\r\n          const css = this.rewrite(rules, prefix);\r\n\r\n          // eslint-disable-next-line no-param-reassign\r\n          styleNode.textContent = css;\r\n          // eslint-disable-next-line no-param-reassign\r\n          (styleNode as any)[ScopedCSS.ModifiedTag] = true;\r\n        }\r\n      }\r\n    });\r\n\r\n    // since observer will be deleted when node be removed\r\n    // we dont need create a cleanup function manually\r\n    // see https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver/disconnect\r\n    mutator.observe(styleNode, { childList: true });\r\n  }\r\n\r\n  private rewrite(rules: CSSRule[], prefix: string = '') {\r\n    let css = '';\r\n\r\n    rules.forEach((rule) => {\r\n      switch (rule.type) {\r\n        case RuleType.STYLE:\r\n          css += this.ruleStyle(rule as CSSStyleRule, prefix);\r\n          break;\r\n        case RuleType.MEDIA:\r\n          css += this.ruleMedia(rule as CSSMediaRule, prefix);\r\n          break;\r\n        case RuleType.SUPPORTS:\r\n          css += this.ruleSupport(rule as CSSSupportsRule, prefix);\r\n          break;\r\n        // case RuleType.FONT_FACE:\r\n        //   css += this.ruleFont(rule, prefix);\r\n        //   break;\r\n        default:\r\n          css += `${rule.cssText}`;\r\n          break;\r\n      }\r\n    });\r\n\r\n    return css;\r\n  }\r\n   // @font-face repalce exclude [http, data:,//]\r\n  private ruleFont(rule: any, prefix: string) {\r\n    let { cssText } = rule;\r\n    // url(\"/\r\n    cssText = cssText.replace(/url\\(\\\"\\//ig,'url(\"' +  widgetsConfig.get(this.appName).entry + '/');\r\n    console.log(cssText, widgetsConfig.get(this.appName).entry)\r\n    return cssText;\r\n  }\r\n  // handle case:\r\n  // .app-main {}\r\n  // html, body {}\r\n\r\n  // eslint-disable-next-line class-methods-use-this\r\n  private ruleStyle(rule: CSSStyleRule, prefix: string) {\r\n    const rootSelectorRE = /((?:[^\\w\\-.#]|^)(body|html|:root))/gm;\r\n    const rootCombinationRE = /(html[^\\w{[]+)/gm;\r\n\r\n    const selector = rule.selectorText.trim();\r\n\r\n    let { cssText } = rule;\r\n    // handle html { ... }\r\n    // handle body { ... }\r\n    // handle :root { ... }\r\n    if (selector === 'html' || selector === 'body' || selector === ':root') {\r\n      return cssText.replace(rootSelectorRE, prefix);\r\n    }\r\n\r\n    // handle html body { ... }\r\n    // handle html > body { ... }\r\n    if (rootCombinationRE.test(rule.selectorText)) {\r\n      const siblingSelectorRE = /(html[^\\w{]+)(\\+|~)/gm;\r\n\r\n      // since html + body is a non-standard rule for html\r\n      // transformer will ignore it\r\n      if (!siblingSelectorRE.test(rule.selectorText)) {\r\n        cssText = cssText.replace(rootCombinationRE, '');\r\n      }\r\n    }\r\n\r\n    // handle grouping selector, a,span,p,div { ... }\r\n    cssText = cssText.replace(/^[\\s\\S]+{/, (selectors) =>\r\n      selectors.replace(/(^|,\\n?)([^,]+)/g, (item, p, s) => {\r\n        // handle div,body,span { ... }\r\n        if (rootSelectorRE.test(item)) {\r\n          return item.replace(rootSelectorRE, (m) => {\r\n            // do not discard valid previous character, such as body,html or *:not(:root)\r\n            const whitePrevChars = [',', '('];\r\n\r\n            if (m && whitePrevChars.includes(m[0])) {\r\n              return `${m[0]}${prefix}`;\r\n            }\r\n\r\n            // replace root selector with prefix\r\n            return prefix;\r\n          });\r\n        }\r\n\r\n        return `${p}${prefix} ${s.replace(/^ */, '')}`;\r\n      }),\r\n    );\r\n\r\n    return cssText;\r\n  }\r\n\r\n  // handle case:\r\n  // @media screen and (max-width: 300px) {}\r\n  private ruleMedia(rule: CSSMediaRule, prefix: string) {\r\n    const css = this.rewrite(arrayify(rule.cssRules), prefix);\r\n    return `@media ${rule.conditionText} {${css}}`;\r\n  }\r\n\r\n  // handle case:\r\n  // @supports (display: grid) {}\r\n  private ruleSupport(rule: CSSSupportsRule, prefix: string) {\r\n    const css = this.rewrite(arrayify(rule.cssRules), prefix);\r\n    return `@supports ${rule.conditionText} {${css}}`;\r\n  }\r\n}\r\n\r\nlet processor: ScopedCSS;\r\n\r\nexport const FreelogCSSRewriteAttr = 'data-freelog';\r\nexport const process = (\r\n  appWrapper: HTMLElement,\r\n  stylesheetElement: HTMLStyleElement | HTMLLinkElement,\r\n  appName: string,\r\n): void => {\r\n  // lazy singleton pattern\r\n  if (!processor) {\r\n    processor = new ScopedCSS({appName});\r\n  }\r\n\r\n  if (stylesheetElement.tagName === 'LINK') {\r\n    console.warn('Feature: sandbox.experimentalStyleIsolation is not support for link element yet.');\r\n  }\r\n\r\n  const mountDOM = appWrapper;\r\n  if (!mountDOM) {\r\n    return;\r\n  }\r\n\r\n  const tag = (mountDOM.tagName || '').toLowerCase();\r\n\r\n  if (tag && stylesheetElement.tagName === 'STYLE') {\r\n    const prefix = `${tag}[${FreelogCSSRewriteAttr}=\"${appName}\"]`;\r\n    processor.process(stylesheetElement, prefix);\r\n  }\r\n};\r\n","/**\r\n * @author Kuitos\r\n * @since 2019-05-15\r\n */\r\n\r\nimport { isFunction, snakeCase } from 'lodash';\r\nimport type { FrameworkConfiguration } from './interfaces';\r\n\r\nexport function toArray<T>(array: T | T[]): T[] {\r\n  return Array.isArray(array) ? array : [array];\r\n}\r\n\r\nexport function sleep(ms: number) {\r\n  return new Promise((resolve) => setTimeout(resolve, ms));\r\n}\r\n\r\n/**\r\n * run a callback after next tick\r\n * @param cb\r\n */\r\nexport function nextTick(cb: () => void): void {\r\n  Promise.resolve().then(cb);\r\n}\r\n\r\nconst constructableMap = new WeakMap<any | FunctionConstructor, boolean>();\r\nexport function isConstructable(fn: () => any | FunctionConstructor) {\r\n  if (constructableMap.has(fn)) {\r\n    return constructableMap.get(fn);\r\n  }\r\n\r\n  const constructableFunctionRegex = /^function\\b\\s[A-Z].*/;\r\n  const classRegex = /^class\\b/;\r\n\r\n  // 有 prototype 并且 prototype 上有定义一系列非 constructor 属性，则可以认为是一个构造函数\r\n  const constructable =\r\n    (fn.prototype && fn.prototype.constructor === fn && Object.getOwnPropertyNames(fn.prototype).length > 1) ||\r\n    constructableFunctionRegex.test(fn.toString()) ||\r\n    classRegex.test(fn.toString());\r\n  constructableMap.set(fn, constructable);\r\n  return constructable;\r\n}\r\n\r\n/**\r\n * in safari\r\n * typeof document.all === 'undefined' // true\r\n * typeof document.all === 'function' // true\r\n * We need to discriminate safari for better performance\r\n */\r\nconst naughtySafari = typeof document.all === 'function' && typeof document.all === 'undefined';\r\nexport const isCallable = naughtySafari\r\n  ? (fn: any) => typeof fn === 'function' && typeof fn !== 'undefined'\r\n  : (fn: any) => typeof fn === 'function';\r\n\r\nconst boundedMap = new WeakMap<CallableFunction, boolean>();\r\nexport function isBoundedFunction(fn: CallableFunction) {\r\n  if (boundedMap.has(fn)) {\r\n    return boundedMap.get(fn);\r\n  }\r\n  /*\r\n   indexOf is faster than startsWith\r\n   see https://jsperf.com/string-startswith/72\r\n   */\r\n  const bounded = fn.name.indexOf('bound ') === 0 && !fn.hasOwnProperty('prototype');\r\n  boundedMap.set(fn, bounded);\r\n  return bounded;\r\n}\r\n\r\nexport function getDefaultTplWrapper(id: string, name: string) {\r\n  return (tpl: string) => `<div id=\"${getWrapperId(id)}\" data-name=\"${name}\">${tpl}</div>`;\r\n}\r\n\r\nexport function getWrapperId(id: string) {\r\n  return `__freelog_microapp_wrapper_for_${snakeCase(id)}__`;\r\n}\r\n\r\n/** 校验子应用导出的 生命周期 对象是否正确 */\r\nexport function validateExportLifecycle(exports: any) {\r\n  const { bootstrap, mount, unmount } = exports ?? {};\r\n  return isFunction(bootstrap) && isFunction(mount) && isFunction(unmount);\r\n}\r\n\r\nclass Deferred<T> {\r\n  promise: Promise<T>;\r\n\r\n  resolve!: (value: T | PromiseLike<T>) => void;\r\n\r\n  reject!: (reason?: any) => void;\r\n\r\n  constructor() {\r\n    this.promise = new Promise((resolve, reject) => {\r\n      this.resolve = resolve;\r\n      this.reject = reject;\r\n    });\r\n  }\r\n}\r\n\r\nexport { Deferred };\r\n\r\nconst supportsUserTiming =\r\n  typeof performance !== 'undefined' &&\r\n  typeof performance.mark === 'function' &&\r\n  typeof performance.clearMarks === 'function' &&\r\n  typeof performance.measure === 'function' &&\r\n  typeof performance.clearMeasures === 'function' &&\r\n  typeof performance.getEntriesByName === 'function';\r\n\r\nexport function performanceGetEntriesByName(markName: string, type?: string) {\r\n  let marks = null;\r\n  if (supportsUserTiming) {\r\n    marks = performance.getEntriesByName(markName, type);\r\n  }\r\n  return marks;\r\n}\r\n\r\nexport function performanceMark(markName: string) {\r\n  if (supportsUserTiming) {\r\n    performance.mark(markName);\r\n  }\r\n}\r\n\r\nexport function performanceMeasure(measureName: string, markName: string) {\r\n  if (supportsUserTiming && performance.getEntriesByName(markName, 'mark').length) {\r\n    performance.measure(measureName, markName);\r\n    performance.clearMarks(markName);\r\n    performance.clearMeasures(measureName);\r\n  }\r\n}\r\n\r\nexport function isEnableScopedCSS(sandbox: FrameworkConfiguration['sandbox']) {\r\n  if (typeof sandbox !== 'object') {\r\n    return false;\r\n  }\r\n\r\n  if (sandbox.strictStyleIsolation) {\r\n    return false;\r\n  }\r\n\r\n  return !!sandbox.experimentalStyleIsolation;\r\n}\r\n\r\n/**\r\n * copy from https://developer.mozilla.org/zh-CN/docs/Using_XPath\r\n * @param el\r\n * @param document\r\n */\r\nexport function getXPathForElement(el: Node, document: Document): string | void {\r\n  // not support that if el not existed in document yet(such as it not append to document before it mounted)\r\n  if (!document.body.contains(el)) {\r\n    return undefined;\r\n  }\r\n\r\n  let xpath = '';\r\n  let pos;\r\n  let tmpEle;\r\n  let element = el;\r\n\r\n  while (element !== document.documentElement) {\r\n    pos = 0;\r\n    tmpEle = element;\r\n    while (tmpEle) {\r\n      if (tmpEle.nodeType === 1 && tmpEle.nodeName === element.nodeName) {\r\n        // If it is ELEMENT_NODE of the same name\r\n        pos += 1;\r\n      }\r\n      tmpEle = tmpEle.previousSibling;\r\n    }\r\n\r\n    xpath = `*[name()='${element.nodeName}' and namespace-uri()='${\r\n      element.namespaceURI === null ? '' : element.namespaceURI\r\n    }'][${pos}]/${xpath}`;\r\n\r\n    element = element.parentNode!;\r\n  }\r\n\r\n  xpath = `/*[name()='${document.documentElement.nodeName}' and namespace-uri()='${\r\n    element.namespaceURI === null ? '' : element.namespaceURI\r\n  }']/${xpath}`;\r\n  xpath = xpath.replace(/\\/$/, '');\r\n\r\n  return xpath;\r\n}\r\n\r\nexport function getContainer(container: string | HTMLElement): HTMLElement | null {\r\n  return typeof container === 'string' ? document.querySelector(container) : container;\r\n}\r\n","/**\r\n * @author Kuitos\r\n * @since 2020-04-13\r\n */\r\n\r\nimport { isBoundedFunction, isCallable, isConstructable } from '../utils';\r\n\r\nlet currentRunningSandboxProxy: WindowProxy | null;\r\nexport function getCurrentRunningSandboxProxy() {\r\n  return currentRunningSandboxProxy;\r\n}\r\n\r\nexport function setCurrentRunningSandboxProxy(proxy: WindowProxy | null) {\r\n  currentRunningSandboxProxy = proxy;\r\n}\r\n\r\nconst functionBoundedValueMap = new WeakMap<CallableFunction, CallableFunction>();\r\nexport function getTargetValue(target: any, value: any): any {\r\n  const cachedBoundFunction = functionBoundedValueMap.get(value);\r\n  if (cachedBoundFunction) {\r\n    return cachedBoundFunction;\r\n  }\r\n\r\n  /*\r\n    仅绑定 isCallable && !isBoundedFunction && !isConstructable 的函数对象，如 window.console、window.atob 这类。目前没有完美的检测方式，这里通过 prototype 中是否还有可枚举的拓展方法的方式来判断\r\n    @warning 这里不要随意替换成别的判断方式，因为可能触发一些 edge case（比如在 lodash.isFunction 在 iframe 上下文中可能由于调用了 top window 对象触发的安全异常）\r\n   */\r\n  if (isCallable(value) && !isBoundedFunction(value) && !isConstructable(value)) {\r\n    const boundValue = Function.prototype.bind.call(value, target);\r\n\r\n    // some callable function has custom fields, we need to copy the enumerable props to boundValue. such as moment function.\r\n    // use for..in rather than Object.keys.forEach for performance reason\r\n    // eslint-disable-next-line guard-for-in,no-restricted-syntax\r\n    for (const key in value) {\r\n      boundValue[key] = value[key];\r\n    }\r\n\r\n    // copy prototype if bound function not have\r\n    // mostly a bound function have no own prototype, but it not absolute in some old version browser, see https://github.com/umijs/freelog/issues/1121\r\n    if (value.hasOwnProperty('prototype') && !boundValue.hasOwnProperty('prototype'))\r\n      boundValue.prototype = value.prototype;\r\n\r\n    functionBoundedValueMap.set(value, boundValue);\r\n    return boundValue;\r\n  }\r\n\r\n  return value;\r\n}\r\n\r\nconst getterInvocationResultMap = new WeakMap<CallableFunction, any>();\r\n\r\nexport function getProxyPropertyValue(getter: CallableFunction) {\r\n  const getterResult = getterInvocationResultMap.get(getter);\r\n  if (!getterResult) {\r\n    const result = getter();\r\n    getterInvocationResultMap.set(getter, result);\r\n    return result;\r\n  }\r\n\r\n  return getterResult;\r\n}\r\n","/**\r\n * @author Kuitos\r\n * @since 2019-10-21\r\n */\r\nimport { execScripts } from '../../../import-html-entry';\r\nimport { isFunction } from 'lodash';\r\nimport { frameworkConfiguration } from '../../../apis';\r\n\r\nimport * as css from '../css';\r\n\r\nexport const rawHeadAppendChild = HTMLHeadElement.prototype.appendChild;\r\nconst rawHeadRemoveChild = HTMLHeadElement.prototype.removeChild;\r\nconst rawBodyAppendChild = HTMLBodyElement.prototype.appendChild;\r\nconst rawBodyRemoveChild = HTMLBodyElement.prototype.removeChild;\r\nconst rawHeadInsertBefore = HTMLHeadElement.prototype.insertBefore;\r\nconst rawRemoveChild = HTMLElement.prototype.removeChild;\r\n\r\nconst SCRIPT_TAG_NAME = 'SCRIPT';\r\nconst LINK_TAG_NAME = 'LINK';\r\nconst STYLE_TAG_NAME = 'STYLE';\r\n\r\nexport function isHijackingTag(tagName?: string) {\r\n  return (\r\n    tagName?.toUpperCase() === LINK_TAG_NAME ||\r\n    tagName?.toUpperCase() === STYLE_TAG_NAME ||\r\n    tagName?.toUpperCase() === SCRIPT_TAG_NAME\r\n  );\r\n}\r\n\r\n/**\r\n * Check if a style element is a styled-component liked.\r\n * A styled-components liked element is which not have textContext but keep the rules in its styleSheet.cssRules.\r\n * Such as the style element generated by styled-components and emotion.\r\n * @param element\r\n */\r\nexport function isStyledComponentsLike(element: HTMLStyleElement) {\r\n  return (\r\n    !element.textContent &&\r\n    ((element.sheet as CSSStyleSheet)?.cssRules.length || getStyledElementCSSRules(element)?.length)\r\n  );\r\n}\r\n\r\nfunction patchCustomEvent(\r\n  e: CustomEvent,\r\n  elementGetter: () => HTMLScriptElement | HTMLLinkElement | null,\r\n): CustomEvent {\r\n  Object.defineProperties(e, {\r\n    srcElement: {\r\n      get: elementGetter,\r\n    },\r\n    target: {\r\n      get: elementGetter,\r\n    },\r\n  });\r\n\r\n  return e;\r\n}\r\n\r\nfunction manualInvokeElementOnLoad(element: HTMLLinkElement | HTMLScriptElement) {\r\n  // we need to invoke the onload event manually to notify the event listener that the script was completed\r\n  // here are the two typical ways of dynamic script loading\r\n  // 1. element.onload callback way, which webpack and loadjs used, see https://github.com/muicss/loadjs/blob/master/src/loadjs.js#L138\r\n  // 2. addEventListener way, which toast-loader used, see https://github.com/pyrsmk/toast/blob/master/src/Toast.ts#L64\r\n  const loadEvent = new CustomEvent('load');\r\n  const patchedEvent = patchCustomEvent(loadEvent, () => element);\r\n  if (isFunction(element.onload)) {\r\n    element.onload(patchedEvent);\r\n  } else {\r\n    element.dispatchEvent(patchedEvent);\r\n  }\r\n}\r\n\r\nfunction manualInvokeElementOnError(element: HTMLLinkElement | HTMLScriptElement) {\r\n  const errorEvent = new CustomEvent('error');\r\n  const patchedEvent = patchCustomEvent(errorEvent, () => element);\r\n  if (isFunction(element.onerror)) {\r\n    element.onerror(patchedEvent);\r\n  } else {\r\n    element.dispatchEvent(patchedEvent);\r\n  }\r\n}\r\n\r\nfunction convertLinkAsStyle(\r\n  element: HTMLLinkElement,\r\n  postProcess: (styleElement: HTMLStyleElement) => void,\r\n  fetchFn = fetch,\r\n): HTMLStyleElement {\r\n  const styleElement = document.createElement('style');\r\n  const { href } = element;\r\n  // add source link element href\r\n  styleElement.dataset.freelogHref = href;\r\n\r\n  fetchFn(href)\r\n    .then((res: any) => res.text())\r\n    .then((styleContext: string) => {\r\n      styleElement.appendChild(document.createTextNode(styleContext));\r\n      postProcess(styleElement);\r\n      manualInvokeElementOnLoad(element);\r\n    })\r\n    .catch(() => manualInvokeElementOnError(element));\r\n\r\n  return styleElement;\r\n}\r\n\r\nconst styledComponentCSSRulesMap = new WeakMap<HTMLStyleElement, CSSRuleList>();\r\nconst dynamicScriptAttachedCommentMap = new WeakMap<HTMLScriptElement, Comment>();\r\nconst dynamicLinkAttachedInlineStyleMap = new WeakMap<HTMLLinkElement, HTMLStyleElement>();\r\n\r\nexport function recordStyledComponentsCSSRules(styleElements: HTMLStyleElement[]): void {\r\n  styleElements.forEach((styleElement) => {\r\n    /*\r\n     With a styled-components generated style element, we need to record its cssRules for restore next re-mounting time.\r\n     We're doing this because the sheet of style element is going to be cleaned automatically by browser after the style element dom removed from document.\r\n     see https://www.w3.org/TR/cssom-1/#associated-css-style-sheet\r\n     */\r\n    if (styleElement instanceof HTMLStyleElement && isStyledComponentsLike(styleElement)) {\r\n      if (styleElement.sheet) {\r\n        // record the original css rules of the style element for restore\r\n        styledComponentCSSRulesMap.set(styleElement, (styleElement.sheet as CSSStyleSheet).cssRules);\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nexport function getStyledElementCSSRules(styledElement: HTMLStyleElement): CSSRuleList | undefined {\r\n  return styledComponentCSSRulesMap.get(styledElement);\r\n}\r\n\r\nexport type ContainerConfig = {\r\n  appName: string;\r\n  proxy: WindowProxy;\r\n  strictGlobal: boolean;\r\n  dynamicStyleSheetElements: HTMLStyleElement[];\r\n  appWrapperGetter: CallableFunction;\r\n  scopedCSS: boolean;\r\n  excludeAssetFilter?: CallableFunction;\r\n};\r\n\r\nfunction getOverwrittenAppendChildOrInsertBefore(opts: {\r\n  rawDOMAppendOrInsertBefore: <T extends Node>(newChild: T, refChild?: Node | null) => T;\r\n  isInvokedByMicroApp: (element: HTMLElement) => boolean;\r\n  containerConfigGetter: (element: HTMLElement) => ContainerConfig;\r\n}) {\r\n  return function appendChildOrInsertBefore<T extends Node>(\r\n    this: HTMLHeadElement | HTMLBodyElement,\r\n    newChild: T,\r\n    refChild?: Node | null,\r\n  ) {\r\n    let element = newChild as any;\r\n    const { rawDOMAppendOrInsertBefore, isInvokedByMicroApp, containerConfigGetter } = opts;\r\n     if (!isHijackingTag(element.tagName) || !isInvokedByMicroApp(element)) {\r\n       return rawDOMAppendOrInsertBefore.call(this, element, refChild) as T;\r\n    }\r\n\r\n    if (element.tagName) {\r\n      const containerConfig = containerConfigGetter(element);\r\n      const {\r\n        appName,\r\n        appWrapperGetter,\r\n        proxy,\r\n        strictGlobal,\r\n        dynamicStyleSheetElements,\r\n        scopedCSS,\r\n        excludeAssetFilter,\r\n      } = containerConfig;\r\n      switch (element.tagName) {\r\n        case LINK_TAG_NAME:\r\n        case STYLE_TAG_NAME: {\r\n          let stylesheetElement: HTMLLinkElement | HTMLStyleElement = newChild as any;\r\n          const { href } = stylesheetElement as HTMLLinkElement;\r\n          if (excludeAssetFilter && href && excludeAssetFilter(href)) {\r\n            return rawDOMAppendOrInsertBefore.call(this, element, refChild) as T;\r\n          }\r\n\r\n          const mountDOM = appWrapperGetter();\r\n\r\n          if (scopedCSS) {\r\n            // exclude link elements like <link rel=\"icon\" href=\"favicon.ico\">\r\n            const linkElementUsingStylesheet =\r\n              element.tagName?.toUpperCase() === LINK_TAG_NAME &&\r\n              (element as HTMLLinkElement).rel === 'stylesheet' &&\r\n              (element as HTMLLinkElement).href;\r\n            if (linkElementUsingStylesheet) {\r\n              const fetch =\r\n                typeof frameworkConfiguration.fetch === 'function'\r\n                  ? frameworkConfiguration.fetch\r\n                  : frameworkConfiguration.fetch?.fn;\r\n              stylesheetElement = convertLinkAsStyle(\r\n                element,\r\n                (styleElement) => css.process(mountDOM, styleElement, appName),\r\n                fetch,\r\n              );\r\n              dynamicLinkAttachedInlineStyleMap.set(element, stylesheetElement);\r\n            } else {\r\n              css.process(mountDOM, stylesheetElement, appName);\r\n            }\r\n          }\r\n\r\n          // eslint-disable-next-line no-shadow\r\n          dynamicStyleSheetElements.push(stylesheetElement);\r\n          const referenceNode = mountDOM.contains(refChild) ? refChild : null;\r\n          return rawDOMAppendOrInsertBefore.call(mountDOM, stylesheetElement, referenceNode);\r\n        }\r\n\r\n        case SCRIPT_TAG_NAME: {\r\n          const { src, text } = element as HTMLScriptElement;\r\n          // some script like jsonp maybe not support cors which should't use execScripts\r\n          if (excludeAssetFilter && src && excludeAssetFilter(src)) {\r\n            return rawDOMAppendOrInsertBefore.call(this, element, refChild) as T;\r\n          }\r\n\r\n          const mountDOM = appWrapperGetter();\r\n          const { fetch } = frameworkConfiguration;\r\n          const referenceNode = mountDOM.contains(refChild) ? refChild : null;\r\n\r\n          if (src) {\r\n            execScripts(null, [src], proxy, {\r\n              fetch,\r\n              strictGlobal,\r\n              beforeExec: () => {\r\n                Object.defineProperty(document, 'currentScript', {\r\n                  get(): any {\r\n                    return element;\r\n                  },\r\n                  configurable: true,\r\n                });\r\n              },\r\n              success: () => {\r\n                manualInvokeElementOnLoad(element);\r\n                element = null;\r\n              },\r\n              error: () => {\r\n                manualInvokeElementOnError(element);\r\n                element = null;\r\n              },\r\n            });\r\n\r\n            const dynamicScriptCommentElement = document.createComment(`dynamic script ${src} replaced by freelog`);\r\n            dynamicScriptAttachedCommentMap.set(element, dynamicScriptCommentElement);\r\n            return rawDOMAppendOrInsertBefore.call(mountDOM, dynamicScriptCommentElement, referenceNode);\r\n          }\r\n\r\n          // inline script never trigger the onload and onerror event\r\n          execScripts(null, [`<script>${text}</script>`], proxy, { strictGlobal });\r\n          const dynamicInlineScriptCommentElement = document.createComment('dynamic inline script replaced by freelog');\r\n          dynamicScriptAttachedCommentMap.set(element, dynamicInlineScriptCommentElement);\r\n          return rawDOMAppendOrInsertBefore.call(mountDOM, dynamicInlineScriptCommentElement, referenceNode);\r\n        }\r\n\r\n        default:\r\n          break;\r\n      }\r\n    }\r\n\r\n    return rawDOMAppendOrInsertBefore.call(this, element, refChild);\r\n  };\r\n}\r\n\r\nfunction getNewRemoveChild(\r\n  headOrBodyRemoveChild: typeof HTMLElement.prototype.removeChild,\r\n  appWrapperGetterGetter: (element: HTMLElement) => ContainerConfig['appWrapperGetter'],\r\n) {\r\n  return function removeChild<T extends Node>(this: HTMLHeadElement | HTMLBodyElement, child: T) {\r\n    const { tagName } = child as any;\r\n    if (!isHijackingTag(tagName)) return headOrBodyRemoveChild.call(this, child) as T;\r\n\r\n    try {\r\n      let attachedElement: Node;\r\n      switch (tagName) {\r\n        case LINK_TAG_NAME: {\r\n          attachedElement = (dynamicLinkAttachedInlineStyleMap.get(child as any) as Node) || child;\r\n          break;\r\n        }\r\n\r\n        case SCRIPT_TAG_NAME: {\r\n          attachedElement = (dynamicScriptAttachedCommentMap.get(child as any) as Node) || child;\r\n          break;\r\n        }\r\n\r\n        default: {\r\n          attachedElement = child;\r\n        }\r\n      }\r\n\r\n      // container may had been removed while app unmounting if the removeChild action was async\r\n      const appWrapperGetter = appWrapperGetterGetter(child as any);\r\n      const container = appWrapperGetter();\r\n      if (container.contains(attachedElement)) {\r\n        return rawRemoveChild.call(container, attachedElement) as T;\r\n      }\r\n    } catch (e) {\r\n      console.warn(e);\r\n    }\r\n\r\n    return headOrBodyRemoveChild.call(this, child) as T;\r\n  };\r\n}\r\n\r\nexport function patchHTMLDynamicAppendPrototypeFunctions(\r\n  isInvokedByMicroApp: (element: HTMLElement) => boolean,\r\n  containerConfigGetter: (element: HTMLElement) => ContainerConfig,\r\n) {\r\n  // Just overwrite it while it have not been overwrite\r\n  if (\r\n    HTMLHeadElement.prototype.appendChild === rawHeadAppendChild &&\r\n    HTMLBodyElement.prototype.appendChild === rawBodyAppendChild &&\r\n    HTMLHeadElement.prototype.insertBefore === rawHeadInsertBefore\r\n  ) {\r\n    HTMLHeadElement.prototype.appendChild = getOverwrittenAppendChildOrInsertBefore({\r\n      rawDOMAppendOrInsertBefore: rawHeadAppendChild,\r\n      containerConfigGetter,\r\n      isInvokedByMicroApp,\r\n    }) as typeof rawHeadAppendChild;\r\n    HTMLBodyElement.prototype.appendChild = getOverwrittenAppendChildOrInsertBefore({\r\n      rawDOMAppendOrInsertBefore: rawBodyAppendChild,\r\n      containerConfigGetter,\r\n      isInvokedByMicroApp,\r\n    }) as typeof rawBodyAppendChild;\r\n\r\n    HTMLHeadElement.prototype.insertBefore = getOverwrittenAppendChildOrInsertBefore({\r\n      rawDOMAppendOrInsertBefore: rawHeadInsertBefore as any,\r\n      containerConfigGetter,\r\n      isInvokedByMicroApp,\r\n    }) as typeof rawHeadInsertBefore;\r\n  }\r\n\r\n  // Just overwrite it while it have not been overwrite\r\n  if (\r\n    HTMLHeadElement.prototype.removeChild === rawHeadRemoveChild &&\r\n    HTMLBodyElement.prototype.removeChild === rawBodyRemoveChild\r\n  ) {\r\n    HTMLHeadElement.prototype.removeChild = getNewRemoveChild(\r\n      rawHeadRemoveChild,\r\n      (element) => containerConfigGetter(element).appWrapperGetter,\r\n    );\r\n    HTMLBodyElement.prototype.removeChild = getNewRemoveChild(\r\n      rawBodyRemoveChild,\r\n      (element) => containerConfigGetter(element).appWrapperGetter,\r\n    );\r\n  }\r\n\r\n  return function unpatch() {\r\n    HTMLHeadElement.prototype.appendChild = rawHeadAppendChild;\r\n    HTMLHeadElement.prototype.removeChild = rawHeadRemoveChild;\r\n    HTMLBodyElement.prototype.appendChild = rawBodyAppendChild;\r\n    HTMLBodyElement.prototype.removeChild = rawBodyRemoveChild;\r\n\r\n    HTMLHeadElement.prototype.insertBefore = rawHeadInsertBefore;\r\n  };\r\n}\r\n\r\nexport function rebuildCSSRules(\r\n  styleSheetElements: HTMLStyleElement[],\r\n  reAppendElement: (stylesheetElement: HTMLStyleElement) => boolean,\r\n) {\r\n  styleSheetElements.forEach((stylesheetElement) => {\r\n    // re-append the dynamic stylesheet to sub-app container\r\n    const appendSuccess = reAppendElement(stylesheetElement);\r\n    if (appendSuccess) {\r\n      /*\r\n      get the stored css rules from styled-components generated element, and the re-insert rules for them.\r\n      note that we must do this after style element had been added to document, which stylesheet would be associated to the document automatically.\r\n      check the spec https://www.w3.org/TR/cssom-1/#associated-css-style-sheet\r\n       */\r\n      if (stylesheetElement instanceof HTMLStyleElement && isStyledComponentsLike(stylesheetElement)) {\r\n        const cssRules = getStyledElementCSSRules(stylesheetElement);\r\n        if (cssRules) {\r\n          // eslint-disable-next-line no-plusplus\r\n          for (let i = 0; i < cssRules.length; i++) {\r\n            const cssRule = cssRules[i];\r\n            const cssStyleSheetElement = stylesheetElement.sheet as CSSStyleSheet;\r\n            cssStyleSheetElement.insertRule(cssRule.cssText, cssStyleSheetElement.cssRules.length);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  });\r\n}\r\n","/**\r\n * @author Kuitos\r\n * @since 2020-10-13\r\n */\r\n\r\nimport type { Freer } from '../../../interfaces';\r\nimport { getCurrentRunningSandboxProxy } from '../../common';\r\nimport type { ContainerConfig } from './common';\r\nimport {\r\n  isHijackingTag,\r\n  patchHTMLDynamicAppendPrototypeFunctions,\r\n  rawHeadAppendChild,\r\n  rebuildCSSRules,\r\n  recordStyledComponentsCSSRules,\r\n} from './common';\r\n\r\nconst rawDocumentCreateElement = Document.prototype.createElement;\r\nconst proxyAttachContainerConfigMap = new WeakMap<WindowProxy, ContainerConfig>();\r\n\r\nconst elementAttachContainerConfigMap = new WeakMap<HTMLElement, ContainerConfig>();\r\nfunction patchDocumentCreateElement() {\r\n  if (Document.prototype.createElement === rawDocumentCreateElement) {\r\n    Document.prototype.createElement = function createElement<K extends keyof HTMLElementTagNameMap>(\r\n      this: Document,\r\n      tagName: K,\r\n      options?: ElementCreationOptions,\r\n    ): HTMLElement {\r\n      const element = rawDocumentCreateElement.call(this, tagName, options);\r\n      if (isHijackingTag(tagName)) {\r\n        const currentRunningSandboxProxy = getCurrentRunningSandboxProxy();\r\n        if (currentRunningSandboxProxy) {\r\n          const proxyContainerConfig = proxyAttachContainerConfigMap.get(currentRunningSandboxProxy);\r\n          if (proxyContainerConfig) {\r\n            elementAttachContainerConfigMap.set(element, proxyContainerConfig);\r\n          }\r\n        }\r\n      }\r\n\r\n      return element;\r\n    };\r\n  }\r\n\r\n  return function unpatch() {\r\n    Document.prototype.createElement = rawDocumentCreateElement;\r\n  };\r\n}\r\n\r\nlet bootstrappingPatchCount = 0;\r\nlet mountingPatchCount = 0;\r\n\r\nexport function patchStrictSandbox(\r\n  appName: string,\r\n  appWrapperGetter: () => HTMLElement | ShadowRoot,\r\n  proxy: Window,\r\n  mounting = true,\r\n  scopedCSS = false,\r\n  excludeAssetFilter?: CallableFunction,\r\n): Freer {\r\n  let containerConfig = proxyAttachContainerConfigMap.get(proxy);\r\n  if (!containerConfig) {\r\n    containerConfig = {\r\n      appName,\r\n      proxy,\r\n      appWrapperGetter,\r\n      dynamicStyleSheetElements: [],\r\n      strictGlobal: true,\r\n      excludeAssetFilter,\r\n      scopedCSS,\r\n    };\r\n    proxyAttachContainerConfigMap.set(proxy, containerConfig);\r\n  }\r\n  // all dynamic style sheets are stored in proxy container\r\n  const { dynamicStyleSheetElements } = containerConfig;\r\n\r\n  const unpatchDocumentCreate = patchDocumentCreateElement();\r\n\r\n  const unpatchDynamicAppendPrototypeFunctions = patchHTMLDynamicAppendPrototypeFunctions(\r\n    (element) => elementAttachContainerConfigMap.has(element),\r\n    (element) => elementAttachContainerConfigMap.get(element)!,\r\n  );\r\n\r\n  if (!mounting) bootstrappingPatchCount++;\r\n  if (mounting) mountingPatchCount++;\r\n\r\n  return function free() {\r\n    // bootstrap patch just called once but its freer will be called multiple times\r\n    if (!mounting && bootstrappingPatchCount !== 0) bootstrappingPatchCount--;\r\n    if (mounting) mountingPatchCount--;\r\n\r\n    const allMicroAppUnmounted = mountingPatchCount === 0 && bootstrappingPatchCount === 0;\r\n    // release the overwrite prototype after all the micro apps unmounted\r\n    if (allMicroAppUnmounted) {\r\n      unpatchDynamicAppendPrototypeFunctions();\r\n      unpatchDocumentCreate();\r\n    }\r\n\r\n    recordStyledComponentsCSSRules(dynamicStyleSheetElements);\r\n\r\n    // As now the sub app content all wrapped with a special id container,\r\n    // the dynamic style sheet would be removed automatically while unmoutting\r\n\r\n    return function rebuild() {\r\n      rebuildCSSRules(dynamicStyleSheetElements, (stylesheetElement) => {\r\n        const appWrapper = appWrapperGetter();\r\n        if (!appWrapper.contains(stylesheetElement)) {\r\n          rawHeadAppendChild.call(appWrapper, stylesheetElement);\r\n          return true;\r\n        }\r\n\r\n        return false;\r\n      });\r\n    };\r\n  };\r\n}\r\n","/* eslint-disable no-param-reassign */\r\n/**\r\n * @author Kuitos\r\n * @since 2019-04-11\r\n */\r\n\r\nimport { noop } from 'lodash';\r\n\r\nconst rawWindowInterval = window.setInterval;\r\nconst rawWindowClearInterval = window.clearInterval;\r\n\r\nexport default function patch(global: Window) {\r\n  let intervals: number[] = [];\r\n\r\n  global.clearInterval = (intervalId: number) => {\r\n    intervals = intervals.filter((id) => id !== intervalId);\r\n    return rawWindowClearInterval(intervalId);\r\n  };\r\n\r\n  global.setInterval = (handler: CallableFunction, timeout?: number, ...args: any[]) => {\r\n    const intervalId = rawWindowInterval(handler, timeout, ...args);\r\n    intervals = [...intervals, intervalId];\r\n    return intervalId;\r\n  };\r\n\r\n  return function free() {\r\n    intervals.forEach((id) => global.clearInterval(id));\r\n    global.setInterval = rawWindowInterval;\r\n    global.clearInterval = rawWindowClearInterval;\r\n\r\n    return noop;\r\n  };\r\n}\r\n","/* eslint-disable no-param-reassign */\r\n/**\r\n * @author Kuitos\r\n * @since 2019-04-11\r\n */\r\n\r\nimport { noop } from 'lodash';\r\n\r\nconst rawAddEventListener = window.addEventListener;\r\nconst rawRemoveEventListener = window.removeEventListener;\r\n\r\nexport default function patch(global: WindowProxy) {\r\n  const listenerMap = new Map<string, EventListenerOrEventListenerObject[]>();\r\n\r\n  global.addEventListener = (\r\n    type: string,\r\n    listener: EventListenerOrEventListenerObject,\r\n    options?: boolean | AddEventListenerOptions,\r\n  ) => {\r\n    const listeners = listenerMap.get(type) || [];\r\n    listenerMap.set(type, [...listeners, listener]);\r\n    return rawAddEventListener.call(window, type, listener, options);\r\n  };\r\n\r\n  global.removeEventListener = (\r\n    type: string,\r\n    listener: EventListenerOrEventListenerObject,\r\n    options?: boolean | AddEventListenerOptions,\r\n  ) => {\r\n    const storedTypeListeners = listenerMap.get(type);\r\n    if (storedTypeListeners && storedTypeListeners.length && storedTypeListeners.indexOf(listener) !== -1) {\r\n      storedTypeListeners.splice(storedTypeListeners.indexOf(listener), 1);\r\n    }\r\n    return rawRemoveEventListener.call(window, type, listener, options);\r\n  };\r\n\r\n  return function free() {\r\n    listenerMap.forEach((listeners, type) =>\r\n      [...listeners].forEach((listener) => global.removeEventListener(type, listener)),\r\n    );\r\n    global.addEventListener = rawAddEventListener;\r\n    global.removeEventListener = rawRemoveEventListener;\r\n\r\n    return noop;\r\n  };\r\n}\r\n","/**\r\n * @author Kuitos\r\n * @since 2019-04-11\r\n */\r\n\r\nimport type { Freer, SandBox } from '../../interfaces';\r\nimport { SandBoxType } from '../../interfaces';\r\nimport * as css from './css';\r\nimport { patchStrictSandbox } from './dynamicAppend';\r\nimport patchHistoryListener from './historyListener';\r\nimport patchInterval from './interval';\r\nimport patchWindowListener from './windowListener';\r\n\r\nexport function patchAtMounting(\r\n  appName: string,\r\n  elementGetter: () => HTMLElement | ShadowRoot,\r\n  sandbox: SandBox,\r\n  scopedCSS: boolean,\r\n  excludeAssetFilter?: CallableFunction,\r\n): Freer[] {\r\n  const basePatchers = [\r\n    () => patchInterval(sandbox.proxy),\r\n    () => patchWindowListener(sandbox.proxy),\r\n    () => patchHistoryListener(),\r\n  ];\r\n\r\n  const patchersInSandbox = {\r\n    [SandBoxType.Proxy]: [\r\n      ...basePatchers,\r\n      () => patchStrictSandbox(appName, elementGetter, sandbox.proxy, true, scopedCSS, excludeAssetFilter),\r\n    ] \r\n  };\r\n // @ts-ignore\r\n  return patchersInSandbox[sandbox.type]?.map((patch) => patch());\r\n}\r\n\r\nexport function patchAtBootstrapping(\r\n  appName: string,\r\n  elementGetter: () => HTMLElement | ShadowRoot,\r\n  sandbox: SandBox,\r\n  scopedCSS: boolean,\r\n  excludeAssetFilter?: CallableFunction,\r\n): Freer[] {\r\n  const patchersInSandbox = { \r\n    [SandBoxType.Proxy]: [\r\n      () => patchStrictSandbox(appName, elementGetter, sandbox.proxy, false, scopedCSS, excludeAssetFilter),\r\n    ] \r\n  };\r\n  // @ts-ignore\r\n  return patchersInSandbox[sandbox.type]?.map((patch) => patch());\r\n}\r\n\r\nexport { css };\r\n","/**\r\n * @author Kuitos\r\n * @since 2019-04-11\r\n */\r\n\r\nimport { isFunction, noop } from 'lodash';\r\n\r\nexport default function patch() {\r\n  // FIXME umi unmount feature request\r\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n  let rawHistoryListen = (_: any) => noop;\r\n  const historyListeners: Array<typeof noop> = [];\r\n  const historyUnListens: Array<typeof noop> = [];\r\n\r\n  if ((window as any).g_history && isFunction((window as any).g_history.listen)) {\r\n    rawHistoryListen = (window as any).g_history.listen.bind((window as any).g_history);\r\n\r\n    (window as any).g_history.listen = (listener: typeof noop) => {\r\n      historyListeners.push(listener);\r\n\r\n      const unListen = rawHistoryListen(listener);\r\n      historyUnListens.push(unListen);\r\n\r\n      return () => {\r\n        unListen();\r\n        historyUnListens.splice(historyUnListens.indexOf(unListen), 1);\r\n        historyListeners.splice(historyListeners.indexOf(listener), 1);\r\n      };\r\n    };\r\n  }\r\n\r\n  return function free() {\r\n    let rebuild = noop;\r\n\r\n    /*\r\n     还存在余量 listener 表明未被卸载，存在两种情况\r\n     1. 应用在 unmout 时未正确卸载 listener\r\n     2. listener 是应用 mount 之前绑定的，\r\n     第二种情况下应用在下次 mount 之前需重新绑定该 listener\r\n     */\r\n    if (historyListeners.length) {\r\n      rebuild = () => {\r\n        // 必须使用 window.g_history.listen 的方式重新绑定 listener，从而能保证 rebuild 这部分也能被捕获到，否则在应用卸载后无法正确的移除这部分副作用\r\n        historyListeners.forEach((listener) => (window as any).g_history.listen(listener));\r\n      };\r\n    }\r\n\r\n    // 卸载余下的 listener\r\n    historyUnListens.forEach((unListen) => unListen());\r\n\r\n    // restore\r\n    if ((window as any).g_history && isFunction((window as any).g_history.listen)) {\r\n      (window as any).g_history.listen = rawHistoryListen;\r\n    }\r\n\r\n    return rebuild;\r\n  };\r\n}\r\n","/* eslint-disable no-param-reassign */\r\n/**\r\n * @author Kuitos\r\n * @since 2020-3-31\r\n */\r\nimport type { SandBox } from \"../interfaces\";\r\nimport { SandBoxType } from \"../interfaces\";\r\nimport { nextTick } from \"../utils\";\r\nimport { getTargetValue, setCurrentRunningSandboxProxy } from \"./common\";\r\nimport {\r\n  createHistoryProxy,\r\n  createFreelogAppProxy,\r\n  createLocationProxy,\r\n  createDocumentProxy,\r\n  createWidgetProxy,\r\n  freelogLocalStorage,\r\n  saveSandBox,\r\n  getPublicPath,\r\n} from \"../../structure/proxy\";\r\n/**\r\n * fastest(at most time) unique array method\r\n * @see https://jsperf.com/array-filter-unique/30\r\n */\r\nfunction uniq(array: PropertyKey[]) {\r\n  return array.filter(function filter(this: PropertyKey[], element) {\r\n    return element in this ? false : ((this as any)[element] = true);\r\n  }, Object.create(null));\r\n}\r\n\r\n// zone.js will overwrite Object.defineProperty\r\nconst rawObjectDefineProperty = Object.defineProperty;\r\n\r\nconst variableWhiteListInDev =\r\n  process.env.NODE_ENV === \"development\" || window.__FREELOG_DEVELOPMENT__\r\n    ? [\r\n        // for react hot reload\r\n        // see https://github.com/facebook/create-react-app/blob/66bf7dfc43350249e2f09d138a20840dae8a0a4a/packages/react-error-overlay/src/index.js#L180\r\n        \"__REACT_ERROR_OVERLAY_GLOBAL_HOOK__\",\r\n      ]\r\n    : [];\r\n// who could escape the sandbox\r\nconst variableWhiteList: PropertyKey[] = [\r\n  // FIXME System.js used a indirect call with eval, which would make it scope escape to global\r\n  // To make System.js works well, we write it back to global window temporary\r\n  // see https://github.com/systemjs/systemjs/blob/457f5b7e8af6bd120a279540477552a07d5de086/src/evaluate.js#L106\r\n  \"System\",\r\n\r\n  // see https://github.com/systemjs/systemjs/blob/457f5b7e8af6bd120a279540477552a07d5de086/src/instantiate.js#L357\r\n  \"__cjsWrapper\",\r\n  ...variableWhiteListInDev,\r\n];\r\n\r\n/*\r\n variables who are impossible to be overwrite need to be escaped from proxy sandbox for performance reasons\r\n */\r\nconst unscopables = {\r\n  undefined: true,\r\n  Array: true,\r\n  Object: true,\r\n  String: true,\r\n  Boolean: true,\r\n  Math: true,\r\n  Number: true,\r\n  Symbol: true,\r\n  parseFloat: true,\r\n  Float32Array: true,\r\n};\r\n\r\ntype SymbolTarget = \"target\" | \"rawWindow\";\r\n\r\ntype FakeWindow = Window & Record<PropertyKey, any>;\r\n\r\nfunction createFakeWindow(global: Window) {\r\n  // map always has the fastest performance in has check scenario\r\n  // see https://jsperf.com/array-indexof-vs-set-has/23\r\n  const propertiesWithGetter = new Map<PropertyKey, boolean>();\r\n  const fakeWindow = {} as FakeWindow;\r\n\r\n  /*\r\n   copy the non-configurable property of global to fakeWindow\r\n   see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/getOwnPropertyDescriptor\r\n   > A property cannot be reported as non-configurable, if it does not exists as an own property of the target object or if it exists as a configurable own property of the target object.\r\n   */\r\n  Object.getOwnPropertyNames(global)\r\n    .filter((p) => {\r\n      const descriptor = Object.getOwnPropertyDescriptor(global, p);\r\n      return !descriptor?.configurable;\r\n    })\r\n    .forEach((p) => {\r\n      const descriptor = Object.getOwnPropertyDescriptor(global, p);\r\n      if (descriptor) {\r\n        const hasGetter = Object.prototype.hasOwnProperty.call(\r\n          descriptor,\r\n          \"get\"\r\n        );\r\n\r\n        /*\r\n         make top/self/window property configurable and writable, otherwise it will cause TypeError while get trap return.\r\n         see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/get\r\n         > The value reported for a property must be the same as the value of the corresponding target object property if the target object property is a non-writable, non-configurable data property.\r\n         */\r\n        if (\r\n          p === \"top\" ||\r\n          p === \"parent\" ||\r\n          p === \"self\" ||\r\n          p === \"window\" ||\r\n          (process.env.NODE_ENV === \"test\" &&\r\n            (p === \"mockTop\" || p === \"mockSafariTop\"))\r\n        ) {\r\n          descriptor.configurable = true;\r\n          /*\r\n           The descriptor of window.window/window.top/window.self in Safari/FF are accessor descriptors, we need to avoid adding a data descriptor while it was\r\n           Example:\r\n            Safari/FF: Object.getOwnPropertyDescriptor(window, 'top') -> {get: function, set: undefined, enumerable: true, configurable: false}\r\n            Chrome: Object.getOwnPropertyDescriptor(window, 'top') -> {value: Window, writable: false, enumerable: true, configurable: false}\r\n           */\r\n          if (!hasGetter) {\r\n            descriptor.writable = true;\r\n          }\r\n        }\r\n\r\n        if (hasGetter) propertiesWithGetter.set(p, true);\r\n\r\n        // freeze the descriptor to avoid being modified by zone.js\r\n        // see https://github.com/angular/zone.js/blob/a5fe09b0fac27ac5df1fa746042f96f05ccb6a00/lib/browser/define-property.ts#L71\r\n        rawObjectDefineProperty(fakeWindow, p, Object.freeze(descriptor));\r\n      }\r\n    });\r\n\r\n  return {\r\n    fakeWindow,\r\n    propertiesWithGetter,\r\n  };\r\n}\r\n\r\nlet activeSandboxCount = 0;\r\n/**\r\n * 基于 Proxy 实现的沙箱\r\n */\r\n\r\nexport default class ProxySandbox implements SandBox {\r\n  /** window 值变更记录 */\r\n  private updatedValueSet = new Set<PropertyKey>();\r\n\r\n  name: string;\r\n\r\n  type: SandBoxType;\r\n\r\n  proxy: WindowProxy;\r\n\r\n  sandboxRunning = true;\r\n\r\n  latestSetProp: PropertyKey | null = null;\r\n\r\n  active() {\r\n    if (!this.sandboxRunning) activeSandboxCount++;\r\n    this.sandboxRunning = true;\r\n  }\r\n\r\n  inactive() {\r\n    if (process.env.NODE_ENV === \"development\") {\r\n      console.info(\r\n        `[freelog:sandbox] ${this.name} modified global properties restore...`,\r\n        [\r\n          // @ts-ignore\r\n          ...this.updatedValueSet.keys(),\r\n        ]\r\n      );\r\n    }\r\n\r\n    if (--activeSandboxCount === 0) {\r\n      variableWhiteList.forEach((p) => {\r\n        if (this.proxy.hasOwnProperty(p)) {\r\n          // @ts-ignore\r\n          delete window[p];\r\n        }\r\n      });\r\n    }\r\n\r\n    this.sandboxRunning = false;\r\n  }\r\n\r\n  constructor(name: string) {\r\n    this.name = name;\r\n    this.type = SandBoxType.Proxy;\r\n    const { updatedValueSet } = this;\r\n\r\n    const rawWindow = window;\r\n    const { fakeWindow, propertiesWithGetter } = createFakeWindow(rawWindow);\r\n\r\n    const descriptorTargetMap = new Map<PropertyKey, SymbolTarget>();\r\n    const hasOwnProperty = (key: PropertyKey) =>\r\n      fakeWindow.hasOwnProperty(key) || rawWindow.hasOwnProperty(key);\r\n\r\n    var proxyDoc: any;\r\n    var proxyHis: any;\r\n    var proxyLoc: any;\r\n    var proxyWidget: any;\r\n    var freelogAppProxy: any;\r\n    var _this = this;\r\n    const proxy = new Proxy(fakeWindow, {\r\n      set: (target: FakeWindow, p: PropertyKey, value: any): boolean => {\r\n        if (p === \"freelogApp\") return false;\r\n        if (this.sandboxRunning) {\r\n          // We must kept its description while the property existed in rawWindow before\r\n          if (!target.hasOwnProperty(p) && rawWindow.hasOwnProperty(p)) {\r\n            const descriptor = Object.getOwnPropertyDescriptor(rawWindow, p);\r\n            const { writable, configurable, enumerable } = descriptor!;\r\n            if (writable) {\r\n              Object.defineProperty(target, p, {\r\n                configurable,\r\n                enumerable,\r\n                writable,\r\n                value,\r\n              });\r\n            }\r\n          } else {\r\n            // @ts-ignore\r\n            target[p] = value;\r\n          }\r\n\r\n          if (variableWhiteList.indexOf(p) !== -1) {\r\n            // @ts-ignore\r\n            rawWindow[p] = value;\r\n          }\r\n\r\n          updatedValueSet.add(p);\r\n\r\n          this.latestSetProp = p;\r\n\r\n          return true;\r\n        }\r\n\r\n        if (process.env.NODE_ENV === \"development\") {\r\n          console.warn(\r\n            `[freelog] Set window.${p.toString()} while sandbox destroyed or inactive in ${name}!`\r\n          );\r\n        }\r\n\r\n        // 在 strict-mode 下，Proxy 的 handler.set 返回 false 会抛出 TypeError，在沙箱卸载的情况下应该忽略错误\r\n        return true;\r\n      },\r\n\r\n      get(target: FakeWindow, p: PropertyKey): any {\r\n        if (p === Symbol.unscopables) return unscopables;\r\n        if (p === \"__INJECTED_PUBLIC_PATH_BY_FREELOG__\") {\r\n          return getPublicPath(name);\r\n        }\r\n        if (p === \"fetch\") {\r\n          return function (url: string, options: any) {\r\n            if (url.indexOf(\"i18n-ts\") > -1) {\r\n              return rawWindow.fetch(url, {...options, credentials: 'include'} );\r\n            }\r\n            // if(url.indexOf(\"freelog.com\") > -1){\r\n            //   const patchUrl = getPublicPath(name) + url.split(\"freelog.com/\")[1];\r\n            //   return rawWindow.fetch(patchUrl, {...options});\r\n            // }else{\r\n            return rawWindow.fetch(url, options);\r\n            // }\r\n          };\r\n        }\r\n        // avoid who using window.window or window.self to escape the sandbox environment to touch the really window\r\n        // see https://github.com/eligrey/FileSaver.js/blob/master/src/FileSaver.js#L13\r\n        if (p === \"window\" || p === \"self\") {\r\n          return proxy;\r\n        }\r\n\r\n        // hijack global accessing with globalThis keyword\r\n        if (p === \"globalThis\") {\r\n          return proxy;\r\n        }\r\n\r\n        if (\r\n          p === \"top\" ||\r\n          p === \"parent\" ||\r\n          (process.env.NODE_ENV === \"test\" &&\r\n            (p === \"mockTop\" || p === \"mockSafariTop\"))\r\n        ) {\r\n          // if your master app in an iframe context, allow these props escape the sandbox\r\n          if (rawWindow === rawWindow.parent) {\r\n            return proxy;\r\n          }\r\n          return (rawWindow as any)[p];\r\n        }\r\n\r\n        // proxy.hasOwnProperty would invoke getter firstly, then its value represented as rawWindow.hasOwnProperty\r\n        if (p === \"hasOwnProperty\") {\r\n          return hasOwnProperty;\r\n        }\r\n        if (p === \"freelogApp\") {\r\n          freelogAppProxy =\r\n            freelogAppProxy || createFreelogAppProxy(name, _this);\r\n          return freelogAppProxy;\r\n        }\r\n        if (p === \"widgetName\") {\r\n          return name;\r\n        }\r\n        // mark the symbol to document while accessing as document.createElement could know is invoked by which sandbox for dynamic append patcher\r\n        if (p === \"history\") {\r\n          // TODO 如果是单应用模式（提升性能）则不用代理\r\n          proxyHis = proxyHis || createHistoryProxy(name, _this);\r\n          return proxyHis;\r\n        }\r\n        if (p === \"childWidgets\") {\r\n          proxyWidget = proxyWidget || createWidgetProxy(name, _this);\r\n        }\r\n        if (p === \"location\") {\r\n          // TODO 如果是单应用模式（提升性能）则不用代理, 可以设置location.href的使用权限\r\n          // TODO reload相当于重载应用，想办法把主应用的对应操控函数弄过来，发布订阅模式\r\n          // TODO replace与reload、toString方法无法访问\r\n          proxyLoc = proxyLoc || createLocationProxy(name, _this);\r\n          return proxyLoc;\r\n        }\r\n        // TODO test localstorage\r\n        if (p === \"localStorage\") {\r\n          return freelogLocalStorage(name);\r\n        }\r\n        if (p === \"document\" || p === \"eval\") {\r\n          setCurrentRunningSandboxProxy(proxy); // FIXME if you have any other good ideas\r\n          // remove the mark in next tick, thus we can identify whether it in micro app or not\r\n          // this approach is just a workaround, it could not cover all complex cases, such as the micro app runs in the same task context with master in some case\r\n\r\n          nextTick(function () {\r\n            return setCurrentRunningSandboxProxy(null);\r\n          });\r\n\r\n          switch (p) {\r\n            case \"document\":\r\n              proxyDoc = createDocumentProxy(name, _this, proxy);\r\n              return proxyDoc;\r\n            case \"eval\":\r\n              // eslint-disable-next-line no-eval\r\n              return eval;\r\n            // no default\r\n          }\r\n        } // eslint-disable-next-line no-nested-ternary\r\n\r\n        // eslint-disable-next-line no-nested-ternary\r\n        const value = propertiesWithGetter.has(p)\r\n          ? (rawWindow as any)[p]\r\n          : p in target\r\n          ? (target as any)[p]\r\n          : (rawWindow as any)[p];\r\n        return getTargetValue(rawWindow, value);\r\n      },\r\n\r\n      // trap in operator\r\n      // see https://github.com/styled-components/styled-components/blob/master/packages/styled-components/src/constants.js#L12\r\n      has(target: FakeWindow, p: string | number | symbol): boolean {\r\n        return p in unscopables || p in target || p in rawWindow;\r\n      },\r\n\r\n      getOwnPropertyDescriptor(\r\n        target: FakeWindow,\r\n        p: string | number | symbol\r\n      ): PropertyDescriptor | undefined {\r\n        /*\r\n         as the descriptor of top/self/window/mockTop in raw window are configurable but not in proxy target, we need to get it from target to avoid TypeError\r\n         see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/getOwnPropertyDescriptor\r\n         > A property cannot be reported as non-configurable, if it does not exists as an own property of the target object or if it exists as a configurable own property of the target object.\r\n         */\r\n        if (target.hasOwnProperty(p)) {\r\n          const descriptor = Object.getOwnPropertyDescriptor(target, p);\r\n          descriptorTargetMap.set(p, \"target\");\r\n          return descriptor;\r\n        }\r\n\r\n        if (rawWindow.hasOwnProperty(p)) {\r\n          const descriptor = Object.getOwnPropertyDescriptor(rawWindow, p);\r\n          descriptorTargetMap.set(p, \"rawWindow\");\r\n          // A property cannot be reported as non-configurable, if it does not exists as an own property of the target object\r\n          if (descriptor && !descriptor.configurable) {\r\n            descriptor.configurable = true;\r\n          }\r\n          return descriptor;\r\n        }\r\n\r\n        return undefined;\r\n      },\r\n\r\n      // trap to support iterator with sandbox\r\n      // @ts-ignore\r\n      ownKeys(target: FakeWindow): PropertyKey[] {\r\n        const keys = uniq(\r\n          Reflect.ownKeys(rawWindow).concat(Reflect.ownKeys(target))\r\n        );\r\n        return keys;\r\n      },\r\n\r\n      defineProperty(\r\n        target: Window,\r\n        p: PropertyKey,\r\n        attributes: PropertyDescriptor\r\n      ): boolean {\r\n        const from = descriptorTargetMap.get(p);\r\n        /*\r\n         Descriptor must be defined to native window while it comes from native window via Object.getOwnPropertyDescriptor(window, p),\r\n         otherwise it would cause a TypeError with illegal invocation.\r\n         */\r\n        switch (from) {\r\n          case \"rawWindow\":\r\n            return Reflect.defineProperty(rawWindow, p, attributes);\r\n          default:\r\n            return Reflect.defineProperty(target, p, attributes);\r\n        }\r\n      },\r\n\r\n      deleteProperty(target: FakeWindow, p: string | number | symbol): boolean {\r\n        if (target.hasOwnProperty(p)) {\r\n          // @ts-ignore\r\n          delete target[p];\r\n          updatedValueSet.delete(p);\r\n\r\n          return true;\r\n        }\r\n\r\n        return true;\r\n      },\r\n    });\r\n\r\n    this.proxy = proxy;\r\n    activeSandboxCount++;\r\n    saveSandBox(name, this);\r\n  }\r\n}\r\n","/**\r\n * @author Kuitos\r\n * @since 2019-04-11\r\n */\r\nimport type { Freer, Rebuilder, SandBox } from '../interfaces';\r\nimport { patchAtBootstrapping, patchAtMounting } from './patchers';\r\nimport ProxySandbox from './proxySandbox';\r\n\r\nexport { css } from './patchers';\r\n\r\n/**\r\n * 生成应用运行时沙箱\r\n *\r\n * 沙箱分两个类型：\r\n * 1. app 环境沙箱\r\n *  app 环境沙箱是指应用初始化过之后，应用会在什么样的上下文环境运行。每个应用的环境沙箱只会初始化一次，因为子应用只会触发一次 bootstrap 。\r\n *  子应用在切换时，实际上切换的是 app 环境沙箱。\r\n * 2. render 沙箱\r\n *  子应用在 app mount 开始前生成好的的沙箱。每次子应用切换过后，render 沙箱都会重现初始化。\r\n *\r\n * 这么设计的目的是为了保证每个子应用切换回来之后，还能运行在应用 bootstrap 之后的环境下。\r\n *\r\n * @param appName\r\n * @param elementGetter\r\n * @param scopedCSS\r\n * @param useLooseSandbox\r\n * @param excludeAssetFilter\r\n */\r\nexport function createSandboxContainer(\r\n  appName: string,\r\n  elementGetter: () => HTMLElement | ShadowRoot,\r\n  scopedCSS: boolean,\r\n  useLooseSandbox?: boolean,\r\n  excludeAssetFilter?: (url: string) => boolean,\r\n) {\r\n  let sandbox: SandBox;\r\n  sandbox =  new ProxySandbox(appName);\r\n  // some side effect could be be invoked while bootstrapping, such as dynamic stylesheet injection with style-loader, especially during the development phase\r\n  const bootstrappingFreers = patchAtBootstrapping(appName, elementGetter, sandbox, scopedCSS, excludeAssetFilter);\r\n  // mounting freers are one-off and should be re-init at every mounting time\r\n  let mountingFreers: Freer[] = [];\r\n\r\n  let sideEffectsRebuilders: Rebuilder[] = [];\r\n\r\n  return {\r\n    instance: sandbox,\r\n\r\n    /**\r\n     * 沙箱被 mount\r\n     * 可能是从 bootstrap 状态进入的 mount\r\n     * 也可能是从 unmount 之后再次唤醒进入 mount\r\n     */\r\n    async mount() {\r\n      /* ------------------------------------------ 因为有上下文依赖（window），以下代码执行顺序不能变 ------------------------------------------ */\r\n\r\n      /* ------------------------------------------ 1. 启动/恢复 沙箱------------------------------------------ */\r\n      sandbox.active();\r\n\r\n      const sideEffectsRebuildersAtBootstrapping = sideEffectsRebuilders.slice(0, bootstrappingFreers.length);\r\n      const sideEffectsRebuildersAtMounting = sideEffectsRebuilders.slice(bootstrappingFreers.length);\r\n\r\n      // must rebuild the side effects which added at bootstrapping firstly to recovery to nature state\r\n      if (sideEffectsRebuildersAtBootstrapping.length) {\r\n        sideEffectsRebuildersAtBootstrapping.forEach((rebuild) => rebuild());\r\n      }\r\n\r\n      /* ------------------------------------------ 2. 开启全局变量补丁 ------------------------------------------*/\r\n      // render 沙箱启动时开始劫持各类全局监听，尽量不要在应用初始化阶段有 事件监听/定时器 等副作用\r\n      mountingFreers = patchAtMounting(appName, elementGetter, sandbox, scopedCSS, excludeAssetFilter);\r\n\r\n      /* ------------------------------------------ 3. 重置一些初始化时的副作用 ------------------------------------------*/\r\n      // 存在 rebuilder 则表明有些副作用需要重建\r\n      if (sideEffectsRebuildersAtMounting.length) {\r\n        sideEffectsRebuildersAtMounting.forEach((rebuild) => rebuild());\r\n      }\r\n\r\n      // clean up rebuilders\r\n      sideEffectsRebuilders = [];\r\n    },\r\n\r\n    /**\r\n     * 恢复 global 状态，使其能回到应用加载之前的状态\r\n     */\r\n    async unmount() {\r\n      // record the rebuilders of window side effects (event listeners or timers)\r\n      // note that the frees of mounting phase are one-off as it will be re-init at next mounting\r\n      sideEffectsRebuilders = [...bootstrappingFreers, ...mountingFreers].map((free) => free());\r\n\r\n      sandbox.inactive();\r\n    },\r\n  };\r\n}\r\n","/**\r\n * @author Kuitos\r\n * @since 2020-04-01\r\n */\r\n\r\nimport { importEntry } from './import-html-entry';\r\nimport { concat, forEach, mergeWith } from 'lodash';\r\nimport type { LifeCycles, ParcelConfigObject } from 'single-spa';\r\nimport getAddOns from './addons';\r\nimport { getMicroAppStateActions } from './globalState';\r\nimport type {\r\n  FrameworkConfiguration,\r\n  FrameworkLifeCycles,\r\n  HTMLContentRender,\r\n  LifeCycleFn,\r\n  LoadableApp,\r\n  ObjectType,\r\n} from './interfaces';\r\nimport { createSandboxContainer, css } from './sandbox';\r\nimport {\r\n  Deferred,\r\n  getContainer,\r\n  getDefaultTplWrapper,\r\n  getWrapperId,\r\n  isEnableScopedCSS,\r\n  performanceMark,\r\n  performanceMeasure,\r\n  performanceGetEntriesByName,\r\n  toArray,\r\n  validateExportLifecycle,\r\n} from './utils';\r\n\r\nfunction assertElementExist(element: Element | null | undefined, msg?: string) {\r\n  if (!element) {\r\n    if (msg) {\r\n      throw new Error(msg);\r\n    }\r\n\r\n    throw new Error('[freelog] element not existed!');\r\n  }\r\n}\r\n\r\nfunction execHooksChain<T extends ObjectType>(\r\n  hooks: Array<LifeCycleFn<T>>,\r\n  app: LoadableApp<T>,\r\n  global = window,\r\n): Promise<any> {\r\n  if (hooks.length) {\r\n    return hooks.reduce((chain, hook) => chain.then(() => hook(app, global)), Promise.resolve());\r\n  }\r\n\r\n  return Promise.resolve();\r\n}\r\n\r\nasync function validateSingularMode<T extends ObjectType>(\r\n  validate: FrameworkConfiguration['singular'],\r\n  app: LoadableApp<T>,\r\n): Promise<boolean> {\r\n  return typeof validate === 'function' ? validate(app) : !!validate;\r\n}\r\n\r\n// @ts-ignore\r\nconst supportShadowDOM = document.head.attachShadow || document.head.createShadowRoot;\r\n\r\nfunction createElement(\r\n  appContent: string,\r\n  strictStyleIsolation: boolean,\r\n  scopedCSS: boolean,\r\n  appName: string,\r\n): HTMLElement {\r\n  const containerElement = document.createElement('div');\r\n  containerElement.innerHTML = appContent;\r\n  // appContent always wrapped with a singular div\r\n  const appElement = containerElement.firstChild as HTMLElement;\r\n  if (strictStyleIsolation) {\r\n    if (!supportShadowDOM) {\r\n      console.warn(\r\n        '[freelog]: As current browser not support shadow dom, your strictStyleIsolation configuration will be ignored!',\r\n      );\r\n    } else {\r\n      const { innerHTML } = appElement;\r\n      appElement.innerHTML = '';\r\n      let shadow: ShadowRoot;\r\n\r\n      if (appElement.attachShadow) {\r\n        shadow = appElement.attachShadow({ mode: 'open' });\r\n      } else {\r\n        // createShadowRoot was proposed in initial spec, which has then been deprecated\r\n        shadow = (appElement as any).createShadowRoot();\r\n      }\r\n      shadow.innerHTML = innerHTML;\r\n    }\r\n  }\r\n  appElement.setAttribute('style', 'width: 100%; height: 100%;,position: relative;z-index:1;')\r\n  if (scopedCSS) {\r\n    const attr = appElement.getAttribute(css.FreelogCSSRewriteAttr);\r\n    if (!attr) {\r\n      appElement.setAttribute(css.FreelogCSSRewriteAttr, appName);\r\n    }\r\n\r\n    const styleNodes = appElement.querySelectorAll('style') || [];\r\n    forEach(styleNodes, (stylesheetElement: HTMLStyleElement) => {\r\n      css.process(appElement!, stylesheetElement, appName);\r\n    });\r\n  }\r\n\r\n  return appElement;\r\n}\r\n\r\n/** generate app wrapper dom getter */\r\nfunction getAppWrapperGetter(\r\n  appName: string,\r\n  appInstanceId: string,\r\n  useLegacyRender: boolean,\r\n  strictStyleIsolation: boolean,\r\n  scopedCSS: boolean,\r\n  elementGetter: () => HTMLElement | null,\r\n) {\r\n  return () => {\r\n    if (useLegacyRender) {\r\n      if (strictStyleIsolation) throw new Error('[freelog]: strictStyleIsolation can not be used with legacy render!');\r\n      if (scopedCSS) throw new Error('[freelog]: experimentalStyleIsolation can not be used with legacy render!');\r\n\r\n      const appWrapper = document.getElementById(getWrapperId(appInstanceId));\r\n      assertElementExist(\r\n        appWrapper,\r\n        `[freelog] Wrapper element for ${appName} with instance ${appInstanceId} is not existed!`,\r\n      );\r\n      return appWrapper!;\r\n    }\r\n\r\n    const element = elementGetter();\r\n    assertElementExist(\r\n      element,\r\n      `[freelog] Wrapper element for ${appName} with instance ${appInstanceId} is not existed!`,\r\n    );\r\n\r\n    if (strictStyleIsolation) {\r\n      return element!.shadowRoot!;\r\n    }\r\n\r\n    return element!;\r\n  };\r\n}\r\n\r\nconst rawAppendChild = HTMLElement.prototype.appendChild;\r\nconst rawRemoveChild = HTMLElement.prototype.removeChild;\r\ntype ElementRender = (\r\n  props: { element: HTMLElement | null; loading: boolean; container?: string | HTMLElement },\r\n  phase: 'loading' | 'mounting' | 'mounted' | 'unmounted',\r\n) => any;\r\n\r\n/**\r\n * Get the render function\r\n * If the legacy render function is provide, used as it, otherwise we will insert the app element to target container by freelog\r\n * @param appName\r\n * @param appContent\r\n * @param legacyRender\r\n */\r\nfunction getRender(appName: string, appContent: string, legacyRender?: HTMLContentRender) {\r\n  const render: ElementRender = ({ element, loading, container }, phase) => {\r\n    if (legacyRender) {\r\n      if (process.env.NODE_ENV === 'development') {\r\n        console.warn(\r\n          '[freelog] Custom rendering function is deprecated, you can use the container element setting instead!',\r\n        );\r\n      }\r\n\r\n      return legacyRender({ loading, appContent: element ? appContent : '' });\r\n    }\r\n\r\n    const containerElement = getContainer(container!);\r\n\r\n    // The container might have be removed after micro app unmounted.\r\n    // Such as the micro app unmount lifecycle called by a react componentWillUnmount lifecycle, after micro app unmounted, the react component might also be removed\r\n    if (phase !== 'unmounted') {\r\n      const errorMsg = (() => {\r\n        switch (phase) {\r\n          case 'loading':\r\n          case 'mounting':\r\n            return `[freelog] Target container with ${container} not existed while ${appName} ${phase}!`;\r\n\r\n          case 'mounted':\r\n            return `[freelog] Target container with ${container} not existed after ${appName} ${phase}!`;\r\n\r\n          default:\r\n            return `[freelog] Target container with ${container} not existed while ${appName} rendering!`;\r\n        }\r\n      })();\r\n      assertElementExist(containerElement, errorMsg);\r\n    }\r\n\r\n    if (containerElement && !containerElement.contains(element)) {\r\n      // clear the container\r\n      while (containerElement!.firstChild) {\r\n        rawRemoveChild.call(containerElement, containerElement!.firstChild);\r\n      }\r\n\r\n      // append the element to container if it exist\r\n      if (element) {\r\n        rawAppendChild.call(containerElement, element);\r\n      }\r\n    }\r\n\r\n    return undefined;\r\n  };\r\n\r\n  return render;\r\n}\r\n\r\nfunction getLifecyclesFromExports(\r\n  scriptExports: LifeCycles<any>,\r\n  appName: string,\r\n  global: WindowProxy,\r\n  globalLatestSetProp?: PropertyKey | null,\r\n) {\r\n  if (validateExportLifecycle(scriptExports)) {\r\n    return scriptExports;\r\n  }\r\n\r\n  // fallback to sandbox latest set property if it had\r\n  if (globalLatestSetProp) {\r\n    const lifecycles = (global as any)[globalLatestSetProp];\r\n    if (validateExportLifecycle(lifecycles)) {\r\n      return lifecycles;\r\n    }\r\n  }\r\n\r\n  if (process.env.NODE_ENV === 'development') {\r\n    console.warn(\r\n      `[freelog] lifecycle not found from ${appName} entry exports, fallback to get from window['${appName}']`,\r\n    );\r\n  }\r\n\r\n  // fallback to global variable who named with ${appName} while module exports not found\r\n  const globalVariableExports = (global as any)[appName];\r\n\r\n  if (validateExportLifecycle(globalVariableExports)) {\r\n    return globalVariableExports;\r\n  }\r\n\r\n  throw new Error(`[freelog] You need to export lifecycle functions in ${appName} entry`);\r\n}\r\n\r\nlet prevAppUnmountedDeferred: Deferred<void>;\r\n\r\nexport type ParcelConfigObjectGetter = (remountContainer?: string | HTMLElement) => ParcelConfigObject;\r\n\r\nexport async function loadApp<T extends ObjectType>(\r\n  app: LoadableApp<T>,\r\n  configuration: FrameworkConfiguration = {},\r\n  lifeCycles?: FrameworkLifeCycles<T>,\r\n): Promise<ParcelConfigObjectGetter> {\r\n  const { entry, name: appName } = app;\r\n  const appInstanceId = `${appName}_${+new Date()}_${Math.floor(Math.random() * 1000)}`;\r\n\r\n  const markName = `[freelog] App ${appInstanceId} Loading`;\r\n  if (process.env.NODE_ENV === 'development') {\r\n    performanceMark(markName);\r\n  }\r\n\r\n  const { singular = false, sandbox = true, excludeAssetFilter, ...importEntryOpts } = configuration;\r\n\r\n  // get the entry html content and script executor\r\n  const { template, execScripts, assetPublicPath } = await importEntry(entry, importEntryOpts);\r\n\r\n  // as single-spa load and bootstrap new app parallel with other apps unmounting\r\n  // (see https://github.com/CanopyTax/single-spa/blob/master/src/navigation/reroute.js#L74)\r\n  // we need wait to load the app until all apps are finishing unmount in singular mode\r\n  if (await validateSingularMode(singular, app)) {\r\n    await (prevAppUnmountedDeferred && prevAppUnmountedDeferred.promise);\r\n  }\r\n\r\n  const appContent = getDefaultTplWrapper(appInstanceId, appName)(template);\r\n\r\n  const strictStyleIsolation = typeof sandbox === 'object' && !!sandbox.strictStyleIsolation;\r\n  const scopedCSS = isEnableScopedCSS(sandbox);\r\n  let initialAppWrapperElement: HTMLElement | null = createElement(\r\n    appContent,\r\n    strictStyleIsolation,\r\n    scopedCSS,\r\n    appName,\r\n  );\r\n\r\n  const initialContainer = 'container' in app ? app.container : undefined;\r\n  const legacyRender = 'render' in app ? app.render : undefined;\r\n\r\n  const render = getRender(appName, appContent, legacyRender);\r\n\r\n  // 第一次加载设置应用可见区域 dom 结构\r\n  // 确保每次应用加载前容器 dom 结构已经设置完毕\r\n  render({ element: initialAppWrapperElement, loading: true, container: initialContainer }, 'loading');\r\n\r\n  const initialAppWrapperGetter = getAppWrapperGetter(\r\n    appName,\r\n    appInstanceId,\r\n    !!legacyRender,\r\n    strictStyleIsolation,\r\n    scopedCSS,\r\n    () => initialAppWrapperElement,\r\n  );\r\n\r\n  let global = window;\r\n  let mountSandbox = () => Promise.resolve();\r\n  let unmountSandbox = () => Promise.resolve();\r\n  const useLooseSandbox = typeof sandbox === 'object' && !!sandbox.loose;\r\n  let sandboxContainer;\r\n  if (sandbox) {\r\n    sandboxContainer = createSandboxContainer(\r\n      appName,\r\n      // FIXME should use a strict sandbox logic while remount, see https://github.com/umijs/freelog/issues/518\r\n      initialAppWrapperGetter,\r\n      scopedCSS,\r\n      useLooseSandbox,\r\n      excludeAssetFilter,\r\n    );\r\n    // 用沙箱的代理对象作为接下来使用的全局对象\r\n    global = sandboxContainer.instance.proxy as typeof window;\r\n    mountSandbox = sandboxContainer.mount;\r\n    unmountSandbox = sandboxContainer.unmount;\r\n  }\r\n\r\n  const { beforeUnmount = [], afterUnmount = [], afterMount = [], beforeMount = [], beforeLoad = [] } = mergeWith(\r\n    {},\r\n    getAddOns(global, assetPublicPath),\r\n    lifeCycles,\r\n    (v1, v2) => concat(v1 ?? [], v2 ?? []),\r\n  );\r\n\r\n  await execHooksChain(toArray(beforeLoad), app, global);\r\n\r\n  // get the lifecycle hooks from module exports\r\n  const scriptExports: any = await execScripts(global, !useLooseSandbox);\r\n  const { bootstrap, mount, unmount, update } = getLifecyclesFromExports(\r\n    scriptExports,\r\n    appName,\r\n    global,\r\n    sandboxContainer?.instance?.latestSetProp,\r\n  );\r\n\r\n  const {\r\n    onGlobalStateChange,\r\n    setGlobalState,\r\n    offGlobalStateChange,\r\n  }: Record<string, CallableFunction> = getMicroAppStateActions(appInstanceId);\r\n\r\n  // FIXME temporary way\r\n  const syncAppWrapperElement2Sandbox = (element: HTMLElement | null) => (initialAppWrapperElement = element);\r\n\r\n  const parcelConfigGetter: ParcelConfigObjectGetter = (remountContainer = initialContainer) => {\r\n    let appWrapperElement: HTMLElement | null = initialAppWrapperElement;\r\n    const appWrapperGetter = getAppWrapperGetter(\r\n      appName,\r\n      appInstanceId,\r\n      !!legacyRender,\r\n      strictStyleIsolation,\r\n      scopedCSS,\r\n      () => appWrapperElement,\r\n    );\r\n\r\n    const parcelConfig: ParcelConfigObject = {\r\n      name: appInstanceId,\r\n      bootstrap,\r\n      mount: [\r\n        async () => {\r\n          if (process.env.NODE_ENV === 'development') {\r\n            const marks = performanceGetEntriesByName(markName, 'mark');\r\n            // mark length is zero means the app is remounting\r\n            if (marks && !marks.length) {\r\n              performanceMark(markName);\r\n            }\r\n          }\r\n        },\r\n        async () => {\r\n          if ((await validateSingularMode(singular, app)) && prevAppUnmountedDeferred) {\r\n            return prevAppUnmountedDeferred.promise;\r\n          }\r\n\r\n          return undefined;\r\n        },\r\n        // 添加 mount hook, 确保每次应用加载前容器 dom 结构已经设置完毕\r\n        async () => {\r\n          const useNewContainer = remountContainer !== initialContainer;\r\n          if (useNewContainer || !appWrapperElement) {\r\n            // element will be destroyed after unmounted, we need to recreate it if it not exist\r\n            // or we try to remount into a new container\r\n            appWrapperElement = createElement(appContent, strictStyleIsolation, scopedCSS, appName);\r\n            syncAppWrapperElement2Sandbox(appWrapperElement);\r\n          }\r\n\r\n          render({ element: appWrapperElement, loading: true, container: remountContainer }, 'mounting');\r\n        },\r\n        mountSandbox,\r\n        // exec the chain after rendering to keep the behavior with beforeLoad\r\n        async () => execHooksChain(toArray(beforeMount), app, global),\r\n        async (props) => mount({ ...props, container: appWrapperGetter(), setGlobalState, onGlobalStateChange }),\r\n        // finish loading after app mounted\r\n        async () => render({ element: appWrapperElement, loading: false, container: remountContainer }, 'mounted'),\r\n        async () => execHooksChain(toArray(afterMount), app, global),\r\n        // initialize the unmount defer after app mounted and resolve the defer after it unmounted\r\n        async () => {\r\n          if (await validateSingularMode(singular, app)) {\r\n            prevAppUnmountedDeferred = new Deferred<void>();\r\n          }\r\n        },\r\n        async () => {\r\n          if (process.env.NODE_ENV === 'development') {\r\n            const measureName = `[freelog] App ${appInstanceId} Loading Consuming`;\r\n            performanceMeasure(measureName, markName);\r\n          }\r\n        },\r\n      ],\r\n      unmount: [\r\n        async () => execHooksChain(toArray(beforeUnmount), app, global),\r\n        async (props) => unmount({ ...props, container: appWrapperGetter() }),\r\n        unmountSandbox,\r\n        async () => execHooksChain(toArray(afterUnmount), app, global),\r\n        async () => {\r\n          render({ element: null, loading: false, container: remountContainer }, 'unmounted');\r\n          offGlobalStateChange(appInstanceId);\r\n          // for gc\r\n          appWrapperElement = null;\r\n          syncAppWrapperElement2Sandbox(appWrapperElement);\r\n        },\r\n        async () => {\r\n          if ((await validateSingularMode(singular, app)) && prevAppUnmountedDeferred) {\r\n            prevAppUnmountedDeferred.resolve();\r\n          }\r\n        },\r\n      ],\r\n    };\r\n\r\n    if (typeof update === 'function') {\r\n      parcelConfig.update = update;\r\n    }\r\n\r\n    return parcelConfig;\r\n  };\r\n\r\n  return parcelConfigGetter;\r\n}\r\n","import type { ParcelConfigObject } from 'single-spa';\r\nimport { mountRootParcel} from './single-spa/single-spa';\r\nimport type { ObjectType } from './interfaces';\r\nimport type { FrameworkConfiguration, FrameworkLifeCycles, LoadableApp, MicroApp } from './interfaces';\r\nimport type { ParcelConfigObjectGetter } from './loader';\r\nimport { loadApp } from './loader';\r\nimport {  getContainer, getXPathForElement, } from './utils';\r\n\r\n \r\n// eslint-disable-next-line import/no-mutable-exports\r\nexport let frameworkConfiguration: FrameworkConfiguration = {};\r\nconst appConfigPromiseGetterMap = new Map<string, Promise<ParcelConfigObjectGetter>>();\r\n\r\nexport function loadMicroApp<T extends ObjectType>(\r\n  app: LoadableApp<T>,\r\n  configuration?: FrameworkConfiguration,\r\n  lifeCycles?: FrameworkLifeCycles<T>,\r\n): MicroApp {\r\n  const { props, name } = app;\r\n\r\n  const getContainerXpath = (container: string | HTMLElement): string | void => {\r\n    const containerElement = getContainer(container);\r\n    if (containerElement) {\r\n      return getXPathForElement(containerElement, document);\r\n    }\r\n\r\n    return undefined;\r\n  };\r\n\r\n  const wrapParcelConfigForRemount = (config: ParcelConfigObject): ParcelConfigObject => {\r\n    return {\r\n      ...config,\r\n      // empty bootstrap hook which should not run twice while it calling from cached micro app\r\n      bootstrap: () => Promise.resolve(),\r\n    };\r\n  };\r\n\r\n  /**\r\n   * using name + container xpath as the micro app instance id,\r\n   * it means if you rendering a micro app to a dom which have been rendered before,\r\n   * the micro app would not load and evaluate its lifecycles again\r\n   */\r\n  const memorizedLoadingFn = async (): Promise<ParcelConfigObject> => {\r\n    const userConfiguration = configuration ?? { ...frameworkConfiguration, singular: false };\r\n    const { $$cacheLifecycleByAppName } = userConfiguration;\r\n    const container = 'container' in app ? app.container : undefined;\r\n\r\n    if (container) {\r\n      // using appName as cache for internal experimental scenario\r\n      if ($$cacheLifecycleByAppName) {\r\n        const parcelConfigGetterPromise = appConfigPromiseGetterMap.get(name);\r\n        if (parcelConfigGetterPromise) return wrapParcelConfigForRemount((await parcelConfigGetterPromise)(container));\r\n      }\r\n\r\n      const xpath = getContainerXpath(container);\r\n      if (xpath) {\r\n        const parcelConfigGetterPromise = appConfigPromiseGetterMap.get(`${name}-${xpath}`);\r\n        if (parcelConfigGetterPromise) return wrapParcelConfigForRemount((await parcelConfigGetterPromise)(container));\r\n      }\r\n    }\r\n\r\n    const parcelConfigObjectGetterPromise = loadApp(app, userConfiguration, lifeCycles);\r\n\r\n    if (container) {\r\n      if ($$cacheLifecycleByAppName) {\r\n        appConfigPromiseGetterMap.set(name, parcelConfigObjectGetterPromise);\r\n      } else {\r\n        const xpath = getContainerXpath(container);\r\n        if (xpath) appConfigPromiseGetterMap.set(`${name}-${xpath}`, parcelConfigObjectGetterPromise);\r\n      }\r\n    }\r\n\r\n    return (await parcelConfigObjectGetterPromise)(container);\r\n  };\r\n  // @ts-ignore\r\n  return mountRootParcel(memorizedLoadingFn, { domElement: document.createElement('div'), ...props });\r\n}\r\n\r\n \r\n","// 工具utils：获取容器，生成容器，销毁容器，生成id\r\n\r\nimport { baseUrl } from \"../../services/base\";\r\nimport { getInfoById } from \"./api\";\r\nimport { widgetsConfig, sandBoxs } from \"./widget\";\r\nimport frequest from \"../../services/handler\";\r\nimport user from \"../../services/api/modules/user\";\r\n\r\nimport { addAuth } from \"../../bridge/index\";\r\nimport { forEach } from \"lodash\";\r\n// todo 此文件的方法需要整理分离出freeelogApp下的和内部使用的\r\nexport function getContainer(\r\n  container: string | HTMLElement\r\n): HTMLElement | null | undefined {\r\n  // @ts-ignore\r\n  return typeof container === \"string\"\r\n    ? document.querySelector(\"#\" + container)\r\n    : container;\r\n}\r\n\r\nexport function createContainer(\r\n  container: string | HTMLElement,\r\n  id: string\r\n): HTMLElement {\r\n  const father =\r\n    typeof container === \"string\"\r\n      ? document.querySelector(\"#\" + container)\r\n      : container;\r\n  // @ts-ignore\r\n  if (father?.querySelector(\"#\" + id)) return father?.querySelector(\"#\" + id);\r\n  let child = document.createElement(\"DIV\");\r\n  child.setAttribute(\"id\", id);\r\n  father?.appendChild(child);\r\n  return child;\r\n}\r\n\r\n// TODO 确定返回类型\r\nexport function deleteContainer(\r\n  father: string | HTMLElement,\r\n  child: string | HTMLElement\r\n): any {\r\n  const fatherContainer =\r\n    typeof father === \"string\" ? document.querySelector(\"#\" + father) : father;\r\n  const childContainer =\r\n    typeof child === \"string\" ? document.querySelector(\"#\" + child) : child;\r\n\r\n  return childContainer ? fatherContainer?.removeChild(childContainer) : true;\r\n}\r\n// let count = 0;\r\nexport function createId(subId: string, count?: number): any {\r\n  let id = count ? \"freelog-\" + subId + \"-\" + count : \"freelog-\" + subId;\r\n  // @ts-ignore\r\n  return document.querySelector(\"#\" + id) ? createId(subId, ++count) : id;\r\n}\r\n\r\nexport function createScript(url: string): Promise<any> {\r\n  return new Promise((resolve, reject) => {\r\n    const script: HTMLScriptElement = document.createElement(\"script\");\r\n    script.src = url;\r\n    script.onload = resolve;\r\n    script.onerror = reject;\r\n    // script.async = true\r\n    script.defer = true;\r\n    // @ts-ignore\r\n    document.getElementsByTagName(\"head\").item(0).appendChild(script);\r\n  });\r\n}\r\n\r\nexport function createCssLink(href: string, type?: string): Promise<any> {\r\n  return new Promise((resolve, reject) => {\r\n    const link: HTMLLinkElement = document.createElement(\"link\");\r\n    link.href = href;\r\n    link.rel = \"stylesheet\";\r\n    link.type = type || \"text/css\";\r\n    link.onload = resolve;\r\n    link.onerror = reject;\r\n    // @ts-ignore\r\n    document.getElementsByTagName(\"head\").item(0).appendChild(link);\r\n  });\r\n}\r\n//\r\nexport function resolveUrl(path: string, params?: any): string {\r\n  // @ts-ignore\r\n  const { nodeType } = window.freelogApp.nodeInfo;\r\n  params = Object.assign({ nodeType }, params);\r\n  var queryStringArr = [];\r\n  for (let key in params) {\r\n    if (params[key] != null) {\r\n      queryStringArr.push(`${key}=${params[key]}`);\r\n    }\r\n  }\r\n  return `${baseUrl}${path}?${queryStringArr.join(\"&\")}`;\r\n}\r\nexport async function getSelfId() {\r\n  // @ts-ignore\r\n  return widgetsConfig.get(this.name)?.presentableId;\r\n}\r\n// TODO if error\r\nexport async function getSubDep(presentableId: any) {\r\n  // @ts-ignore\r\n  let that = sandBoxs.get(this.name);\r\n  if (!that) {\r\n    that = { name: \"freelog-\" + presentableId, presentableId };\r\n  }\r\n  // @ts-ignore\r\n  let info = await getInfoById.bind(that)(presentableId);\r\n  if (info.data.errCode) {\r\n    await new Promise((resolve, reject) => {\r\n      addAuth.bind(that)(presentableId, resolve, reject, { immediate: true });\r\n    });\r\n    info = await getInfoById.bind(that)(presentableId);\r\n    if (info.data.errCode) {\r\n      await new Promise((resolve, reject) => {\r\n        addAuth.bind(that)(presentableId, resolve, reject, { immediate: true });\r\n      });\r\n    }\r\n    info = await getInfoById.bind(that)(presentableId);\r\n  }\r\n  const [subDeps, entityNid] = [\r\n    info.headers[\"freelog-sub-dependencies\"],\r\n    info.headers[\"freelog-entity-nid\"],\r\n  ];\r\n  return {\r\n    subDeps: subDeps ? JSON.parse(decodeURIComponent(subDeps)) : [],\r\n    entityNid,\r\n    data: info.data.data,\r\n  };\r\n}\r\nlet userInfo: any = null;\r\nexport async function getUserInfo() {\r\n  if (userInfo) return userInfo;\r\n  const res = await frequest(user.getCurrent, \"\", \"\");\r\n  userInfo = res.data.errCode === 0 ? res.data.data : null;\r\n  return userInfo;\r\n}\r\nexport function getCurrentUser() {\r\n  return userInfo;\r\n}\r\nexport async function setUserInfo(info: any) {\r\n  userInfo = info;\r\n}\r\nexport function getStaticPath(path: string, type?: string) {\r\n  if (!/^\\//.test(path)) {\r\n    path = \"/\" + path;\r\n  }\r\n  // @ts-ignore\r\n  return widgetsConfig.get(this.name).entry + path;\r\n}\r\nexport function getEntry(that: any) {\r\n  let baseURL = \"http://qi.freelog.com/v2/\";\r\n  // TODO  判断不严谨，会有漏洞\r\n  if (window.location.href.indexOf(\"testfreelog\") > -1) {\r\n    baseURL = \"http://qi.testfreelog.com/v2/\";\r\n  }\r\n  let url = baseURL + `auths/presentables/${that.presentableId}/fileStream?`;\r\n  let url2 = `parentNid=${that.parentNid}&subResourceIdOrName=${that.subResourceIdOrName}`;\r\n  if (that.parentNid) {\r\n    return url + url2 + \"&subResourceFile=\";\r\n  } else {\r\n    return url + \"subResourceFile=\";\r\n  }\r\n}\r\nconst immutableKeys = [\"width\"];\r\nconst viewPortValue = {\r\n  width: \"device-width\", // immutable\r\n  height: \"device-height\", // not supported in browser\r\n  \"initial-scale\": 1, // 0.0-10.0   available for theme\r\n  \"maximum-scale\": 1, // 0.0-10.0   available for theme\r\n  \"minimum-scale\": 1, // 0.0-10.0   available for theme\r\n  \"user-scalable\": \"no\", // available for theme\r\n  \"viewport-fit\": \"auto\", // not supported in browser\r\n};\r\nexport function setViewport(keys: any) {\r\n  // @ts-ignore\r\n  const that = this;\r\n  // 如果是主题\r\n  if (!widgetsConfig.get(that.name)?.isTheme) {\r\n    return;\r\n  }\r\n  Object.keys(keys).forEach((key: any) => {\r\n    if (viewPortValue.hasOwnProperty(key) && !immutableKeys.includes(key)) {\r\n      // TODO 开发体验最好做下验证值是否合法\r\n      // @ts-ignore\r\n      viewPortValue[key] = keys[key];\r\n    }\r\n  });\r\n  var doc = window.document;\r\n  var metaEl: any = doc.querySelector('meta[name=\"viewport\"]');\r\n  let content = \"\";\r\n  Object.keys(viewPortValue).forEach((key: any) => {\r\n    if (viewPortValue.hasOwnProperty(key)) {\r\n      // @ts-ignore\r\n      content += key + \"=\" + viewPortValue[key] + ',';\r\n    }\r\n  });\r\n  metaEl.setAttribute(\r\n    \"content\",\r\n    content\r\n  );\r\n}\r\n","import { Modal, Input, Spin } from \"antd\";\r\nimport Button from \"../_components/button\";\r\nimport \"./pay.scss\";\r\nimport { useState, useEffect } from \"react\";\r\nimport frequest from \"../../../services/handler\";\r\nimport user from \"../../../services/api/modules/user\";\r\nimport event from \"../../../services/api/modules/event\";\r\nimport transaction from \"../../../services/api/modules/transaction\";\r\n\r\nimport { getUserInfo } from \"../../../platform/structure/utils\";\r\nimport { clearInterval } from \"timers\";\r\n\r\ninterface PayProps {\r\n  isModalVisible: boolean;\r\n  setIsModalVisible: any;\r\n  contractId: string;\r\n  subjectName: string;\r\n  receiver: string;\r\n  contractName: string;\r\n  transactionAmount?: number;\r\n  eventId: any;\r\n  paymentFinish: any;\r\n}\r\n\r\nexport default function (props: PayProps) {\r\n  const [password, setPassword] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n  const [visible, setVisible] = useState(false);\r\n  const [userAccount, setUserAccount] = useState<any>({});\r\n  const handleOk = () => {\r\n    props.setIsModalVisible(false);\r\n  };\r\n  const handleCancel = () => {\r\n    // TODO 提示支付中\r\n    !loading && props.setIsModalVisible(false);\r\n  };\r\n  async function getAccount() {\r\n    // @ts-ignore\r\n    const userInfo = await getUserInfo();\r\n    // @ts-ignore\r\n    const res = await frequest(user.getAccount, [userInfo.userId], \"\");\r\n    setUserAccount(res.data.data);\r\n  }\r\n  useEffect(() => {\r\n    setPassword(\"\")\r\n    setVisible(props.isModalVisible);\r\n    props.isModalVisible && getAccount();\r\n  }, [props.isModalVisible]);\r\n  async function pay() {\r\n    // TODO 防止多次点击\r\n    if(loading) return \r\n    setLoading(true);\r\n    const payResult = await frequest(event.pay, [props.contractId], {\r\n      eventId: props.eventId,\r\n      accountId: userAccount.accountId,\r\n      transactionAmount: props.transactionAmount,\r\n      password: password,\r\n    });\r\n    console.log(payResult)\r\n    if(payResult.data.errCode !== 0){\r\n      Modal.error({\r\n        title: '支付失败',\r\n        content: payResult.data.msg,\r\n        zIndex: 9999\r\n      });\r\n      setLoading(false)\r\n      return\r\n    }\r\n    const modal = Modal.success({\r\n      title: '支付成功',\r\n      content: payResult.data.msg,\r\n      zIndex: 9999\r\n    });\r\n    // TODO 查交易状态, flag应该设为状态，在关闭弹窗时清除\r\n    const flag = setInterval(async()=>{\r\n      const res:any = await frequest(transaction.getRecord, [payResult.data.data.transactionRecordId],'');\r\n      const status = res.data.data.status\r\n      console.log(res)\r\n      if([2,3,4].includes(status)){\r\n        props.paymentFinish(status)\r\n        setLoading(false)\r\n        modal.destroy()\r\n        window.clearInterval(flag)\r\n      }\r\n    },2000)\r\n    \r\n    // setLoading(false);\r\n    //   eventId: \"string\",  contractId\r\n    //   accountId: \"int\",\r\n    //   transactionAmount: \"string\",\r\n    //   password: \"string\"\r\n  }\r\n  return (\r\n    <Modal\r\n      title=\"支付\"\r\n      zIndex={1201}\r\n      centered\r\n      footer={null}\r\n      visible={visible}\r\n      className=\"w-600 \"\r\n      maskClosable={false}\r\n      onOk={handleOk}\r\n      onCancel={handleCancel}\r\n      wrapClassName=\"freelog-pay\"\r\n      getContainer={document.getElementById(\"runtime-pc\")}\r\n    >\r\n      <div className=\"flex-column \">\r\n         {/* 金额 */}\r\n        <div className=\"amount text-center my-40 px-80\">\r\n          <span className=\"ml-30\">\r\n            {props.transactionAmount}\r\n            <span className=\"type ml-10\">羽币</span>\r\n          </span>\r\n        </div>\r\n        <div className=\"flex-row px-80 over-h\">\r\n          <div className=\"flex-column shrink-0\">\r\n            <div className=\"left-item\">标的物</div>\r\n            <div className=\"left-item\">授权合约</div>\r\n            <div className=\"left-item\">收款方</div>\r\n            <div className=\"left-item\">支付方式</div>\r\n          </div>\r\n          <div className=\"flex-column flex-1\">\r\n            <div className=\"right-item text-ellipsis\">{props.subjectName}</div>\r\n            <div className=\"right-item text-ellipsis\">{props.contractName}</div>\r\n            <div className=\"right-item text-ellipsis\">{props.receiver}</div>\r\n            <div className=\"right-item text-ellipsis\">\r\n              <span className=\"\">羽币账户</span>\r\n              <span className=\"balance\">（余额{userAccount.balance}枚）</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"forgot-p text-align-right px-80 mt-18 cur-pointer\">\r\n          忘记密码\r\n        </div>\r\n        <div className=\"px-80 pt-5\">\r\n          <Input.Password\r\n            size=\"large\"\r\n            onChange={(e) => {\r\n              setPassword(e.target.value);\r\n            }}\r\n            maxLength={6}\r\n            value={password}\r\n            placeholder=\"输入6位支付密码\"\r\n          />\r\n        </div>\r\n        <div className=\"px-80 pt-20\">\r\n          <Button click={pay} disabled={password.length !== 6 || loading} className=\"py-9\">\r\n            {loading? <span>支付中...<Spin /></span>: \r\n            '确认支付'}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n}\r\n","import { Graph } from \"@antv/x6\";\r\nimport React, { useState, useEffect } from \"react\";\r\nimport { forEach } from \"lodash\";\r\n\r\ninterface GraphProps {\r\n  policy: any;\r\n  children?: any;\r\n}\r\n\r\nexport default function (props: GraphProps) {\r\n  /**\r\n   * first: 面临最大问题，计算文字长短问题\r\n   * start:\r\n   */\r\n\r\n  /**\r\n   * 垂直线需要转弯\r\n   * 面向对象：\r\n   *     画板：高和宽，多少层\r\n   *     层：多少列\r\n   *     节点：在第几层第几列\r\n   *     线段：起点，终点，箭头方向\r\n   * Graph: width height\r\n   * node: {\r\n        id: \"node1\", // String，可选，节点的唯一标识\r\n        x: 40, // Number，必选，节点位置的 x 值\r\n        y: 40, // Number，必选，节点位置的 y 值\r\n        width: 80, // Number，可选，节点大小的 width 值\r\n        height: 40, // Number，可选，节点大小的 height 值\r\n        label: \"hello\", // String，节点标签\r\n      }\r\n     edges: {\r\n        source: \"node1\", // String，必须，起始节点 id\r\n        target: \"node2\", // String，必须，目标节点 id\r\n        labels: [\r\n          {\r\n            attrs: { label: { text: \"edge\" } },\r\n          },\r\n        ],\r\n      },\r\n      policyMaps, bestPyramid, betterPyramids, nodesMap， bestPyramid.maxWidth \r\n      方案：固定节点大小，字体大小？那就放不下，如何解决放不下的问题：滚动\r\n            步骤：1.固定层高和节点大小字体大小\r\n                  2.通过bestPyramid.pyramid 确定节点的id和位置和内容\r\n                  3.通过nodesMap确定线段的起始点 折线点 以及计算出是否重叠与穿过了节点。\r\n   */\r\n  const nodes: any = [];\r\n  props.policy.bestPyramid.pyramid.forEach((layer: any, yIndex: number) => {\r\n    // x 40间隙 node 宽100    y 60间隙 node搞60\r\n    layer.forEach((node: any, xIndex: number) => {\r\n      if (!node) return;\r\n      let body:any = {\r\n        fill: '#FFFFFF',\r\n        stroke: '#D4D4D4',\r\n        rx: 8,\r\n        ry: 8,\r\n        zIndex: 1\r\n      }\r\n      if(node.isAuth){\r\n        body.fill = '#E5F6EF'\r\n        body.stroke = '#8FD6B8'\r\n      }\r\n      nodes.push({\r\n        id: node.status, // String，可选，节点的唯一标识\r\n        x: xIndex * 100 + xIndex * 80 + 10, // Number，必选，节点位置的 x 值\r\n        y: yIndex * 60 + yIndex * 60 + 10, // Number，必选，节点位置的 y 值\r\n        width: 100, // Number，可选，节点大小的 width 值\r\n        height: 60, // Number，可选，节点大小的 height 值\r\n        label: node.status, // String，节点标签\r\n        zIndex: 1000,\r\n        attrs: {\r\n          body\r\n        },\r\n      });\r\n    });\r\n  });\r\n  const edges: any = []\r\n  // TODO 需要在处理数据时做，不能放在这里\r\n  props.policy.translateInfo.fsmInfos.forEach((info:any)=>{\r\n    info.eventTranslateInfos.forEach((eventInfo:any)=>{\r\n      eventInfo.used = false      \r\n    })\r\n  })\r\n  props.policy.nodesMap.forEach((node:any, key:any)=>{\r\n    // 判断source 与 target ，如果邻行且同列，不需要折线，否则都需要折线\r\n    // 折线点判断：邻行，如果从左往右画，折线点在target上方，且记录这个点，下一次需要避免这个点\r\n    //             隔行同列, 如果是中间左边列，y方向在target和source中的左边取平均，x方向在节点的左侧，同理右边\r\n    //             隔行非同列，\r\n    node.from.forEach((item:any)=>{\r\n      let text = ''\r\n      props.policy.translateInfo.fsmInfos.forEach((info:any)=>{\r\n        if(info.stateInfo.origin === item){\r\n          info.eventTranslateInfos.forEach((eventInfo:any)=>{\r\n            if(eventInfo.origin.state === key){\r\n              eventInfo.used = true\r\n              text = eventInfo.content.substr(0, eventInfo.content.lastIndexOf('，'))\r\n            }\r\n          })\r\n        }\r\n      })\r\n      edges.push({\r\n        source: item, // String，必须，起始节点 id\r\n        target: key, // String，必须，目标节点 id\r\n        labels: [\r\n          {\r\n            attrs: { label: { text } },\r\n          },\r\n        ],\r\n        attrs: {\r\n          line: {\r\n            stroke: \"#979797\", // 指定 path 元素的填充色\r\n          },\r\n        },\r\n        // connector: {\r\n        //     name: 'rounded',\r\n        //     args: {},\r\n        //   },\r\n        // vertices: [\r\n        //   { x: 300, y: 180 },\r\n        // ],\r\n      })\r\n    })\r\n    node.to.forEach((item:any)=>{\r\n      let text = ''\r\n      props.policy.translateInfo.fsmInfos.forEach((info:any)=>{\r\n        if(info.stateInfo.origin === key){\r\n          info.eventTranslateInfos.forEach((eventInfo:any)=>{\r\n            if(eventInfo.origin.state === item){\r\n              eventInfo.used = true\r\n              text = eventInfo.content.substr(0, eventInfo.content.lastIndexOf('，'))\r\n            }\r\n          })\r\n        }\r\n      })\r\n      edges.push({\r\n        source: key, // String，必须，起始节点 id\r\n        target: item, // String，必须，目标节点 id\r\n        labels: [\r\n          {\r\n            attrs: { label: { text } },\r\n          },\r\n        ],\r\n        attrs: {\r\n          line: {\r\n            stroke: \"#979797\", // 指定 path 元素的填充色\r\n          },\r\n        },\r\n        // connector: {\r\n        //     name: 'rounded',\r\n        //     args: {},\r\n        //   },\r\n        // vertices: [\r\n        //   { x: 300, y: 180 },\r\n        // ],\r\n      })\r\n    })\r\n  })\r\n  const data = {\r\n\r\n    // 边\r\n    edges: [\r\n      ...edges\r\n      // {\r\n      //   source: \"node2\", // String，必须，起始节点 id\r\n      //   target: \"node1\", // String，必须，目标节点 id\r\n      //   labels: [\r\n      //     {\r\n      //       attrs: { label: { text: \"edge33\" } },\r\n      //     },\r\n      //   ],\r\n      //   connector: {\r\n      //       name: 'rounded',\r\n      //       args: {},\r\n      //     },\r\n      //   vertices: [\r\n      //     { x: 300, y: 180 },\r\n      //   ],\r\n      // }\r\n    ],\r\n        // 节点\r\n        nodes,\r\n  };\r\n  useEffect(() => {\r\n    const graph = new Graph({\r\n      // @ts-ignore\r\n      container: document.getElementById(props.policy.policyId),\r\n      width: 800,\r\n      height: 600,\r\n      // frozen: true,\r\n      panning: false,\r\n      interacting: {\r\n        nodeMovable: false,\r\n        edgeMovable: false,\r\n      },\r\n    });\r\n    graph.fromJSON(data);\r\n  });\r\n\r\n  return (\r\n    <div className=\"w-100x h-100x x-auto y-auto \">\r\n      <div id={props.policy.policyId} className=\"  w-100x  x-auto y-auto\"></div>\r\n    </div>\r\n  );\r\n}\r\n","interface CodeProps {\r\n  policyText: any;\r\n  children?: any;\r\n} \r\nexport default function (props:CodeProps ) {\r\n   \r\n  return (\r\n    <div  className=\"fs-14 lh-24 fw-regular fc-main py-10\">{props.policyText}</div>\r\n    );\r\n}\r\n","interface CotentProps {\r\n  translateInfo: any;\r\n  children?: any;\r\n}  \r\nexport default function (props:CotentProps) {\r\n   \r\n  return (\r\n    <pre className=\"fs-14 lh-24 fw-regular fc-main\">{props.translateInfo.content}</pre>\r\n    );\r\n}\r\n","import { Radio, Input, Space } from \"antd\";\r\nimport { useState, useEffect } from \"react\";\r\nimport Button from \"../_components/button\";\r\nimport Pay from \"../event/pay\";\r\nimport { DownOutlined, UpOutlined } from \"@ant-design/icons\";\r\nimport \"./contract.scss\";\r\nimport PolicyGraph from \"../policy/_components/policyGraph\";\r\nimport PolicyCode from \"../policy/_components/policyCode\";\r\nimport PolicyContent from \"../policy/_components/policyContent\";\r\nimport { Tabs, Checkbox, Popconfirm } from \"antd\";\r\nconst { TabPane } = Tabs;\r\n\r\nvar moment = require(\"moment\");\r\n/**\r\n * 事件执行后：分情况，如果是获得授权的事件，那就是---获得授权后\r\n */\r\ninterface ItemProps {\r\n  policy: any;\r\n  contract: any;\r\n  children?: any;\r\n  paymentFinish: any;\r\n  [propName: string]: any;\r\n}\r\n\r\nexport default function (props: ItemProps) {\r\n  const [eventIndex, setEventIndex] = useState(-1);\r\n  const [unfold, setUnFold] = useState(false);\r\n  const [argsMap, setArgsMap] = useState<Map<any, any>>(new Map());\r\n  const [authClass, setAuthClass] = useState(\"bg-auth-non\");\r\n  const [authStatus, setAuthStatus] = useState(\"未授权\");\r\n  const [currentStatus, setCurrentStatus] = useState({\r\n    eventTranslateInfos: [{ origin: { args: { amount: \"\" } } }],\r\n  });\r\n  const [isModalVisible, setIsModalVisible] = useState(false);\r\n  useEffect(() => {\r\n    const argsMap = new Map();\r\n    props.contract.fsmDeclarations.envArgs?.forEach((item: any) => {\r\n      argsMap.set(item.name, item);\r\n    });\r\n    setArgsMap(argsMap);\r\n    let authClass = \"bg-auth-end\";\r\n    let authStatus = \"已终止\";\r\n    if (props.contract.status !== 1) {\r\n      authStatus = \"未授权\";\r\n      authClass = \"bg-auth-non\";\r\n      if (props.contract.authStatus === 2 && window.isTest) {\r\n        authStatus = \"已授权\";\r\n        authClass = \"bg-auth\";\r\n      } else if (props.contract.authStatus === 1) {\r\n        authStatus = \"已授权\";\r\n        authClass = \"bg-auth\";\r\n      }\r\n    }\r\n    setAuthStatus(authStatus);\r\n    setAuthClass(authClass);\r\n    props.contract.policyInfo.translateInfo.fsmInfos.some((item: any) => {\r\n      if (item.stateInfo.origin === props.contract.fsmCurrentState) {\r\n        let tec = 0; // TransactionEventCount\r\n        item.eventTranslateInfos.forEach((event: any) => {\r\n          if (event.origin.name === \"TransactionEvent\") tec++;\r\n          props.contract.policyInfo.translateInfo.fsmInfos.some(\r\n            (state: any) => {\r\n              if (state.stateInfo.origin === event.origin.state) {\r\n                event.nextState = {\r\n                  ...state,\r\n                  ...props.contract.policyInfo.fsmDescriptionInfo[\r\n                    event.origin.state\r\n                  ],\r\n                };\r\n                return true;\r\n              }\r\n            }\r\n          );\r\n        });\r\n\r\n        const currentSatus = {\r\n          tec,\r\n          status: props.contract.fsmCurrentState,\r\n          ...item,\r\n          ...props.contract.policyInfo.fsmDescriptionInfo[\r\n            props.contract.fsmCurrentState\r\n          ],\r\n        };\r\n        // @ts-ignore\r\n        setCurrentStatus(currentSatus);\r\n        return true;\r\n      }\r\n    });\r\n  }, [props.contract]);\r\n  function onChange(e: any) {\r\n    setEventIndex(e.target.value);\r\n  }\r\n  function payEvent(e: any) {\r\n    setIsModalVisible(true);\r\n  }\r\n  function paymentFinish(status: number) {\r\n    if (status === 2) {\r\n      setIsModalVisible(false);\r\n    }\r\n    props.paymentFinish();\r\n  }\r\n  return (\r\n    <div className=\"contract-card px-20 py-15 mt-15 w-100x\">\r\n      {eventIndex > -1 && (\r\n        <Pay\r\n          contractId={props.contract.contractId}\r\n          subjectName={props.contract.subjectName}\r\n          contractName={props.contract.contractName}\r\n          paymentFinish={paymentFinish}\r\n          // @ts-ignore\r\n          receiver={\r\n            argsMap.get(\r\n              // @ts-ignore\r\n              currentStatus.eventTranslateInfos[eventIndex].origin.args.account\r\n            ).ownerName\r\n          }\r\n          // @ts-ignore\r\n          eventId={currentStatus.eventTranslateInfos[eventIndex].origin.id}\r\n          // @ts-ignore\r\n          transactionAmount={\r\n            currentStatus.eventTranslateInfos[eventIndex].origin.args.amount\r\n          }\r\n          isModalVisible={isModalVisible}\r\n          setIsModalVisible={setIsModalVisible}\r\n        ></Pay>\r\n      )}\r\n      <div className=\"flex-row w-100x\">\r\n        <div className=\"contract-name  text-ellipsis\">\r\n          {props.contract.contractName}\r\n        </div>\r\n        {/* <div className=\"policy-button cur-pointer  shrink-0 select-none\">策略内容</div> */}\r\n      </div>\r\n      <Tabs defaultActiveKey=\"1\" className=\"select-none\">\r\n        <TabPane tab=\"合约流转记录\" key=\"1\">\r\n          {/* 状态整体 */}\r\n          <div className=\"status-card p-15 mt-15\">\r\n            <div className=\"flex-row\">\r\n              <div\r\n                className={\"auth-status text-center select-none \" + authClass}\r\n              >\r\n                {authStatus}\r\n              </div>\r\n              <div className=\"auth-time\">\r\n                {moment(props.contract.updateDate).format(\"YYYY-MM-DD HH:mm\")}\r\n              </div>\r\n            </div>\r\n            <div className=\"flex-row py-10 space-between align-center\">\r\n              <div>当前无授权，请选择执行事件</div>\r\n\r\n              {\r\n                // @ts-ignore\r\n                currentStatus.tec > 1 && (\r\n                  <Button\r\n                    className=\"fs-12\"\r\n                    disabled={eventIndex === -1}\r\n                    click={payEvent}\r\n                  >\r\n                    支付\r\n                  </Button>\r\n                )\r\n              }\r\n            </div>\r\n            {/* 可选事件 */}\r\n            <div>\r\n              <div className=\"flex-row\">\r\n                <Radio.Group onChange={onChange} value={eventIndex}>\r\n                  <div className=\"flex-column\">\r\n                    {\r\n                      // @ts-ignore\r\n                      currentStatus.eventTranslateInfos &&\r\n                        // @ts-ignore\r\n                        currentStatus.eventTranslateInfos.map(\r\n                          (event: any, index: number) => {\r\n                            // origin.id  name\r\n                            return (\r\n                              <div\r\n                                className={\r\n                                  \"event-card p-10 mt-10 flex-column \" +\r\n                                  (index !== eventIndex ? \"\" : \"event-selected\")\r\n                                }\r\n                                key={index}\r\n                              >\r\n                                <Radio\r\n                                  className=\"\"\r\n                                  value={index}\r\n                                  disabled={\r\n                                    event.origin.name !== \"TransactionEvent\"\r\n                                  }\r\n                                >\r\n                                  <div className=\"flex-row event flex-wrap align-center\">\r\n                                    <div className=\"mr-10 flex-row align-center\">\r\n                                      <span>{event.content}</span>\r\n                                      <span className=\"auth ml-10\">\r\n                                        {event.nextState &&\r\n                                        event.nextState.isAuth\r\n                                          ? \"获得授权\"\r\n                                          : \"\"}\r\n                                      </span>\r\n                                    </div>\r\n                                    {\r\n                                      // @ts-ignore\r\n                                      currentStatus.tec === 1 &&\r\n                                        event.origin.name ===\r\n                                          \"TransactionEvent\" && (\r\n                                          <Button\r\n                                            disabled={index !== eventIndex}\r\n                                            className=\"fs-12\"\r\n                                            click={payEvent}\r\n                                          >\r\n                                            支付\r\n                                          </Button>\r\n                                        )\r\n                                    }\r\n                                  </div>\r\n                                  {/* 执行完成后下一个状态的所有事件 */}\r\n                                  <div className=\"flex-column event-next pt-5 ml-3\">\r\n                                    {/** 事件执行后：分情况，如果是获得授权的事件，那就是---获得授权后\r\n                                     * event.origin.state\r\n                                     */}\r\n                                    <div className=\"event-next\">\r\n                                      {event.nextState && event.nextState.isAuth\r\n                                        ? \"获得授权后\"\r\n                                        : \"执行成功后:\"}\r\n                                    </div>\r\n                                    {event.nextState &&\r\n                                      event.nextState.eventTranslateInfos.map(\r\n                                        (nextEvent: any, index: number) => {\r\n                                          return (\r\n                                            <div\r\n                                              key={index}\r\n                                              className=\"flex-row align-center\"\r\n                                            >\r\n                                              <div className=\"event-dot mr-5\"></div>\r\n                                              <span>{nextEvent.content}</span>\r\n                                            </div>\r\n                                          );\r\n                                        }\r\n                                      )}\r\n                                  </div>\r\n                                </Radio>\r\n                              </div>\r\n                            );\r\n                          }\r\n                        )\r\n                    }\r\n                  </div>\r\n                </Radio.Group>\r\n              </div>\r\n            </div>\r\n            <div className=\"fluent-record text-align-center cur-pointer select-none mt-20\">\r\n              {!unfold ? (\r\n                <div\r\n                  onClick={(e) => {\r\n                    setUnFold(true);\r\n                  }}\r\n                >\r\n                  展开流转记录 <DownOutlined />\r\n                </div>\r\n              ) : (\r\n                <div\r\n                  onClick={(e) => {\r\n                    setUnFold(false);\r\n                  }}\r\n                >\r\n                  收起流转记录 <UpOutlined />\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n          <div className=\"contract-code pt-12\">\r\n            合同编号 {props.contract.contractId} | 签约时间{\" \"}\r\n            {moment(props.contract.updateDate).format(\"YYYY-MM-DD HH:mm\")}\r\n          </div>\r\n        </TabPane>\r\n        <TabPane tab=\"策略内容\" key=\"2\">\r\n          <PolicyContent\r\n            translateInfo={props.policy.translateInfo}\r\n          ></PolicyContent>\r\n        </TabPane>\r\n        <TabPane tab=\"状态机视图\" key=\"3\">\r\n          <PolicyGraph policy={props.policy}></PolicyGraph>\r\n        </TabPane>\r\n        <TabPane tab=\"策略代码\" key=\"4\">\r\n          <PolicyCode policyText={props.policy.policyText}></PolicyCode>\r\n        </TabPane>\r\n      </Tabs>\r\n    </div>\r\n  );\r\n}\r\n","import PolicyGraph from \"./_components/policyGraph\";\r\nimport PolicyCode from \"./_components/policyCode\";\r\nimport \"./policy.scss\";\r\nimport { useState, useEffect } from \"react\";\r\n\r\nimport PolicyContent from \"./_components/policyContent\";\r\nimport Button from \"../_components/button\";\r\n\r\nimport { Tabs, Checkbox, Popconfirm } from \"antd\";\r\n\r\nconst { TabPane } = Tabs;\r\n\r\ninterface ItemProps {\r\n  policy: any;\r\n  selectType: boolean;\r\n  policySelect: any;\r\n  seq: number;\r\n  getAuth: any;\r\n  children?: any;\r\n}\r\nexport default function (props: ItemProps) {\r\n  const [visible, setVisible] = useState(false);\r\n  function callback(key: any) {}\r\n  function onChange(e: any) {\r\n    console.log(e)\r\n    props.policySelect(props.policy.policyId, e.target.checked);\r\n  }\r\n  async function confirm(e: any) {\r\n    props.getAuth()\r\n    setVisible(false);\r\n  }\r\n\r\n  function cancel(e: any) {\r\n    props.policySelect();\r\n    setVisible(false);\r\n  }\r\n  return (\r\n    <div className=\"flex-column policy-card\">\r\n      {/* 上：策略名称与操作 */}\r\n      <div className=\"flex-row space-between px-20 py-15\">\r\n        <div className=\"flex-1 policy-name  text-ellipsis\">\r\n          {props.policy.policyName}\r\n        </div>\r\n        {props.selectType ? (\r\n          <Popconfirm\r\n            title=\"确定使用此策略与资源签约？\"\r\n            onConfirm={confirm}\r\n            onCancel={cancel}\r\n            zIndex={1202}\r\n            visible={visible}\r\n            // @ts-ignore\r\n            getPopupContainer={() => document.getElementById(\"runtime-pc\")}\r\n            okText=\"确定\"\r\n            cancelText=\"取消\"\r\n          >\r\n            <Button\r\n              className=\"fs-13\"\r\n              click={() => {\r\n                props.policySelect(props.policy.policyId, true, true);\r\n                setVisible(true);\r\n              }}\r\n            >\r\n              签约\r\n            </Button>\r\n          </Popconfirm>\r\n        ) : (\r\n          <Checkbox onChange={onChange}></Checkbox>\r\n        )}\r\n      </div>\r\n      {/* 下：tab */}\r\n      <div className=\"flex-column px-20\">\r\n        <Tabs defaultActiveKey=\"1\" onChange={callback} className=\"select-none\">\r\n          <TabPane tab=\"策略内容\" key=\"1\">\r\n            <PolicyContent\r\n              translateInfo={props.policy.translateInfo}\r\n            ></PolicyContent>\r\n          </TabPane>\r\n          <TabPane tab=\"状态机视图\" key=\"2\">\r\n            <PolicyGraph policy={props.policy}></PolicyGraph>\r\n          </TabPane>\r\n          <TabPane tab=\"策略代码\" key=\"3\">\r\n            <PolicyCode policyText={props.policy.policyText}></PolicyCode>\r\n          </TabPane>\r\n        </Tabs>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { Modal } from \"antd\";\r\nimport Button from \"./button\";\r\nimport React, { useState, useEffect } from \"react\";\r\n\r\ninterface ConfirmProps {\r\n  isModalVisible: boolean;\r\n  currentPresentable: any;\r\n  policies: any;\r\n  getAuth: any;\r\n  setIsModalVisible: any;\r\n}\r\n\r\nexport default function (props: ConfirmProps) {\r\n  const handleOk = () => {\r\n    props.setIsModalVisible(false);\r\n  };\r\n  const handleCancel = () => {\r\n    props.setIsModalVisible(false);\r\n  };\r\n  const [policNames, setPolicNames] = useState<any>('');\r\n\r\n  useEffect(() => {\r\n    if (props.isModalVisible) {\r\n      let names = ''\r\n      props.policies.forEach((item: any) => {\r\n        if (item.checked) {\r\n          names += names ? names + '，' + item.policyName : item.policyName\r\n        }\r\n      });\r\n      setPolicNames(names)\r\n    }\r\n  }, [props.isModalVisible])\r\n  return (\r\n    <Modal\r\n      title=\"签约确认\"\r\n      zIndex={1201}\r\n      centered\r\n      footer={null}\r\n      visible={props.isModalVisible}\r\n      className=\"w-560\"\r\n      onOk={handleOk}\r\n      onCancel={handleCancel}\r\n      wrapClassName=\"freelog-confirm\"\r\n      getContainer={document.getElementById('runtime-pc')}\r\n    >\r\n      <div className=\"w-100x h-100x flex-column justify-center  pt-16\">\r\n        <div className=\"flex-row fc-grey mb-20 fs-14 justify-center\">\r\n          <span className=\"pr-10 shrink-0\">展品名称</span>\r\n          {props.currentPresentable ? (\r\n            <span>\r\n              {props.currentPresentable.presentableName}\r\n            </span>\r\n          ) : (\r\n            \"\"\r\n          )}\r\n        </div>\r\n        <div className=\"flex-row align-center lh-25 fs-16 fc-grey mb-70 justify-center\">\r\n          <span className=\"shrink-0\">确定使用</span>\r\n          <span className=\"fc-main fw-bold px-10 text-ellipsis\">\r\n            {policNames}\r\n          </span>\r\n          <span className=\"shrink-0\">获取授权？</span>\r\n        </div>\r\n        <div className=\"flex-row justify-center\">\r\n          <Button\r\n            type=\"cancel\"\r\n            click={(e) => {\r\n              props.setIsModalVisible(false);\r\n            }}\r\n            className=\"mr-10\"\r\n          >\r\n            取消\r\n          </Button>\r\n          <Button\r\n            click={(e) => {\r\n              props.getAuth();\r\n            }}\r\n            type=\"main\"\r\n          >\r\n            确定\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n}\r\n","import { Form, Input, Modal, Checkbox } from \"antd\";\r\nimport user from \"../../services/api/modules/user\";\r\nimport frequest from \"../../services/handler\";\r\nimport { SUCCESS } from \"../../bridge/event\";\r\nimport Button from \"./_components/button\";\r\n\r\nimport { useState } from \"react\";\r\nimport \"./login.scss\";\r\n\r\nconst layout = {\r\n  labelCol: { span: 8 },\r\n  wrapperCol: { span: 16 },\r\n};\r\n\r\ninterface loginProps {\r\n  loginFinished: any;\r\n  setIsLoginVisible: any;\r\n  children?: any;\r\n}\r\nexport default function (props: loginProps) {\r\n  const [form] = Form.useForm();\r\n  const [disabled, setDisabled] = useState(true);\r\n\r\n  function onValuesChange(changedValues:any,allValues:any){\r\n    console.log(changedValues, allValues)\r\n    setDisabled(!allValues.loginName || !allValues.password)\r\n  }\r\n  \r\n  const onFinish = async () => {\r\n    console.log(form.getFieldsValue())\r\n    const values: any = form.getFieldsValue()\r\n    // loginName: \"string\",\r\n    //   password: \"string\",\r\n    //   isRemember: \"string\",\r\n    //   returnUrl: \"string\",\r\n    //   jwtType: \"string\",\r\n    values.isRemember = values.isRemember ? 1 : 0;\r\n    const res = await frequest(user.login, \"\", values);\r\n    if (res.data.errCode === 0) {\r\n      props.loginFinished(SUCCESS, res.data.data);\r\n    }\r\n  };\r\n\r\n  const onFinishFailed = (errorInfo: any) => {\r\n    console.log(\"Failed:\", errorInfo);\r\n  };\r\n\r\n  const handleOk = () => {\r\n    props.setIsLoginVisible(false);\r\n  };\r\n \r\n  const handleCancel = () => {\r\n    props.setIsLoginVisible(false);\r\n  };\r\n  return (\r\n    <Modal\r\n      title=\"登录\"\r\n      zIndex={1200}\r\n      centered\r\n      footer={null}\r\n      visible={true}\r\n      closable={false}\r\n      className=\"\"\r\n      onOk={handleOk}\r\n      onCancel={handleCancel}\r\n      maskClosable={false}\r\n      wrapClassName=\"freelog-login\"\r\n      getContainer={document.getElementById(\"runtime-pc\")}\r\n    >\r\n      <div className=\"w-100x h-100x flex-column align-center\">\r\n        <div className=\"login-title py-55\">登录freelog</div>\r\n        <Form\r\n          {...layout}\r\n          onValuesChange={onValuesChange}\r\n          name=\"basic\"\r\n          form={form}\r\n          className=\"\"\r\n          initialValues={{ remember: true }}\r\n          onFinish={onFinish}\r\n          onFinishFailed={onFinishFailed}\r\n        >\r\n          <div className=\"login-label\">用户名/手机号/邮箱</div>\r\n          <Form.Item\r\n            name=\"loginName\"\r\n            rules={[{ required: true, message: \"请输入用户名!\" }]}\r\n          >\r\n            <Input />\r\n          </Form.Item>\r\n          <div className=\"flex-row space-between login-label mt-10\">\r\n            <div className=\"\">密码</div>\r\n            <div className=\"login-forgot select-none cur-pointer\">忘记密码？</div>\r\n          </div>\r\n\r\n          <Form.Item\r\n            name=\"password\"\r\n            rules={[{ required: true, message: \"请输入密码!\" }]}\r\n          >\r\n            <Input.Password />\r\n          </Form.Item>\r\n\r\n          {/* <Form.Item {...tailLayout} name=\"isRemember\" valuePropName=\"checked\" className=\"ml-40\">\r\n          <Checkbox>记住我</Checkbox>\r\n        </Form.Item> */}\r\n\r\n          <Form.Item className=\"pt-30\">\r\n            <Button className=\"py-9\" click={onFinish} disabled={disabled}>登录</Button>\r\n          </Form.Item>\r\n        </Form>\r\n        <div className=\"flex-row  mt-30\">\r\n          <span className=\"login-new\">freelog新用户？</span>\r\n          <span className=\"regist-now\">立即注册</span>\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n}\r\n","import { addAuth } from \"../../bridge/index\";\r\n// 异步回调\r\nexport function asyncCallUI(\r\n  presentableId: any,\r\n  resolve: any,\r\n  reject: any,\r\n  options?: any\r\n) {\r\n  // @ts-ignore\r\n  addAuth.bind(this)(presentableId, resolve, reject, options);\r\n}\r\n// 同步回调  callBack 与callUI函数后面的代码执行顺序 是有问题的，后面代码可能先执行，所以这里的同步回调，把后面代码写入callBack才是正确的\r\n// 已解决\r\nexport async function callUI(\r\n  presentableId: any,\r\n  resolve: any,\r\n  reject: any,\r\n  options?: any\r\n) {\r\n  await new Promise((res, rej) => {\r\n    const _res = () => {\r\n      // @ts-ignore\r\n      resolve && resolve(...arguments);\r\n      // @ts-ignore\r\n      res && res(...arguments);\r\n    };\r\n    const _rej = () => {\r\n      // @ts-ignore\r\n      reject && reject(...arguments);\r\n      // @ts-ignore\r\n      rej && rej(...arguments);\r\n    };\r\n    // @ts-ignore\r\n    addAuth.bind(this)(presentableId, _res, _rej, options);\r\n  });\r\n}\r\nexport const loginCallback:any = []\r\n// 登录和切换用户需要触发\r\nexport async function onLogin(\r\n  callback: any \r\n) {\r\n  if(typeof callback === 'function'){\r\n    loginCallback.push(callback)\r\n  } else{\r\n    console.error('onLogin error: ' , callback, ' is not a function!')\r\n  }\r\n}","import { placeHolder } from \"../../base\";\r\n\r\nexport type Contract = {\r\n  getContractInfo: any;\r\n  getContracts: any;\r\n  contract: any;\r\n  contracts: any;\r\n};\r\n\r\nconst contract: Contract = {\r\n  // presentableId, result|info|resourceInfo|fileStream\r\n  getContractInfo: {\r\n    url: `contracts/${placeHolder}`,\r\n    method: \"GET\",\r\n    dataModel: {\r\n      contractIds: \"string\",\r\n      isLoadPolicyInfo: \"int\",\r\n      projection: \"string\",\r\n    },\r\n  },\r\n  getContracts: {\r\n    url: `contracts/list`,\r\n    method: \"GET\",\r\n    dataModel: {\r\n      contractIds: \"string\",\r\n      subjectIds: \"string\",\r\n      subjectType: \"int\",\r\n      licenseeIdentityType: \"int\",\r\n      licensorId: \"string\",\r\n      licenseeId: \"string\",\r\n      isLoadPolicyInfo: \"int\",\r\n      projection: \"string\",\r\n      isTranslate: \"int\"\r\n    },\r\n  },\r\n  contract: {\r\n    url: `contracts`,\r\n    method: \"POST\",\r\n    dataModel: {\r\n      subjectId: \"string\",\r\n      subjectType: \"int\",\r\n      policyId: \"string\",\r\n      licenseeId: \"string\",\r\n      licenseeIdentityType: \"int\"\r\n    },\r\n  },\r\n  contracts: {\r\n    url: `contracts/batchSign`,\r\n    method: \"POST\",\r\n    dataModel: {\r\n      subjects: \"array\",\r\n      subjectId: \"string\",\r\n      subjectType: \"int\",\r\n      policyId: \"string\",\r\n      licenseeId: \"string\",\r\n      licenseeIdentityType: \"int\",\r\n      isWaitInitial: \"int\"\r\n    },\r\n  }\r\n};\r\nexport default contract;\r\n","/**\r\n * 节点集合\r\n * {\r\n *   row: 0,    // 固定的\r\n *   column: 0, //在不同排列中不同\r\n *   relations: []\r\n * }\r\n */\r\n \r\ninterface Node {\r\n  row: number;\r\n  column: number;\r\n  relations: Array<string>;\r\n  to: Array<string>;\r\n  from: Array<string>;\r\n  route: Array<string>;\r\n}\r\nlet nodesMap = new Map<any, Node>();\r\n\r\nfunction getRouteMaps(policy: any): any {\r\n  /**\r\n   * 数据结构：\r\n   *   节点：状态本身和层级，下一状态的集合\r\n   *   路径：每一个\r\n   *   金字塔：二维数组，记录每个节点的层级\r\n   * 1.找到所有路径\r\n   * 2.明确层级\r\n   *   2.1 以初始状态往下找到所有层（遇环停止且不记录）\r\n   *   2.2 向上去重\r\n   */\r\n  const policyMaps: any = [];\r\n  function findNext(status: any, route: any) {\r\n    // 准备下一层的\r\n    status.transitions.forEach((to: any, index: number) => {\r\n      // cycle test\r\n      let isExist = route.some((x: any) => x[0] === to.toState);\r\n      const event = to;\r\n      // prepare for next route\r\n      const nextRoute = [...route];\r\n      nextRoute.push([to.toState, event, policy[to.toState]]);\r\n      if (isExist) {\r\n        policyMaps.push(nextRoute);\r\n        return;\r\n      }\r\n      // route end\r\n      if (!policy[to.toState].transitions.length) {\r\n        policyMaps.push(nextRoute);\r\n        return;\r\n      }\r\n      // next route  同层往下都携带同一个下一层nextLevel\r\n      findNext(policy[to.toState], nextRoute);\r\n    });\r\n  }\r\n  if (!policy.initial.transitions) {\r\n    return [[[\"initial\", \"\", policy.initial]]];\r\n  }\r\n  findNext(policy.initial, [[\"initial\", \"\", policy.initial]]);\r\n  return policyMaps\r\n}\r\n/**\r\n * 分层工具  同时记录节点信息\r\n * @param policy\r\n * 如果ba\r\n */\r\n\r\nfunction getPyramid(policy: any): any {\r\n  const pyramid: any = []\r\n  function findNextLevel(level: number) {\r\n    const currentLevel = pyramid[level] || []\r\n    // console.log('currentLevel', currentLevel, pyramid[level - 1])\r\n    // 遍历上层的所有节点\r\n    pyramid[level - 1].forEach((pre: any) => {\r\n      // 拿出节点信息 \r\n      const nodeData = nodesMap.get(pre.status) || {\r\n        row: 0,\r\n        column: 0,\r\n        relations: [],\r\n        route: ['initial'],\r\n        to: [],\r\n        from: []\r\n      };\r\n      pre.transitions.forEach((next: any, index: number) => {\r\n        // if(next.toState === 'g') console.log(nodeData)\r\n        // 拿出节点信息\r\n        const toNodeData = nodesMap.get(next.toState) || {\r\n          row: 0,\r\n          column: 0,\r\n          relations: [],\r\n          route: [],\r\n          to: [],\r\n          from: []\r\n        };\r\n        // @ts-ignore 先考虑relations中有没有出现过，如果出现过就是环，则忽略\r\n        // 这里有问题，并没有一直往上找，而是只找了上级\r\n        if (nodeData.route.includes(next.toState)) {\r\n          // /  !nodeData.to.includes(next.toState) && nodeData.to.push(next.toState);\r\n          nodeData.to.push(next.toState);\r\n          // 反转,即面向对象，忽略箭头，此时pre与next也建立连接\r\n          if(!nodeData.relations.includes(next.toState)){\r\n            nodeData.relations.push(next.toState);\r\n          }  \r\n          return\r\n        }\r\n        \r\n        // 保存上层过来的对应节点\r\n        toNodeData.from.push(pre.status);\r\n        if(!toNodeData.relations.includes(pre.status)){\r\n          toNodeData.relations.push(pre.status);\r\n        }\r\n        toNodeData.row = level; // 此时的层是准确的，在后面向上去重也不会影响，因为会保留最后一个\r\n        // 需要去重，这里是所有到达此节点的路径节点\r\n        toNodeData.route = [...nodeData.route, ...toNodeData.route, next.toState] // 节点自己以及上级的route\r\n        nodesMap.set(next.toState, toNodeData)\r\n        // 再考虑同层去重\r\n        if (!(currentLevel.some((item: any) => item.status === next.toState))) {\r\n          currentLevel.push({ status: next.toState, ...policy[next.toState] })\r\n        }\r\n      })\r\n    })\r\n    if (!currentLevel.length) return\r\n    pyramid[level] = currentLevel\r\n    findNextLevel(level + 1)\r\n  }\r\n  // 第一层已经有了\r\n  pyramid.push([{ status: \"initial\", ...policy.initial }]);\r\n  // 开始找第一层的所有子节点即第二层\r\n  findNextLevel(1);\r\n  let maxWidth = 0\r\n  // 向上去重\r\n  for (let aRow = pyramid.length - 1; aRow > 0; aRow--) {\r\n    const layer = pyramid[aRow];\r\n    maxWidth < layer.length && (maxWidth = layer.length)\r\n    // 选一个a并比较当层和上面所有层的中列大于a的\r\n    layer.forEach((a: any, aColumn: number) => {\r\n      // 同层已经没有重复的了\r\n      for (let bRow = aRow - 1; bRow > -1; bRow--) {\r\n        pyramid[bRow] = pyramid[bRow].filter((b: any, bColumn: number) => b.status !== a.status);\r\n      }\r\n    });\r\n  }\r\n  maxWidth < pyramid[0].length && (maxWidth = pyramid[0].length)\r\n  return { policyPyramid: pyramid, maxWidth }\r\n}\r\n// @ts-ignore\r\nArray.prototype.equals = function (array: any) {\r\n  // if the other array is a falsy value, return\r\n  if (!array) return false;\r\n\r\n  // compare lengths - can save a lot of time\r\n  if (this.length != array.length) return false;\r\n\r\n  for (var i = 0, l = this.length; i < l; i++) {\r\n    // Check if we have nested arrays\r\n    if (this[i] instanceof Array && array[i] instanceof Array) {\r\n      // recurse into the nested arrays\r\n      if (!this[i].equals(array[i])) return false;\r\n    } else if (this[i] != array[i]) {\r\n      // Warning - two different object instances will never be equal: {x:20} != {x:20}\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n};\r\n// Hide method from for-in loops\r\nObject.defineProperty(Array.prototype, \"equals\", { enumerable: false });\r\n/**\r\n *\r\n * @param contents 去重\r\n * @returns\r\n */\r\nfunction norepeat(contents: any) {\r\n  var norepeatContents = [];\r\n  for (var i = 0; i < contents.length; i++) {\r\n    const flag = norepeatContents.some((item: any) => {\r\n      return item.equals(contents[i]);\r\n    });\r\n    if (!flag) {\r\n      norepeatContents.push(contents[i]);\r\n    }\r\n  }\r\n  return norepeatContents;\r\n}\r\n\r\n/**\r\n *\r\n * @param 全排列\r\n */\r\nfunction fullSort(input: any) {\r\n  var permArr: any = [],\r\n    usedChars: any = [];\r\n  function main(input: any) {\r\n    var i, ch;\r\n    for (i = 0; i < input.length; i++) {\r\n      ch = input.splice(i, 1)[0];\r\n      usedChars.push(ch);\r\n      if (input.length == 0) {\r\n        permArr.push(usedChars.slice());\r\n      }\r\n      main(input);\r\n      input.splice(i, 0, ch);\r\n      usedChars.pop();\r\n    }\r\n    return permArr;\r\n  }\r\n  return main(input);\r\n}\r\n\r\n/**\r\n * 找到在第几列\r\n * @param status\r\n * @param pyramid\r\n * @returns\r\n */\r\nfunction getColumn(status: string, pyramid: any) {\r\n  let column = 0;\r\n  pyramid.some((item: any) => {\r\n    return item.some((node: any, index: number) => {\r\n      column = index;\r\n      return node && node.status === status;\r\n    });\r\n  });\r\n  return column;\r\n}\r\n/**\r\n * 计算所有交叉\r\n */\r\nfunction getCrosses(pyramid: any): number {\r\n  let cross = 0;\r\n  // 从最后一层开始\r\n  for (let aRow = pyramid.length - 1; aRow > -1; aRow--) {\r\n    const layer = pyramid[aRow];\r\n    // 选一个a并比较当层和上面所有层的中列大于a的\r\n    layer.forEach((a: any, aColumn: number) => {\r\n      if (!a) return;\r\n      const aNode = nodesMap.get(a.status);\r\n      for (let bRow = aRow; bRow > -1; bRow--) {\r\n        pyramid[bRow].forEach((b: any, bColumn: number) => {\r\n          // a后面的列才判断\r\n          if (bColumn > aColumn && b) {\r\n            const bNode = nodesMap.get(b.status);\r\n            // 此处都是上层  如果存在b的relations中的节点 c 的 column小于a的relations中d的column, 且b的row小于d的row\r\n            // 但是如果是同样的列，会出现重叠，解决方案：1.此处要找出重叠  2.绘图时如果不从同一点画两条线且以折线方式\r\n            // 选用方案2\r\n            bNode?.relations.forEach((c: string) => {\r\n              const cColumn = getColumn(c, pyramid);\r\n              aNode?.relations.forEach((d: string) => {\r\n                const dRow = nodesMap.get(d);\r\n                // @ts-ignore  如果是大于bRow的就是ad与bc无法产生交叉，因为bc的层都在ad上\r\n                if (dRow?.row >= bRow) return;\r\n                const dColumn = getColumn(d, pyramid);\r\n                if (cColumn < dColumn) cross++;\r\n              });\r\n            });\r\n          }\r\n        });\r\n      }\r\n    });\r\n  }\r\n  return cross;\r\n}\r\n\r\n/**\r\n * 1.分层并记录节点信息  getPyramid\r\n * 2.按最大层，排列组合 找出最少交叉\r\n * @param data\r\n */\r\nexport default function getBestTopology(data: any): any {\r\n  nodesMap = new Map<any, Node>();\r\n  // 最少交叉的金字塔\r\n  let bestPyramid: any = null;\r\n\r\n  /**\r\n   * 如果出现多个最少交叉的，先按交叉数保存起来，最后再取出跟bestPyramid交叉数一样的\r\n   * 此对象数组中不包含bestPyramid中的pyramid\r\n   * {\r\n   *   0:[],\r\n   *   1:[],\r\n   * }\r\n   */\r\n  let betterPyramids: any = {};\r\n  // bestPyramid betterPyramids\r\n  const { policyPyramid, maxWidth } = getPyramid(data);\r\n  // console.log(nodesMap, policyPyramid)\r\n  // return\r\n  /**\r\n   * 每一层所有组合方式，与其余层所有组合方式再组合\r\n   */\r\n  // 三维数组\r\n  const allLevel: any = [];\r\n  policyPyramid.forEach((item: any) => {\r\n    const arr = [...item];\r\n    for (var i = item.length; i < maxWidth; i++) {\r\n      arr[i] = null;\r\n    }\r\n    // 每一层没有重复组合的\r\n    allLevel.push(norepeat(fullSort(arr)));\r\n  });\r\n  // console.log('allLevel', allLevel);\r\n  let count = 0\r\n  // 从每一层取一个  深度优先\r\n  function compose(nextLevel: any, index: number, _pyramid: any) {\r\n    nextLevel.forEach((layer: any, i: number) => {\r\n      // 取一个\r\n      const pyramid = [..._pyramid]\r\n      pyramid.push(layer);\r\n      if (index + 1 === allLevel.length) {\r\n        // getCross for this tower      bestPyramid    betterPyramids\r\n        const crosses = getCrosses(pyramid);\r\n        if (!crosses) {\r\n          count++\r\n        }\r\n        if (!bestPyramid || crosses < bestPyramid.crosses) {\r\n          bestPyramid = {\r\n            crosses,\r\n            pyramid,\r\n          };\r\n          betterPyramids = {};\r\n        } else if (crosses === bestPyramid.crosses) {\r\n          const arr = (betterPyramids[crosses] || [])\r\n          arr.push(pyramid);\r\n          betterPyramids[crosses] = arr\r\n        }\r\n        return;\r\n      }\r\n      compose(allLevel[index + 1], index + 1, [...pyramid]);\r\n    });\r\n  }\r\n  // 从第一层开始\r\n  compose(allLevel[0], 0, []);\r\n  // console.log('zero', count)\r\n  const policyMaps = getRouteMaps(data)\r\n  bestPyramid.maxWidth = maxWidth\r\n  return { policyMaps, bestPyramid, betterPyramids, nodesMap };\r\n}\r\n","import { Modal } from \"antd\";\r\nimport { SUCCESS, USER_CANCEL } from \"../../bridge/event\";\r\nimport React, { useState, useEffect } from \"react\";\r\nimport { LOGIN } from \"../../bridge/event\";\r\nimport Button from \"./_components/button\";\r\nimport \"./auth.scss\";\r\nimport Contract from \"./contract/contract\";\r\nimport Policy from \"./policy/policy\";\r\nimport frequest from \"../../services/handler\";\r\nimport presentable from \"../../services/api/modules/presentable\";\r\nimport Confirm from \"./_components/confirm\";\r\nimport Login from \"./login\";\r\nimport { setUserInfo } from \"../../platform/structure/utils\";\r\nimport { loginCallback } from \"../../platform/structure/event\";\r\nimport contract from \"../../services/api/modules/contract\";\r\nimport { getCurrentUser } from \"../../platform/structure/utils\";\r\nimport getBestTopology from \"./topology/data\";\r\n/**\r\n * 展品授权窗口：\r\n *     左：展品列表\r\n *         上：展品名称\r\n *         下：已签约合同：绿色：已授权，黄色：未授权，红色：异常\r\n *     右：合约与策略列表：合约列表在上面，策略在下面\r\n *         合约：上：策略名称\r\n *               中： 上：策略内容：当前状态---->是否授权，当前时间--->状态内容，事件需要可点击\r\n *                    下：合约流转记录：可显示隐藏\r\n *               下：合约编号，签约时间\r\n *         策略：上：整行：名称 复选框（没有合约时，复选框变成签约按钮）\r\n *               中：tab页：策略内容，状态机视图，策略代码\r\n * 组件化：不过分考虑细腻度\r\n *     最外层：\r\n *         待获取授权展品组件\r\n *         合约组件：授权状态组件（全局），按钮组件（全局），流转记录组件（有可能需要放大，所以提出来）\r\n *         策略组件(策略组件需要放大或点击合约的策略内容单独显示)：状态机视图组件，策略内容组件，策略代码组件\r\n *\r\n * 最外面拦截到errCode === 30 时需要跳转登录\r\n *\r\n */\r\n\r\ninterface contractProps {\r\n  events: Array<any>;\r\n  contractFinished(eventId: any, type: number, data?: any): any;\r\n  loginFinished: any;\r\n  children?: any;\r\n  updateEvents: any;\r\n}\r\nexport default function (props: contractProps) {\r\n  /**\r\n   * 对象形式authDatas：\r\n   *   key: subjectId\r\n   *   value: { policies: {policyId: }, contracts: {contractId: }，}\r\n   * 在合约里面通过策略拿翻译\r\n   * 流程：\r\n   *     未授权过来需要整合数据\r\n  *       widget: caller.name,\r\n          errCode: response.data.errCode,\r\n          authCode: response.data.data.authCode,\r\n          contracts: response.data.data.data.contracts,\r\n          policies: response.data.data.data.policies,\r\n          presentableName,\r\n          presentableId,\r\n          info: response.data,\r\n   *     点击展品：\r\n   *         1.如果有合约则请求合约\r\n   *         2.请求策略\r\n   *     签约：\r\n   *         签约后判断有无授权：\r\n   *             1.授权：直接清除events\r\n   *             2.未授权：更新events对应的数据\r\n   *     执行事件：\r\n   *             \r\n   */\r\n  const [isModalVisible, setIsModalVisible] = useState(false);\r\n  const [isLoginVisible, setIsLoginVisible] = useState(false);\r\n\r\n  const [contracts, setContracts] = useState([]);\r\n  const events = props.events || [];\r\n  const [currentPresentable, setCurrentPresentable] = useState(events[0]);\r\n  const [policies, setPolicies] = useState([]);\r\n  const [selectedPolicies, setSelectedPolicies] = useState<Array<any>>([]);\r\n  function paymentFinish() {\r\n    getDetail();\r\n  }\r\n  function loginFinished(type: number, data?: any) {\r\n    setUserInfo(data);\r\n    loginCallback.forEach((func: any) => {\r\n      func && func();\r\n    });\r\n    // TODO 重载插件需要把授权的也一并清除\r\n    setIsLoginVisible(false);\r\n\r\n    props.loginFinished()\r\n  }\r\n  function showPolicy() {}\r\n  async function getDetail(id?: string) {\r\n    setSelectedPolicies([]);\r\n    // userInfo 如果不存在就是未登录\r\n    const userInfo: any = getCurrentUser();\r\n    const con =\r\n      userInfo &&\r\n      (await frequest(contract.getContracts, \"\", {\r\n        subjectIds: currentPresentable.presentableId,\r\n        subjectType: 2,\r\n        licenseeIdentityType: 3,\r\n        licenseeId: userInfo.userId,\r\n        isLoadPolicyInfo: 1,\r\n        isTranslate: 1,\r\n      }));\r\n    if (!id) {\r\n      const isAuth = con.data.data.some((item: any) => {\r\n        if ((window.isTest && item.authStatus === 2) || item.authStatus === 1) {\r\n          props.contractFinished(currentPresentable.eventId, SUCCESS);\r\n          return true;\r\n        }\r\n      });\r\n      if (!isAuth) {\r\n        props.updateEvents({ ...currentPresentable, contracts: con.data.data });\r\n      }\r\n      return;\r\n    }\r\n    const res = await frequest(\r\n      presentable.getPresentableDetail,\r\n      [id || currentPresentable.presentableId],\r\n      {\r\n        isLoadPolicyInfo: 1,\r\n        isTranslate: 1,\r\n      }\r\n    );\r\n    /**\r\n     * 获取\r\n     */\r\n\r\n    res.data.data.policies = res.data.data.policies.filter((i: any) => {\r\n      return i.status === 1;\r\n    });\r\n    res.data.data.policies.forEach((item: any) => {\r\n      const { policyMaps, bestPyramid, betterPyramids, nodesMap } =\r\n        getBestTopology(item.fsmDescriptionInfo);\r\n      item.policyMaps = policyMaps;\r\n      item.bestPyramid = bestPyramid;\r\n      item.betterPyramids = betterPyramids;\r\n      item.nodesMap = nodesMap;\r\n    });\r\n    setPolicies(res.data.data.policies);\r\n    if (con) {\r\n      const contracts = con.data.data.filter((item: any) => {\r\n        if (item.status === 0) {\r\n          res.data.data.policies.some((i: any) => {\r\n            if (item.policyId === i.policyId) {\r\n              item.policyInfo = i;\r\n              i.contracted = true;\r\n              return true;\r\n            }\r\n          });\r\n          return true;\r\n        }\r\n      });\r\n      setContracts(contracts);\r\n    }\r\n  }\r\n  useEffect(() => {\r\n    const isExist = events.some((item: any) => {\r\n      if (item.presentableId === currentPresentable.presentableId) {\r\n        setCurrentPresentable(item);\r\n        return true;\r\n      }\r\n    });\r\n    !isExist && setCurrentPresentable(events[0]);\r\n  }, [props.events]);\r\n  useEffect(() => {\r\n    currentPresentable && getDetail(currentPresentable.presentableId);\r\n  }, [currentPresentable]);\r\n\r\n  const userCancel = () => {\r\n    props.contractFinished(\"\", USER_CANCEL);\r\n  };\r\n  function policySelect(policyId: number, checked?: boolean, single?:boolean) {\r\n    if (policyId) {\r\n      if(checked){\r\n        if(single){\r\n          setSelectedPolicies([policyId]);\r\n        }else{\r\n          setSelectedPolicies([...selectedPolicies, policyId]);\r\n        }\r\n      }else{\r\n        setSelectedPolicies([...selectedPolicies].filter((item:any)=> item !== policyId))\r\n      }\r\n    } else {\r\n      setSelectedPolicies([]);\r\n    }\r\n  }\r\n  function act() {\r\n    if (!getCurrentUser()) {\r\n      setIsLoginVisible(true);\r\n      return;\r\n    }\r\n    setIsModalVisible(true);\r\n  }\r\n  const getAuth = async () => {\r\n    const subjects: any = [];\r\n    policies.forEach((item: any) => {\r\n      selectedPolicies.includes(item.policyId) &&\r\n        subjects.push({\r\n          subjectId: currentPresentable.presentableId,\r\n          policyId: item.policyId,\r\n        });\r\n    });\r\n    const userInfo: any = getCurrentUser();\r\n    const res = await frequest(contract.contracts, [], {\r\n      subjects,\r\n      subjectType: 2,\r\n      licenseeId: userInfo.userId + \"\",\r\n      licenseeIdentityType: 3,\r\n      isWaitInitial: 1,\r\n    });\r\n    if (res.data.isAuth) {\r\n      // `付款到${seller}${amount}块钱就可以达到${status}状态`\r\n    }\r\n    setIsModalVisible(false);\r\n    const isAuth = res.data.data.some((item: any) => {\r\n      if ((window.isTest && item.authStatus === 2) || item.authStatus === 1) {\r\n        const modal = Modal.success({\r\n          title: '提示',\r\n          content: '获得授权',\r\n          zIndex: 9999\r\n        });\r\n        setTimeout(() => {\r\n          modal.destroy();\r\n          props.contractFinished(currentPresentable.eventId, SUCCESS);\r\n        }, 2000);\r\n        \r\n        return true;\r\n      }\r\n    });\r\n    if (!isAuth) {\r\n      const modal = Modal.success({\r\n        title: '提示',\r\n        content: '签约成功',\r\n        zIndex: 9999\r\n      });\r\n      setTimeout(() => {\r\n        modal.destroy();\r\n        props.updateEvents({ ...currentPresentable, contracts: res.data.data });\r\n      }, 2000);\r\n      \r\n    }\r\n  };\r\n  return (\r\n    <div className=\"runtime-pc\" id=\"runtime-pc\">\r\n      {isModalVisible && (\r\n        <Confirm\r\n          setIsModalVisible={setIsModalVisible}\r\n          isModalVisible={isModalVisible}\r\n          getAuth={getAuth}\r\n          policies={policies}\r\n          currentPresentable={currentPresentable}\r\n        />\r\n      )}\r\n      {isLoginVisible && (\r\n        <Login\r\n        loginFinished={loginFinished}\r\n          setIsLoginVisible={setIsLoginVisible}\r\n        ></Login>\r\n      )}\r\n\r\n      <Modal\r\n        title=\"展品授权\"\r\n        zIndex={1200}\r\n        centered\r\n        footer={null}\r\n        visible={true}\r\n        width={860}\r\n        onCancel={userCancel}\r\n        className=\"h-600\"\r\n        keyboard={false}\r\n        maskClosable={false}\r\n        wrapClassName=\"freelog-contract\"\r\n        getContainer={document.getElementById(\"runtime-pc\")}\r\n      >\r\n        <div className=\"w-100x h-574 flex-column\">\r\n          {/* 左右 */}\r\n          <div className=\"w-100x flex-1 flex-row over-h\">\r\n            <div className=\"w-100x h-100x  flex-row\">\r\n              {/* 左：待授权展品列表 */}\r\n              <div className=\"flex-column w-344 h-100x  y-auto\">\r\n                {events.length\r\n                  ? events.map((item: any, index: number) => {\r\n                      if (item.event === LOGIN) return null;\r\n                      return (\r\n                        <div\r\n                          key={index}\r\n                          onClick={() => {\r\n                            setCurrentPresentable(item);\r\n                          }}\r\n                          className={\r\n                            (currentPresentable === item\r\n                              ? \"presentable-selected \"\r\n                              : \"\") +\r\n                            \" px-20 py-15 w-100x b-box x-auto  cur-pointer presentable-item select-none flex-column\"\r\n                          }\r\n                        >\r\n                          <div\r\n                            className=\"presentable-name w-100x text-ellipsis flex-1 flex-row align-center\"\r\n                            title={item.presentableName}\r\n                          >\r\n                            <span>{item.presentableName}</span>\r\n                          </div>\r\n                          {!item.contracts.length ? null : (\r\n                            <div className=\"flex-row pt-10\">\r\n                              {item.contracts.map(\r\n                                (contract: any, index: number) => {\r\n                                  return (\r\n                                    <div\r\n                                      className={\r\n                                        \"contract-tag flex-row align-center mr-5\"\r\n                                      }\r\n                                      key={index}\r\n                                    >\r\n                                      <div className=\"contract-name\">\r\n                                        {contract.contractName}\r\n                                      </div>\r\n                                      <div\r\n                                        className={\r\n                                          \"contract-dot ml-6 \" +\r\n                                          (contract.authStatus === 128\r\n                                            ? \"bg-auth-none\"\r\n                                            : !window.isTest &&\r\n                                              contract.authStatus === 1\r\n                                            ? \"bg-auth\"\r\n                                            : \"bg-auth-none\")\r\n                                        }\r\n                                      ></div>\r\n                                    </div>\r\n                                  );\r\n                                }\r\n                              )}\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      );\r\n                    })\r\n                  : null}\r\n                {/* <Presentables></Presentables> */}\r\n              </div>\r\n              {/* 右：策略或合约列表 */}\r\n              <div className=\"w-516 bg-content h-100x   y-auto px-20 pb-20\">\r\n                {contracts.length && policies.length - contracts.length ? (\r\n                  <div className=\"policy-tip flex-row align-center mt-15 px-10\">\r\n                    <div className=\"tip\">最下方有可签约的策略</div>\r\n                  </div>\r\n                ) : null}\r\n                {contracts.map((contract: any, index: number) => {\r\n                  return (\r\n                    <Contract\r\n                      policy={contract.policyInfo}\r\n                      contract={contract}\r\n                      paymentFinish={paymentFinish}\r\n                      key={index}\r\n                    ></Contract>\r\n                  );\r\n                })}\r\n                {policies.map((policy: any, index: number) => {\r\n                  return policy.contracted ? null : (\r\n                    <Policy\r\n                      policy={policy}\r\n                      key={index}\r\n                      seq={index}\r\n                      getAuth={getAuth}\r\n                      policySelect={policySelect}\r\n                      selectType={contracts.length ? true : false}\r\n                    ></Policy>\r\n                  );\r\n                })}\r\n              </div>\r\n            </div>\r\n          </div>\r\n          {contracts.length ? (\r\n            \"\"\r\n          ) : (\r\n            <div className=\"h-74 w-100x text-center\">\r\n              <Button\r\n                disabled={selectedPolicies.length === 0 && getCurrentUser()}\r\n                click={act}\r\n                className=\"w-300 h-38 fs-14 text-center\"\r\n              >\r\n                {getCurrentUser() ? \"立即签约\" : \"请登录\"}\r\n              </Button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </Modal>\r\n    </div>\r\n  );\r\n}\r\n","import user from \"../../../services/api/modules/user\";\r\nimport frequest from \"../../../services/handler\";\r\nimport { SUCCESS } from \"../../../bridge/event\";\r\nimport { Tabs, Badge, Modal, Button, Toast } from \"antd-mobile\";\r\n\r\nimport { useState } from \"react\";\r\nimport \"./login.scss\";\r\n\r\n \r\n\r\ninterface loginProps {\r\n  loginFinished: any;\r\n  visible: boolean;\r\n  setModalType: any;\r\n  children?: any;\r\n}\r\nexport default function (props: loginProps) {\r\n  const [errorTip, setErrorTip] = useState<any>({\r\n    loginName: \"\",\r\n    password: \"\",\r\n  });\r\n  const [logging, setLogging] = useState(false);\r\n  const [loginName, setLoginName] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const onFinish = async () => {\r\n    setLogging(true);\r\n    const values: any = {\r\n      loginName,\r\n      password,\r\n    };\r\n    // loginName: \"string\",\r\n    //   password: \"string\",\r\n    //   isRemember: \"string\",\r\n    //   returnUrl: \"string\",\r\n    //   jwtType: \"string\",\r\n    values.isRemember = values.isRemember ? 1 : 0;\r\n    const res = await frequest(user.login, \"\", values);\r\n    if (res.data.errCode === 0) {\r\n      setLogging(false);\r\n      props.loginFinished(SUCCESS, res.data.data);\r\n    } else {\r\n      Toast.fail(res.data.msg, 2);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      popup\r\n      visible={props.visible}\r\n      maskClosable={false}\r\n      animationType=\"slide\"\r\n      className=\"w-100x h-100x\"\r\n      wrapClassName=\"user-login\"\r\n    >\r\n      <div className=\"w-100x h-100x flex-column align-center\">\r\n        <div className=\"flex-1 w-100x flex-column align-center\">\r\n          <i className=\"iconfont  mt-50 mb-20 logo\">&#xe614;</i>\r\n\r\n          <div className=\"login-title mb-46 flex-row justify-center\">\r\n            免费专业的资源发行和运营平台\r\n          </div>\r\n          <div className=\"login-container flex-column justify-center\">\r\n            <input\r\n              type=\"text\"\r\n              value={loginName}\r\n              placeholder=\"用户名/手机号/邮箱\"\r\n              onChange={(e) => {\r\n                setLoginName(e.target.value);\r\n              }}\r\n            />\r\n            <input\r\n              type=\"password\"\r\n              value={password}\r\n              placeholder=\"密码\"\r\n              onChange={(e) => {\r\n                setPassword(e.target.value);\r\n              }}\r\n            />\r\n            <Button\r\n              loading={logging}\r\n              type=\"primary\"\r\n              className=\"mb-15\"\r\n              onClick={onFinish}\r\n              disabled={!loginName || !password}\r\n            >\r\n              {logging ? \"登陆中\" : \"登 录\"}\r\n            </Button>\r\n            <Button className=\"registry\" onClick={() => props.setModalType(2)}>\r\n              注 册\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        <div\r\n          className=\"text-center login-forgot mb-50\"\r\n          \r\n        >\r\n          <Button type=\"ghost\" inline size=\"small\" onClick={() => props.setModalType(3)}>\r\n          忘记密码\r\n          </Button>\r\n          \r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n}\r\n","import user from \"../../../services/api/modules/user\";\r\nimport frequest from \"../../../services/handler\";\r\nimport { SUCCESS } from \"../../../bridge/event\";\r\nimport { Tabs, Badge, Modal, Button, Toast } from \"antd-mobile\";\r\n\r\nimport { useState } from \"react\";\r\nimport \"./forgot.scss\";\r\n\r\n \r\n\r\ninterface loginProps {\r\n  visible: boolean;\r\n  setModalType: any;\r\n  children?: any;\r\n}\r\nexport default function (props: loginProps) {\r\n  const [errorTip, setErrorTip] = useState<any>({\r\n    loginName: \"\",\r\n    password: \"\",\r\n  });\r\n  const [logging, setLogging] = useState(false);\r\n  const [loginName, setLoginName] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const onFinish = async () => {\r\n    setLogging(true);\r\n    const values: any = {\r\n      loginName,\r\n      password,\r\n    };\r\n    // loginName: \"string\",\r\n    //   password: \"string\",\r\n    //   isRemember: \"string\",\r\n    //   returnUrl: \"string\",\r\n    //   jwtType: \"string\",\r\n    values.isRemember = values.isRemember ? 1 : 0;\r\n    const res = await frequest(user.login, \"\", values);\r\n    if (res.data.errCode === 0) {\r\n      setLogging(false);\r\n    } else {\r\n      Toast.fail(res.data.msg, 2);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      popup\r\n      visible={props.visible}\r\n      maskClosable={false}\r\n      animationType=\"slide\"\r\n      className=\"w-100x h-100x\"\r\n      wrapClassName=\"user-forgot\"\r\n    >\r\n      <div className=\"w-100x h-100x flex-column align-center\">\r\n        <div className=\"flex-1 w-100x flex-column align-center\">\r\n          <i className=\"iconfont  mt-50 mb-20 logo\">&#xe614;</i>\r\n\r\n          <div className=\"login-title mb-46 flex-row justify-center\">\r\n            忘记密码\r\n          </div>\r\n          <div className=\"login-container flex-column justify-center\">\r\n            <input\r\n              type=\"text\"\r\n              value={loginName}\r\n              placeholder=\"用户名/手机号/邮箱\"\r\n              onChange={(e) => {\r\n                setLoginName(e.target.value);\r\n              }}\r\n            />\r\n            <input\r\n              type=\"password\"\r\n              value={password}\r\n              placeholder=\"密码\"\r\n              onChange={(e) => {\r\n                setPassword(e.target.value);\r\n              }}\r\n            />\r\n            <Button\r\n              loading={logging}\r\n              type=\"primary\"\r\n              className=\"mb-15\"\r\n              onClick={onFinish}\r\n              disabled={!loginName || !password}\r\n            >\r\n              {logging? '登陆中' : '登 录'}\r\n            </Button>\r\n            <Button className=\"registry\">注 册</Button>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"text-center login-forgot mb-50\">忘记密码</div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n}\r\n","import user from \"../../../services/api/modules/user\";\r\nimport frequest from \"../../../services/handler\";\r\nimport {\r\n  checkPhone,\r\n  checkEmail,\r\n  checkPassword,\r\n  checkUsername,\r\n} from \"../../../utils/utils\";\r\nimport { Tabs, Badge, Modal, Button, Toast } from \"antd-mobile\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport \"./register.scss\";\r\n\r\ninterface loginProps {\r\n  visible: boolean;\r\n  setModalType: any;\r\n  children?: any;\r\n}\r\nexport default function (props: loginProps) {\r\n  const [errorTip, setErrorTip] = useState<any>({\r\n    username: \"\",\r\n    loginName: \"\",\r\n    phone: \"\",\r\n    email: \"\",\r\n    password: \"\",\r\n    authCode: \"\",\r\n  });\r\n  const [success, setSuccess] = useState(false);\r\n  const [loading, setLoading] = useState(false);\r\n  const [available, setAvailable] = useState(false);\r\n  const [countDown, setCountDown] = useState(60);\r\n  const [authCode, setAuthCode] = useState(\"\");\r\n  const [authCodeLoading, setAuthCodeLoading] = useState(false);\r\n  const [username, setUsername] = useState(\"\");\r\n  // loginName: phone | email\r\n  const [phone, setPhone] = useState(\"\");\r\n  const [email, setEmail] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  // 1 phone    2 email\r\n  const [registerType, setRegisterType] = useState(1);\r\n  const verify = (type: any, value: any) => {\r\n    value = value ? value : \"\";\r\n    const obj: any = {\r\n      [type]: \"\",\r\n    };\r\n    if (type === \"username\" && !checkUsername(value)) {\r\n      obj[type] = value\r\n        ? \"不超过30个字符；只能使用小写字母、数字或短横线（-）；必须以小写字母或数字开头和结尾。\"\r\n        : \"请输入用户名\";\r\n    }\r\n    if (type === \"phone\" && !checkPhone(value)) {\r\n      obj[type] = value ? \"手机号格式不正确\" : \"请输入手机号\";\r\n    }\r\n    if (type === \"email\" && !checkEmail(value)) {\r\n      obj[type] = value ? \"无效邮箱地址\" : \"请输入邮箱地址\";\r\n    }\r\n    if (type === \"password\" && !checkPassword(value)) {\r\n      obj[type] = value\r\n        ? \"密码长度必须为6-24个字符，必须包含数字和字母\"\r\n        : \"请输入密码\";\r\n    }\r\n    if (type === \"authCode\") {\r\n      obj[type] = value ? \"\" : \"请输入验证码\";\r\n    }\r\n    const errors = {\r\n      ...errorTip,\r\n      ...obj,\r\n    };\r\n    setErrorTip(errors);\r\n    const values = {\r\n      username,\r\n      password,\r\n      authCode,\r\n      [type]: value,\r\n      loginName: registerType === 1 ? phone : email,\r\n    };\r\n    const flag1 = Object.keys(errors).some((key: any) => {\r\n      if (errors[key]) {\r\n        return true;\r\n      }\r\n    });\r\n    const flag2 = Object.keys(values).some((key: any) => {\r\n      if (!values[key]) {\r\n        return true;\r\n      }\r\n    });\r\n    setAvailable(!(flag1 || flag2));\r\n  };\r\n  useEffect(() => {\r\n    if (!authCodeLoading) return;\r\n    const timer = window.setInterval(() => {\r\n      if (countDown <= 0) {\r\n        window.clearInterval(timer);\r\n        setAuthCodeLoading(false);\r\n        setCountDown(60);\r\n        return;\r\n      }\r\n      setCountDown((prevTime) => {\r\n        if (prevTime <= 0) {\r\n          window.clearInterval(timer);\r\n          setAuthCodeLoading(false);\r\n          return 60;\r\n        }\r\n        return prevTime - 1;\r\n      }); // <-- Change this line!\r\n    }, 1000);\r\n    return () => {\r\n      window.clearInterval(timer);\r\n    };\r\n  }, [authCodeLoading]);\r\n  const getAuthCode = async () => {\r\n    // {\r\n    //     \"loginName\":\"18923803593\",\r\n    //     \"authCodeType\":\"register\"\r\n    // }\r\n    const authCodeRes = await frequest(user.getAuthCode, \"\", {\r\n      loginName: registerType === 1 ? phone : email,\r\n      authCodeType: \"register\",\r\n    });\r\n    if (authCodeRes.errCode !== 0) {\r\n      const obj: any = {};\r\n      obj[registerType === 1 ? \"phone\" : \"email\"] = authCodeRes.data.msg;\r\n\r\n      setErrorTip({\r\n        ...errorTip,\r\n        ...obj,\r\n      });\r\n    }\r\n  };\r\n  const onFinish = async () => {\r\n    setLoading(true);\r\n    const values: any = {\r\n      loginName: registerType === 1 ? phone : email,\r\n      username,\r\n      password,\r\n      authCode,\r\n    };\r\n    //   username: \"string\",\r\n    //   password: \"string\",\r\n    //   isRemember: \"string\",\r\n    //   returnUrl: \"string\",\r\n    //   jwtType: \"string\",\r\n    const res = await frequest(user.postRegister, \"\", values);\r\n    if (res.data.errCode === 0) {\r\n      setSuccess(true);\r\n      setLoading(false);\r\n    } else {\r\n      Toast.fail(res.data.msg, 2);\r\n      if (res.data.msg.startWith(\"验证码\")) {\r\n        const obj: any = { authCode: res.data.msg };\r\n        setErrorTip({\r\n          ...errorTip,\r\n          ...obj,\r\n        });\r\n      }\r\n      setTimeout(() => setLoading(false), 2000);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      popup\r\n      visible={props.visible}\r\n      maskClosable={false}\r\n      animationType=\"slide\"\r\n      className=\"w-100x h-100x\"\r\n      wrapClassName=\"user-register\"\r\n    >\r\n      <div className=\"w-100x h-100x flex-column align-center\">\r\n        <div className=\"flex-1 w-100x flex-column align-center\">\r\n          <div className=\"register-title mb-38 mt-45 flex-row px-30 self-start\">\r\n            注册\r\n          </div>\r\n          <div className=\"register-type mb-30  flex-row px-30 self-start align-center\">\r\n            <input\r\n              type=\"radio\"\r\n              id=\"phone-type\"\r\n              name=\"register-type\"\r\n              className=\"mr-4\"\r\n              checked={registerType === 1}\r\n              value=\"1\"\r\n              onChange={(e) => {\r\n                setRegisterType(parseInt(e.target.value));\r\n              }}\r\n            />{\" \"}\r\n            <label\r\n              htmlFor=\"phone-type\"\r\n              className={registerType === 1 ? \"selected mr-20\" : \" mr-20\"}\r\n            >\r\n              手机号注册\r\n            </label>\r\n            <input\r\n              type=\"radio\"\r\n              id=\"mail-type\"\r\n              name=\"register-type\"\r\n              className=\"mr-4\"\r\n              checked={registerType === 2}\r\n              onChange={(e) => {\r\n                setRegisterType(parseInt(e.target.value));\r\n              }}\r\n              value=\"2\"\r\n            />{\" \"}\r\n            <label\r\n              htmlFor=\"mail-type\"\r\n              className={registerType === 2 ? \"selected\" : \"\"}\r\n            >\r\n              邮箱注册\r\n            </label>\r\n          </div>\r\n          <div className=\"register-container flex-column justify-center px-30\">\r\n            <input\r\n              type=\"text\"\r\n              className=\"w-100x mb-5\"\r\n              value={username}\r\n              placeholder=\"用户名\"\r\n              onChange={(e) => {\r\n                verify(\"username\", e.target.value);\r\n                setUsername(e.target.value);\r\n              }}\r\n            />\r\n            {errorTip.username !== \"\" ? (\r\n              <div className=\"error-tip self-start\">{errorTip.username}</div>\r\n            ) : null}\r\n            {registerType === 1 ? (\r\n              <input\r\n                type=\"text\"\r\n                value={phone}\r\n                className=\"w-100x  mb-5 mt-15\"\r\n                placeholder={\"手机号\"}\r\n                onChange={(e) => {\r\n                  verify(\"phone\", e.target.value);\r\n                  setPhone(e.target.value);\r\n                }}\r\n              />\r\n            ) : (\r\n              <input\r\n                type=\"text\"\r\n                value={email}\r\n                className=\"w-100x  mb-5 mt-15\"\r\n                placeholder={\"邮箱地址\"}\r\n                onChange={(e) => {\r\n                  verify(\"email\", e.target.value);\r\n                  setEmail(e.target.value);\r\n                }}\r\n              />\r\n            )}\r\n            {errorTip[registerType === 1 ? \"phone\" : \"email\"] !== \"\" ? (\r\n              <div className=\"error-tip self-start\">\r\n                {errorTip[registerType === 1 ? \"phone\" : \"email\"]}\r\n              </div>\r\n            ) : null}\r\n            <div className=\"flex-row mb-5 mt-15\">\r\n              <input\r\n                type=\"text\"\r\n                value={authCode}\r\n                className=\"mr-10\"\r\n                placeholder=\"验证码\"\r\n                onChange={(e) => {\r\n                  verify(\"authCode\", e.target.value);\r\n                  setAuthCode(e.target.value);\r\n                }}\r\n              />\r\n              <Button\r\n                loading={loading}\r\n                type=\"primary\"\r\n                className=\"flex-1 shrink-0 fs-16\"\r\n                disabled={\r\n                  authCodeLoading ||\r\n                  (registerType === 1\r\n                    ? !phone || errorTip.phone\r\n                    : !email || errorTip.email)\r\n                }\r\n                onClick={() => {\r\n                  getAuthCode();\r\n                  setAuthCodeLoading(true);\r\n                  setCountDown(60);\r\n                }}\r\n              >\r\n                {authCodeLoading ? (\r\n                  <span>获取验证码 {countDown}s</span>\r\n                ) : (\r\n                  \"获取验证码\"\r\n                )}\r\n              </Button>\r\n            </div>\r\n            <input\r\n              type=\"password\"\r\n              value={password}\r\n              className=\"w-100x  mt-15 mb-5\"\r\n              placeholder=\"密码\"\r\n              onChange={(e) => {\r\n                verify(\"password\", e.target.value);\r\n                setPassword(e.target.value);\r\n              }}\r\n            />\r\n            {errorTip.password !== \"\" ? (\r\n              <div className=\"error-tip  self-start\">{errorTip.password}</div>\r\n            ) : null}\r\n            <Button\r\n              loading={loading}\r\n              type=\"primary\"\r\n              className=\"mt-15\"\r\n              onClick={onFinish}\r\n              disabled={!available}\r\n            >\r\n              {loading ? \"注册中\" : \"注 册\"}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"flex-row justify-center align-center register-bottom mb-50\">\r\n          已有账号？\r\n          <Button\r\n            type=\"ghost\"\r\n            inline\r\n            size=\"small\"\r\n            onClick={() => props.setModalType(1)}\r\n          >\r\n            马上登陆\r\n          </Button>\r\n        </div>\r\n      </div>\r\n      <Modal\r\n        visible={loading}\r\n        transparent\r\n        maskClosable={false}\r\n        title=\"\"\r\n        className=\"w-325 h-220 register-tip\"\r\n      >\r\n        <div className=\"paying bg-white\">\r\n          <Button loading className=\"loading\">\r\n            注册中\r\n          </Button>\r\n        </div>\r\n      </Modal>\r\n      <Modal\r\n        popup\r\n        visible={success}\r\n        maskClosable={false}\r\n        animationType=\"slide\"\r\n        className=\"w-100x h-100x\"\r\n        wrapClassName=\"register-success\"\r\n      >\r\n        <div className=\"w-100x h-100 flex-column justify-center\">\r\n          <div className=\"flex-column align-center \">\r\n            <i className=\"iconfont \">&#xe62d;</i>\r\n            <span className=\" success mb-60 mt-4\">注册成功</span>\r\n            <div className=\"flex-row justify-center align-center\">\r\n              <span className=\"count-back\">3s后返回登陆页；</span>\r\n              <Button\r\n                type=\"ghost\"\r\n                inline\r\n                size=\"small\"\r\n                onClick={() => {\r\n                  setSuccess(false);\r\n                  props.setModalType(1);\r\n                }}\r\n              >\r\n                立即登陆\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </Modal>\r\n    </Modal>\r\n  );\r\n}\r\n","import { Input, Spin } from \"antd\";\r\nimport { useState, useEffect, useRef } from \"react\";\r\nimport frequest from \"../../../services/handler\";\r\nimport user from \"../../../services/api/modules/user\";\r\nimport event from \"../../../services/api/modules/event\";\r\nimport transaction from \"../../../services/api/modules/transaction\";\r\nimport { Modal, List, Button, WhiteSpace, Toast } from \"antd-mobile\";\r\nimport \"./pay.scss\";\r\nimport { getUserInfo } from \"../../../platform/structure/utils\";\r\nconst prompt = Modal.prompt;\r\n\r\ninterface PayProps {\r\n  isModalVisible: boolean;\r\n  setIsModalVisible: any;\r\n  contractId: string;\r\n  subjectName: string;\r\n  receiver: string;\r\n  contractName: string;\r\n  transactionAmount?: number;\r\n  eventId: any;\r\n  paymentFinish: any;\r\n}\r\n\r\nexport default function (props: PayProps) {\r\n  const [focus, setFocus] = useState(0);\r\n  const [loading, setLoading] = useState(false);\r\n  const [inputVisible, setInputVisible] = useState(false);\r\n  // 1: 支付中  2: 支付成功  3: 密码错误   4: 支付失败：需要考虑网络超时\r\n  const [tipType, setTipType] = useState(0);\r\n  const [tip, setTip] = useState(false);\r\n  const [passwords, setPasswords] = useState<any>([\"\", \"\", \"\", \"\", \"\", \"\"]);\r\n  const [userAccount, setUserAccount] = useState<any>({});\r\n  const input1 = useRef(null);\r\n  const input2 = useRef(null);\r\n  const input3 = useRef(null);\r\n  const input4 = useRef(null);\r\n  const input5 = useRef(null);\r\n  const input0 = useRef(null);\r\n  const inputs = [input0, input1, input2, input3, input4, input5];\r\n  const handleOk = () => {\r\n    props.setIsModalVisible(false);\r\n  };\r\n  useEffect(() => {\r\n    if (inputVisible) {\r\n      // @ts-ignore\r\n      input0.current.focus();\r\n      setPasswords([\"\", \"\", \"\", \"\", \"\", \"\"]);\r\n    }\r\n  }, [inputVisible]);\r\n  const handleCancel = () => {\r\n    props.setIsModalVisible(false);\r\n  };\r\n  async function getAccount() {\r\n    // @ts-ignore\r\n    const userInfo = await getUserInfo();\r\n    // @ts-ignore\r\n    const res = await frequest(user.getAccount, [userInfo.userId], \"\");\r\n    setUserAccount(res.data.data);\r\n  }\r\n  useEffect(() => {\r\n    props.isModalVisible && getAccount();\r\n  }, [props.isModalVisible]);\r\n  const pay = async function (password: any) {\r\n    // TODO 防止多次点击\r\n    if (loading) return;\r\n    setTipType(1);\r\n    setLoading(true);\r\n    const payResult = await frequest(event.pay, [props.contractId], {\r\n      eventId: props.eventId,\r\n      accountId: userAccount.accountId,\r\n      transactionAmount: props.transactionAmount,\r\n      password: password,\r\n    });\r\n    // 这里考虑支付超时\r\n    if (payResult.data.errCode !== 0) {\r\n      Toast.fail(payResult.data.msg, 2);\r\n      setTimeout(() => {\r\n        setLoading(false);\r\n        // @ts-ignore\r\n        input5.current.focus();\r\n      }, 2000);\r\n      return;\r\n    }\r\n    console.log(payResult);\r\n    setTipType(2);\r\n    // Toast.success(payResult.data.msg, 2);\r\n    // TODO 查交易状态, flag应该设为状态，在关闭弹窗时清除\r\n    const flag = setInterval(async () => {\r\n      const res: any = await frequest(\r\n        transaction.getRecord,\r\n        [payResult.data.data.transactionRecordId],\r\n        \"\"\r\n      );\r\n      const status = res.data.data.status;\r\n      console.log(res);\r\n      if ([2, 3, 4].includes(status)) {\r\n        setInputVisible(false);\r\n        setLoading(false);\r\n        window.clearInterval(flag);\r\n        props.paymentFinish(status);\r\n      }\r\n    }, 2000);\r\n  };\r\n  return (\r\n    <Modal\r\n      popup\r\n      visible={props.isModalVisible}\r\n      maskClosable={false}\r\n      onClose={handleCancel}\r\n      animationType=\"slide-up\"\r\n      wrapClassName=\"freelog-pay\"\r\n    >\r\n      <div className=\"flex-column px-30\">\r\n        {/* 金额 */}\r\n        <div className=\" mb-10 flex-row space-between\">\r\n          <span className=\"amount mt-30\">\r\n            {props.transactionAmount}\r\n            <span className=\"type ml-10\">羽币</span>\r\n          </span>\r\n          <span\r\n            className=\"fs-28 mt-10\"\r\n            onClick={() => {\r\n              props.setIsModalVisible(false);\r\n            }}\r\n          >\r\n            <i className=\"iconfont\">&#xe637;</i>\r\n          </span>\r\n        </div>\r\n        <div className=\"flex-column over-h\">\r\n          <div className=\"title-item\">标的物</div>\r\n          <div className=\"content-item text-ellipsis\">{props.subjectName}</div>\r\n\r\n          <div className=\"title-item\">授权合约</div>\r\n          <div className=\"content-item text-ellipsis\">{props.contractName}</div>\r\n\r\n          <div className=\"title-item\">收款方</div>\r\n          <div className=\"content-item text-ellipsis\">{props.receiver}</div>\r\n\r\n          <div className=\"title-item\">支付方式</div>\r\n          <div className=\"content-item\">\r\n            <span className=\"\">羽币账户</span>\r\n            <span className=\"balance\">（余额{userAccount.balance}枚）</span>\r\n          </div>\r\n        </div>\r\n        {/* <div className=\"forgot-p text-align-right px-80 mt-18 cur-pointer\">\r\n          忘记密码\r\n        </div> */}\r\n        {/* <div className=\"px-80 pt-5\">\r\n          <Input.Password\r\n            size=\"large\"\r\n            onChange={(e) => {\r\n              setPassword(e.target.value);\r\n            }}\r\n            maxLength={6}\r\n            value={password}\r\n            placeholder=\"输入6位支付密码\"\r\n          />\r\n        </div> */}\r\n        <Modal\r\n          visible={loading && tipType > 0}\r\n          transparent\r\n          maskClosable={false}\r\n          title=\"\"\r\n          className=\"w-325 h-220 pay-tip\"\r\n        >\r\n          {tipType === 1 ? (\r\n            <div className=\"paying bg-white\">\r\n              <Button loading className=\"loading\">\r\n                支付中\r\n              </Button>\r\n            </div>\r\n          ) : (\r\n            <div className=\"paying w-100x h-100x flex-column justify-center\">\r\n              <div className=\"pb-15 success flex-row align-center justify-center\">\r\n                <i className=\"iconfont mr-10\">&#xe62d;</i>\r\n                <span className=\"mr-10\">支付成功</span>\r\n              </div>\r\n              <Button loading className=\"loading  pt-15 proccessing\">\r\n                系统处理中请稍后...\r\n              </Button>\r\n            </div>\r\n          )}\r\n        </Modal>\r\n        <Modal\r\n          visible={inputVisible}\r\n          transparent\r\n          maskClosable={false}\r\n          title=\"输入支付密码\"\r\n          className=\"w-325  input-password\"\r\n        >\r\n          <div\r\n            className=\"p-absolute  rt-0 pr-24 pt-20\"\r\n            onClick={() => setInputVisible(false)}\r\n          >\r\n            <i className=\"iconfont fs-11\">&#xe637;</i>\r\n          </div>\r\n          <div className=\"flex-row space-between\">\r\n            {[0, 0, 0, 0, 0, 0].map((item: any, index: any) => {\r\n              return (\r\n                <input\r\n                  type=\"password\"\r\n                  maxLength={1}\r\n                  minLength={1}\r\n                  key={index}\r\n                  ref={inputs[index]}\r\n                  value={passwords[index]}\r\n                  onChange={(e: any) => {\r\n                    // console.log(e)\r\n                  }}\r\n                  onClick={(e: any) => {\r\n                    // @ts-ignore\r\n                    inputs[focus].current.focus();\r\n                  }}\r\n                  onKeyDown={(e: any) => {\r\n                    // alert(e.keyCode)\r\n                    const p = [...passwords];\r\n                    if ([46,8, 229].includes(e.keyCode) && index > 0 && isNaN(parseInt(p[index]))) {\r\n                      // @ts-ignore\r\n                      if (inputs[index - 1]) {\r\n                        // @ts-ignore\r\n                        inputs[index - 1].current.focus();\r\n                        setFocus(index - 1);\r\n                      }\r\n                      p[index - 1] = \"\";\r\n                      setPasswords(p);\r\n                      return;\r\n                    }\r\n                    if (!isNaN(parseInt(e.key))) {\r\n                      p[index] = e.key;\r\n\r\n                      if (inputs[index + 1]) {\r\n                        // @ts-ignore\r\n                        inputs[index + 1].current.focus();\r\n                        setFocus(index + 1);\r\n                      }\r\n                      if (index === 5) {\r\n                        const password = p.join(\"\");\r\n                        pay(password);\r\n                      }\r\n                    } else {\r\n                      p[index] = \"\";\r\n                    }\r\n                    setPasswords(p);\r\n                  }}\r\n                />\r\n              );\r\n            })}\r\n          </div>\r\n          <div className=\"flex-row space-around password-forget pb-30\">\r\n            忘记密码\r\n          </div>\r\n        </Modal>\r\n        <div className=\" pt-35 mb-40\">\r\n          <Button\r\n            type=\"primary\"\r\n            size=\"large\"\r\n            className=\"\"\r\n            onClick={() => {\r\n              setInputVisible(true);\r\n\r\n              // prompt(\r\n              //   \"输入密码\",\r\n              //   \"\",\r\n              //   [\r\n              //     { text: \"取消\" },\r\n              //     { text: \"提交\", onPress: (password) => pay(password) },\r\n              //   ],\r\n              //   \"secure-text\"\r\n              // );\r\n            }}\r\n          >\r\n            {loading ? (\r\n              <span>\r\n                支付中...\r\n                <Spin />\r\n              </span>\r\n            ) : (\r\n              \"立即支付\"\r\n            )}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n}\r\n","import { Graph } from \"@antv/x6\";\r\nimport React, { useState, useEffect } from \"react\";\r\nimport { forEach } from \"lodash\";\r\n\r\ninterface GraphProps {\r\n  policy: any;\r\n  children?: any;\r\n}\r\n\r\nexport default function (props: GraphProps) {\r\n  /**\r\n   * first: 面临最大问题，计算文字长短问题\r\n   * start:\r\n   */\r\n\r\n  /**\r\n   * 垂直线需要转弯\r\n   * 面向对象：\r\n   *     画板：高和宽，多少层\r\n   *     层：多少列\r\n   *     节点：在第几层第几列\r\n   *     线段：起点，终点，箭头方向\r\n   * Graph: width height\r\n   * node: {\r\n        id: \"node1\", // String，可选，节点的唯一标识\r\n        x: 40, // Number，必选，节点位置的 x 值\r\n        y: 40, // Number，必选，节点位置的 y 值\r\n        width: 80, // Number，可选，节点大小的 width 值\r\n        height: 40, // Number，可选，节点大小的 height 值\r\n        label: \"hello\", // String，节点标签\r\n      }\r\n     edges: {\r\n        source: \"node1\", // String，必须，起始节点 id\r\n        target: \"node2\", // String，必须，目标节点 id\r\n        labels: [\r\n          {\r\n            attrs: { label: { text: \"edge\" } },\r\n          },\r\n        ],\r\n      },\r\n      policyMaps, bestPyramid, betterPyramids, nodesMap， bestPyramid.maxWidth \r\n      方案：固定节点大小，字体大小？那就放不下，如何解决放不下的问题：滚动\r\n            步骤：1.固定层高和节点大小字体大小\r\n                  2.通过bestPyramid.pyramid 确定节点的id和位置和内容\r\n                  3.通过nodesMap确定线段的起始点 折线点 以及计算出是否重叠与穿过了节点。\r\n   */\r\n  const nodes: any = [];\r\n  props.policy.bestPyramid.pyramid.forEach((layer: any, yIndex: number) => {\r\n    // x 40间隙 node 宽100    y 60间隙 node搞60\r\n    layer.forEach((node: any, xIndex: number) => {\r\n      if (!node) return;\r\n      let body:any = {\r\n        fill: '#FFFFFF',\r\n        stroke: '#D4D4D4',\r\n        rx: 8,\r\n        ry: 8,\r\n        zIndex: 1\r\n      }\r\n      if(node.isAuth){\r\n        body.fill = '#E5F6EF'\r\n        body.stroke = '#8FD6B8'\r\n      }\r\n      nodes.push({\r\n        id: node.status, // String，可选，节点的唯一标识\r\n        x: xIndex * 100 + xIndex * 80 + 10, // Number，必选，节点位置的 x 值\r\n        y: yIndex * 60 + yIndex * 60 + 10, // Number，必选，节点位置的 y 值\r\n        width: 100, // Number，可选，节点大小的 width 值\r\n        height: 60, // Number，可选，节点大小的 height 值\r\n        label: node.status, // String，节点标签\r\n        zIndex: 1000,\r\n        attrs: {\r\n          body\r\n        },\r\n      });\r\n    });\r\n  });\r\n  const edges: any = []\r\n  // TODO 需要在处理数据时做，不能放在这里\r\n  props.policy.translateInfo.fsmInfos.forEach((info:any)=>{\r\n    info.eventTranslateInfos.forEach((eventInfo:any)=>{\r\n      eventInfo.used = false      \r\n    })\r\n  })\r\n  props.policy.nodesMap.forEach((node:any, key:any)=>{\r\n    // 判断source 与 target ，如果邻行且同列，不需要折线，否则都需要折线\r\n    // 折线点判断：邻行，如果从左往右画，折线点在target上方，且记录这个点，下一次需要避免这个点\r\n    //             隔行同列, 如果是中间左边列，y方向在target和source中的左边取平均，x方向在节点的左侧，同理右边\r\n    //             隔行非同列，\r\n    node.from.forEach((item:any)=>{\r\n      let text = ''\r\n      props.policy.translateInfo.fsmInfos.forEach((info:any)=>{\r\n        if(info.stateInfo.origin === item){\r\n          info.eventTranslateInfos.forEach((eventInfo:any)=>{\r\n            if(eventInfo.origin.state === key){\r\n              eventInfo.used = true\r\n              text = eventInfo.content.substr(0, eventInfo.content.lastIndexOf('，'))\r\n            }\r\n          })\r\n        }\r\n      })\r\n      edges.push({\r\n        source: item, // String，必须，起始节点 id\r\n        target: key, // String，必须，目标节点 id\r\n        labels: [\r\n          {\r\n            attrs: { label: { text } },\r\n          },\r\n        ],\r\n        attrs: {\r\n          line: {\r\n            stroke: \"#979797\", // 指定 path 元素的填充色\r\n          },\r\n        },\r\n        // connector: {\r\n        //     name: 'rounded',\r\n        //     args: {},\r\n        //   },\r\n        // vertices: [\r\n        //   { x: 300, y: 180 },\r\n        // ],\r\n      })\r\n    })\r\n    node.to.forEach((item:any)=>{\r\n      let text = ''\r\n      props.policy.translateInfo.fsmInfos.forEach((info:any)=>{\r\n        if(info.stateInfo.origin === key){\r\n          info.eventTranslateInfos.forEach((eventInfo:any)=>{\r\n            if(eventInfo.origin.state === item){\r\n              eventInfo.used = true\r\n              text = eventInfo.content.substr(0, eventInfo.content.lastIndexOf('，'))\r\n            }\r\n          })\r\n        }\r\n      })\r\n      edges.push({\r\n        source: key, // String，必须，起始节点 id\r\n        target: item, // String，必须，目标节点 id\r\n        labels: [\r\n          {\r\n            attrs: { label: { text } },\r\n          },\r\n        ],\r\n        attrs: {\r\n          line: {\r\n            stroke: \"#979797\", // 指定 path 元素的填充色\r\n          },\r\n        },\r\n        // connector: {\r\n        //     name: 'rounded',\r\n        //     args: {},\r\n        //   },\r\n        // vertices: [\r\n        //   { x: 300, y: 180 },\r\n        // ],\r\n      })\r\n    })\r\n  })\r\n  const data = {\r\n\r\n    // 边\r\n    edges: [\r\n      ...edges\r\n      // {\r\n      //   source: \"node2\", // String，必须，起始节点 id\r\n      //   target: \"node1\", // String，必须，目标节点 id\r\n      //   labels: [\r\n      //     {\r\n      //       attrs: { label: { text: \"edge33\" } },\r\n      //     },\r\n      //   ],\r\n      //   connector: {\r\n      //       name: 'rounded',\r\n      //       args: {},\r\n      //     },\r\n      //   vertices: [\r\n      //     { x: 300, y: 180 },\r\n      //   ],\r\n      // }\r\n    ],\r\n        // 节点\r\n        nodes,\r\n  };\r\n  useEffect(() => {\r\n    const graph = new Graph({\r\n      // @ts-ignore\r\n      container: document.getElementById(props.policy.policyId),\r\n      width: 800,\r\n      height: 600,\r\n      // frozen: true,\r\n      panning: false,\r\n      interacting: {\r\n        nodeMovable: false,\r\n        edgeMovable: false,\r\n      },\r\n    });\r\n    graph.fromJSON(data);\r\n  });\r\n\r\n  return (\r\n    <div className=\"w-100x h-100x x-auto y-auto \">\r\n      <div id={props.policy.policyId} className=\"  w-100x  x-auto y-auto\"></div>\r\n    </div>\r\n  );\r\n}\r\n","interface CodeProps {\r\n  policyText: any;\r\n  children?: any;\r\n} \r\nexport default function (props:CodeProps ) {\r\n   \r\n  return (\r\n     <div  className=\"fs-14 lh-24 fw-regular fc-main py-10\">{props.policyText}</div>\r\n  );\r\n}\r\n","interface CotentProps {\r\n  translateInfo: any;\r\n  children?: any;\r\n}  \r\nexport default function (props:CotentProps) {\r\n   \r\n  return (\r\n     <pre className=\"fs-14 lh-24 fw-regular fc-main\">{props.translateInfo.content}</pre>\r\n  );\r\n}\r\n","import { Radio, Input, Space } from \"antd\";\r\nimport { useState, useEffect } from \"react\";\r\nimport Pay from \"../event/pay\";\r\nimport \"./contract.scss\";\r\nimport { DownOutlined, UpOutlined } from \"@ant-design/icons\";\r\nimport PolicyGraph from \"../policy/_components/policyGraph\";\r\nimport PolicyCode from \"../policy/_components/policyCode\";\r\nimport PolicyContent from \"../policy/_components/policyContent\";\r\nimport { Tabs, WhiteSpace, Badge, Button } from \"antd-mobile\";\r\nvar moment = require(\"moment\");\r\n/**\r\n * 事件执行后：分情况，如果是获得授权的事件，那就是---获得授权后\r\n */\r\ninterface ItemProps {\r\n  policy: any;\r\n  contract: any;\r\n  children?: any;\r\n  paymentFinish: any;\r\n  [propName: string]: any;\r\n}\r\nconst tabs = [\r\n  { title: <Badge>合约流转记录</Badge> },\r\n  { title: <Badge>策略内容</Badge> },\r\n  { title: <Badge>状态机视图</Badge> },\r\n  { title: <Badge>策略代码</Badge> },\r\n];\r\nexport default function (props: ItemProps) {\r\n  const [eventIndex, setEventIndex] = useState(-1);\r\n  const [unfold, setUnFold] = useState(false);\r\n  const [argsMap, setArgsMap] = useState<Map<any, any>>(new Map());\r\n  const [authClass, setAuthClass] = useState(\"bg-auth-non\");\r\n  const [authStatus, setAuthStatus] = useState(\"未授权\");\r\n  const [currentStatus, setCurrentStatus] = useState({\r\n    eventTranslateInfos: [{ origin: { args: { amount: \"\" } } }],\r\n  });\r\n  const [isModalVisible, setIsModalVisible] = useState(false);\r\n  useEffect(() => {\r\n    const argsMap = new Map();\r\n    props.contract.fsmDeclarations.envArgs?.forEach((item: any) => {\r\n      argsMap.set(item.name, item);\r\n    });\r\n    setArgsMap(argsMap);\r\n    let authClass = \"bg-auth-end\";\r\n    let authStatus = \"已终止\";\r\n    if (props.contract.status !== 1) {\r\n      authStatus = \"未授权\";\r\n      authClass = \"bg-auth-non\";\r\n      if (props.contract.authStatus === 2 && window.isTest) {\r\n        authStatus = \"已授权\";\r\n        authClass = \"bg-auth\";\r\n      } else if (props.contract.authStatus === 1) {\r\n        authStatus = \"已授权\";\r\n        authClass = \"bg-auth\";\r\n      }\r\n    }\r\n    setAuthStatus(authStatus);\r\n    setAuthClass(authClass);\r\n    props.contract.policyInfo.translateInfo.fsmInfos.some((item: any) => {\r\n      if (item.stateInfo.origin === props.contract.fsmCurrentState) {\r\n        let tec = 0; // TransactionEventCount\r\n        item.eventTranslateInfos.forEach((event: any) => {\r\n          if (event.origin.name === \"TransactionEvent\") tec++;\r\n          props.contract.policyInfo.translateInfo.fsmInfos.some(\r\n            (state: any) => {\r\n              if (state.stateInfo.origin === event.origin.state) {\r\n                event.nextState = {\r\n                  ...state,\r\n                  ...props.contract.policyInfo.fsmDescriptionInfo[\r\n                    event.origin.state\r\n                  ],\r\n                };\r\n                return true;\r\n              }\r\n            }\r\n          );\r\n        });\r\n\r\n        const currentSatus = {\r\n          tec,\r\n          status: props.contract.fsmCurrentState,\r\n          ...item,\r\n          ...props.contract.policyInfo.fsmDescriptionInfo[\r\n            props.contract.fsmCurrentState\r\n          ],\r\n        };\r\n        // @ts-ignore\r\n        setCurrentStatus(currentSatus);\r\n        return true;\r\n      }\r\n    });\r\n  }, [props.contract]);\r\n  function onChange(e: any) {\r\n    setEventIndex(parseInt(e.target.value));\r\n  }\r\n  function payEvent(index?: number) {\r\n    typeof(index) !=\"undefined\" && setEventIndex(index)\r\n    setIsModalVisible(true);\r\n  }\r\n  function paymentFinish(status: number) {\r\n    if (status === 2) {\r\n      setIsModalVisible(false);\r\n    }\r\n    props.paymentFinish();\r\n  }\r\n  return (\r\n    <div className=\"flex-column brs-10 b-1 mx-10 mt-15 pb-12 contract-card\">\r\n      {eventIndex > -1 && (\r\n        <Pay\r\n          contractId={props.contract.contractId}\r\n          subjectName={props.contract.subjectName}\r\n          contractName={props.contract.contractName}\r\n          paymentFinish={paymentFinish}\r\n          // @ts-ignore\r\n          receiver={\r\n            argsMap.get(\r\n              // @ts-ignore\r\n              currentStatus.eventTranslateInfos[eventIndex].origin.args.account\r\n            ).ownerName\r\n          }\r\n          // @ts-ignore\r\n          eventId={currentStatus.eventTranslateInfos[eventIndex].origin.id}\r\n          // @ts-ignore\r\n          transactionAmount={\r\n            currentStatus.eventTranslateInfos[eventIndex].origin.args.amount\r\n          }\r\n          isModalVisible={isModalVisible}\r\n          setIsModalVisible={setIsModalVisible}\r\n        ></Pay>\r\n      )}\r\n      <div className=\"flex-row  p-15\">\r\n        <div className=\"flex-1 text-ellipsis fc-main fs-16 fw-bold lh-33\">\r\n          {props.contract.contractName}\r\n        </div>\r\n        {/* <div className=\"policy-button cur-pointer  shrink-0 select-none\">策略内容</div> */}\r\n      </div>\r\n      <Tabs\r\n        tabs={tabs}\r\n        initialPage={0}\r\n        onChange={(tab, index) => {\r\n          console.log(\"onChange\", index, tab);\r\n        }}\r\n        onTabClick={(tab, index) => {\r\n          console.log(\"onTabClick\", index, tab);\r\n        }}\r\n      >\r\n        <div className=\"px-15\">\r\n          {/* 状态整体 */}\r\n          <div className=\"status-card p-15 mt-15\">\r\n            <div className=\"flex-row\">\r\n              <div\r\n                className={\"auth-status text-center select-none \" + authClass}\r\n              >\r\n                {authStatus}\r\n              </div>\r\n              <div className=\"auth-time\">\r\n                {moment(props.contract.updateDate).format(\"YYYY-MM-DD HH:mm\")}\r\n              </div>\r\n            </div>\r\n            <div className=\"flex-row py-10 space-between align-center\">\r\n              <div className=\"contract-tip fs-12\">\r\n                当前无授权，请选择执行事件\r\n              </div>\r\n\r\n              {\r\n                // @ts-ignore\r\n                currentStatus.tec > 1 && (\r\n                  <Button\r\n                    type=\"primary\"\r\n                    size=\"small\"\r\n                    className=\"fs-12\"\r\n                    disabled={eventIndex === -1}\r\n                    onClick={() => {\r\n                      payEvent();\r\n                    }}\r\n                  >\r\n                    支付\r\n                  </Button>\r\n                )\r\n              }\r\n            </div>\r\n            {/* 可选事件 */}\r\n            <div>\r\n                <div className=\"flex-column\">\r\n                  {\r\n                    // @ts-ignore\r\n                    currentStatus.eventTranslateInfos &&\r\n                      // @ts-ignore\r\n                      currentStatus.eventTranslateInfos.map(\r\n                        (event: any, index: number) => {\r\n                          // origin.id  name\r\n                          return (\r\n                            <div\r\n                              className={\r\n                                \"event-card p-10 mt-10 flex-row \" +\r\n                                (index !== eventIndex ? \"\" : \"event-selected\")\r\n                              }\r\n                              key={index}\r\n                            >\r\n                              <input\r\n                               // @ts-ignore\r\n                                className={currentStatus.tec === 1? \"mt-8\" : \"mt-4\"}\r\n                                type=\"radio\"\r\n                                checked={index === eventIndex}\r\n                                onChange={onChange}\r\n                                id={event.origin.id}\r\n                                name={props.contract.contractId}\r\n                                value={index}\r\n                                disabled={\r\n                                  event.origin.name !== \"TransactionEvent\"\r\n                                }\r\n                              />\r\n                              <label htmlFor={event.origin.id}>\r\n                                <div className=\"flex-row event flex-wrap align-center  justify-end\">\r\n                                  <div className=\"mx-10 flex-row align-center pe-none flex-wrap flex-1\">\r\n                                    <span className=\"mr-10 \">{event.content}</span>\r\n                                    <span className=\"auth shrink-0\">\r\n                                      {event.nextState && event.nextState.isAuth\r\n                                        ? \"获得授权\"\r\n                                        : \"\"}\r\n                                    </span>\r\n                                  </div>\r\n                                  {\r\n                                    // @ts-ignore\r\n                                    currentStatus.tec === 1 &&\r\n                                      event.origin.name ===\r\n                                        \"TransactionEvent\" && (\r\n                                        <Button\r\n                                          type=\"primary\"\r\n                                          size=\"small\"\r\n                                          // disabled={index !== eventIndex}\r\n                                          className=\"fs-12  shrink-0 \"\r\n                                          onClick={() => {\r\n                                            payEvent(index);\r\n                                          }}\r\n                                        >\r\n                                          支付\r\n                                        </Button>\r\n                                      )\r\n                                  }\r\n                                </div>\r\n                                {/* 执行完成后下一个状态的所有事件 */}\r\n                                <div className=\"flex-column event-next pt-5 ml-12 pe-none\">\r\n                                  {/** 事件执行后：分情况，如果是获得授权的事件，那就是---获得授权后\r\n                                   * event.origin.state\r\n                                   */}\r\n                                  <div className=\"event-next\">\r\n                                    {event.nextState && event.nextState.isAuth\r\n                                      ? \"获得授权后\"\r\n                                      : \"执行成功后:\"}\r\n                                  </div>\r\n                                  {event.nextState &&\r\n                                    event.nextState.eventTranslateInfos.map(\r\n                                      (nextEvent: any, index: number) => {\r\n                                        return (\r\n                                          <div\r\n                                            key={index}\r\n                                            className=\"flex-row align-center\"\r\n                                          >\r\n                                            <div className=\"event-dot mr-5\"></div>\r\n                                            <span>{nextEvent.content}</span>\r\n                                          </div>\r\n                                        );\r\n                                      }\r\n                                    )}\r\n                                </div>\r\n                              </label>\r\n                            </div>\r\n                          );\r\n                        }\r\n                      )\r\n                  }\r\n                </div>\r\n            </div>\r\n            <div className=\"fluent-record text-align-center cur-pointer select-none mt-20\">\r\n              {!unfold ? (\r\n                <div\r\n                  onClick={(e) => {\r\n                    setUnFold(true);\r\n                  }}\r\n                >\r\n                  展开流转记录 <DownOutlined />\r\n                </div>\r\n              ) : (\r\n                <div\r\n                  onClick={(e) => {\r\n                    setUnFold(false);\r\n                  }}\r\n                >\r\n                  收起流转记录 <UpOutlined />\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n          <div className=\"contract-code pt-12\">\r\n            <div>合同编号： {props.contract.contractId}</div>\r\n            <div>\r\n              签约时间：\r\n              {moment(props.contract.updateDate).format(\"YYYY-MM-DD HH:mm\")}\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"px-15\">\r\n          <PolicyContent\r\n            translateInfo={props.policy.translateInfo}\r\n          ></PolicyContent>\r\n        </div>\r\n        <div className=\"px-15\">\r\n          <PolicyGraph policy={props.policy}></PolicyGraph>\r\n        </div>\r\n        <div className=\"px-15\">\r\n          <PolicyCode policyText={props.policy.policyText}></PolicyCode>\r\n        </div>\r\n      </Tabs>\r\n    </div>\r\n  );\r\n}\r\n","import PolicyGraph from \"./_components/policyGraph\";\r\nimport PolicyCode from \"./_components/policyCode\";\r\nimport { useState, useEffect } from \"react\";\r\nimport { SUCCESS } from \"../../../bridge/event\";\r\n\r\nimport PolicyContent from \"./_components/policyContent\";\r\nimport { getCurrentUser } from \"../../../platform/structure/utils\";\r\nimport user from \"../../../services/api/modules/user\";\r\nimport frequest from \"../../../services/handler\";\r\nimport { Checkbox } from \"antd\";\r\nimport { Tabs, Badge, Modal, Button } from \"antd-mobile\";\r\n\r\nconst alert = Modal.alert;\r\nconst prompt = Modal.prompt;\r\n\r\ninterface ItemProps {\r\n  policy: any;\r\n  selectType: boolean;\r\n  policySelect: any;\r\n  seq: number;\r\n  loginFinished: any;\r\n  setModalType: any;\r\n  getAuth: any;\r\n  children?: any;\r\n}\r\nconst tabs = [\r\n  { title: <Badge>策略内容</Badge> },\r\n  { title: <Badge>状态机视图</Badge> },\r\n  { title: <Badge>策略代码</Badge> },\r\n];\r\nexport default function (props: ItemProps) {\r\n  const [visible, setVisible] = useState(false);\r\n  function callback(key: any) {}\r\n  function onChange(e: any) {\r\n    console.log(e);\r\n    props.policySelect(props.policy.policyId, e.target.checked);\r\n  }\r\n  async function confirm(id: any) {\r\n    props.getAuth(id);\r\n  }\r\n\r\n  function cancel() {\r\n    props.policySelect();\r\n  }\r\n  const login = async (loginName: string, password: string) => {\r\n    const values: any = {\r\n      loginName,\r\n      password,\r\n      isRemember: 1,\r\n    }\r\n    // loginName: \"string\",\r\n    //   password: \"string\",\r\n    //   isRemember: \"string\",\r\n    //   returnUrl: \"string\",\r\n    //   jwtType: \"string\",\r\n\r\n    values.isRemember = values.isRemember ? 1 : 0;\r\n    const res = await frequest(user.login, \"\", values);\r\n    if (res.data.errCode === 0) {\r\n      props.loginFinished(SUCCESS, res.data.data);\r\n    }\r\n  };\r\n  return (\r\n    <div className=\"flex-column brs-10 b-1 mx-10 mt-15\">\r\n      {/* 上：策略名称与操作 */}\r\n      <div className=\"flex-row space-between px-15 py-15\">\r\n        <div className=\"flex-1 text-ellipsis fc-main fs-16 fw-bold\">\r\n          {props.policy.policyName}\r\n        </div>\r\n        {props.selectType ? (\r\n          <Button\r\n            type=\"primary\"\r\n            size=\"small\"\r\n            onClick={() => {\r\n              if(!getCurrentUser()){\r\n                props.setModalType(1)\r\n                return\r\n                prompt(\r\n                  '登录',\r\n                  '',\r\n                  (name, password) => {name && password && login(name, password)},\r\n                  'login-password',\r\n                  '',\r\n                  ['输入用户名', '输入密码'],\r\n                );\r\n                return\r\n              }\r\n              props.policySelect(props.policy.policyId, true, true);\r\n              setTimeout(() => {\r\n                alert(\"签约\",\"确定使用策略 \" + props.policy.policyName + \" 与资源签约？\", [\r\n                  { text: \"取消\", onPress: () => cancel() },\r\n                  {\r\n                    text: \"确定\",\r\n                    onPress: () => confirm(props.policy.policyId),\r\n                  },\r\n                ]);\r\n              }, 0);\r\n            }}\r\n          >\r\n            {getCurrentUser() ? \"签约\" : \"请登录\"}\r\n          </Button>\r\n        ) : (\r\n          <Checkbox onChange={onChange}></Checkbox>\r\n        )}\r\n      </div>\r\n      {/* 下：tab */}\r\n      <div className=\"flex-column\">\r\n        <Tabs\r\n          tabs={tabs}\r\n          initialPage={0}\r\n          onChange={(tab, index) => {\r\n            console.log(\"onChange\", index, tab);\r\n          }}\r\n          onTabClick={(tab, index) => {\r\n            console.log(\"onTabClick\", index, tab);\r\n          }}\r\n        >\r\n          <div className=\"px-15\">\r\n            <PolicyContent\r\n              translateInfo={props.policy.translateInfo}\r\n            ></PolicyContent>\r\n          </div>\r\n          <div>\r\n            <PolicyGraph policy={props.policy}></PolicyGraph>\r\n          </div>\r\n          <div className=\"px-15\">\r\n            <PolicyCode policyText={props.policy.policyText}></PolicyCode>\r\n          </div>\r\n        </Tabs>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","/**\r\n * 节点集合\r\n * {\r\n *   row: 0,    // 固定的\r\n *   column: 0, //在不同排列中不同\r\n *   relations: []\r\n * }\r\n */\r\n \r\ninterface Node {\r\n  row: number;\r\n  column: number;\r\n  relations: Array<string>;\r\n  to: Array<string>;\r\n  from: Array<string>;\r\n  route: Array<string>;\r\n}\r\nlet nodesMap = new Map<any, Node>();\r\n\r\nfunction getRouteMaps(policy: any): any {\r\n  /**\r\n   * 数据结构：\r\n   *   节点：状态本身和层级，下一状态的集合\r\n   *   路径：每一个\r\n   *   金字塔：二维数组，记录每个节点的层级\r\n   * 1.找到所有路径\r\n   * 2.明确层级\r\n   *   2.1 以初始状态往下找到所有层（遇环停止且不记录）\r\n   *   2.2 向上去重\r\n   */\r\n  const policyMaps: any = [];\r\n  function findNext(status: any, route: any) {\r\n    // 准备下一层的\r\n    status.transitions.forEach((to: any, index: number) => {\r\n      // cycle test\r\n      let isExist = route.some((x: any) => x[0] === to.toState);\r\n      const event = to;\r\n      // prepare for next route\r\n      const nextRoute = [...route];\r\n      nextRoute.push([to.toState, event, policy[to.toState]]);\r\n      if (isExist) {\r\n        policyMaps.push(nextRoute);\r\n        return;\r\n      }\r\n      // route end\r\n      if (!policy[to.toState].transitions.length) {\r\n        policyMaps.push(nextRoute);\r\n        return;\r\n      }\r\n      // next route  同层往下都携带同一个下一层nextLevel\r\n      findNext(policy[to.toState], nextRoute);\r\n    });\r\n  }\r\n  if (!policy.initial.transitions) {\r\n    return [[[\"initial\", \"\", policy.initial]]];\r\n  }\r\n  findNext(policy.initial, [[\"initial\", \"\", policy.initial]]);\r\n  return policyMaps\r\n}\r\n/**\r\n * 分层工具  同时记录节点信息\r\n * @param policy\r\n * 如果ba\r\n */\r\n\r\nfunction getPyramid(policy: any): any {\r\n  const pyramid: any = []\r\n  function findNextLevel(level: number) {\r\n    const currentLevel = pyramid[level] || []\r\n    // console.log('currentLevel', currentLevel, pyramid[level - 1])\r\n    // 遍历上层的所有节点\r\n    pyramid[level - 1].forEach((pre: any) => {\r\n      // 拿出节点信息 \r\n      const nodeData = nodesMap.get(pre.status) || {\r\n        row: 0,\r\n        column: 0,\r\n        relations: [],\r\n        route: ['initial'],\r\n        to: [],\r\n        from: []\r\n      };\r\n      pre.transitions.forEach((next: any, index: number) => {\r\n        // if(next.toState === 'g') console.log(nodeData)\r\n        // 拿出节点信息\r\n        const toNodeData = nodesMap.get(next.toState) || {\r\n          row: 0,\r\n          column: 0,\r\n          relations: [],\r\n          route: [],\r\n          to: [],\r\n          from: []\r\n        };\r\n        // @ts-ignore 先考虑relations中有没有出现过，如果出现过就是环，则忽略\r\n        // 这里有问题，并没有一直往上找，而是只找了上级\r\n        if (nodeData.route.includes(next.toState)) {\r\n          // /  !nodeData.to.includes(next.toState) && nodeData.to.push(next.toState);\r\n          nodeData.to.push(next.toState);\r\n          // 反转,即面向对象，忽略箭头，此时pre与next也建立连接\r\n          if(!nodeData.relations.includes(next.toState)){\r\n            nodeData.relations.push(next.toState);\r\n          }  \r\n          return\r\n        }\r\n        \r\n        // 保存上层过来的对应节点\r\n        toNodeData.from.push(pre.status);\r\n        if(!toNodeData.relations.includes(pre.status)){\r\n          toNodeData.relations.push(pre.status);\r\n        }\r\n        toNodeData.row = level; // 此时的层是准确的，在后面向上去重也不会影响，因为会保留最后一个\r\n        // 需要去重，这里是所有到达此节点的路径节点\r\n        toNodeData.route = [...nodeData.route, ...toNodeData.route, next.toState] // 节点自己以及上级的route\r\n        nodesMap.set(next.toState, toNodeData)\r\n        // 再考虑同层去重\r\n        if (!(currentLevel.some((item: any) => item.status === next.toState))) {\r\n          currentLevel.push({ status: next.toState, ...policy[next.toState] })\r\n        }\r\n      })\r\n    })\r\n    if (!currentLevel.length) return\r\n    pyramid[level] = currentLevel\r\n    findNextLevel(level + 1)\r\n  }\r\n  // 第一层已经有了\r\n  pyramid.push([{ status: \"initial\", ...policy.initial }]);\r\n  // 开始找第一层的所有子节点即第二层\r\n  findNextLevel(1);\r\n  let maxWidth = 0\r\n  // 向上去重\r\n  for (let aRow = pyramid.length - 1; aRow > 0; aRow--) {\r\n    const layer = pyramid[aRow];\r\n    maxWidth < layer.length && (maxWidth = layer.length)\r\n    // 选一个a并比较当层和上面所有层的中列大于a的\r\n    layer.forEach((a: any, aColumn: number) => {\r\n      // 同层已经没有重复的了\r\n      for (let bRow = aRow - 1; bRow > -1; bRow--) {\r\n        pyramid[bRow] = pyramid[bRow].filter((b: any, bColumn: number) => b.status !== a.status);\r\n      }\r\n    });\r\n  }\r\n  maxWidth < pyramid[0].length && (maxWidth = pyramid[0].length)\r\n  return { policyPyramid: pyramid, maxWidth }\r\n}\r\n// @ts-ignore\r\nArray.prototype.equals = function (array: any) {\r\n  // if the other array is a falsy value, return\r\n  if (!array) return false;\r\n\r\n  // compare lengths - can save a lot of time\r\n  if (this.length != array.length) return false;\r\n\r\n  for (var i = 0, l = this.length; i < l; i++) {\r\n    // Check if we have nested arrays\r\n    if (this[i] instanceof Array && array[i] instanceof Array) {\r\n      // recurse into the nested arrays\r\n      if (!this[i].equals(array[i])) return false;\r\n    } else if (this[i] != array[i]) {\r\n      // Warning - two different object instances will never be equal: {x:20} != {x:20}\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n};\r\n// Hide method from for-in loops\r\nObject.defineProperty(Array.prototype, \"equals\", { enumerable: false });\r\n/**\r\n *\r\n * @param contents 去重\r\n * @returns\r\n */\r\nfunction norepeat(contents: any) {\r\n  var norepeatContents = [];\r\n  for (var i = 0; i < contents.length; i++) {\r\n    const flag = norepeatContents.some((item: any) => {\r\n      return item.equals(contents[i]);\r\n    });\r\n    if (!flag) {\r\n      norepeatContents.push(contents[i]);\r\n    }\r\n  }\r\n  return norepeatContents;\r\n}\r\n\r\n/**\r\n *\r\n * @param 全排列\r\n */\r\nfunction fullSort(input: any) {\r\n  var permArr: any = [],\r\n    usedChars: any = [];\r\n  function main(input: any) {\r\n    var i, ch;\r\n    for (i = 0; i < input.length; i++) {\r\n      ch = input.splice(i, 1)[0];\r\n      usedChars.push(ch);\r\n      if (input.length == 0) {\r\n        permArr.push(usedChars.slice());\r\n      }\r\n      main(input);\r\n      input.splice(i, 0, ch);\r\n      usedChars.pop();\r\n    }\r\n    return permArr;\r\n  }\r\n  return main(input);\r\n}\r\n\r\n/**\r\n * 找到在第几列\r\n * @param status\r\n * @param pyramid\r\n * @returns\r\n */\r\nfunction getColumn(status: string, pyramid: any) {\r\n  let column = 0;\r\n  pyramid.some((item: any) => {\r\n    return item.some((node: any, index: number) => {\r\n      column = index;\r\n      return node && node.status === status;\r\n    });\r\n  });\r\n  return column;\r\n}\r\n/**\r\n * 计算所有交叉\r\n */\r\nfunction getCrosses(pyramid: any): number {\r\n  let cross = 0;\r\n  // 从最后一层开始\r\n  for (let aRow = pyramid.length - 1; aRow > -1; aRow--) {\r\n    const layer = pyramid[aRow];\r\n    // 选一个a并比较当层和上面所有层的中列大于a的\r\n    layer.forEach((a: any, aColumn: number) => {\r\n      if (!a) return;\r\n      const aNode = nodesMap.get(a.status);\r\n      for (let bRow = aRow; bRow > -1; bRow--) {\r\n        pyramid[bRow].forEach((b: any, bColumn: number) => {\r\n          // a后面的列才判断\r\n          if (bColumn > aColumn && b) {\r\n            const bNode = nodesMap.get(b.status);\r\n            // 此处都是上层  如果存在b的relations中的节点 c 的 column小于a的relations中d的column, 且b的row小于d的row\r\n            // 但是如果是同样的列，会出现重叠，解决方案：1.此处要找出重叠  2.绘图时如果不从同一点画两条线且以折线方式\r\n            // 选用方案2\r\n            bNode?.relations.forEach((c: string) => {\r\n              const cColumn = getColumn(c, pyramid);\r\n              aNode?.relations.forEach((d: string) => {\r\n                const dRow = nodesMap.get(d);\r\n                // @ts-ignore  如果是大于bRow的就是ad与bc无法产生交叉，因为bc的层都在ad上\r\n                if (dRow?.row >= bRow) return;\r\n                const dColumn = getColumn(d, pyramid);\r\n                if (cColumn < dColumn) cross++;\r\n              });\r\n            });\r\n          }\r\n        });\r\n      }\r\n    });\r\n  }\r\n  return cross;\r\n}\r\n\r\n/**\r\n * 1.分层并记录节点信息  getPyramid\r\n * 2.按最大层，排列组合 找出最少交叉\r\n * @param data\r\n */\r\nexport default function getBestTopology(data: any): any {\r\n  nodesMap = new Map<any, Node>();\r\n  // 最少交叉的金字塔\r\n  let bestPyramid: any = null;\r\n\r\n  /**\r\n   * 如果出现多个最少交叉的，先按交叉数保存起来，最后再取出跟bestPyramid交叉数一样的\r\n   * 此对象数组中不包含bestPyramid中的pyramid\r\n   * {\r\n   *   0:[],\r\n   *   1:[],\r\n   * }\r\n   */\r\n  let betterPyramids: any = {};\r\n  // bestPyramid betterPyramids\r\n  const { policyPyramid, maxWidth } = getPyramid(data);\r\n  // console.log(nodesMap, policyPyramid)\r\n  // return\r\n  /**\r\n   * 每一层所有组合方式，与其余层所有组合方式再组合\r\n   */\r\n  // 三维数组\r\n  const allLevel: any = [];\r\n  policyPyramid.forEach((item: any) => {\r\n    const arr = [...item];\r\n    for (var i = item.length; i < maxWidth; i++) {\r\n      arr[i] = null;\r\n    }\r\n    // 每一层没有重复组合的\r\n    allLevel.push(norepeat(fullSort(arr)));\r\n  });\r\n  // console.log('allLevel', allLevel);\r\n  let count = 0\r\n  // 从每一层取一个  深度优先\r\n  function compose(nextLevel: any, index: number, _pyramid: any) {\r\n    nextLevel.forEach((layer: any, i: number) => {\r\n      // 取一个\r\n      const pyramid = [..._pyramid]\r\n      pyramid.push(layer);\r\n      if (index + 1 === allLevel.length) {\r\n        // getCross for this tower      bestPyramid    betterPyramids\r\n        const crosses = getCrosses(pyramid);\r\n        if (!crosses) {\r\n          count++\r\n        }\r\n        if (!bestPyramid || crosses < bestPyramid.crosses) {\r\n          bestPyramid = {\r\n            crosses,\r\n            pyramid,\r\n          };\r\n          betterPyramids = {};\r\n        } else if (crosses === bestPyramid.crosses) {\r\n          const arr = (betterPyramids[crosses] || [])\r\n          arr.push(pyramid);\r\n          betterPyramids[crosses] = arr\r\n        }\r\n        return;\r\n      }\r\n      compose(allLevel[index + 1], index + 1, [...pyramid]);\r\n    });\r\n  }\r\n  // 从第一层开始\r\n  compose(allLevel[0], 0, []);\r\n  // console.log('zero', count)\r\n  const policyMaps = getRouteMaps(data)\r\n  bestPyramid.maxWidth = maxWidth\r\n  return { policyMaps, bestPyramid, betterPyramids, nodesMap };\r\n}\r\n","import { SUCCESS, USER_CANCEL } from \"../../bridge/event\";\r\nimport React, { useState, useEffect } from \"react\";\r\nimport { LOGIN } from \"../../bridge/event\";\r\nimport \"../../assets/mobile/index.scss\";\r\nimport \"./auth.scss\";\r\nimport Login from \"./user/login\";\r\nimport Forgot from \"./user/forgot\";\r\nimport Register from \"./user/register\";\r\n\r\nimport Contract from \"./contract/contract\";\r\nimport Policy from \"./policy/policy\";\r\nimport frequest from \"../../services/handler\";\r\nimport presentable from \"../../services/api/modules/presentable\";\r\nimport Confirm from \"./_components/confirm\";\r\nimport { setUserInfo } from \"../../platform/structure/utils\";\r\nimport { loginCallback } from \"../../platform/structure/event\";\r\nimport contract from \"../../services/api/modules/contract\";\r\nimport { getCurrentUser } from \"../../platform/structure/utils\";\r\nimport getBestTopology from \"./topology/data\";\r\nimport { Modal, Button, WhiteSpace, WingBlank, Toast } from \"antd-mobile\";\r\nconst alert = Modal.alert;\r\n\r\ninterface contractProps {\r\n  events: Array<any>;\r\n  contractFinished(eventId: any, type: number, data?: any): any;\r\n  loginFinished: any;\r\n  children?: any;\r\n  updateEvents: any;\r\n}\r\nexport default function (props: contractProps) {\r\n  /**\r\n   * 对象形式authDatas：\r\n   *   key: subjectId\r\n   *   value: { policies: {policyId: }, contracts: {contractId: }，}\r\n   * 在合约里面通过策略拿翻译\r\n   * 流程：\r\n   *     未授权过来需要整合数据\r\n  *       widget: caller.name,\r\n          errCode: response.data.errCode,\r\n          authCode: response.data.data.authCode,\r\n          contracts: response.data.data.data.contracts,\r\n          policies: response.data.data.data.policies,\r\n          presentableName,\r\n          presentableId,\r\n          info: response.data,\r\n   *     点击展品：\r\n   *         1.如果有合约则请求合约\r\n   *         2.请求策略\r\n   *     签约：\r\n   *         签约后判断有无授权：\r\n   *             1.授权：直接清除events\r\n   *             2.未授权：更新events对应的数据\r\n   *     执行事件：\r\n   *             \r\n   */\r\n  const [isListVisible, setIsListVisible] = useState(false);\r\n  // 1 登陆  2 注册   3 忘记密码\r\n  const [modalType, setModalType] = useState(0);\r\n\r\n  const [contracts, setContracts] = useState([]);\r\n  const events = props.events || [];\r\n  const [currentPresentable, setCurrentPresentable] = useState(events[0]);\r\n  const [policies, setPolicies] = useState([]);\r\n  const [selectedPolicies, setSelectedPolicies] = useState<Array<any>>([]);\r\n  function closeCurrent() {\r\n    if (events.length === 1) {\r\n      // 如果只有一个，提示确定放弃签约\r\n      alert(\"提示\", \"当前展品未获得授权，确定退出？\", [\r\n        { text: \"取消\", onPress: () => {} },\r\n        {\r\n          text: \"确定\",\r\n          onPress: () => userCancel(),\r\n        },\r\n      ]);\r\n    } else {\r\n      // 否则弹出展品列表\r\n      setIsListVisible(true);\r\n    }\r\n  }\r\n  function paymentFinish() {\r\n    getDetail();\r\n  }\r\n  function loginFinished(type: number, data?: any) {\r\n    setUserInfo(data);\r\n    loginCallback.forEach((func: any) => {\r\n      func && func();\r\n    });\r\n    // TODO 重载插件需要把授权的也一并清除\r\n    setModalType(0);\r\n\r\n    props.loginFinished();\r\n  }\r\n  function showPolicy() {}\r\n  async function getDetail(id?: string) {\r\n    setSelectedPolicies([]);\r\n    // userInfo 如果不存在就是未登录\r\n    const userInfo: any = getCurrentUser();\r\n    const con =\r\n      userInfo &&\r\n      (await frequest(contract.getContracts, \"\", {\r\n        subjectIds: currentPresentable.presentableId,\r\n        subjectType: 2,\r\n        licenseeIdentityType: 3,\r\n        licenseeId: userInfo.userId,\r\n        isLoadPolicyInfo: 1,\r\n        isTranslate: 1,\r\n      }));\r\n    if (!id) {\r\n      const isAuth = con.data.data.some((item: any) => {\r\n        if ((window.isTest && item.authStatus === 2) || item.authStatus === 1) {\r\n          props.contractFinished(currentPresentable.eventId, SUCCESS);\r\n          return true;\r\n        }\r\n      });\r\n      if (!isAuth) {\r\n        props.updateEvents({ ...currentPresentable, contracts: con.data.data });\r\n      }\r\n      return;\r\n    }\r\n    const res = await frequest(\r\n      presentable.getPresentableDetail,\r\n      [id || currentPresentable.presentableId],\r\n      {\r\n        isLoadPolicyInfo: 1,\r\n        isTranslate: 1,\r\n      }\r\n    );\r\n    /**\r\n     * 获取\r\n     */\r\n\r\n    res.data.data.policies = res.data.data.policies.filter((i: any) => {\r\n      return i.status === 1;\r\n    });\r\n    res.data.data.policies.forEach((item: any) => {\r\n      const { policyMaps, bestPyramid, betterPyramids, nodesMap } =\r\n        getBestTopology(item.fsmDescriptionInfo);\r\n      item.policyMaps = policyMaps;\r\n      item.bestPyramid = bestPyramid;\r\n      item.betterPyramids = betterPyramids;\r\n      item.nodesMap = nodesMap;\r\n    });\r\n    setPolicies(res.data.data.policies);\r\n    if (con) {\r\n      const contracts = con.data.data.filter((item: any) => {\r\n        if (item.status === 0) {\r\n          res.data.data.policies.some((i: any) => {\r\n            if (item.policyId === i.policyId) {\r\n              item.policyInfo = i;\r\n              i.contracted = true;\r\n              return true;\r\n            }\r\n          });\r\n          return true;\r\n        }\r\n      });\r\n      setContracts(contracts);\r\n    }\r\n  }\r\n  useEffect(() => {\r\n    const isExist = events.some((item: any) => {\r\n      if (item.presentableId === currentPresentable.presentableId) {\r\n        setCurrentPresentable(item);\r\n        return true;\r\n      }\r\n    });\r\n    !isExist && setCurrentPresentable(events[0]);\r\n  }, [props.events]);\r\n  useEffect(() => {\r\n    currentPresentable && getDetail(currentPresentable.presentableId);\r\n  }, [currentPresentable]);\r\n\r\n  const userCancel = () => {\r\n    props.contractFinished(\"\", USER_CANCEL);\r\n  };\r\n  function policySelect(policyId: number, checked?: boolean, single?: boolean) {\r\n    if (policyId) {\r\n      if (checked) {\r\n        if (single) {\r\n          setSelectedPolicies([policyId]);\r\n        } else {\r\n          setSelectedPolicies([...selectedPolicies, policyId]);\r\n        }\r\n      } else {\r\n        setSelectedPolicies(\r\n          [...selectedPolicies].filter((item: any) => item !== policyId)\r\n        );\r\n      }\r\n    } else {\r\n      setSelectedPolicies([]);\r\n    }\r\n  }\r\n  function act() {\r\n    if (!getCurrentUser()) {\r\n      setModalType(1);\r\n      return;\r\n    }\r\n  }\r\n  const getAuth = async (id: any) => {\r\n    const subjects: any = [];\r\n    policies.forEach((item: any) => {\r\n      [...selectedPolicies, id].includes(item.policyId) &&\r\n        subjects.push({\r\n          subjectId: currentPresentable.presentableId,\r\n          policyId: item.policyId,\r\n        });\r\n    });\r\n    const userInfo: any = getCurrentUser();\r\n    const res = await frequest(contract.contracts, [], {\r\n      subjects,\r\n      subjectType: 2,\r\n      licenseeId: userInfo.userId + \"\",\r\n      licenseeIdentityType: 3,\r\n      isWaitInitial: 1,\r\n    });\r\n    if (res.data.isAuth) {\r\n    }\r\n    const isAuth = res.data.data.some((item: any) => {\r\n      if ((window.isTest && item.authStatus === 2) || item.authStatus === 1) {\r\n        Toast.success(\"获得授权\", 2);\r\n        setTimeout(() => {\r\n          props.contractFinished(currentPresentable.eventId, SUCCESS);\r\n        }, 2000);\r\n        return true;\r\n      }\r\n    });\r\n    if (!isAuth) {\r\n      Toast.success(\"签约成功\", 2);\r\n      setTimeout(() => {\r\n        props.updateEvents({ ...currentPresentable, contracts: res.data.data });\r\n      }, 2000);\r\n    }\r\n  };\r\n  return (\r\n    <div id=\"runtime-mobile\" className=\"w-100x h-100x over-h\">\r\n      {modalType === 1 ? (\r\n        <Login loginFinished={loginFinished} visible={modalType === 1} setModalType={setModalType}/>\r\n      ) : modalType === 2 ? (\r\n        <Register visible={modalType === 2} setModalType={setModalType}/>\r\n      ) : modalType === 3 ? (\r\n        <Forgot visible={modalType === 3} setModalType={setModalType}/>\r\n      ) : null}\r\n      <Modal\r\n        popup\r\n        visible={isListVisible}\r\n        maskClosable={false}\r\n        animationType=\"slide\"\r\n        wrapClassName=\"presentable-list\"\r\n      >\r\n        <div className=\"flex-row space-between px-15 py-20 list-title\">\r\n          <div className=\"list-title-name\">展品列表</div>\r\n          <div\r\n            className=\"list-exit\"\r\n            onClick={() => {\r\n              alert(\"提示\", \"当前还有展品未获得授权，确定退出？\", [\r\n                { text: \"取消\", onPress: () => {} },\r\n                {\r\n                  text: \"确定\",\r\n                  onPress: () => userCancel(),\r\n                },\r\n              ]);\r\n            }}\r\n          >\r\n            退出\r\n          </div>\r\n        </div>\r\n        {events.length\r\n          ? events.map((item: any, index: number) => {\r\n              if (item.event === LOGIN) return null;\r\n              return (\r\n                <div\r\n                  key={index}\r\n                  onClick={() => {\r\n                    setIsListVisible(false);\r\n                    setCurrentPresentable(item);\r\n                  }}\r\n                  className={\r\n                    (currentPresentable === item\r\n                      ? \"presentable-selected \"\r\n                      : \"\") +\r\n                    \" px-15 py-15 presentable-item  flex-row space-between algin-center\"\r\n                  }\r\n                >\r\n                  <div className=\"flex-1 flex-column over-h\">\r\n                    <div\r\n                      className=\"presentable-name text-ellipsis flex-1 flex-row align-center\"\r\n                      title={item.presentableName}\r\n                    >\r\n                      <span className=\"text-ellipsis\">\r\n                        {item.presentableName}\r\n                      </span>\r\n                    </div>\r\n                    {!item.contracts.length ? null : (\r\n                      <div className=\"flex-row pt-10\">\r\n                        {item.contracts.map((contract: any, index: number) => {\r\n                          return (\r\n                            <div\r\n                              className={\r\n                                \"contract-tag flex-row align-center mr-5\"\r\n                              }\r\n                              key={index}\r\n                            >\r\n                              <div className=\"contract-name\">\r\n                                {contract.contractName}\r\n                              </div>\r\n                              <div\r\n                                className={\r\n                                  \"contract-dot ml-6 \" +\r\n                                  (contract.authStatus === 128\r\n                                    ? \"bg-auth-none\"\r\n                                    : !window.isTest &&\r\n                                      contract.authStatus === 1\r\n                                    ? \"bg-auth\"\r\n                                    : \"bg-auth-none\")\r\n                                }\r\n                              ></div>\r\n                            </div>\r\n                          );\r\n                        })}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"shrink-0 text-center pl-10 fs-24\">&gt;</div>\r\n                </div>\r\n              );\r\n            })\r\n          : null}\r\n      </Modal>\r\n      <div className=\"flex-column w-100x h-100x over-h\">\r\n        <div className=\"flex-column justify-center bb-1\">\r\n          <div className=\"text-center mt-20 fs-16 fc-main fw-bold\">签约</div>\r\n          <div\r\n            className=\"p-absolute fs-16 mt-20 mr-15 rt-0 fc-blue cur-pointer\"\r\n            onClick={() => closeCurrent()}\r\n          >\r\n            {events.length === 1 ? \"退出\" : \"关闭\"}\r\n          </div>\r\n          <div className=\"text-center my-20 fs-20 fc-main fw-bold\">\r\n            {currentPresentable.presentableName}\r\n          </div>\r\n          {!currentPresentable.contracts.length ? null : (\r\n            <div className=\"flex-row justify-center mb-15\">\r\n              {currentPresentable.contracts.map(\r\n                (contract: any, index: number) => {\r\n                  return (\r\n                    <div\r\n                      className={\"contract-tag flex-row align-center mr-5\"}\r\n                      key={index}\r\n                    >\r\n                      <div className=\"contract-name\">\r\n                        {contract.contractName}\r\n                      </div>\r\n                      <div\r\n                        className={\r\n                          \"contract-dot ml-6 \" +\r\n                          (contract.authStatus === 128\r\n                            ? \"bg-auth-none\"\r\n                            : !window.isTest && contract.authStatus === 1\r\n                            ? \"bg-auth\"\r\n                            : \"bg-auth-none\")\r\n                        }\r\n                      ></div>\r\n                    </div>\r\n                  );\r\n                }\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n        <div className=\"flex-column flex-1 over-h\">\r\n          <div className=\"w-100x h-100x y-auto pb-20\">\r\n            {contracts.map((contract: any, index: number) => {\r\n              return (\r\n                <Contract\r\n                  policy={contract.policyInfo}\r\n                  contract={contract}\r\n                  paymentFinish={paymentFinish}\r\n                  key={index}\r\n                ></Contract>\r\n              );\r\n            })}\r\n            {policies.map((policy: any, index: number) => {\r\n              return policy.contracted ? null : (\r\n                <Policy\r\n                  policy={policy}\r\n                  key={index}\r\n                  seq={index}\r\n                  loginFinished={loginFinished}\r\n                  setModalType={setModalType}\r\n                  getAuth={getAuth}\r\n                  policySelect={policySelect}\r\n                  selectType={contracts.length ? true : true}\r\n                ></Policy>\r\n              );\r\n            })}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","// import logo from './logo.svg';\r\nimport \"./App.scss\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { USER_CANCEL } from \"../bridge/event\";\r\nimport Pc from \"./pc/auth\";\r\nimport Mobile from \"./mobile/auth\";\r\nimport {\r\n  reisterUI,\r\n  eventMap,\r\n  failedMap,\r\n  endEvent,\r\n  updateLock,\r\n  updateEvent,\r\n} from \"../bridge/index\";\r\n\r\nfunction App() {\r\n  const [events, setEvents] = useState([]);\r\n  const [failedEvents, setFailedEvents] = useState([]);\r\n  const [inited, setInited] = useState(false);\r\n  useEffect(() => {\r\n    updateLock(false);\r\n  }, [events]);\r\n  function loginFinished() {\r\n    eventMap.clear()\r\n    failedMap.clear()\r\n    updateEvents()\r\n  }\r\n  function backToNode() {\r\n    // @ts-ignore\r\n    const app = document.getElementById(window.rootId);\r\n    // @ts-ignore\r\n    app.style.zIndex = 0;\r\n    // @ts-ignore\r\n    app.style.opacity = 0;\r\n    // @ts-ignore\r\n    document.getElementById(\"freelog-plugin-container\").style.zIndex = 1;\r\n    setInited(false);\r\n  }\r\n  function showUI() {\r\n    // document.body.appendChild = document.body.appendChild.bind(\r\n    //   document.getElementById(window.rootId)\r\n    // );\r\n    // document.body.removeChild = document.body.removeChild.bind(\r\n    //   document.getElementById(window.rootId)\r\n    // );\r\n    // @ts-ignore\r\n    const app = document.getElementById(window.rootId);\r\n    // @ts-ignore\r\n    app.style.zIndex = 1;\r\n    // @ts-ignore\r\n    app.style.opacity = 1;\r\n    // @ts-ignore\r\n    document.getElementById(\"freelog-plugin-container\").style.zIndex = 0;\r\n  }\r\n  // 遍历顺序是否永远一致\r\n  function updateEvents(event?: any) {\r\n    const eventMap = updateEvent(event)\r\n    updateLock(true);\r\n    const arr: any = [];\r\n    eventMap.forEach((val, key) => {\r\n      arr.push(val);\r\n    });\r\n    const arr2: any = [];\r\n    failedMap.forEach((val) => {\r\n      arr2.push(val);\r\n    });\r\n    setFailedEvents(arr2);\r\n    setEvents(arr);\r\n    if (!arr.length) {\r\n      backToNode();\r\n    } else {\r\n      showUI();\r\n      setInited(true);\r\n    }\r\n  }\r\n  function UI() {\r\n    updateEvents();\r\n  }\r\n  function updateUI() {\r\n    updateEvents();\r\n  }\r\n\r\n  function contractFinished(eventId: any, type: number, data?: any) {\r\n    if (type === USER_CANCEL && !eventId) {\r\n      endEvent(eventId, type, data);\r\n      // TODO 通知所有 用户取消了\r\n      backToNode();\r\n      return;\r\n    }\r\n    endEvent(eventId, type, data);\r\n  }\r\n  reisterUI(UI, updateUI);\r\n  return (\r\n    <div id=\"freelog-app\" className=\"w-100x h-100x over-h\">\r\n      {inited ? (\r\n        !window.isMobile ? <Pc events={events} contractFinished={contractFinished} updateEvents={updateEvents} loginFinished={loginFinished}></Pc> :\r\n         <Mobile events={events}  contractFinished={contractFinished} updateEvents={updateEvents} loginFinished={loginFinished}></Mobile>\r\n      ) : (\r\n        null\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","const reportWebVitals = onPerfEntry => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import {\r\n    mountWidget, autoMoutSubWdigets\r\n} from './widget'\r\nimport { getSubDep,  getSelfId, getStaticPath, getCurrentUser, setViewport} from './utils'\r\nimport { onLogin } from './event'\r\nimport {callAuth, addAuth} from '../../bridge/index'\r\nimport {\r\n    getPresentables,\r\n    getPresentablesPaging,\r\n    getPresentablesSearch,\r\n    getInfoById,\r\n    getInfoByName,\r\n    getResultById,\r\n    getResultByName,\r\n    getFileStreamById,\r\n    getFileStreamByName,\r\n    getSubInfoById,\r\n    getSubInfoByName,\r\n    getSubResultById,\r\n    getSubResultByName,\r\n    getSubFileStreamById,\r\n    getSubFileStreamByName,\r\n    getResourceInfoById,\r\n    getResourceInfoByName,\r\n    getSubResourceInfoById,\r\n    getSubResourceInfoByName\r\n} from './api'\r\nlet devData = ''\r\nexport const freelogApp = {\r\n    mountWidget,\r\n    getPresentables,\r\n    getPresentablesPaging,\r\n    getPresentablesSearch,\r\n    getInfoById,\r\n    getInfoByName,\r\n    getResultById,\r\n    getResultByName,\r\n    getFileStreamById,\r\n    getFileStreamByName,\r\n    getSubInfoById,\r\n    getSubInfoByName,\r\n    getSubResultById,\r\n    getSubResultByName,\r\n    getSubFileStreamById,\r\n    getSubFileStreamByName,\r\n    getResourceInfoById,\r\n    getResourceInfoByName,\r\n    getSubResourceInfoById,\r\n    getSubResourceInfoByName,\r\n    devData,\r\n    getStaticPath,\r\n    autoMoutSubWdigets,\r\n    getSubDep,\r\n    getSelfId,\r\n    callAuth,\r\n    addAuth,\r\n    onLogin,\r\n    getCurrentUser,\r\n    setViewport\r\n}","import frequest from \"../../services/handler\";\r\nimport node from \"../../services/api/modules/node\";\r\nimport { getSubDep, getUserInfo } from \"./utils\";\r\nimport { freelogApp } from \"./global\";\r\nimport { init } from \"./api\";\r\nimport { dev, DEV_WIDGET } from \"./dev\";\r\nimport {LOGIN} from '../../bridge/event'\r\nimport {addAuth} from '../../bridge/index'\r\nimport { pathATag, initLocation } from './proxy'\r\n// @ts-ignore  TODO 需要控制不可改变\r\nwindow.freelogApp = freelogApp;\r\n\r\nexport function initNode() {\r\n  pathATag()\r\n  /**\r\n   * 1.resolveUrl\r\n   * 2.requestNodeInfo\r\n   * 3.requestTheme\r\n   * TODO  error resolve\r\n   * TODO title 问题\r\n   */\r\n  \r\n  return new Promise<void>(async (resolve) => {\r\n    const nodeDomain = await getDomain(window.location.host);\r\n    let nodeData = await requestNodeInfo(nodeDomain);\r\n    if(nodeData.errCode === 30){\r\n      await new Promise((resolve, reject)=>{\r\n        addAuth.bind({name: 'node', event: LOGIN})('', resolve, reject, {immediate: true})\r\n      })\r\n      nodeData = await requestNodeInfo(nodeDomain);\r\n    }\r\n    const nodeInfo = nodeData.data;\r\n    // @ts-ignore\r\n    freelogApp.nodeInfo = nodeInfo;\r\n    document.title = nodeInfo.nodeName\r\n    init();\r\n    const devData = dev();\r\n    // TODO 深度克隆\r\n    freelogApp.devData = {...devData};\r\n    Object.freeze(freelogApp)\r\n    initLocation();   \r\n    await getUserInfo()\r\n    // @ts-ignore\r\n    const container = document.getElementById(\"freelog-plugin-container\");\r\n    if (devData.type === DEV_WIDGET) {\r\n      freelogApp.mountWidget(\"\", container, {presentableId: nodeInfo.nodeThemeId, isTheme: true,}, \"\", {shadowDom: false,scopedCss: true});\r\n      return;\r\n    }\r\n    // @ts-ignore\r\n    const theme = await getSubDep.bind({ name: \"freelog-\" + nodeInfo.nodeThemeId, presentableId: nodeInfo.nodeThemeId })(nodeInfo.nodeThemeId);\r\n    freelogApp.mountWidget(\r\n      { id: theme.data.presentableId, name: theme.data.resourceInfo.resourceName },\r\n      container,\r\n      {\r\n        presentableId: theme.data.presentableId,\r\n        entityNid: \"\",\r\n        subDependId: theme.data.presentableId,\r\n        resourceInfo: { resourceId: theme.data.resourceInfo.resourceId },\r\n        isTheme: true,\r\n      },\r\n      \"\",\r\n      {shadowDom: false,scopedCss: true}\r\n    );\r\n    // new Promise<void>((resolve) => {\r\n    //   let count = 0\r\n    //   const inter = setInterval(() => {\r\n    //     count++\r\n    //     if (themeApp.getStatus() === \"MOUNTED\" || count === 25) {\r\n    //       clearInterval(inter)\r\n    //       resolve && resolve();\r\n    //     }\r\n    //   }, 200);\r\n    // }).then(() => {\r\n    //   mountSubWidgets(theme, true, resolve)\r\n    // });\r\n  });\r\n}\r\n\r\nfunction getDomain(url: string) {\r\n  if(url.split(\".\")[0] === 't'){\r\n    return url.split(\".\")[1]\r\n  }\r\n  return url.split(\".\")[0];\r\n}\r\n\r\nasync function requestNodeInfo(nodeDomain: string) {\r\n  let info = await frequest.bind({name: 'node'})(node.getInfoByNameOrDomain, \"\", { nodeDomain });\r\n  return info.data;\r\n}\r\n\r\n","// @ts-ignore\r\nimport React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport App from \"./ui/App\";\r\nimport reportWebVitals from \"./reportWebVitals\";\r\nimport { run } from \"./platform\";\r\nimport { isMobile } from \"./utils/utils\";\r\nimport zhCN from \"antd/lib/locale/zh_CN\";\r\nimport { ConfigProvider } from \"antd\";\r\nconst pcId = 'pc-root'\r\nconst mobileId = 'mobile-root'\r\nwindow.rootId = pcId\r\nif (isMobile()) {\r\n  window.isMobile = true;\r\n  window.rootId = mobileId\r\n  // @ts-ignore\r\n  document.querySelector(\"meta[name=viewport]\").content =\r\n    \"width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no\";\r\n}\r\nconsole.log('1234234234234234234234')\r\n// @ts-ignore\r\ndocument.getElementById(window.rootId).style.display = 'block';\r\nwindow.isTest = false;\r\nif (\r\n  window.location.href\r\n    .replace(\"http://\", \"\")\r\n    .replace(\"https://\", \"\")\r\n    .indexOf(\"t.\") === 0\r\n) {\r\n  window.isTest = true;\r\n}\r\ndocument.domain = \"testfreelog.com\"\r\n// @ts-ignore\r\nconsole.log(window.__REACT_ERROR_OVERLAY_GLOBAL_HOOK__)\r\n// @ts-ignore\r\n  console.log(window.parent.__REACT_ERROR_OVERLAY_GLOBAL_HOOK__)\r\nReactDOM.render(\r\n  <ConfigProvider locale={zhCN}>\r\n    <App />\r\n  </ConfigProvider>,\r\n  document.getElementById(window.rootId)\r\n);\r\n\r\n// TODO 必须ui准备好了才能让里面的addAuth生效\r\nsetTimeout(()=>{run();},0)\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n","import {initNode} from './structure/init';\r\n\r\nexport function run(){\r\n    initNode()\r\n}\r\n"],"sourceRoot":""}